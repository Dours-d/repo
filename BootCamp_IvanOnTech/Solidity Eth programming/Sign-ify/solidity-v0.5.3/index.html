

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Solidity 0.5.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="https://solidity.readthedocs.io/en/v0.5.3/" />

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'index'
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js"></script>

<!-- end RTD <extrahead> -->
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> Solidity
          

          
          </a>

          
            
            
            
              <div class="version">
                v0.5.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-introduction-to-smart-contracts">Introduction to Smart Contracts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#a-simple-smart-contract">A Simple Smart Contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blockchain-basics">Blockchain Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#index-6">The Ethereum Virtual Machine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installing-solidity">Installing the Solidity Compiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#versioning">Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#remix">Remix</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#npm-node-js">npm / Node.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#binary-packages">Binary Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#building-from-source">Building from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#cmake-options">CMake options</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#the-version-string-in-detail">The version string in detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#important-information-about-versioning">Important information about versioning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-solidity-by-example">Solidity by Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#voting">Voting</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#blind-auction">Blind Auction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#safe-remote-purchase">Safe Remote Purchase</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#micropayment-channel">Micropayment Channel</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-solidity-in-depth">Solidity in Depth</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-layout-of-source-files">Layout of a Solidity Source File</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-structure-of-a-contract">Structure of a Contract</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-types">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-units-and-global-variables">Units and Globally Available Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-control-structures">Expressions and Control Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-contracts">Contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-assembly">Solidity Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-miscellaneous">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#document-050-breaking-changes">Solidity v0.5.0 Breaking Changes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security-considerations">Security Considerations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#pitfalls">Pitfalls</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#recommendations">Recommendations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#formal-verification">Formal Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-resources">Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#solidity-integrations">Solidity Integrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#solidity-tools">Solidity Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#third-party-solidity-parsers-and-grammars">Third-Party Solidity Parsers and Grammars</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-using-the-compiler">Using the compiler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-the-commandline-compiler">Using the Commandline Compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#setting-the-evm-version-to-target">Setting the EVM version to target</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#compiler-input-and-output-json-description">Compiler Input and Output JSON Description</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-metadata">Contract Metadata</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#encoding-of-the-metadata-hash-in-the-bytecode">Encoding of the Metadata Hash in the Bytecode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#usage-for-automatic-interface-generation-and-natspec">Usage for Automatic Interface Generation and NatSpec</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#usage-for-source-code-verification">Usage for Source Code Verification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-abi-spec">Contract ABI Specification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-design">Basic Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#function-selector">Function Selector</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#argument-encoding">Argument Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#types">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#design-criteria-for-the-encoding">Design Criteria for the Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#formal-specification-of-the-encoding">Formal Specification of the Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#function-selector-and-argument-encoding">Function Selector and Argument Encoding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#use-of-dynamic-types">Use of Dynamic Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#events">Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#json">JSON</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#strict-encoding-mode">Strict Encoding Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#non-standard-packed-mode">Non-standard Packed Mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-yul">Yul</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#specification-of-yul">Specification of Yul</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#specification-of-yul-object">Specification of Yul Object</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-style-guide">Style Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-layout">Code Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#order-of-layout">Order of Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#naming-conventions">Naming Conventions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#natspec">NatSpec</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-common-patterns">Common Patterns</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#withdrawal-from-contracts">Withdrawal from Contracts</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#restricting-access">Restricting Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#state-machine">State Machine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-bugs">List of Known Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-to-report-issues">How to Report Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#workflow-for-pull-requests">Workflow for Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-the-compiler-tests">Running the compiler tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#running-the-fuzzer-via-afl">Running the Fuzzer via AFL</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#whiskers">Whiskers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-frequently-asked-questions">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-questions">Basic Questions</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-questions">Advanced Questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-lll">LLL</a></li>
</ul>
</div>
            
          
    <a href="genindex.html">Keyword Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">Solidity</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>Solidity 0.5.3 documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/ethereum/solidity/blob/v0.5.3/docs/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="solidity">
<h1>Solidity<a class="headerlink" href="#solidity" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="_images/logo.svg"><div align="center" class="align-center"><img alt="Solidity logo" src="_images/logo.svg" width="120px" /></div>
</a>
<p>Solidity is an object-oriented, high-level language for implementing smart
contracts. Smart contracts are programs which govern the behaviour of accounts
within the Ethereum state.</p>
<p>Solidity was influenced by C++, Python and JavaScript and is designed to target
the Ethereum Virtual Machine (EVM).</p>
<p>Solidity is statically typed, supports inheritance, libraries and complex
user-defined types among other features.</p>
<p>With Solidity you can create contracts for uses such as voting, crowdfunding, blind auctions,
and multi-signature wallets.</p>
<p>When deploying contracts, you should use the latest released version of Solidity. This is because breaking changes as well as new features and bug fixes are introduced regularly. We currently use a 0.x version number [to indicate this fast pace of change](<a class="reference external" href="https://semver.org/#spec-item-4">https://semver.org/#spec-item-4</a>).</p>
<div class="section" id="language-documentation">
<h2>Language Documentation<a class="headerlink" href="#language-documentation" title="Permalink to this headline">¶</a></h2>
<p>If you are new to the concept of smart contracts we recommend you start with
<a class="reference internal" href="index.html#simple-smart-contract"><span class="std std-ref">an example smart contract</span></a> written
in Solidity. When you are ready for more detail, we recommend you read the
<a class="reference internal" href="index.html#document-solidity-by-example"><span class="doc">“Solidity by Example”</span></a> and <a class="reference internal" href="index.html#document-solidity-in-depth"><span class="doc">“Solidity in Depth”</span></a> sections to learn the core concepts of the language.</p>
<p>For further reading, try <a class="reference internal" href="index.html#blockchain-basics"><span class="std std-ref">the basics of blockchains</span></a>
and details of the <a class="reference internal" href="index.html#the-ethereum-virtual-machine"><span class="std std-ref">Ethereum Virtual Machine</span></a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">You can always try out code examples in your browser with the
<a class="reference external" href="https://remix.ethereum.org">Remix IDE</a>. Remix is a web browser based IDE
that allows you to write Solidity smart contracts, then deploy and run the
smart contracts. It can take a while to load, so please be patient.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As humans write software, it can have bugs. You should follow established
software development best-practices when writing your smart contracts, this
includes code review, testing, audits, and correctness proofs. Smart contract
users are sometimes more confident with code than their authors, and
blockchains and smart contracts have their own unique issues to
watch out for, so before working on production code, make sure you read the
<a class="reference internal" href="index.html#security-considerations"><span class="std std-ref">Security Considerations</span></a> section.</p>
</div>
<p>If you have any questions, you can try searching for answers or asking on the
<a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum Stackexchange</a>, or our <a class="reference external" href="https://gitter.im/ethereum/solidity/">gitter channel</a>.</p>
<p>Ideas for improving Solidity or this documentation are always welcome, read our <a class="reference internal" href="index.html#document-contributing"><span class="doc">contributors guide</span></a> for more details.</p>
</div>
<div class="section" id="translations">
<h2>Translations<a class="headerlink" href="#translations" title="Permalink to this headline">¶</a></h2>
<p>Community volunteers help translate this documentation into several languages.
They have varying degrees of completeness and up-to-dateness. The English
version stands as a reference.</p>
<ul class="simple">
<li><a class="reference external" href="http://solidity-cn.readthedocs.io">Simplified Chinese</a> (in progress)</li>
<li><a class="reference external" href="https://solidity-es.readthedocs.io">Spanish</a></li>
<li><a class="reference external" href="https://github.com/ethereum/wiki/wiki/%5BRussian%5D-%D0%A0%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE-%D0%BF%D0%BE-Solidity">Russian</a> (rather outdated)</li>
<li><a class="reference external" href="http://solidity-kr.readthedocs.io">Korean</a> (in progress)</li>
<li><a class="reference external" href="http://solidity-fr.readthedocs.io">French</a> (in progress)</li>
</ul>
</div>
</div>
<div class="section" id="contents">
<h1>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="genindex.html"><span class="std std-ref">Keyword Index</span></a>, <a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p>
<div class="toctree-wrapper compound">
<span id="document-introduction-to-smart-contracts"></span><div class="section" id="introduction-to-smart-contracts">
<h2>Introduction to Smart Contracts<a class="headerlink" href="#introduction-to-smart-contracts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-simple-smart-contract">
<span id="simple-smart-contract"></span><h3>A Simple Smart Contract<a class="headerlink" href="#a-simple-smart-contract" title="Permalink to this headline">¶</a></h3>
<p>Let us begin with a basic example that sets the value of a variable and exposes
it for other contracts to access. It is fine if you do not understand
everything right now, we will go into more detail later.</p>
<div class="section" id="storage">
<h4>Storage<a class="headerlink" href="#storage" title="Permalink to this headline">¶</a></h4>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SimpleStorage</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">storedData</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">storedData</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">get</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">storedData</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first line simply tells that the source code is written for
Solidity version 0.4.0 or anything newer that does not break functionality
(up to, but not including, version 0.6.0). This is to ensure that the
contract is not compilable with a new (breaking) compiler version, where it could behave differently.
So-called pragmas are common instructions for compilers about how to treat the
source code (e.g. <a class="reference external" href="https://en.wikipedia.org/wiki/Pragma_once">pragma once</a>).</p>
<p>A contract in the sense of Solidity is a collection of code (its <em>functions</em>) and
data (its <em>state</em>) that resides at a specific address on the Ethereum
blockchain. The line <code class="docutils literal notranslate"><span class="pre">uint</span> <span class="pre">storedData;</span></code> declares a state variable called <code class="docutils literal notranslate"><span class="pre">storedData</span></code> of
type <code class="docutils literal notranslate"><span class="pre">uint</span></code> (<em>u</em>nsigned <em>int</em>eger of <em>256</em> bits). You can think of it as a single slot
in a database that can be queried and altered by calling functions of the
code that manages the database. In the case of Ethereum, this is always the owning
contract. And in this case, the functions <code class="docutils literal notranslate"><span class="pre">set</span></code> and <code class="docutils literal notranslate"><span class="pre">get</span></code> can be used to modify
or retrieve the value of the variable.</p>
<p>To access a state variable, you do not need the prefix <code class="docutils literal notranslate"><span class="pre">this.</span></code> as is common in
other languages.</p>
<p>This contract does not do much yet apart from (due to the infrastructure
built by Ethereum) allowing anyone to store a single number that is accessible by
anyone in the world without a (feasible) way to prevent you from publishing
this number. Of course, anyone could just call <code class="docutils literal notranslate"><span class="pre">set</span></code> again with a different value
and overwrite your number, but the number will still be stored in the history
of the blockchain. Later, we will see how you can impose access restrictions
so that only you can alter the number.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All identifiers (contract names, function names and variable names) are restricted to
the ASCII character set. It is possible to store UTF-8 encoded data in string variables.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful with using Unicode text, as similar looking (or even identical) characters can
have different code points and as such will be encoded as a different byte array.</p>
</div>
</div>
<div class="section" id="subcurrency-example">
<span id="index-0"></span><h4>Subcurrency Example<a class="headerlink" href="#subcurrency-example" title="Permalink to this headline">¶</a></h4>
<p>The following contract will implement the simplest form of a
cryptocurrency. It is possible to generate coins out of thin air, but
only the person that created the contract will be able to do that (it is easy
to implement a different issuance scheme).
Furthermore, anyone can send coins to each other without a need for
registering with username and password — all you need is an Ethereum keypair.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Coin</span> <span class="p">{</span>
    <span class="c1">// The keyword &quot;public&quot; makes those variables</span>
    <span class="c1">// easily readable from outside.</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">minter</span><span class="p">;</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">balances</span><span class="p">;</span>

    <span class="c1">// Events allow light clients to react to</span>
    <span class="c1">// changes efficiently.</span>
    <span class="kd">event</span> <span class="n">Sent</span><span class="p">(</span><span class="kt">address</span> <span class="kr">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">);</span>

    <span class="c1">// This is the constructor whose code is</span>
    <span class="c1">// run only when the contract is created.</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">minter</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">minter</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="mi">1e60</span><span class="p">);</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">receiver</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">send</span><span class="p">(</span><span class="kt">address</span> <span class="n">receiver</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">amount</span> <span class="o">&lt;=</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">],</span> <span class="s">&quot;Insufficient balance.&quot;</span><span class="p">);</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span><span class="p">;</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">receiver</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
        <span class="kr">emit</span> <span class="n">Sent</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This contract introduces some new concepts, let us go through them one by one.</p>
<p>The line <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">public</span> <span class="pre">minter;</span></code> declares a state variable of type address
that is publicly accessible. The <code class="docutils literal notranslate"><span class="pre">address</span></code> type is a 160-bit value
that does not allow any arithmetic operations. It is suitable for
storing addresses of contracts or of keypairs belonging to external
persons. The keyword <code class="docutils literal notranslate"><span class="pre">public</span></code> automatically generates a function that
allows you to access the current value of the state variable
from outside of the contract.
Without this keyword, other contracts have no way to access the variable.
The code of the function generated by the compiler is roughly equivalent
to the following (ignore <code class="docutils literal notranslate"><span class="pre">external</span></code> and <code class="docutils literal notranslate"><span class="pre">view</span></code> for now):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">minter</span><span class="p">()</span> <span class="kr">external</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">minter</span><span class="p">;</span> <span class="p">}</span>
</pre></div>
</div>
<p>Of course, adding a function exactly like that will not work
because we would have a
function and a state variable with the same name, but hopefully, you
get the idea - the compiler figures that out for you.</p>
<p id="index-1">The next line, <code class="docutils literal notranslate"><span class="pre">mapping</span> <span class="pre">(address</span> <span class="pre">=&gt;</span> <span class="pre">uint)</span> <span class="pre">public</span> <span class="pre">balances;</span></code> also
creates a public state variable, but it is a more complex datatype.
The type maps addresses to unsigned integers.
Mappings can be seen as <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a> which are
virtually initialized such that every possible key exists from the start and is mapped to a
value whose byte-representation is all zeros. This analogy does not go
too far, though, as it is neither possible to obtain a list of all keys of
a mapping, nor a list of all values. So either keep in mind (or
better, keep a list or use a more advanced data type) what you
added to the mapping or use it in a context where this is not needed.
The <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a> created by the <code class="docutils literal notranslate"><span class="pre">public</span></code> keyword
is a bit more complex in this case. It roughly looks like the
following:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">balances</span><span class="p">(</span><span class="kt">address</span> <span class="n">_account</span><span class="p">)</span> <span class="kr">external</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">balances</span><span class="p">[</span><span class="n">_account</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you see, you can use this function to easily query the balance of a
single account.</p>
<p id="index-2">The line <code class="docutils literal notranslate"><span class="pre">event</span> <span class="pre">Sent(address</span> <span class="pre">from,</span> <span class="pre">address</span> <span class="pre">to,</span> <span class="pre">uint</span> <span class="pre">amount);</span></code> declares
a so-called “event” which is emitted in the last line of the function
<code class="docutils literal notranslate"><span class="pre">send</span></code>. User interfaces (as well as server applications of course) can
listen for those events being emitted on the blockchain without much
cost. As soon as it is emitted, the listener will also receive the
arguments <code class="docutils literal notranslate"><span class="pre">from</span></code>, <code class="docutils literal notranslate"><span class="pre">to</span></code> and <code class="docutils literal notranslate"><span class="pre">amount</span></code>, which makes it easy to track
transactions. In order to listen for this event, you would use the following
JavaScript code (which assumes that <code class="docutils literal notranslate"><span class="pre">Coin</span></code> is a contract object created via
web3.js or a similar module):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Coin</span><span class="p">.</span><span class="n">Sent</span><span class="p">().</span><span class="n">watch</span><span class="p">({},</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Coin transfer: &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span>
            <span class="s">&quot; coins were sent from &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="kr">from</span> <span class="o">+</span>
            <span class="s">&quot; to &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">to</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span><span class="p">);</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&quot;Balances now:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span>
            <span class="s">&quot;Sender: &quot;</span> <span class="o">+</span> <span class="n">Coin</span><span class="p">.</span><span class="n">balances</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="kr">from</span><span class="p">)</span> <span class="o">+</span>
            <span class="s">&quot;Receiver: &quot;</span> <span class="o">+</span> <span class="n">Coin</span><span class="p">.</span><span class="n">balances</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="n">to</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Note how the automatically generated function <code class="docutils literal notranslate"><span class="pre">balances</span></code> is called from
the user interface.</p>
<p id="index-3">The constructor is a special function which is run during creation of the contract and
cannot be called afterwards. It permanently stores the address of the person creating the
contract: <code class="docutils literal notranslate"><span class="pre">msg</span></code> (together with <code class="docutils literal notranslate"><span class="pre">tx</span></code> and <code class="docutils literal notranslate"><span class="pre">block</span></code>) is a special global variable that
contains some properties which allow access to the blockchain. <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> is
always the address where the current (external) function call came from.</p>
<p>Finally, the functions that will actually end up with the contract and can be called
by users and contracts alike are <code class="docutils literal notranslate"><span class="pre">mint</span></code> and <code class="docutils literal notranslate"><span class="pre">send</span></code>.
If <code class="docutils literal notranslate"><span class="pre">mint</span></code> is called by anyone except the account that created the contract,
nothing will happen. This is ensured by the special function <code class="docutils literal notranslate"><span class="pre">require</span></code> which
causes all changes to be reverted if its argument evaluates to false.
The second call to <code class="docutils literal notranslate"><span class="pre">require</span></code> ensures that there will not be too many coins,
which could cause overflow errors later.</p>
<p>On the other hand, <code class="docutils literal notranslate"><span class="pre">send</span></code> can be used by anyone (who already
has some of these coins) to send coins to anyone else. If you do not have
enough coins to send, the <code class="docutils literal notranslate"><span class="pre">require</span></code> call will fail and also provide the
user with an appropriate error message string.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you use
this contract to send coins to an address, you will not see anything when you
look at that address on a blockchain explorer, because the fact that you sent
coins and the changed balances are only stored in the data storage of this
particular coin contract. By the use of events it is relatively easy to create
a “blockchain explorer” that tracks transactions and balances of your new coin,
but you have to inspect the coin contract address and not the addresses of the
coin owners.</p>
</div>
</div>
</div>
<div class="section" id="blockchain-basics">
<span id="id1"></span><h3>Blockchain Basics<a class="headerlink" href="#blockchain-basics" title="Permalink to this headline">¶</a></h3>
<p>Blockchains as a concept are not too hard to understand for programmers. The reason is that
most of the complications (mining, <a class="reference external" href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">hashing</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Elliptic_curve_cryptography">elliptic-curve cryptography</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Peer-to-peer">peer-to-peer networks</a>, etc.)
are just there to provide a certain set of features and promises for the platform. Once you accept these
features as given, you do not have to worry about the underlying technology - or do you have
to know how Amazon’s AWS works internally in order to use it?</p>
<div class="section" id="transactions">
<span id="index-4"></span><h4>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h4>
<p>A blockchain is a globally shared, transactional database.
This means that everyone can read entries in the database just by participating in the network.
If you want to change something in the database, you have to create a so-called transaction
which has to be accepted by all others.
The word transaction implies that the change you want to make (assume you want to change
two values at the same time) is either not done at all or completely applied. Furthermore,
while your transaction is being applied to the database, no other transaction can alter it.</p>
<p>As an example, imagine a table that lists the balances of all accounts in an
electronic currency. If a transfer from one account to another is requested,
the transactional nature of the database ensures that if the amount is
subtracted from one account, it is always added to the other account. If due
to whatever reason, adding the amount to the target account is not possible,
the source account is also not modified.</p>
<p>Furthermore, a transaction is always cryptographically signed by the sender (creator).
This makes it straightforward to guard access to specific modifications of the
database. In the example of the electronic currency, a simple check ensures that
only the person holding the keys to the account can transfer money from it.</p>
</div>
<div class="section" id="blocks">
<span id="index-5"></span><h4>Blocks<a class="headerlink" href="#blocks" title="Permalink to this headline">¶</a></h4>
<p>One major obstacle to overcome is what (in Bitcoin terms) is called a “double-spend attack”:
What happens if two transactions exist in the network that both want to empty an account?
Only one of the transactions can be valid, typically the one that is accepted first.
The problem is that “first” is not an objective term in a peer-to-peer network.</p>
<p>The abstract answer to this is that you do not have to care. A globally accepted order of the transactions
will be selected for you, solving the conflict. The transactions will be bundled into what is called a “block”
and then they will be executed and distributed among all participating nodes.
If two transactions contradict each other, the one that ends up being second will
be rejected and not become part of the block.</p>
<p>These blocks form a linear sequence in time and that is where the word “blockchain”
derives from. Blocks are added to the chain in rather regular intervals - for
Ethereum this is roughly every 17 seconds.</p>
<p>As part of the “order selection mechanism” (which is called “mining”) it may happen that
blocks are reverted from time to time, but only at the “tip” of the chain. The more
blocks are added on top of a particular block, the less likely this block will be reverted. So it might be that your transactions
are reverted and even removed from the blockchain, but the longer you wait, the less
likely it will be.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Transactions are not guaranteed to be included in the next block or any specific future block,
since it is not up to the submitter of a transaction, but up to the miners to determine in which block the transaction is included.</p>
<p class="last">If you want to schedule future calls of your contract, you can use
the <a class="reference external" href="http://www.ethereum-alarm-clock.com/">alarm clock</a> or a similar oracle service.</p>
</div>
<span class="target" id="the-ethereum-virtual-machine"></span></div>
</div>
<div class="section" id="index-6">
<span id="id2"></span><h3>The Ethereum Virtual Machine<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h3>
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>The Ethereum Virtual Machine or EVM is the runtime environment
for smart contracts in Ethereum. It is not only sandboxed but
actually completely isolated, which means that code running
inside the EVM has no access to network, filesystem or other processes.
Smart contracts even have limited access to other smart contracts.</p>
</div>
<div class="section" id="accounts">
<span id="index-7"></span><h4>Accounts<a class="headerlink" href="#accounts" title="Permalink to this headline">¶</a></h4>
<p>There are two kinds of accounts in Ethereum which share the same
address space: <strong>External accounts</strong> that are controlled by
public-private key pairs (i.e. humans) and <strong>contract accounts</strong> which are
controlled by the code stored together with the account.</p>
<p>The address of an external account is determined from
the public key while the address of a contract is
determined at the time the contract is created
(it is derived from the creator address and the number
of transactions sent from that address, the so-called “nonce”).</p>
<p>Regardless of whether or not the account stores code, the two types are
treated equally by the EVM.</p>
<p>Every account has a persistent key-value store mapping 256-bit words to 256-bit
words called <strong>storage</strong>.</p>
<p>Furthermore, every account has a <strong>balance</strong> in
Ether (in “Wei” to be exact, <cite>1 ether</cite> is <cite>10**18 wei</cite>) which can be modified by sending transactions that
include Ether.</p>
</div>
<div class="section" id="index-8">
<span id="id3"></span><h4>Transactions<a class="headerlink" href="#index-8" title="Permalink to this headline">¶</a></h4>
<p>A transaction is a message that is sent from one account to another
account (which might be the same or empty, see below).
It can include binary data (which is called “payload”) and Ether.</p>
<p>If the target account contains code, that code is executed and
the payload is provided as input data.</p>
<p>If the target account is not set (the transaction does not have
a recipient or the recipient is set to <code class="docutils literal notranslate"><span class="pre">null</span></code>), the transaction
creates a <strong>new contract</strong>.
As already mentioned, the address of that contract is not
the zero address but an address derived from the sender and
its number of transactions sent (the “nonce”). The payload
of such a contract creation transaction is taken to be
EVM bytecode and executed. The output data of this execution is
permanently stored as the code of the contract.
This means that in order to create a contract, you do not
send the actual code of the contract, but in fact code that
returns that code when executed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While a contract is being created, its code is still empty.
Because of that, you should not call back into the
contract under construction until its constructor has
finished executing.</p>
</div>
</div>
<div class="section" id="gas">
<span id="index-9"></span><h4>Gas<a class="headerlink" href="#gas" title="Permalink to this headline">¶</a></h4>
<p>Upon creation, each transaction is charged with a certain amount of <strong>gas</strong>,
whose purpose is to limit the amount of work that is needed to execute
the transaction and to pay for this execution at the same time. While the EVM executes the
transaction, the gas is gradually depleted according to specific rules.</p>
<p>The <strong>gas price</strong> is a value set by the creator of the transaction, who
has to pay <code class="docutils literal notranslate"><span class="pre">gas_price</span> <span class="pre">*</span> <span class="pre">gas</span></code> up front from the sending account.
If some gas is left after the execution, it is refunded to the creator in the same way.</p>
<p>If the gas is used up at any point (i.e. it would be negative),
an out-of-gas exception is triggered, which reverts all modifications
made to the state in the current call frame.</p>
</div>
<div class="section" id="storage-memory-and-the-stack">
<span id="index-10"></span><h4>Storage, Memory and the Stack<a class="headerlink" href="#storage-memory-and-the-stack" title="Permalink to this headline">¶</a></h4>
<p>The Ethereum Virtual Machine has three areas where it can store data-
storage, memory and the stack, which are explained in the following
paragraphs.</p>
<p>Each account has a data area called <strong>storage</strong>, which is persistent between function calls
and transactions.
Storage is a key-value store that maps 256-bit words to 256-bit words.
It is not possible to enumerate storage from within a contract and it is
comparatively costly to read, and even more to modify storage.
A contract can neither read nor write to any storage apart from its own.</p>
<p>The second data area is called <strong>memory</strong>, of which a contract obtains
a freshly cleared instance for each message call. Memory is linear and can be
addressed at byte level, but reads are limited to a width of 256 bits, while writes
can be either 8 bits or 256 bits wide. Memory is expanded by a word (256-bit), when
accessing (either reading or writing) a previously untouched memory word (i.e. any offset
within a word). At the time of expansion, the cost in gas must be paid. Memory is more
costly the larger it grows (it scales quadratically).</p>
<p>The EVM is not a register machine but a stack machine, so all
computations are performed on a data area called the <strong>stack</strong>. It has a maximum size of
1024 elements and contains words of 256 bits. Access to the stack is
limited to the top end in the following way:
It is possible to copy one of
the topmost 16 elements to the top of the stack or swap the
topmost element with one of the 16 elements below it.
All other operations take the topmost two (or one, or more, depending on
the operation) elements from the stack and push the result onto the stack.
Of course it is possible to move stack elements to storage or memory
in order to get deeper access to the stack,
but it is not possible to just access arbitrary elements deeper in the stack
without first removing the top of the stack.</p>
</div>
<div class="section" id="instruction-set">
<span id="index-11"></span><h4>Instruction Set<a class="headerlink" href="#instruction-set" title="Permalink to this headline">¶</a></h4>
<p>The instruction set of the EVM is kept minimal in order to avoid
incorrect or inconsistent implementations which could cause consensus problems.
All instructions operate on the basic data type, 256-bit words or on slices of memory
(or other byte arrays).
The usual arithmetic, bit, logical and comparison operations are present.
Conditional and unconditional jumps are possible. Furthermore,
contracts can access relevant properties of the current block
like its number and timestamp.</p>
<p>For a complete list, please see the <a class="reference internal" href="index.html#opcodes"><span class="std std-ref">list of opcodes</span></a> as part of the inline
assembly documentation.</p>
</div>
<div class="section" id="message-calls">
<span id="index-12"></span><h4>Message Calls<a class="headerlink" href="#message-calls" title="Permalink to this headline">¶</a></h4>
<p>Contracts can call other contracts or send Ether to non-contract
accounts by the means of message calls. Message calls are similar
to transactions, in that they have a source, a target, data payload,
Ether, gas and return data. In fact, every transaction consists of
a top-level message call which in turn can create further message calls.</p>
<p>A contract can decide how much of its remaining <strong>gas</strong> should be sent
with the inner message call and how much it wants to retain.
If an out-of-gas exception happens in the inner call (or any
other exception), this will be signaled by an error value put onto the stack.
In this case, only the gas sent together with the call is used up.
In Solidity, the calling contract causes a manual exception by default in
such situations, so that exceptions “bubble up” the call stack.</p>
<p>As already said, the called contract (which can be the same as the caller)
will receive a freshly cleared instance of memory and has access to the
call payload - which will be provided in a separate area called the <strong>calldata</strong>.
After it has finished execution, it can return data which will be stored at
a location in the caller’s memory preallocated by the caller.
All such calls are fully synchronous.</p>
<p>Calls are <strong>limited</strong> to a depth of 1024, which means that for more complex
operations, loops should be preferred over recursive calls. Furthermore,
only 63/64th of the gas can be forwarded in a message call, which causes a
depth limit of a little less than 1000 in practice.</p>
</div>
<div class="section" id="delegatecall-callcode-and-libraries">
<span id="index-13"></span><h4>Delegatecall / Callcode and Libraries<a class="headerlink" href="#delegatecall-callcode-and-libraries" title="Permalink to this headline">¶</a></h4>
<p>There exists a special variant of a message call, named <strong>delegatecall</strong>
which is identical to a message call apart from the fact that
the code at the target address is executed in the context of the calling
contract and <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> do not change their values.</p>
<p>This means that a contract can dynamically load code from a different
address at runtime. Storage, current address and balance still
refer to the calling contract, only the code is taken from the called address.</p>
<p>This makes it possible to implement the “library” feature in Solidity:
Reusable library code that can be applied to a contract’s storage, e.g. in
order to implement a complex data structure.</p>
</div>
<div class="section" id="logs">
<span id="index-14"></span><h4>Logs<a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h4>
<p>It is possible to store data in a specially indexed data structure
that maps all the way up to the block level. This feature called <strong>logs</strong>
is used by Solidity in order to implement <a class="reference internal" href="index.html#events"><span class="std std-ref">events</span></a>.
Contracts cannot access log data after it has been created, but they
can be efficiently accessed from outside the blockchain.
Since some part of the log data is stored in <a class="reference external" href="https://en.wikipedia.org/wiki/Bloom_filter">bloom filters</a>, it is
possible to search for this data in an efficient and cryptographically
secure way, so network peers that do not download the whole blockchain
(so-called “light clients”) can still find these logs.</p>
</div>
<div class="section" id="create">
<span id="index-15"></span><h4>Create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h4>
<p>Contracts can even create other contracts using a special opcode (i.e.
they do not simply call the zero address as a transaction would). The only difference between
these <strong>create calls</strong> and normal message calls is that the payload data is
executed and the result stored as code and the caller / creator
receives the address of the new contract on the stack.</p>
</div>
<div class="section" id="deactivate-and-self-destruct">
<span id="index-16"></span><h4>Deactivate and Self-destruct<a class="headerlink" href="#deactivate-and-self-destruct" title="Permalink to this headline">¶</a></h4>
<p>The only way to remove code from the blockchain is when a contract at that address performs the <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code> operation. The remaining Ether stored at that address is sent to a designated target and then the storage and code is removed from the state. Removing the contract in theory sounds like a good idea, but it is potentially dangerous, as if someone sends Ether to removed contracts, the Ether is forever lost.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even if a contract’s code does not contain a call to <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>, it can still perform that operation using <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> or <code class="docutils literal notranslate"><span class="pre">callcode</span></code>.</p>
</div>
<p>If you want to deactivate your contracts, you should instead <strong>disable</strong> them by changing some internal state which causes all functions to revert. This makes it impossible to use the contract, as it returns Ether immediately.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Even if a contract is removed by “selfdestruct”, it is still part of the history of the blockchain and probably retained by most Ethereum nodes. So using “selfdestruct” is not the same as deleting data from a hard disk.</p>
</div>
</div>
</div>
</div>
<span id="document-installing-solidity"></span><div class="section" id="installing-the-solidity-compiler">
<span id="installing-solidity"></span><span id="index-0"></span><h2>Installing the Solidity Compiler<a class="headerlink" href="#installing-the-solidity-compiler" title="Permalink to this headline">¶</a></h2>
<div class="section" id="versioning">
<h3>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h3>
<p>Solidity versions follow <a class="reference external" href="https://semver.org">semantic versioning</a> and in addition to
releases, <strong>nightly development builds</strong> are also made available.  The nightly builds
are not guaranteed to be working and despite best efforts they might contain undocumented
and/or broken changes. We recommend using the latest release. Package installers below
will use the latest release.</p>
</div>
<div class="section" id="remix">
<h3>Remix<a class="headerlink" href="#remix" title="Permalink to this headline">¶</a></h3>
<p><em>We recommend Remix for small contracts and for quickly learning Solidity.</em></p>
<p><a class="reference external" href="https://remix.ethereum.org/">Access Remix online</a>, you don’t need to install anything.
If you want to use it without connection to the Internet, go to
<a class="reference external" href="https://github.com/ethereum/remix-live/tree/gh-pages">https://github.com/ethereum/remix-live/tree/gh-pages</a> and download the <code class="docutils literal notranslate"><span class="pre">.zip</span></code> file as
explained on that page.</p>
<p>Further options on this page detail installing commandline Solidity compiler software
on your computer. Choose a commandline compiler if you are working on a larger contract
or if you require more compilation options.</p>
</div>
<div class="section" id="npm-node-js">
<span id="solcjs"></span><h3>npm / Node.js<a class="headerlink" href="#npm-node-js" title="Permalink to this headline">¶</a></h3>
<p>Use <cite>npm</cite> for a convenient and portable way to install <cite>solcjs</cite>, a Solidity compiler. The
<cite>solcjs</cite> program has fewer features than the ways to access the compiler described
further down this page. The
<a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> documentation assumes you are using
the full-featured compiler, <cite>solc</cite>. The usage of <cite>solcjs</cite> is documented inside its own
<a class="reference external" href="https://github.com/ethereum/solc-js">repository</a>.</p>
<p>Note: The solc-js project is derived from the C++
<cite>solc</cite> by using Emscripten which means that both use the same compiler source code.
<cite>solc-js</cite> can be used in JavaScript projects directly (such as Remix).
Please refer to the solc-js repository for instructions.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>npm install -g solc
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The commandline executable is named <cite>solcjs</cite>.</p>
<p class="last">The comandline options of <cite>solcjs</cite> are not compatible with <cite>solc</cite> and tools (such as <cite>geth</cite>)
expecting the behaviour of <cite>solc</cite> will not work with <cite>solcjs</cite>.</p>
</div>
</div>
<div class="section" id="docker">
<h3>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h3>
<p>We provide up to date docker builds for the compiler. The <code class="docutils literal notranslate"><span class="pre">stable</span></code>
repository contains released versions while the <code class="docutils literal notranslate"><span class="pre">nightly</span></code>
repository contains potentially unstable changes in the develop branch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run ethereum/solc:stable --version
</pre></div>
</div>
<p>Currently, the docker image only contains the compiler executable,
so you have to do some additional work to link in the source and
output directories.</p>
</div>
<div class="section" id="binary-packages">
<h3>Binary Packages<a class="headerlink" href="#binary-packages" title="Permalink to this headline">¶</a></h3>
<p>Binary packages of Solidity are available at
<a class="reference external" href="https://github.com/ethereum/solidity/releases">solidity/releases</a>.</p>
<p>We also have PPAs for Ubuntu, you can get the latest stable
version using the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo add-apt-repository ppa:ethereum/ethereum
sudo apt-get update
sudo apt-get install solc
</pre></div>
</div>
<p>The nightly version can be installed using these commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo add-apt-repository ppa:ethereum/ethereum
sudo add-apt-repository ppa:ethereum/ethereum-dev
sudo apt-get update
sudo apt-get install solc
</pre></div>
</div>
<p>We are also releasing a <a class="reference external" href="https://snapcraft.io/">snap package</a>, which is installable in all the <a class="reference external" href="https://snapcraft.io/docs/core/install">supported Linux distros</a>. To install the latest stable version of solc:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo snap install solc
</pre></div>
</div>
<p>If you want to help testing the latest development version of Solidity
with the most recent changes, please use the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo snap install solc --edge
</pre></div>
</div>
<p>Arch Linux also has packages, albeit limited to the latest development version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pacman -S solidity
</pre></div>
</div>
<p>We distribute the Solidity compiler through Homebrew
as a build-from-source version. Pre-built bottles are
currently not supported.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew update
brew upgrade
brew tap ethereum/ethereum
brew install solidity
</pre></div>
</div>
<p>If you need a specific version of Solidity you can install a
Homebrew formula directly from Github.</p>
<p>View
<a class="reference external" href="https://github.com/ethereum/homebrew-ethereum/commits/master/solidity.rb">solidity.rb commits on Github</a>.</p>
<p>Follow the history links until you have a raw file link of a
specific commit of <code class="docutils literal notranslate"><span class="pre">solidity.rb</span></code>.</p>
<p>Install it using <code class="docutils literal notranslate"><span class="pre">brew</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>brew unlink solidity
<span class="c1"># Install 0.4.8</span>
brew install https://raw.githubusercontent.com/ethereum/homebrew-ethereum/77cce03da9f289e5a3ffe579840d3c5dc0a62717/solidity.rb
</pre></div>
</div>
<p>Gentoo Linux also provides a solidity package that can be installed using <code class="docutils literal notranslate"><span class="pre">emerge</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>emerge dev-lang/solidity
</pre></div>
</div>
</div>
<div class="section" id="building-from-source">
<span id="id1"></span><h3>Building from Source<a class="headerlink" href="#building-from-source" title="Permalink to this headline">¶</a></h3>
<div class="section" id="prerequisites-linux">
<h4>Prerequisites - Linux<a class="headerlink" href="#prerequisites-linux" title="Permalink to this headline">¶</a></h4>
<p>You need to install the following dependencies for Linux builds of Solidity:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Software</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="https://git-scm.com/download/linux">Git for Linux</a></td>
<td>Command-line tool for retrieving source from Github.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="prerequisites-macos">
<h4>Prerequisites - macOS<a class="headerlink" href="#prerequisites-macos" title="Permalink to this headline">¶</a></h4>
<p>For macOS, ensure that you have the latest version of
<a class="reference external" href="https://developer.apple.com/xcode/download/">Xcode installed</a>.
This contains the <a class="reference external" href="https://en.wikipedia.org/wiki/Clang">Clang C++ compiler</a>, the
<a class="reference external" href="https://en.wikipedia.org/wiki/Xcode">Xcode IDE</a> and other Apple development
tools which are required for building C++ applications on OS X.
If you are installing Xcode for the first time, or have just installed a new
version then you will need to agree to the license before you can do
command-line builds:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo xcodebuild -license accept
</pre></div>
</div>
<p>Our OS X builds require you to <a class="reference external" href="http://brew.sh">install the Homebrew</a>
package manager for installing external dependencies.
Here’s how to <a class="reference external" href="https://github.com/Homebrew/homebrew/blob/master/share/doc/homebrew/FAQ.md#how-do-i-uninstall-homebrew">uninstall Homebrew</a>,
if you ever want to start again from scratch.</p>
</div>
<div class="section" id="prerequisites-windows">
<h4>Prerequisites - Windows<a class="headerlink" href="#prerequisites-windows" title="Permalink to this headline">¶</a></h4>
<p>You need to install the following dependencies for Windows builds of Solidity:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Software</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="https://git-scm.com/download/win">Git for Windows</a></td>
<td>Command-line tool for retrieving source from Github.</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://cmake.org/download/">CMake</a></td>
<td>Cross-platform build file generator.</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://www.visualstudio.com/downloads/#build-tools-for-visual-studio-2017">Visual Studio 2017 Build Tools</a></td>
<td>C++ compiler</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://www.visualstudio.com/vs/">Visual Studio 2017</a>  (Optional)</td>
<td>C++ compiler and dev environment.</td>
</tr>
</tbody>
</table>
<p>If you’ve already had one IDE and only need compiler and libraries,
you could install Visual Studio 2017 Build Tools.</p>
<p>Visual Studio 2017 provides both IDE and necessary compiler and libraries.
So if you have not got an IDE and prefer to develop solidity, Visual Studio 2017
may be an choice for you to get everything setup easily.</p>
<p>Here is the list of components that should be installed
in Visual Studio 2017 Build Tools or Visual Studio 2017:</p>
<ul class="simple">
<li>Visual Studio C++ core features</li>
<li>VC++ 2017 v141 toolset (x86,x64)</li>
<li>Windows Universal CRT SDK</li>
<li>Windows 8.1 SDK</li>
<li>C++/CLI support</li>
</ul>
</div>
<div class="section" id="clone-the-repository">
<h4>Clone the Repository<a class="headerlink" href="#clone-the-repository" title="Permalink to this headline">¶</a></h4>
<p>To clone the source code, execute the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recursive https://github.com/ethereum/solidity.git
<span class="nb">cd</span> solidity
</pre></div>
</div>
<p>If you want to help developing Solidity,
you should fork Solidity and add your personal fork as a second remote:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git remote add personal git@github.com:<span class="o">[</span>username<span class="o">]</span>/solidity.git
</pre></div>
</div>
</div>
<div class="section" id="external-dependencies">
<h4>External Dependencies<a class="headerlink" href="#external-dependencies" title="Permalink to this headline">¶</a></h4>
<p>We have a helper script which installs all required external dependencies
on macOS, Windows and on numerous Linux distros.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/install_deps.sh
</pre></div>
</div>
<p>Or, on Windows:</p>
<div class="highlight-bat notranslate"><div class="highlight"><pre><span></span>scripts\install_deps.bat
</pre></div>
</div>
</div>
<div class="section" id="command-line-build">
<h4>Command-Line Build<a class="headerlink" href="#command-line-build" title="Permalink to this headline">¶</a></h4>
<p><strong>Be sure to install External Dependencies (see above) before build.</strong></p>
<p>Solidity project uses CMake to configure the build.
You might want to install ccache to speed up repeated builds.
CMake will pick it up automatically.
Building Solidity is quite similar on Linux, macOS and other Unices:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake .. <span class="o">&amp;&amp;</span> make
</pre></div>
</div>
<p>or even easier:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#note: this will install binaries solc and soltest at usr/local/bin</span>
./scripts/build.sh
</pre></div>
</div>
<p>And for Windows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir build
<span class="nb">cd</span> build
cmake -G <span class="s2">&quot;Visual Studio 15 2017 Win64&quot;</span> ..
</pre></div>
</div>
<p>This latter set of instructions should result in the creation of
<strong>solidity.sln</strong> in that build directory.  Double-clicking on that file
should result in Visual Studio firing up.  We suggest building
<strong>Release</strong> configuration, but all others work.</p>
<p>Alternatively, you can build for Windows on the command-line, like so:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake --build . --config Release
</pre></div>
</div>
</div>
</div>
<div class="section" id="cmake-options">
<h3>CMake options<a class="headerlink" href="#cmake-options" title="Permalink to this headline">¶</a></h3>
<p>If you are interested what CMake options are available run <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">..</span> <span class="pre">-LH</span></code>.</p>
<div class="section" id="smt-solvers">
<span id="smt-solvers-build"></span><h4>SMT Solvers<a class="headerlink" href="#smt-solvers" title="Permalink to this headline">¶</a></h4>
<p>Solidity can be built against SMT solvers and will do so by default if
they are found in the system. Each solver can be disabled by a <cite>cmake</cite> option.</p>
<p><em>Note: In some cases, this can also be a potential workaround for build failures.</em></p>
<p>Inside the build folder you can disable them, since they are enabled by default:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># disables only Z3 SMT Solver.</span>
cmake .. -DUSE_Z3<span class="o">=</span>OFF

<span class="c1"># disables only CVC4 SMT Solver.</span>
cmake .. -DUSE_CVC4<span class="o">=</span>OFF

<span class="c1"># disables both Z3 and CVC4</span>
cmake .. -DUSE_CVC4<span class="o">=</span>OFF -DUSE_Z3<span class="o">=</span>OFF
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-version-string-in-detail">
<h3>The version string in detail<a class="headerlink" href="#the-version-string-in-detail" title="Permalink to this headline">¶</a></h3>
<p>The Solidity version string contains four parts:</p>
<ul class="simple">
<li>the version number</li>
<li>pre-release tag, usually set to <code class="docutils literal notranslate"><span class="pre">develop.YYYY.MM.DD</span></code> or <code class="docutils literal notranslate"><span class="pre">nightly.YYYY.MM.DD</span></code></li>
<li>commit in the format of <code class="docutils literal notranslate"><span class="pre">commit.GITHASH</span></code></li>
<li>platform, which has an arbitrary number of items, containing details about the platform and compiler</li>
</ul>
<p>If there are local modifications, the commit will be postfixed with <code class="docutils literal notranslate"><span class="pre">.mod</span></code>.</p>
<p>These parts are combined as required by Semver, where the Solidity pre-release tag equals to the Semver pre-release
and the Solidity commit and platform combined make up the Semver build metadata.</p>
<p>A release example: <code class="docutils literal notranslate"><span class="pre">0.4.8+commit.60cc1668.Emscripten.clang</span></code>.</p>
<p>A pre-release example: <code class="docutils literal notranslate"><span class="pre">0.4.9-nightly.2017.1.17+commit.6ecb4aa3.Emscripten.clang</span></code></p>
</div>
<div class="section" id="important-information-about-versioning">
<h3>Important information about versioning<a class="headerlink" href="#important-information-about-versioning" title="Permalink to this headline">¶</a></h3>
<p>After a release is made, the patch version level is bumped, because we assume that only
patch level changes follow. When changes are merged, the version should be bumped according
to semver and the severity of the change. Finally, a release is always made with the version
of the current nightly build, but without the <code class="docutils literal notranslate"><span class="pre">prerelease</span></code> specifier.</p>
<p>Example:</p>
<ol class="arabic simple" start="0">
<li>the 0.4.0 release is made</li>
<li>nightly build has a version of 0.4.1 from now on</li>
<li>non-breaking changes are introduced - no change in version</li>
<li>a breaking change is introduced - version is bumped to 0.5.0</li>
<li>the 0.5.0 release is made</li>
</ol>
<p>This behaviour works well with the  <a class="reference internal" href="index.html#version-pragma"><span class="std std-ref">version pragma</span></a>.</p>
</div>
</div>
<span id="document-solidity-by-example"></span><div class="section" id="solidity-by-example">
<h2>Solidity by Example<a class="headerlink" href="#solidity-by-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="voting">
<span id="index-0"></span><span id="id1"></span><h3>Voting<a class="headerlink" href="#voting" title="Permalink to this headline">¶</a></h3>
<p>The following contract is quite complex, but showcases
a lot of Solidity’s features. It implements a voting
contract. Of course, the main problems of electronic
voting is how to assign voting rights to the correct
persons and how to prevent manipulation. We will not
solve all problems here, but at least we will show
how delegated voting can be done so that vote counting
is <strong>automatic and completely transparent</strong> at the
same time.</p>
<p>The idea is to create one contract per ballot,
providing a short name for each option.
Then the creator of the contract who serves as
chairperson will give the right to vote to each
address individually.</p>
<p>The persons behind the addresses can then choose
to either vote themselves or to delegate their
vote to a person they trust.</p>
<p>At the end of the voting time, <code class="docutils literal notranslate"><span class="pre">winningProposal()</span></code>
will return the proposal with the largest number
of votes.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">/// </span><span class="cs">@title</span><span class="c1"> Voting with delegation.</span>
<span class="kd">contract</span> <span class="n">Ballot</span> <span class="p">{</span>
    <span class="c1">// This declares a new complex type which will</span>
    <span class="c1">// be used for variables later.</span>
    <span class="c1">// It will represent a single voter.</span>
    <span class="kd">struct</span> <span class="n">Voter</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">weight</span><span class="p">;</span> <span class="c1">// weight is accumulated by delegation</span>
        <span class="kt">bool</span> <span class="n">voted</span><span class="p">;</span>  <span class="c1">// if true, that person already voted</span>
        <span class="kt">address</span> <span class="n">delegate</span><span class="p">;</span> <span class="c1">// person delegated to</span>
        <span class="kt">uint</span> <span class="n">vote</span><span class="p">;</span>   <span class="c1">// index of the voted proposal</span>
    <span class="p">}</span>

    <span class="c1">// This is a type for a single proposal.</span>
    <span class="kd">struct</span> <span class="n">Proposal</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="n">name</span><span class="p">;</span>   <span class="c1">// short name (up to 32 bytes)</span>
        <span class="kt">uint</span> <span class="n">voteCount</span><span class="p">;</span> <span class="c1">// number of accumulated votes</span>
    <span class="p">}</span>

    <span class="kt">address</span> <span class="kr">public</span> <span class="n">chairperson</span><span class="p">;</span>

    <span class="c1">// This declares a state variable that</span>
    <span class="c1">// stores a `Voter` struct for each possible address.</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="n">Voter</span><span class="p">)</span> <span class="kr">public</span> <span class="n">voters</span><span class="p">;</span>

    <span class="c1">// A dynamically-sized array of `Proposal` structs.</span>
    <span class="n">Proposal</span><span class="p">[]</span> <span class="kr">public</span> <span class="n">proposals</span><span class="p">;</span>

    <span class="c1">/// Create a new ballot to choose one of `proposalNames`.</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">proposalNames</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">chairperson</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">voters</span><span class="p">[</span><span class="n">chairperson</span><span class="p">].</span><span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1">// For each of the provided proposal names,</span>
        <span class="c1">// create a new proposal object and add it</span>
        <span class="c1">// to the end of the array.</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">proposalNames</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// `Proposal({...})` creates a temporary</span>
            <span class="c1">// Proposal object and `proposals.push(...)`</span>
            <span class="c1">// appends it to the end of `proposals`.</span>
            <span class="n">proposals</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">Proposal</span><span class="p">({</span>
                <span class="n">name</span><span class="o">:</span> <span class="n">proposalNames</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">voteCount</span><span class="o">:</span> <span class="mi">0</span>
            <span class="p">}));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Give `voter` the right to vote on this ballot.</span>
    <span class="c1">// May only be called by `chairperson`.</span>
    <span class="kd">function</span> <span class="n">giveRightToVote</span><span class="p">(</span><span class="kt">address</span> <span class="n">voter</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// If the first argument of `require` evaluates</span>
        <span class="c1">// to `false`, execution terminates and all</span>
        <span class="c1">// changes to the state and to Ether balances</span>
        <span class="c1">// are reverted.</span>
        <span class="c1">// This used to consume all gas in old EVM versions, but</span>
        <span class="c1">// not anymore.</span>
        <span class="c1">// It is often a good idea to use `require` to check if</span>
        <span class="c1">// functions are called correctly.</span>
        <span class="c1">// As a second argument, you can also provide an</span>
        <span class="c1">// explanation about what went wrong.</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">chairperson</span><span class="p">,</span>
            <span class="s">&quot;Only chairperson can give right to vote.&quot;</span>
        <span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="o">!</span><span class="n">voters</span><span class="p">[</span><span class="n">voter</span><span class="p">].</span><span class="n">voted</span><span class="p">,</span>
            <span class="s">&quot;The voter already voted.&quot;</span>
        <span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">voters</span><span class="p">[</span><span class="n">voter</span><span class="p">].</span><span class="n">weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">voters</span><span class="p">[</span><span class="n">voter</span><span class="p">].</span><span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Delegate your vote to the voter `to`.</span>
    <span class="kd">function</span> <span class="n">delegate</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// assigns reference</span>
        <span class="n">Voter</span> <span class="kr">storage</span> <span class="n">sender</span> <span class="o">=</span> <span class="n">voters</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">sender</span><span class="p">.</span><span class="n">voted</span><span class="p">,</span> <span class="s">&quot;You already voted.&quot;</span><span class="p">);</span>

        <span class="nf">require</span><span class="p">(</span><span class="n">to</span> <span class="o">!=</span> <span class="nb">msg.sender</span><span class="p">,</span> <span class="s">&quot;Self-delegation is disallowed.&quot;</span><span class="p">);</span>

        <span class="c1">// Forward the delegation as long as</span>
        <span class="c1">// `to` also delegated.</span>
        <span class="c1">// In general, such loops are very dangerous,</span>
        <span class="c1">// because if they run too long, they might</span>
        <span class="c1">// need more gas than is available in a block.</span>
        <span class="c1">// In this case, the delegation will not be executed,</span>
        <span class="c1">// but in other situations, such loops might</span>
        <span class="c1">// cause a contract to get &quot;stuck&quot; completely.</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">voters</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">delegate</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">voters</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">delegate</span><span class="p">;</span>

            <span class="c1">// We found a loop in the delegation, not allowed.</span>
            <span class="nf">require</span><span class="p">(</span><span class="n">to</span> <span class="o">!=</span> <span class="nb">msg.sender</span><span class="p">,</span> <span class="s">&quot;Found loop in delegation.&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Since `sender` is a reference, this</span>
        <span class="c1">// modifies `voters[msg.sender].voted`</span>
        <span class="n">sender</span><span class="p">.</span><span class="n">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">sender</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">to</span><span class="p">;</span>
        <span class="n">Voter</span> <span class="kr">storage</span> <span class="n">delegate_</span> <span class="o">=</span> <span class="n">voters</span><span class="p">[</span><span class="n">to</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">delegate_</span><span class="p">.</span><span class="n">voted</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// If the delegate already voted,</span>
            <span class="c1">// directly add to the number of votes</span>
            <span class="n">proposals</span><span class="p">[</span><span class="n">delegate_</span><span class="p">.</span><span class="n">vote</span><span class="p">].</span><span class="n">voteCount</span> <span class="o">+=</span> <span class="n">sender</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// If the delegate did not vote yet,</span>
            <span class="c1">// add to her weight.</span>
            <span class="n">delegate_</span><span class="p">.</span><span class="n">weight</span> <span class="o">+=</span> <span class="n">sender</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// Give your vote (including votes delegated to you)</span>
    <span class="c1">/// to proposal `proposals[proposal].name`.</span>
    <span class="kd">function</span> <span class="n">vote</span><span class="p">(</span><span class="kt">uint</span> <span class="n">proposal</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">Voter</span> <span class="kr">storage</span> <span class="n">sender</span> <span class="o">=</span> <span class="n">voters</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">sender</span><span class="p">.</span><span class="n">weight</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Has no right to vote&quot;</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">sender</span><span class="p">.</span><span class="n">voted</span><span class="p">,</span> <span class="s">&quot;Already voted.&quot;</span><span class="p">);</span>
        <span class="n">sender</span><span class="p">.</span><span class="n">voted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">sender</span><span class="p">.</span><span class="n">vote</span> <span class="o">=</span> <span class="n">proposal</span><span class="p">;</span>

        <span class="c1">// If `proposal` is out of the range of the array,</span>
        <span class="c1">// this will throw automatically and revert all</span>
        <span class="c1">// changes.</span>
        <span class="n">proposals</span><span class="p">[</span><span class="n">proposal</span><span class="p">].</span><span class="n">voteCount</span> <span class="o">+=</span> <span class="n">sender</span><span class="p">.</span><span class="n">weight</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> Computes the winning proposal taking all</span>
    <span class="c1">/// previous votes into account.</span>
    <span class="kd">function</span> <span class="n">winningProposal</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">winningProposal_</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">winningVoteCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">proposals</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">proposals</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">voteCount</span> <span class="o">&gt;</span> <span class="n">winningVoteCount</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">winningVoteCount</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">p</span><span class="p">].</span><span class="n">voteCount</span><span class="p">;</span>
                <span class="n">winningProposal_</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Calls winningProposal() function to get the index</span>
    <span class="c1">// of the winner contained in the proposals array and then</span>
    <span class="c1">// returns the name of the winner</span>
    <span class="kd">function</span> <span class="n">winnerName</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span> <span class="n">winnerName_</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">winnerName_</span> <span class="o">=</span> <span class="n">proposals</span><span class="p">[</span><span class="n">winningProposal</span><span class="p">()].</span><span class="n">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="possible-improvements">
<h4>Possible Improvements<a class="headerlink" href="#possible-improvements" title="Permalink to this headline">¶</a></h4>
<p>Currently, many transactions are needed to assign the rights
to vote to all participants. Can you think of a better way?</p>
</div>
</div>
<div class="section" id="blind-auction">
<span id="index-1"></span><h3>Blind Auction<a class="headerlink" href="#blind-auction" title="Permalink to this headline">¶</a></h3>
<p>In this section, we will show how easy it is to create a
completely blind auction contract on Ethereum.
We will start with an open auction where everyone
can see the bids that are made and then extend this
contract into a blind auction where it is not
possible to see the actual bid until the bidding
period ends.</p>
<div class="section" id="simple-open-auction">
<span id="simple-auction"></span><h4>Simple Open Auction<a class="headerlink" href="#simple-open-auction" title="Permalink to this headline">¶</a></h4>
<p>The general idea of the following simple auction contract
is that everyone can send their bids during
a bidding period. The bids already include sending
money / ether in order to bind the bidders to their
bid. If the highest bid is raised, the previously
highest bidder gets her money back.
After the end of the bidding period, the
contract has to be called manually for the
beneficiary to receive their money - contracts cannot
activate themselves.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SimpleAuction</span> <span class="p">{</span>
    <span class="c1">// Parameters of the auction. Times are either</span>
    <span class="c1">// absolute unix timestamps (seconds since 1970-01-01)</span>
    <span class="c1">// or time periods in seconds.</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">auctionEndTime</span><span class="p">;</span>

    <span class="c1">// Current state of the auction.</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">highestBid</span><span class="p">;</span>

    <span class="c1">// Allowed withdrawals of previous bids</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">pendingReturns</span><span class="p">;</span>

    <span class="c1">// Set to true at the end, disallows any change.</span>
    <span class="c1">// By default initialized to `false`.</span>
    <span class="kt">bool</span> <span class="n">ended</span><span class="p">;</span>

    <span class="c1">// Events that will be emitted on changes.</span>
    <span class="kd">event</span> <span class="n">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span> <span class="n">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">);</span>
    <span class="kd">event</span> <span class="n">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="n">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">);</span>

    <span class="c1">// The following is a so-called natspec comment,</span>
    <span class="c1">// recognizable by the three slashes.</span>
    <span class="c1">// It will be shown when the user is asked to</span>
    <span class="c1">// confirm a transaction.</span>

    <span class="c1">/// Create a simple auction with `_biddingTime`</span>
    <span class="c1">/// seconds bidding time on behalf of the</span>
    <span class="c1">/// beneficiary address `_beneficiary`.</span>
    <span class="kd">constructor</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_biddingTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="kr">payable</span> <span class="n">_beneficiary</span>
    <span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">beneficiary</span> <span class="o">=</span> <span class="n">_beneficiary</span><span class="p">;</span>
        <span class="n">auctionEndTime</span> <span class="o">=</span> <span class="nb">now</span> <span class="o">+</span> <span class="n">_biddingTime</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Bid on the auction with the value sent</span>
    <span class="c1">/// together with this transaction.</span>
    <span class="c1">/// The value will only be refunded if the</span>
    <span class="c1">/// auction is not won.</span>
    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="c1">// No arguments are necessary, all</span>
        <span class="c1">// information is already part of</span>
        <span class="c1">// the transaction. The keyword payable</span>
        <span class="c1">// is required for the function to</span>
        <span class="c1">// be able to receive Ether.</span>

        <span class="c1">// Revert the call if the bidding</span>
        <span class="c1">// period is over.</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">now</span> <span class="o">&lt;=</span> <span class="n">auctionEndTime</span><span class="p">,</span>
            <span class="s">&quot;Auction already ended.&quot;</span>
        <span class="p">);</span>

        <span class="c1">// If the bid is not higher, send the</span>
        <span class="c1">// money back.</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">highestBid</span><span class="p">,</span>
            <span class="s">&quot;There already is a higher bid.&quot;</span>
        <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">highestBid</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Sending back the money by simply using</span>
            <span class="c1">// highestBidder.send(highestBid) is a security risk</span>
            <span class="c1">// because it could execute an untrusted contract.</span>
            <span class="c1">// It is always safer to let the recipients</span>
            <span class="c1">// withdraw their money themselves.</span>
            <span class="n">pendingReturns</span><span class="p">[</span><span class="n">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="n">highestBid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">highestBidder</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">highestBid</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
        <span class="kr">emit</span> <span class="n">HighestBidIncreased</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="nb">msg.value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// Withdraw a bid that was overbid.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">pendingReturns</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// It is important to set this to zero because the recipient</span>
            <span class="c1">// can call this function again as part of the receiving call</span>
            <span class="c1">// before `send` returns.</span>
            <span class="n">pendingReturns</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">msg.sender</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">amount</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// No need to call throw here, just reset the amount owing</span>
                <span class="n">pendingReturns</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">amount</span><span class="p">;</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// End the auction and send the highest bid</span>
    <span class="c1">/// to the beneficiary.</span>
    <span class="kd">function</span> <span class="n">auctionEnd</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// It is a good guideline to structure functions that interact</span>
        <span class="c1">// with other contracts (i.e. they call functions or send Ether)</span>
        <span class="c1">// into three phases:</span>
        <span class="c1">// 1. checking conditions</span>
        <span class="c1">// 2. performing actions (potentially changing conditions)</span>
        <span class="c1">// 3. interacting with other contracts</span>
        <span class="c1">// If these phases are mixed up, the other contract could call</span>
        <span class="c1">// back into the current contract and modify the state or cause</span>
        <span class="c1">// effects (ether payout) to be performed multiple times.</span>
        <span class="c1">// If functions called internally include interaction with external</span>
        <span class="c1">// contracts, they also have to be considered interaction with</span>
        <span class="c1">// external contracts.</span>

        <span class="c1">// 1. Conditions</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">auctionEndTime</span><span class="p">,</span> <span class="s">&quot;Auction not yet ended.&quot;</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">ended</span><span class="p">,</span> <span class="s">&quot;auctionEnd has already been called.&quot;</span><span class="p">);</span>

        <span class="c1">// 2. Effects</span>
        <span class="n">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kr">emit</span> <span class="n">AuctionEnded</span><span class="p">(</span><span class="n">highestBidder</span><span class="p">,</span> <span class="n">highestBid</span><span class="p">);</span>

        <span class="c1">// 3. Interaction</span>
        <span class="n">beneficiary</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">highestBid</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Blind Auction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The previous open auction is extended to a blind auction
in the following. The advantage of a blind auction is
that there is no time pressure towards the end of
the bidding period. Creating a blind auction on a
transparent computing platform might sound like a
contradiction, but cryptography comes to the rescue.</p>
<p>During the <strong>bidding period</strong>, a bidder does not
actually send her bid, but only a hashed version of it.
Since it is currently considered practically impossible
to find two (sufficiently long) values whose hash
values are equal, the bidder commits to the bid by that.
After the end of the bidding period, the bidders have
to reveal their bids: They send their values
unencrypted and the contract checks that the hash value
is the same as the one provided during the bidding period.</p>
<p>Another challenge is how to make the auction
<strong>binding and blind</strong> at the same time: The only way to
prevent the bidder from just not sending the money
after they won the auction is to make her send it
together with the bid. Since value transfers cannot
be blinded in Ethereum, anyone can see the value.</p>
<p>The following contract solves this problem by
accepting any value that is larger than the highest
bid. Since this can of course only be checked during
the reveal phase, some bids might be <strong>invalid</strong>, and
this is on purpose (it even provides an explicit
flag to place invalid bids with high value transfers):
Bidders can confuse competition by placing several
high or low invalid bids.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">23</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">BlindAuction</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="n">Bid</span> <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="n">blindedBid</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">deposit</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">beneficiary</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">biddingEnd</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">revealEnd</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="kr">public</span> <span class="n">ended</span><span class="p">;</span>

    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="n">Bid</span><span class="p">[])</span> <span class="kr">public</span> <span class="n">bids</span><span class="p">;</span>

    <span class="kt">address</span> <span class="kr">public</span> <span class="n">highestBidder</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">highestBid</span><span class="p">;</span>

    <span class="c1">// Allowed withdrawals of previous bids</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">pendingReturns</span><span class="p">;</span>

    <span class="kd">event</span> <span class="n">AuctionEnded</span><span class="p">(</span><span class="kt">address</span> <span class="n">winner</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">highestBid</span><span class="p">);</span>

    <span class="c1">/// Modifiers are a convenient way to validate inputs to</span>
    <span class="c1">/// functions. `onlyBefore` is applied to `bid` below:</span>
    <span class="c1">/// The new function body is the modifier&#39;s body where</span>
    <span class="c1">/// `_` is replaced by the old function body.</span>
    <span class="kd">modifier</span> <span class="n">onlyBefore</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_time</span><span class="p">)</span> <span class="p">{</span> <span class="nf">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&lt;</span> <span class="n">_time</span><span class="p">);</span> <span class="kr">_</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">modifier</span> <span class="n">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_time</span><span class="p">)</span> <span class="p">{</span> <span class="nf">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;</span> <span class="n">_time</span><span class="p">);</span> <span class="kr">_</span><span class="p">;</span> <span class="p">}</span>

    <span class="kd">constructor</span><span class="p">(</span>
        <span class="kt">uint</span> <span class="n">_biddingTime</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_revealTime</span><span class="p">,</span>
        <span class="kt">address</span> <span class="kr">payable</span> <span class="n">_beneficiary</span>
    <span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">beneficiary</span> <span class="o">=</span> <span class="n">_beneficiary</span><span class="p">;</span>
        <span class="n">biddingEnd</span> <span class="o">=</span> <span class="nb">now</span> <span class="o">+</span> <span class="n">_biddingTime</span><span class="p">;</span>
        <span class="n">revealEnd</span> <span class="o">=</span> <span class="n">biddingEnd</span> <span class="o">+</span> <span class="n">_revealTime</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Place a blinded bid with `_blindedBid` =</span>
    <span class="c1">/// keccak256(abi.encodePacked(value, fake, secret)).</span>
    <span class="c1">/// The sent ether is only refunded if the bid is correctly</span>
    <span class="c1">/// revealed in the revealing phase. The bid is valid if the</span>
    <span class="c1">/// ether sent together with the bid is at least &quot;value&quot; and</span>
    <span class="c1">/// &quot;fake&quot; is not true. Setting &quot;fake&quot; to true and sending</span>
    <span class="c1">/// not the exact amount are ways to hide the real bid but</span>
    <span class="c1">/// still make the required deposit. The same address can</span>
    <span class="c1">/// place multiple bids.</span>
    <span class="kd">function</span> <span class="n">bid</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_blindedBid</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">payable</span>
        <span class="n">onlyBefore</span><span class="p">(</span><span class="n">biddingEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">bids</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">].</span><span class="nf">push</span><span class="p">(</span><span class="n">Bid</span><span class="p">({</span>
            <span class="n">blindedBid</span><span class="o">:</span> <span class="n">_blindedBid</span><span class="p">,</span>
            <span class="n">deposit</span><span class="o">:</span> <span class="nb">msg.value</span>
        <span class="p">}));</span>
    <span class="p">}</span>

    <span class="c1">/// Reveal your blinded bids. You will get a refund for all</span>
    <span class="c1">/// correctly blinded invalid bids and for all bids except for</span>
    <span class="c1">/// the totally highest.</span>
    <span class="kd">function</span> <span class="n">reveal</span><span class="p">(</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">_values</span><span class="p">,</span>
        <span class="kt">bool</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">_fake</span><span class="p">,</span>
        <span class="kt">bytes32</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">_secret</span>
    <span class="p">)</span>
        <span class="kr">public</span>
        <span class="n">onlyAfter</span><span class="p">(</span><span class="n">biddingEnd</span><span class="p">)</span>
        <span class="n">onlyBefore</span><span class="p">(</span><span class="n">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">length</span> <span class="o">=</span> <span class="n">bids</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">].</span><span class="n">length</span><span class="p">;</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">_values</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">length</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">_fake</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">length</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">_secret</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">length</span><span class="p">);</span>

        <span class="kt">uint</span> <span class="n">refund</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Bid</span> <span class="kr">storage</span> <span class="n">bidToCheck</span> <span class="o">=</span> <span class="n">bids</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
            <span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">fake</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">secret</span><span class="p">)</span> <span class="o">=</span>
                    <span class="p">(</span><span class="n">_values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_fake</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_secret</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">bidToCheck</span><span class="p">.</span><span class="n">blindedBid</span> <span class="o">!=</span> <span class="nf">keccak256</span><span class="p">(</span><span class="nb">abi.encodePacked</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">fake</span><span class="p">,</span> <span class="n">secret</span><span class="p">)))</span> <span class="p">{</span>
                <span class="c1">// Bid was not actually revealed.</span>
                <span class="c1">// Do not refund deposit.</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">refund</span> <span class="o">+=</span> <span class="n">bidToCheck</span><span class="p">.</span><span class="n">deposit</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fake</span> <span class="o">&amp;&amp;</span> <span class="n">bidToCheck</span><span class="p">.</span><span class="n">deposit</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">placeBid</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
                    <span class="n">refund</span> <span class="o">-=</span> <span class="n">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// Make it impossible for the sender to re-claim</span>
            <span class="c1">// the same deposit.</span>
            <span class="n">bidToCheck</span><span class="p">.</span><span class="n">blindedBid</span> <span class="o">=</span> <span class="kt">bytes32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">refund</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// This is an &quot;internal&quot; function which means that it</span>
    <span class="c1">// can only be called from the contract itself (or from</span>
    <span class="c1">// derived contracts).</span>
    <span class="kd">function</span> <span class="n">placeBid</span><span class="p">(</span><span class="kt">address</span> <span class="n">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="kr">internal</span>
            <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">highestBid</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">highestBidder</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Refund the previously highest bidder.</span>
            <span class="n">pendingReturns</span><span class="p">[</span><span class="n">highestBidder</span><span class="p">]</span> <span class="o">+=</span> <span class="n">highestBid</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">highestBid</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
        <span class="n">highestBidder</span> <span class="o">=</span> <span class="n">bidder</span><span class="p">;</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Withdraw a bid that was overbid.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">pendingReturns</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// It is important to set this to zero because the recipient</span>
            <span class="c1">// can call this function again as part of the receiving call</span>
            <span class="c1">// before `transfer` returns (see the remark above about</span>
            <span class="c1">// conditions -&gt; effects -&gt; interaction).</span>
            <span class="n">pendingReturns</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// End the auction and send the highest bid</span>
    <span class="c1">/// to the beneficiary.</span>
    <span class="kd">function</span> <span class="n">auctionEnd</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">onlyAfter</span><span class="p">(</span><span class="n">revealEnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">ended</span><span class="p">);</span>
        <span class="kr">emit</span> <span class="n">AuctionEnded</span><span class="p">(</span><span class="n">highestBidder</span><span class="p">,</span> <span class="n">highestBid</span><span class="p">);</span>
        <span class="n">ended</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="n">beneficiary</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">highestBid</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="safe-remote-purchase">
<span id="index-2"></span><h3>Safe Remote Purchase<a class="headerlink" href="#safe-remote-purchase" title="Permalink to this headline">¶</a></h3>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Purchase</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">value</span><span class="p">;</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">seller</span><span class="p">;</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">buyer</span><span class="p">;</span>
    <span class="kd">enum</span> <span class="n">State</span> <span class="p">{</span> <span class="n">Created</span><span class="p">,</span> <span class="n">Locked</span><span class="p">,</span> <span class="n">Inactive</span> <span class="p">}</span>
    <span class="n">State</span> <span class="kr">public</span> <span class="n">state</span><span class="p">;</span>

    <span class="c1">// Ensure that `msg.value` is an even number.</span>
    <span class="c1">// Division will truncate if it is an odd number.</span>
    <span class="c1">// Check via multiplication that it wasn&#39;t an odd number.</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">seller</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="nf">require</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">msg.value</span><span class="p">,</span> <span class="s">&quot;Value has to be even.&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">condition</span><span class="p">(</span><span class="kt">bool</span> <span class="n">_condition</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">_condition</span><span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">onlyBuyer</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">buyer</span><span class="p">,</span>
            <span class="s">&quot;Only buyer can call this.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">onlySeller</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">seller</span><span class="p">,</span>
            <span class="s">&quot;Only seller can call this.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">inState</span><span class="p">(</span><span class="n">State</span> <span class="n">_state</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="n">state</span> <span class="o">==</span> <span class="n">_state</span><span class="p">,</span>
            <span class="s">&quot;Invalid state.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">event</span> <span class="n">Aborted</span><span class="p">();</span>
    <span class="kd">event</span> <span class="n">PurchaseConfirmed</span><span class="p">();</span>
    <span class="kd">event</span> <span class="n">ItemReceived</span><span class="p">();</span>

    <span class="c1">/// Abort the purchase and reclaim the ether.</span>
    <span class="c1">/// Can only be called by the seller before</span>
    <span class="c1">/// the contract is locked.</span>
    <span class="kd">function</span> <span class="n">abort</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">onlySeller</span>
        <span class="n">inState</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Created</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kr">emit</span> <span class="n">Aborted</span><span class="p">();</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">.</span><span class="n">Inactive</span><span class="p">;</span>
        <span class="n">seller</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// Confirm the purchase as buyer.</span>
    <span class="c1">/// Transaction has to include `2 * value` ether.</span>
    <span class="c1">/// The ether will be locked until confirmReceived</span>
    <span class="c1">/// is called.</span>
    <span class="kd">function</span> <span class="n">confirmPurchase</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">inState</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Created</span><span class="p">)</span>
        <span class="n">condition</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">==</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">value</span><span class="p">))</span>
        <span class="kr">payable</span>
    <span class="p">{</span>
        <span class="kr">emit</span> <span class="n">PurchaseConfirmed</span><span class="p">();</span>
        <span class="n">buyer</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">.</span><span class="n">Locked</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Confirm that you (the buyer) received the item.</span>
    <span class="c1">/// This will release the locked ether.</span>
    <span class="kd">function</span> <span class="n">confirmReceived</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">onlyBuyer</span>
        <span class="n">inState</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Locked</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kr">emit</span> <span class="n">ItemReceived</span><span class="p">();</span>
        <span class="c1">// It is important to change the state first because</span>
        <span class="c1">// otherwise, the contracts called using `send` below</span>
        <span class="c1">// can call in again here.</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">.</span><span class="n">Inactive</span><span class="p">;</span>

        <span class="c1">// NOTE: This actually allows both the buyer and the seller to</span>
        <span class="c1">// block the refund - the withdraw pattern should be used.</span>

        <span class="n">buyer</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
        <span class="n">seller</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="micropayment-channel">
<h3>Micropayment Channel<a class="headerlink" href="#micropayment-channel" title="Permalink to this headline">¶</a></h3>
<p>In this section we will learn how to build an example implementation
of a payment channel. It uses cryptographic signatures to make
repeated transfers of Ether between the same parties secure, instantaneous, and
without transaction fees. For the example, we need to understand how to
sign and verify signatures, and setup the payment channel.</p>
<div class="section" id="creating-and-verifying-signatures">
<h4>Creating and verifying signatures<a class="headerlink" href="#creating-and-verifying-signatures" title="Permalink to this headline">¶</a></h4>
<p>Imagine Alice wants to send a quantity of Ether to Bob, i.e.
Alice is the sender and the Bob is the recipient.</p>
<p>Alice only needs to send cryptographically signed messages off-chain
(e.g. via email) to Bob and it is similar to writing checks.</p>
<p>Alice and Bob use signatures to authorise transactions, which is possible with smart contracts on Ethereum.
Alice will build a simple smart contract that lets her transmit Ether, but instead of calling a function herself
to initiate a payment, she will let Bob do that, and therefore pay the transaction fee.</p>
<p>The contract will work as follows:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Alice deploys the <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> contract, attaching enough Ether to cover the payments that will be made.</li>
<li>Alice authorises a payment by signing a message with their private key.</li>
<li>Alice sends the cryptographically signed message to Bob. The message does not need to be kept secret
(explained later), and the mechanism for sending it does not matter.</li>
<li>Bob claims their payment by presenting the signed message to the smart contract, it verifies the
authenticity of the message and then releases the funds.</li>
</ol>
</div></blockquote>
<div class="section" id="creating-the-signature">
<h5>Creating the signature<a class="headerlink" href="#creating-the-signature" title="Permalink to this headline">¶</a></h5>
<p>Alice does not need to interact with the Ethereum network to sign the transaction, the process is completely offline.
In this tutorial, we will sign messages in the browser using <a class="reference external" href="https://github.com/ethereum/web3.js">web3.js</a> and <a class="reference external" href="https://metamask.io">MetaMask</a>, using the method described in <a class="reference external" href="https://github.com/ethereum/EIPs/pull/712">EIP-762</a>,
as it provides a number of other security benefits.</p>
<dl class="docutils">
<dt>::</dt>
<dd>/// Hashing first makes things easier
var hash = web3.utils.sha3(“message to sign”);
web3.eth.personal.sign(hash, web3.eth.defaultAccount, function () { console.log(“Signed”); });</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">web3.eth.personal.sign</span></code> prepends the length of the message to the signed data. Since we hash first, the message will always be exactly 32 bytes long, and thus this length prefix is always the same.</p>
</div>
</div>
<div class="section" id="what-to-sign">
<h5>What to Sign<a class="headerlink" href="#what-to-sign" title="Permalink to this headline">¶</a></h5>
<p>For a contract that fulfils payments, the signed message must include:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The recipient’s address.</li>
<li>The amount to be transferred.</li>
<li>Protection against replay attacks.</li>
</ol>
</div></blockquote>
<p>A replay attack is when a signed message is reused to claim authorization for
a second action.
To avoid replay attacks we use the same as in Ethereum transactions
themselves, a so-called nonce, which is the number of transactions sent by an
account.
The smart contract checks if a nonce is used multiple times.</p>
<p>Another type of replay attack can occur when the owner deploys a <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> smart contract, makes some payments, and then destroys the contract. Later, they decide to deploy the <code class="docutils literal notranslate"><span class="pre">RecipientPays</span></code> smart contract again, but the new contract does not know the nonces used in the previous deployment, so the attacker can use the old messages again.</p>
<p>Alice can protect against this attack by including the contract’s address in the message, and only messages containing the contract’s address itself will be accepted. You can find an example of this in the first two lines of the <code class="docutils literal notranslate"><span class="pre">claimPayment()</span></code> function of the full contract at the end of this section.</p>
</div>
<div class="section" id="packing-arguments">
<h5>Packing arguments<a class="headerlink" href="#packing-arguments" title="Permalink to this headline">¶</a></h5>
<p>Now that we have identified what information to include in the signed message,
we are ready to put the message together, hash it, and sign it. For simplicity,
we concatenate the data. The <a class="reference external" href="https://github.com/ethereumjs/ethereumjs-abi">ethereumjs-abi</a>
library provides a function called <code class="docutils literal notranslate"><span class="pre">soliditySHA3</span></code> that mimics the behaviour of
Solidity’s <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> function applied to arguments encoded using <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code>.
Here is a JavaScript function that creates the proper signature for the <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// recipient is the address that should be paid.</span>
<span class="c1">// amount, in wei, specifies how much ether should be sent.</span>
<span class="c1">// nonce can be any unique number to prevent replay attacks</span>
<span class="c1">// contractAddress is used to prevent cross-contract replay attacks</span>
<span class="kd">function</span> <span class="n">signPayment</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="n">contractAddress</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">hash</span> <span class="o">=</span> <span class="s">&quot;0x&quot;</span> <span class="o">+</span> <span class="n">abi</span><span class="p">.</span><span class="n">soliditySHA3</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&quot;address&quot;</span><span class="p">,</span> <span class="s">&quot;uint256&quot;</span><span class="p">,</span> <span class="s">&quot;uint256&quot;</span><span class="p">,</span> <span class="s">&quot;address&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="n">recipient</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="n">contractAddress</span><span class="p">]</span>
    <span class="p">).</span><span class="n">toString</span><span class="p">(</span><span class="s">&quot;hex&quot;</span><span class="p">);</span>

    <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">personal</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">defaultAccount</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="recovering-the-message-signer-in-solidity">
<h5>Recovering the Message Signer in Solidity<a class="headerlink" href="#recovering-the-message-signer-in-solidity" title="Permalink to this headline">¶</a></h5>
<p>In general, ECDSA signatures consist of two parameters, <code class="docutils literal notranslate"><span class="pre">r</span></code> and <code class="docutils literal notranslate"><span class="pre">s</span></code>. Signatures in Ethereum include a third parameter called <code class="docutils literal notranslate"><span class="pre">v</span></code>, that you can use to verify which account’s private key was used to sign the message, and the transaction’s sender. Solidity provides a built-in function <a class="reference external" href="mathematical-and-cryptographic-functions">ecrecover</a> that accepts a message along with the <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code> parameters and returns the address that was used to sign the message.</p>
</div>
<div class="section" id="extracting-the-signature-parameters">
<h5>Extracting the Signature Parameters<a class="headerlink" href="#extracting-the-signature-parameters" title="Permalink to this headline">¶</a></h5>
<p>Signatures produced by web3.js are the concatenation of <code class="docutils literal notranslate"><span class="pre">r</span></code>, <code class="docutils literal notranslate"><span class="pre">s</span></code> and <code class="docutils literal notranslate"><span class="pre">v</span></code>, so the first step is to split these parameters apart. You can do this on the client-side, but doing it inside the smart contract means you only need to send one signature parameter rather than three. Splitting apart a byte array into component parts is a mess, so we use <a class="reference external" href="assembly">inline assembly</a> to do the job in the <code class="docutils literal notranslate"><span class="pre">splitSignature</span></code> function (the third function in the full contract at the end of this section).</p>
</div>
<div class="section" id="computing-the-message-hash">
<h5>Computing the Message Hash<a class="headerlink" href="#computing-the-message-hash" title="Permalink to this headline">¶</a></h5>
<p>The smart contract needs to know exactly what parameters were signed, and so it
must recreate the message from the parameters and use that for signature verification.
The functions <code class="docutils literal notranslate"><span class="pre">prefixed</span></code> and <code class="docutils literal notranslate"><span class="pre">recoverSigner</span></code> do this in the <code class="docutils literal notranslate"><span class="pre">claimPayment</span></code> function.</p>
</div>
<div class="section" id="the-full-contract">
<h5>The full contract<a class="headerlink" href="#the-full-contract" title="Permalink to this headline">¶</a></h5>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">24</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">ReceiverPays</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>

    <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">usedNonces</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{}</span>

    <span class="kd">function</span> <span class="n">claimPayment</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">nonce</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">signature</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="o">!</span><span class="n">usedNonces</span><span class="p">[</span><span class="n">nonce</span><span class="p">]);</span>
        <span class="n">usedNonces</span><span class="p">[</span><span class="n">nonce</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="c1">// this recreates the message that was signed on the client</span>
        <span class="kt">bytes32</span> <span class="n">message</span> <span class="o">=</span> <span class="n">prefixed</span><span class="p">(</span><span class="nf">keccak256</span><span class="p">(</span><span class="nb">abi.encodePacked</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="nb">this</span><span class="p">)));</span>

        <span class="nf">require</span><span class="p">(</span><span class="n">recoverSigner</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>

        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// destroy the contract and reclaim the leftover funds.</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// signature methods.</span>
    <span class="kd">function</span> <span class="n">splitSignature</span><span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">sig</span><span class="p">)</span>
        <span class="kr">internal</span>
        <span class="kr">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">65</span><span class="p">);</span>

        <span class="k">assembly</span> <span class="p">{</span>
            <span class="c1">// first 32 bytes, after the length prefix.</span>
            <span class="n">r</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
            <span class="c1">// second 32 bytes.</span>
            <span class="n">s</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
            <span class="c1">// final byte (first byte of the next 32 bytes).</span>
            <span class="n">v</span> <span class="o">:=</span> <span class="nf">byte</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">mload</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">96</span><span class="p">)))</span>
        <span class="p">}</span>

        <span class="nf">return</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span><span class="err">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">recoverSigner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">message</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">sig</span><span class="p">)</span>
        <span class="kr">internal</span>
        <span class="kr">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">(</span><span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="n">splitSignature</span><span class="p">(</span><span class="n">sig</span><span class="p">);</span>

        <span class="k">return</span> <span class="nf">ecrecover</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// builds a prefixed hash to mimic the behavior of eth_sign.</span>
    <span class="kd">function</span> <span class="n">prefixed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">hash</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">keccak256</span><span class="p">(</span><span class="nb">abi.encodePacked</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\x19</span><span class="s">Ethereum Signed Message:</span><span class="se">\n</span><span class="s">32&quot;</span><span class="p">,</span> <span class="n">hash</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="writing-a-simple-payment-channel">
<h4>Writing a Simple Payment Channel<a class="headerlink" href="#writing-a-simple-payment-channel" title="Permalink to this headline">¶</a></h4>
<p>Alice now builds a simple but complete implementation of a payment channel. Payment channels use cryptographic signatures to make repeated transfers of Ether securely, instantaneously, and without transaction fees.</p>
<div class="section" id="what-is-a-payment-channel">
<h5>What is a Payment Channel?<a class="headerlink" href="#what-is-a-payment-channel" title="Permalink to this headline">¶</a></h5>
<p>Payment channels allow participants to make repeated transfers of Ether without using transactions. This means that you can avoid the delays and fees associated with transactions. We are going to explore a simple unidirectional payment channel between two parties (Alice and Bob). It involves three steps:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Alice funds a smart contract with Ether. This “opens” the payment channel.</li>
<li>Alice signs messages that specify how much of that Ether is owed to the recipient. This step is repeated for each payment.</li>
<li>Bob “closes” the payment channel, withdrawing their portion of the Ether and sending the remainder back to the sender.</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only steps 1 and 3 require Ethereum transactions, step 2 means that the sender transmits a cryptographically signed message to the recipient via off chain methods (e.g. email). This means only two transactions are required to support any number of transfers.</p>
</div>
<p>Bob is guaranteed to receive their funds because the smart contract escrows the Ether and honours a valid signed message. The smart contract also enforces a timeout, so Alice is guaranteed to eventually recover their funds even if the recipient refuses to close the channel. It is up to the participants in a payment channel to decide how long to keep it open. For a short-lived transaction, such as paying an internet café for each minute of network access, or for a longer relationship, such as paying an employee an hourly wage, a payment could last for months or years.</p>
</div>
<div class="section" id="opening-the-payment-channel">
<h5>Opening the Payment Channel<a class="headerlink" href="#opening-the-payment-channel" title="Permalink to this headline">¶</a></h5>
<p>To open the payment channel, Alice deploys the smart contract, attaching the Ether to be escrowed and specifying the intended recipient and a maximum duration for the channel to exist. This is the function <code class="docutils literal notranslate"><span class="pre">SimplePaymentChannel</span></code> in the contract, at the end of this section.</p>
</div>
<div class="section" id="making-payments">
<h5>Making Payments<a class="headerlink" href="#making-payments" title="Permalink to this headline">¶</a></h5>
<p>Alice makes payments by sending signed messages to Bob.
This step is performed entirely outside of the Ethereum network.
Messages are cryptographically signed by the sender and then transmitted directly to the recipient.</p>
<p>Each message includes the following information:</p>
<blockquote>
<div><ul class="simple">
<li>The smart contract’s address, used to prevent cross-contract replay attacks.</li>
<li>The total amount of Ether that is owed the recipient so far.</li>
</ul>
</div></blockquote>
<p>A payment channel is closed just once, at the end of a series of transfers.
Because of this, only one of the messages sent is redeemed. This is why
each message specifies a cumulative total amount of Ether owed, rather than the
amount of the individual micropayment. The recipient will naturally choose to
redeem the most recent message because that is the one with the highest total.
The nonce per-message is not needed anymore, because the smart contract only honors a single message. The address of the smart contract is still used
to prevent a message intended for one payment channel from being used for a different channel.</p>
<p>Here is the modified JavaScript code to cryptographically sign a message from the previous section:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">constructPaymentMessage</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">abi</span><span class="p">.</span><span class="n">soliditySHA3</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&quot;address&quot;</span><span class="p">,</span> <span class="s">&quot;uint256&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">signMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">personal</span><span class="p">.</span><span class="n">sign</span><span class="p">(</span>
        <span class="s">&quot;0x&quot;</span> <span class="o">+</span> <span class="n">message</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="s">&quot;hex&quot;</span><span class="p">),</span>
        <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">defaultAccount</span><span class="p">,</span>
        <span class="n">callback</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// contractAddress is used to prevent cross-contract replay attacks.</span>
<span class="c1">// amount, in wei, specifies how much Ether should be sent.</span>

<span class="kd">function</span> <span class="n">signPayment</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">message</span> <span class="o">=</span> <span class="n">constructPaymentMessage</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">);</span>
    <span class="n">signMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">callback</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="closing-the-payment-channel">
<h5>Closing the Payment Channel<a class="headerlink" href="#closing-the-payment-channel" title="Permalink to this headline">¶</a></h5>
<p>When Bob is ready to receive their funds, it is time to
close the payment channel by calling a <code class="docutils literal notranslate"><span class="pre">close</span></code> function on the smart contract.
Closing the channel pays the recipient the Ether they are owed and destroys the contract, sending any remaining Ether back to Alice. To close the channel, Bob needs to provide a message signed by Alice.</p>
<p>The smart contract must verify that the message contains a valid signature from the sender.
The process for doing this verification is the same as the process the recipient uses.
The Solidity functions <code class="docutils literal notranslate"><span class="pre">isValidSignature</span></code> and <code class="docutils literal notranslate"><span class="pre">recoverSigner</span></code> work just like their
JavaScript counterparts in the previous section, with the latter function borrowed from the <code class="docutils literal notranslate"><span class="pre">ReceiverPays</span></code> contract.</p>
<p>Only the payment channel recipient can call the <code class="docutils literal notranslate"><span class="pre">close</span></code> function,
who naturally passes the most recent payment message because that message
carries the highest total owed. If the sender were allowed to call this function,
they could provide a message with a lower amount and cheat the recipient out of what they are owed.</p>
<p>The function verifies the signed message matches the given parameters.
If everything checks out, the recipient is sent their portion of the Ether,
and the sender is sent the rest via a <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.
You can see the <code class="docutils literal notranslate"><span class="pre">close</span></code> function in the full contract.</p>
</div>
<div class="section" id="channel-expiration">
<h5>Channel Expiration<a class="headerlink" href="#channel-expiration" title="Permalink to this headline">¶</a></h5>
<p>Bob can close the payment channel at any time, but if they fail to do so,
Alice needs a way to recover their escrowed funds. An <em>expiration</em> time was set
at the time of contract deployment. Once that time is reached, Alice can call
<code class="docutils literal notranslate"><span class="pre">claimTimeout</span></code> to recover their funds. You can see the <code class="docutils literal notranslate"><span class="pre">claimTimeout</span></code> function in the full contract.</p>
<p>After this function is called, Bob can no longer receive any Ether,
so it is important that Bob closes the channel before the expiration is reached.</p>
</div>
<div class="section" id="id3">
<h5>The full contract<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">24</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SimplePaymentChannel</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">sender</span><span class="p">;</span>      <span class="c1">// The account sending payments.</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">recipient</span><span class="p">;</span>   <span class="c1">// The account receiving the payments.</span>
    <span class="kt">uint256</span> <span class="kr">public</span> <span class="n">expiration</span><span class="p">;</span>  <span class="c1">// Timeout in case the recipient never closes.</span>

    <span class="kd">constructor</span> <span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">_recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">duration</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">payable</span>
    <span class="p">{</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">recipient</span> <span class="o">=</span> <span class="n">_recipient</span><span class="p">;</span>
        <span class="n">expiration</span> <span class="o">=</span> <span class="nb">now</span> <span class="o">+</span> <span class="n">duration</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">isValidSignature</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">signature</span><span class="p">)</span>
        <span class="kr">internal</span>
        <span class="kr">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">bytes32</span> <span class="n">message</span> <span class="o">=</span> <span class="n">prefixed</span><span class="p">(</span><span class="nf">keccak256</span><span class="p">(</span><span class="nb">abi.encodePacked</span><span class="p">(</span><span class="nb">this</span><span class="p">,</span> <span class="n">amount</span><span class="p">)));</span>

        <span class="c1">// check that the signature is from the payment sender</span>
        <span class="k">return</span> <span class="n">recoverSigner</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span> <span class="o">==</span> <span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// the recipient can close the channel at any time by presenting a</span>
    <span class="c1">/// signed amount from the sender. the recipient will be sent that amount,</span>
    <span class="c1">/// and the remainder will go back to the sender</span>
    <span class="kd">function</span> <span class="n">close</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">signature</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">recipient</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">isValidSignature</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="n">signature</span><span class="p">));</span>

        <span class="n">recipient</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// the sender can extend the expiration at any time</span>
    <span class="kd">function</span> <span class="n">extend</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">newExpiration</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">sender</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">newExpiration</span> <span class="o">&gt;</span> <span class="n">expiration</span><span class="p">);</span>

        <span class="n">expiration</span> <span class="o">=</span> <span class="n">newExpiration</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// if the timeout is reached without the recipient closing the channel,</span>
    <span class="c1">/// then the Ether is released back to the sender.</span>
    <span class="kd">function</span> <span class="n">claimTimeout</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">expiration</span><span class="p">);</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// All functions below this are just taken from the chapter</span>
    <span class="c1">/// &#39;creating and verifying signatures&#39; chapter.</span>

    <span class="kd">function</span> <span class="n">splitSignature</span><span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">sig</span><span class="p">)</span>
        <span class="kr">internal</span>
        <span class="kr">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">s</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">sig</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">65</span><span class="p">);</span>

        <span class="k">assembly</span> <span class="p">{</span>
            <span class="c1">// first 32 bytes, after the length prefix</span>
            <span class="n">r</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
            <span class="c1">// second 32 bytes</span>
            <span class="n">s</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
            <span class="c1">// final byte (first byte of the next 32 bytes)</span>
            <span class="n">v</span> <span class="o">:=</span> <span class="nf">byte</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">mload</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="mi">96</span><span class="p">)))</span>
        <span class="p">}</span>

        <span class="nf">return</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span><span class="err">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">recoverSigner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">message</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">sig</span><span class="p">)</span>
        <span class="kr">internal</span>
        <span class="kr">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">(</span><span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="n">splitSignature</span><span class="p">(</span><span class="n">sig</span><span class="p">);</span>

        <span class="k">return</span> <span class="nf">ecrecover</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// builds a prefixed hash to mimic the behavior of eth_sign.</span>
    <span class="kd">function</span> <span class="n">prefixed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">hash</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">keccak256</span><span class="p">(</span><span class="nb">abi.encodePacked</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\x19</span><span class="s">Ethereum Signed Message:</span><span class="se">\n</span><span class="s">32&quot;</span><span class="p">,</span> <span class="n">hash</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The function <code class="docutils literal notranslate"><span class="pre">splitSignature</span></code> does not use all security
checks. A real implementation should use a more rigorously tested library,
such as openzepplin’s <a class="reference external" href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/ECRecovery.sol">version</a> of this code.</p>
</div>
</div>
<div class="section" id="verifying-payments">
<h5>Verifying Payments<a class="headerlink" href="#verifying-payments" title="Permalink to this headline">¶</a></h5>
<p>Unlike in the previous section, messages in a payment channel aren’t
redeemed right away. The recipient keeps track of the latest message and
redeems it when it’s time to close the payment channel. This means it’s
critical that the recipient perform their own verification of each message.
Otherwise there is no guarantee that the recipient will be able to get paid
in the end.</p>
<p>The recipient should verify each message using the following process:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Verify that the contact address in the message matches the payment channel.</li>
<li>Verify that the new total is the expected amount.</li>
<li>Verify that the new total does not exceed the amount of Ether escrowed.</li>
<li>Verify that the signature is valid and comes from the payment channel sender.</li>
</ol>
</div></blockquote>
<p>We’ll use the <a class="reference external" href="https://github.com/ethereumjs/ethereumjs-util">ethereumjs-util</a>
library to write this verification. The final step can be done a number of ways,
and we use JavaScript. The following code borrows the <cite>constructMessage</cite> function from the signing <strong>JavaScript code</strong> above:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// this mimics the prefixing behavior of the eth_sign JSON-RPC method.</span>
<span class="kd">function</span> <span class="n">prefixed</span><span class="p">(</span><span class="n">hash</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ethereumjs</span><span class="p">.</span><span class="n">ABI</span><span class="p">.</span><span class="n">soliditySHA3</span><span class="p">(</span>
        <span class="p">[</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="s">&quot;bytes32&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s">&quot;</span><span class="se">\x19</span><span class="s">Ethereum Signed Message:</span><span class="se">\n</span><span class="s">32&quot;</span><span class="p">,</span> <span class="n">hash</span><span class="p">]</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">recoverSigner</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">signature</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">split</span> <span class="o">=</span> <span class="n">ethereumjs</span><span class="p">.</span><span class="n">Util</span><span class="p">.</span><span class="n">fromRpcSig</span><span class="p">(</span><span class="n">signature</span><span class="p">);</span>
    <span class="kd">var</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="n">ethereumjs</span><span class="p">.</span><span class="n">Util</span><span class="p">.</span><span class="nf">ecrecover</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">split</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">split</span><span class="p">.</span><span class="n">r</span><span class="p">,</span> <span class="n">split</span><span class="p">.</span><span class="n">s</span><span class="p">);</span>
    <span class="kd">var</span> <span class="n">signer</span> <span class="o">=</span> <span class="n">ethereumjs</span><span class="p">.</span><span class="n">Util</span><span class="p">.</span><span class="n">pubToAddress</span><span class="p">(</span><span class="n">publicKey</span><span class="p">).</span><span class="n">toString</span><span class="p">(</span><span class="s">&quot;hex&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">signer</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">isValidSignature</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">signature</span><span class="p">,</span> <span class="n">expectedSigner</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="n">message</span> <span class="o">=</span> <span class="n">prefixed</span><span class="p">(</span><span class="n">constructPaymentMessage</span><span class="p">(</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">amount</span><span class="p">));</span>
    <span class="kd">var</span> <span class="n">signer</span> <span class="o">=</span> <span class="n">recoverSigner</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">signature</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">signer</span><span class="p">.</span><span class="n">toLowerCase</span><span class="p">()</span> <span class="o">==</span>
        <span class="n">ethereumjs</span><span class="p">.</span><span class="n">Util</span><span class="p">.</span><span class="n">stripHexPrefix</span><span class="p">(</span><span class="n">expectedSigner</span><span class="p">).</span><span class="n">toLowerCase</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-solidity-in-depth"></span><div class="section" id="solidity-in-depth">
<h2>Solidity in Depth<a class="headerlink" href="#solidity-in-depth" title="Permalink to this headline">¶</a></h2>
<p>This section should provide you with all you need to know about Solidity.
If something is missing here, please contact us on
<a class="reference external" href="https://gitter.im/ethereum/solidity">Gitter</a> or create a pull request on
<a class="reference external" href="https://github.com/ethereum/solidity/pulls">Github</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-layout-of-source-files"></span><div class="section" id="layout-of-a-solidity-source-file">
<h3>Layout of a Solidity Source File<a class="headerlink" href="#layout-of-a-solidity-source-file" title="Permalink to this headline">¶</a></h3>
<p>Source files can contain an arbitrary number of
<a class="reference internal" href="index.html#contract-structure"><span class="std std-ref">contract definitions</span></a>, <a class="reference internal" href="#import">import</a> directives
and <a class="reference internal" href="#pragma"><span class="std std-ref">pragma directives</span></a>.</p>
<div class="section" id="pragmas">
<span id="pragma"></span><span id="index-0"></span><h4>Pragmas<a class="headerlink" href="#pragmas" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">pragma</span></code> keyword can be used to enable certain compiler features
or checks. A pragma directive is always local to a source file, so
you have to add the pragma to all your files if you want enable it
in all of your project. If you <a class="reference internal" href="#import"><span class="std std-ref">import</span></a> another file, the pragma
from that file will not automatically apply to the importing file.</p>
<div class="section" id="version-pragma">
<span id="index-1"></span><span id="id1"></span><h5>Version Pragma<a class="headerlink" href="#version-pragma" title="Permalink to this headline">¶</a></h5>
<p>Source files can (and should) be annotated with a so-called version pragma to reject
being compiled with future compiler versions that might introduce incompatible
changes. We try to keep such changes to an absolute minimum and especially
introduce changes in a way that changes in semantics will also require changes
in the syntax, but this is of course not always possible. Because of that, it is always
a good idea to read through the changelog at least for releases that contain
breaking changes, those releases will always have versions of the form
<code class="docutils literal notranslate"><span class="pre">0.x.0</span></code> or <code class="docutils literal notranslate"><span class="pre">x.0.0</span></code>.</p>
<p>The version pragma is used as follows:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
<p>Such a source file will not compile with a compiler earlier than version 0.5.2
and it will also not work on a compiler starting from version 0.6.0 (this
second condition is added by using <code class="docutils literal notranslate"><span class="pre">^</span></code>). The idea behind this is that
there will be no breaking changes until version <code class="docutils literal notranslate"><span class="pre">0.6.0</span></code>, so we can always
be sure that our code will compile the way we intended it to. We do not fix
the exact version of the compiler, so that bugfix releases are still possible.</p>
<p>It is possible to specify much more complex rules for the compiler version,
the expression follows those used by <a class="reference external" href="https://docs.npmjs.com/misc/semver">npm</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the version pragma will <em>not</em> change the version of the compiler.
It will also <em>not</em> enable or disable features of the compiler. It will just
instruct the compiler to check whether its version matches the one
required by the pragma. If it does not match, the compiler will issue
an error.</p>
</div>
</div>
<div class="section" id="experimental-pragma">
<span id="index-2"></span><span id="id2"></span><h5>Experimental Pragma<a class="headerlink" href="#experimental-pragma" title="Permalink to this headline">¶</a></h5>
<p>The second pragma is the experimental pragma. It can be used to enable
features of the compiler or language that are not yet enabled by default.
The following experimental pragmas are currently supported:</p>
<div class="section" id="abiencoderv2">
<h6>ABIEncoderV2<a class="headerlink" href="#abiencoderv2" title="Permalink to this headline">¶</a></h6>
<p>The new ABI encoder is able to encode and decode arbitrarily nested
arrays and structs. It produces less optimal code (the optimizer
for this part of the code is still under development) and has not
received as much testing as the old encoder. You can activate it
using <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">ABIEncoderV2;</span></code>.</p>
</div>
<div class="section" id="smtchecker">
<span id="smt-checker"></span><h6>SMTChecker<a class="headerlink" href="#smtchecker" title="Permalink to this headline">¶</a></h6>
<p>This component has to be enabled when the Solidity compiler is built
and therefore it is not available in all Solidity binaries.
The <a class="reference internal" href="index.html#smt-solvers-build"><span class="std std-ref">build instructions</span></a> explain how to activate this option.
It is activated for the Ubuntu PPA releases in most versions,
but not for solc-js, the Docker images, Windows binaries or the
statically-built Linux binaries.</p>
<p>If you use
<code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">SMTChecker;</span></code>, then you get additional
safety warnings which are obtained by querying an SMT solver.
The component does not yet support all features of the Solidity language
and likely outputs many warnings. In case it reports unsupported
features, the analysis may not be fully sound.</p>
</div>
</div>
</div>
<div class="section" id="importing-other-source-files">
<span id="import"></span><span id="index-3"></span><h4>Importing other Source Files<a class="headerlink" href="#importing-other-source-files" title="Permalink to this headline">¶</a></h4>
<div class="section" id="syntax-and-semantics">
<h5>Syntax and Semantics<a class="headerlink" href="#syntax-and-semantics" title="Permalink to this headline">¶</a></h5>
<p>Solidity supports import statements that are very similar to those available in JavaScript
(from ES6 on), although Solidity does not know the concept of a “default export”.</p>
<p>At a global level, you can use import statements of the following form:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="s">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>This statement imports all global symbols from “filename” (and symbols imported there) into the
current global scope (different than in ES6 but backwards-compatible for Solidity).
This simple form is not recommended for use, because it pollutes the namespace in an
unpredictable way: If you add new top-level items inside “filename”, they will automatically
appear in all files that import like this from “filename”. It is better to import specific
symbols explicitly.</p>
<p>The following example creates a new global symbol <code class="docutils literal notranslate"><span class="pre">symbolName</span></code> whose members are all
the global symbols from <code class="docutils literal notranslate"><span class="pre">&quot;filename&quot;</span></code>.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="o">*</span> <span class="kr">as</span> <span class="n">symbolName</span> <span class="kr">from</span> <span class="s">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>If there is a naming collision, you can also rename symbols while importing.
This code
creates new global symbols <code class="docutils literal notranslate"><span class="pre">alias</span></code> and <code class="docutils literal notranslate"><span class="pre">symbol2</span></code> which reference <code class="docutils literal notranslate"><span class="pre">symbol1</span></code> and <code class="docutils literal notranslate"><span class="pre">symbol2</span></code> from inside <code class="docutils literal notranslate"><span class="pre">&quot;filename&quot;</span></code>, respectively.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">{</span><span class="n">symbol1</span> <span class="kr">as</span> <span class="n">alias</span><span class="p">,</span> <span class="n">symbol2</span><span class="p">}</span> <span class="kr">from</span> <span class="s">&quot;filename&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>Another syntax is not part of ES6, but probably convenient:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="s">&quot;filename&quot;</span> <span class="kr">as</span> <span class="n">symbolName</span><span class="p">;</span>
</pre></div>
</div>
<p>which is equivalent to <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span> <span class="pre">as</span> <span class="pre">symbolName</span> <span class="pre">from</span> <span class="pre">&quot;filename&quot;;</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you use <cite>import “filename.sol” as moduleName;</cite>, you access a contract called <cite>C</cite>
from inside <cite>“filename.sol”</cite> as <cite>moduleName.C</cite> and not by using <cite>C</cite> directly.</p>
</div>
</div>
<div class="section" id="paths">
<h5>Paths<a class="headerlink" href="#paths" title="Permalink to this headline">¶</a></h5>
<p>In the above, <code class="docutils literal notranslate"><span class="pre">filename</span></code> is always treated as a path with <code class="docutils literal notranslate"><span class="pre">/</span></code> as directory separator,
<code class="docutils literal notranslate"><span class="pre">.</span></code> as the current and <code class="docutils literal notranslate"><span class="pre">..</span></code> as the parent directory.  When <code class="docutils literal notranslate"><span class="pre">.</span></code> or <code class="docutils literal notranslate"><span class="pre">..</span></code> is followed by a character except <code class="docutils literal notranslate"><span class="pre">/</span></code>,
it is not considered as the current or the parent directory.
All path names are treated as absolute paths unless they start with the current <code class="docutils literal notranslate"><span class="pre">.</span></code> or the parent directory <code class="docutils literal notranslate"><span class="pre">..</span></code>.</p>
<p>To import a file <code class="docutils literal notranslate"><span class="pre">x</span></code> from the same directory as the current file, use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;./x&quot;</span> <span class="pre">as</span> <span class="pre">x;</span></code>.
If you use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;x&quot;</span> <span class="pre">as</span> <span class="pre">x;</span></code> instead, a different file could be referenced
(in a global “include directory”).</p>
<p>It depends on the compiler (see below) how to actually resolve the paths.
In general, the directory hierarchy does not need to strictly map onto your local
filesystem, it can also map to resources discovered via e.g. ipfs, http or git.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Always use relative imports like <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;./filename.sol&quot;;</span></code> and avoid
using <code class="docutils literal notranslate"><span class="pre">..</span></code> in path specifiers. In the latter case, it is probably better to use
global paths and set up remappings as explained below.</p>
</div>
</div>
<div class="section" id="use-in-actual-compilers">
<h5>Use in Actual Compilers<a class="headerlink" href="#use-in-actual-compilers" title="Permalink to this headline">¶</a></h5>
<p>When invoking the compiler, you can specify how to discover the first element
of a path, and also path prefix remappings. For
example you can setup a remapping so that everything imported from the virtual
directory <code class="docutils literal notranslate"><span class="pre">github.com/ethereum/dapp-bin/library</span></code> would actually be read from
your local directory <code class="docutils literal notranslate"><span class="pre">/usr/local/dapp-bin/library</span></code>.
If multiple remappings apply, the one with the longest key is tried first.
An empty prefix is not allowed. The remappings can depend on a context,
which allows you to configure packages to import e.g., different versions of a
library of the same name.</p>
<p><strong>solc</strong>:</p>
<p>For solc (the commandline compiler), you provide these path remappings as
<code class="docutils literal notranslate"><span class="pre">context:prefix=target</span></code> arguments, where both the <code class="docutils literal notranslate"><span class="pre">context:</span></code> and the
<code class="docutils literal notranslate"><span class="pre">=target</span></code> parts are optional (<code class="docutils literal notranslate"><span class="pre">target</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">prefix</span></code> in this
case). All remapping values that are regular files are compiled (including
their dependencies).</p>
<p>This mechanism is backwards-compatible (as long
as no filename contains <code class="docutils literal notranslate"><span class="pre">=</span></code> or <code class="docutils literal notranslate"><span class="pre">:</span></code>) and thus not a breaking change. All
files in or below the <code class="docutils literal notranslate"><span class="pre">context</span></code> directory that import a file that starts with
<code class="docutils literal notranslate"><span class="pre">prefix</span></code> are redirected by replacing <code class="docutils literal notranslate"><span class="pre">prefix</span></code> by <code class="docutils literal notranslate"><span class="pre">target</span></code>.</p>
<p>For example, if you clone <code class="docutils literal notranslate"><span class="pre">github.com/ethereum/dapp-bin/</span></code> locally to
<code class="docutils literal notranslate"><span class="pre">/usr/local/dapp-bin</span></code>, you can use the following in your source file:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="s">&quot;github.com/ethereum/dapp-bin/library/iterable_mapping.sol&quot;</span> <span class="kr">as</span> <span class="n">it_mapping</span><span class="p">;</span>
</pre></div>
</div>
<p>Then run the compiler:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin/ source.sol
</pre></div>
</div>
<p>As a more complex example, suppose you rely on a module that uses an old
version of dapp-bin that you checked out to <code class="docutils literal notranslate"><span class="pre">/usr/local/dapp-bin_old</span></code>, then you can run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>solc module1:github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin/ <span class="se">\</span>
     module2:github.com/ethereum/dapp-bin/<span class="o">=</span>/usr/local/dapp-bin_old/ <span class="se">\</span>
     source.sol
</pre></div>
</div>
<p>This means that all imports in <code class="docutils literal notranslate"><span class="pre">module2</span></code> point to the old version but imports
in <code class="docutils literal notranslate"><span class="pre">module1</span></code> point to the new version.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">solc</span></code> only allows you to include files from certain directories. They have
to be in the directory (or subdirectory) of one of the explicitly specified
source files or in the directory (or subdirectory) of a remapping target. If
you want to allow direct absolute includes, add the remapping <code class="docutils literal notranslate"><span class="pre">/=/</span></code>.</p>
</div>
<p>If there are multiple remappings that lead to a valid file, the remapping
with the longest common prefix is chosen.</p>
<p><strong>Remix</strong>:</p>
<p><a class="reference external" href="https://remix.ethereum.org/">Remix</a> provides an automatic remapping for
GitHub and automatically retrieves the file over the network. You can import
the iterable mapping as above,  e.g.</p>
<dl class="docutils">
<dt>::</dt>
<dd>import “github.com/ethereum/dapp-bin/library/iterable_mapping.sol” as it_mapping;</dd>
</dl>
<p>Remix may add other source code providers in the future.</p>
</div>
</div>
<div class="section" id="comments">
<span id="index-4"></span><h4>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h4>
<p>Single-line comments (<code class="docutils literal notranslate"><span class="pre">//</span></code>) and multi-line comments (<code class="docutils literal notranslate"><span class="pre">/*...*/</span></code>) are possible.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// This is a single-line comment.</span>

<span class="cm">/*</span>
<span class="cm">This is a</span>
<span class="cm">multi-line comment.</span>
<span class="cm">*/</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A single-line comment is terminated by any unicode line terminator
(LF, VF, FF, CR, NEL, LS or PS) in utf8 encoding. The terminator is still part of
the source code after the comment, so if it is not an ascii symbol
(these are NEL, LS and PS), it will lead to a parser error.</p>
</div>
<p>Additionally, there is another type of comment called a natspec comment,
which is detailed in the <a class="reference internal" href="index.html#natspec"><span class="std std-ref">style guide</span></a>. They are written with a
triple slash (<code class="docutils literal notranslate"><span class="pre">///</span></code>) or a double asterisk block(<code class="docutils literal notranslate"><span class="pre">/**</span> <span class="pre">...</span> <span class="pre">*/</span></code>) and
they should be used directly above function declarations or statements.
You can use <a class="reference external" href="https://en.wikipedia.org/wiki/Doxygen">Doxygen</a>-style tags inside these comments to document
functions, annotate conditions for formal verification, and provide a
<strong>confirmation text</strong> which is shown to users when they attempt to invoke a
function.</p>
<p>In the following example we document the title of the contract, the explanation
for the two function parameters and two return variables.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="cm">/** </span><span class="cs">@title</span><span class="cm"> Shape calculator. */</span>
<span class="kd">contract</span> <span class="n">ShapeCalculator</span> <span class="p">{</span>
    <span class="cm">/** </span><span class="cs">@dev</span><span class="cm"> Calculates a rectangle&#39;s surface and perimeter.</span>
<span class="cm">      * </span><span class="cs">@param</span><span class="cm"> w Width of the rectangle.</span>
<span class="cm">      * </span><span class="cs">@param</span><span class="cm"> h Height of the rectangle.</span>
<span class="cm">      * </span><span class="cs">@return</span><span class="cm"> s The calculated surface.</span>
<span class="cm">      * </span><span class="cs">@return</span><span class="cm"> p The calculated perimeter.</span>
<span class="cm">      */</span>
    <span class="kd">function</span> <span class="n">rectangle</span><span class="p">(</span><span class="kt">uint</span> <span class="n">w</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">h</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">s</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">h</span><span class="p">;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="n">h</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-structure-of-a-contract"></span><div class="section" id="structure-of-a-contract">
<span id="contract-structure"></span><span id="index-0"></span><h3>Structure of a Contract<a class="headerlink" href="#structure-of-a-contract" title="Permalink to this headline">¶</a></h3>
<p>Contracts in Solidity are similar to classes in object-oriented languages.
Each contract can contain declarations of <a class="reference internal" href="#structure-state-variables"><span class="std std-ref">State Variables</span></a>, <a class="reference internal" href="#structure-functions"><span class="std std-ref">Functions</span></a>,
<a class="reference internal" href="#structure-function-modifiers"><span class="std std-ref">Function Modifiers</span></a>, <a class="reference internal" href="#structure-events"><span class="std std-ref">Events</span></a>, <a class="reference internal" href="#structure-struct-types"><span class="std std-ref">Struct Types</span></a> and <a class="reference internal" href="#structure-enum-types"><span class="std std-ref">Enum Types</span></a>.
Furthermore, contracts can inherit from other contracts.</p>
<p>There are also special kinds of contracts called <a class="reference internal" href="index.html#libraries"><span class="std std-ref">libraries</span></a> and <a class="reference internal" href="index.html#interfaces"><span class="std std-ref">interfaces</span></a>.</p>
<p>The section about <a class="reference internal" href="index.html#contracts"><span class="std std-ref">contracts</span></a> contains more details than this section,
which serves to provide a quick overview.</p>
<div class="section" id="state-variables">
<span id="structure-state-variables"></span><h4>State Variables<a class="headerlink" href="#state-variables" title="Permalink to this headline">¶</a></h4>
<p>State variables are variables whose values are permanently stored in contract
storage.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SimpleStorage</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">storedData</span><span class="p">;</span> <span class="c1">// State variable</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See the <a class="reference internal" href="index.html#types"><span class="std std-ref">Types</span></a> section for valid state variable types and
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">Visibility and Getters</span></a> for possible choices for
visibility.</p>
</div>
<div class="section" id="functions">
<span id="structure-functions"></span><h4>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h4>
<p>Functions are the executable units of code within a contract.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SimpleAuction</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span> <span class="c1">// Function</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="index.html#function-calls"><span class="std std-ref">Function Calls</span></a> can happen internally or externally
and have different levels of <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">visibility</span></a>
towards other contracts. <a class="reference internal" href="index.html#functions"><span class="std std-ref">Functions</span></a> accept <a class="reference internal" href="index.html#function-parameters-return-variables"><span class="std std-ref">parameters and return variables</span></a> to pass parameters
and values between them.</p>
</div>
<div class="section" id="function-modifiers">
<span id="structure-function-modifiers"></span><h4>Function Modifiers<a class="headerlink" href="#function-modifiers" title="Permalink to this headline">¶</a></h4>
<p>Function modifiers can be used to amend the semantics of functions in a declarative way
(see <a class="reference internal" href="index.html#modifiers"><span class="std std-ref">Function Modifiers</span></a> in the contracts section).</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Purchase</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">seller</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">onlySeller</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// Modifier</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">seller</span><span class="p">,</span>
            <span class="s">&quot;Only seller can call this.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">abort</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span> <span class="n">onlySeller</span> <span class="p">{</span> <span class="c1">// Modifier usage</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="events">
<span id="structure-events"></span><h4>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>Events are convenience interfaces with the EVM logging facilities.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">21</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SimpleAuction</span> <span class="p">{</span>
    <span class="kd">event</span> <span class="n">HighestBidIncreased</span><span class="p">(</span><span class="kt">address</span> <span class="n">bidder</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">);</span> <span class="c1">// Event</span>

    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="kr">emit</span> <span class="n">HighestBidIncreased</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="nb">msg.value</span><span class="p">);</span> <span class="c1">// Triggering event</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="index.html#events"><span class="std std-ref">Events</span></a> in contracts section for information on how events are declared
and can be used from within a dapp.</p>
</div>
<div class="section" id="struct-types">
<span id="structure-struct-types"></span><h4>Struct Types<a class="headerlink" href="#struct-types" title="Permalink to this headline">¶</a></h4>
<p>Structs are custom defined types that can group several variables (see
<a class="reference internal" href="index.html#structs"><span class="std std-ref">Structs</span></a> in types section).</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Ballot</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="n">Voter</span> <span class="p">{</span> <span class="c1">// Struct</span>
        <span class="kt">uint</span> <span class="n">weight</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">voted</span><span class="p">;</span>
        <span class="kt">address</span> <span class="n">delegate</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">vote</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="enum-types">
<span id="structure-enum-types"></span><h4>Enum Types<a class="headerlink" href="#enum-types" title="Permalink to this headline">¶</a></h4>
<p>Enums can be used to create custom types with a finite set of ‘constant values’ (see
<a class="reference internal" href="index.html#enums"><span class="std std-ref">Enums</span></a> in types section).</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Purchase</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">State</span> <span class="p">{</span> <span class="n">Created</span><span class="p">,</span> <span class="n">Locked</span><span class="p">,</span> <span class="n">Inactive</span> <span class="p">}</span> <span class="c1">// Enum</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-types"></span><div class="section" id="types">
<span id="index-0"></span><span id="id1"></span><h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p>Solidity is a statically typed language, which means that the type of each
variable (state and local) needs to be specified.
Solidity provides several elementary types which can be combined to form complex types.</p>
<p>In addition, types can interact with each other in expressions containing
operators. For a quick reference of the various operators, see <a class="reference internal" href="index.html#order"><span class="std std-ref">Order of Precedence of Operators</span></a>.</p>
<p>The concept of “undefined” or “null” values does not exist in Solidity, but newly
declared variables always have a <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a> dependent
on its type. To handle any unexpected values, you should use the <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">revert function</span></a> to revert the whole transaction, or return a
tuple with a second <cite>bool</cite> value denoting success.</p>
<div class="section" id="value-types">
<span id="index-1"></span><span id="id2"></span><h4>Value Types<a class="headerlink" href="#value-types" title="Permalink to this headline">¶</a></h4>
<p>The following types are also called value types because variables of these
types will always be passed by value, i.e. they are always copied when they
are used as function arguments or in assignments.</p>
<div class="section" id="booleans">
<span id="index-2"></span><h5>Booleans<a class="headerlink" href="#booleans" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">bool</span></code>: The possible values are constants <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>Operators:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">!</span></code> (logical negation)</li>
<li><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> (logical conjunction, “and”)</li>
<li><code class="docutils literal notranslate"><span class="pre">||</span></code> (logical disjunction, “or”)</li>
<li><code class="docutils literal notranslate"><span class="pre">==</span></code> (equality)</li>
<li><code class="docutils literal notranslate"><span class="pre">!=</span></code> (inequality)</li>
</ul>
<p>The operators <code class="docutils literal notranslate"><span class="pre">||</span></code> and <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> apply the common short-circuiting rules. This means that in the expression <code class="docutils literal notranslate"><span class="pre">f(x)</span> <span class="pre">||</span> <span class="pre">g(y)</span></code>, if <code class="docutils literal notranslate"><span class="pre">f(x)</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">g(y)</span></code> will not be evaluated even if it may have side-effects.</p>
</div>
<div class="section" id="integers">
<span id="index-3"></span><h5>Integers<a class="headerlink" href="#integers" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code> / <code class="docutils literal notranslate"><span class="pre">uint</span></code>: Signed and unsigned integers of various sizes. Keywords <code class="docutils literal notranslate"><span class="pre">uint8</span></code> to <code class="docutils literal notranslate"><span class="pre">uint256</span></code> in steps of <code class="docutils literal notranslate"><span class="pre">8</span></code> (unsigned of 8 up to 256 bits) and <code class="docutils literal notranslate"><span class="pre">int8</span></code> to <code class="docutils literal notranslate"><span class="pre">int256</span></code>. <code class="docutils literal notranslate"><span class="pre">uint</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span></code> are aliases for <code class="docutils literal notranslate"><span class="pre">uint256</span></code> and <code class="docutils literal notranslate"><span class="pre">int256</span></code>, respectively.</p>
<p>Operators:</p>
<ul class="simple">
<li>Comparisons: <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal notranslate"><span class="pre">bool</span></code>)</li>
<li>Bit operators: <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code> (bitwise exclusive or), <code class="docutils literal notranslate"><span class="pre">~</span></code> (bitwise negation)</li>
<li>Shift operators: <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> (left shift), <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> (right shift)</li>
<li>Arithmetic operators: <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, unary <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> (modulo), <code class="docutils literal notranslate"><span class="pre">**</span></code> (exponentiation)</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Integers in Solidity are restricted to a certain range. For example, with <code class="docutils literal notranslate"><span class="pre">uint32</span></code>, this is <code class="docutils literal notranslate"><span class="pre">0</span></code> up to <code class="docutils literal notranslate"><span class="pre">2**32</span> <span class="pre">-</span> <span class="pre">1</span></code>.
If the result of some operation on those numbers does not fit inside this range, it is truncated. These truncations can have
serious consequences that you should <a class="reference internal" href="index.html#underflow-overflow"><span class="std std-ref">be aware of and mitigate against</span></a>.</p>
</div>
<div class="section" id="comparisons">
<h6>Comparisons<a class="headerlink" href="#comparisons" title="Permalink to this headline">¶</a></h6>
<p>The value of a comparison is the one obtained by comparing the integer value.</p>
</div>
<div class="section" id="bit-operations">
<h6>Bit operations<a class="headerlink" href="#bit-operations" title="Permalink to this headline">¶</a></h6>
<p>Bit operations are performed on the two’s complement representation of the number.
This means that, for example <code class="docutils literal notranslate"><span class="pre">~int256(0)</span> <span class="pre">==</span> <span class="pre">int256(-1)</span></code>.</p>
</div>
<div class="section" id="shifts">
<h6>Shifts<a class="headerlink" href="#shifts" title="Permalink to this headline">¶</a></h6>
<p>The result of a shift operation has the type of the left operand. The
expression <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;&lt;</span> <span class="pre">y</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">*</span> <span class="pre">2**y</span></code>, and, for positive integers,
<code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">y</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">2**y</span></code>. For negative <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">y</span></code>
is equivalent to dividing by a power of <code class="docutils literal notranslate"><span class="pre">2</span></code> while rounding down (towards negative infinity).
Shifting by a negative amount throws a runtime exception.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Before version <code class="docutils literal notranslate"><span class="pre">0.5.0</span></code> a right shift <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&gt;&gt;</span> <span class="pre">y</span></code> for negative <code class="docutils literal notranslate"><span class="pre">x</span></code> was equivalent to <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">/</span> <span class="pre">2**y</span></code>,
i.e. right shifts used rounding towards zero instead of rounding towards negative infinity.</p>
</div>
</div>
<div class="section" id="addition-subtraction-and-multiplication">
<h6>Addition, Subtraction and Multiplication<a class="headerlink" href="#addition-subtraction-and-multiplication" title="Permalink to this headline">¶</a></h6>
<p>Addition, subtraction and multiplication have the usual semantics.
They wrap in two’s complement representation, meaning that
for example <code class="docutils literal notranslate"><span class="pre">uint256(0)</span> <span class="pre">-</span> <span class="pre">uint256(1)</span> <span class="pre">==</span> <span class="pre">2**256</span> <span class="pre">-</span> <span class="pre">1</span></code>. You have to take these overflows
into account when designing safe smart contracts.</p>
<p>The expression <code class="docutils literal notranslate"><span class="pre">-x</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">(T(0)</span> <span class="pre">-</span> <span class="pre">x)</span></code> where
<code class="docutils literal notranslate"><span class="pre">T</span></code> is the type of <code class="docutils literal notranslate"><span class="pre">x</span></code>. This means that <code class="docutils literal notranslate"><span class="pre">-x</span></code> will not be negative
if the type of <code class="docutils literal notranslate"><span class="pre">x</span></code> is an unsigned integer type. Also, <code class="docutils literal notranslate"><span class="pre">-x</span></code> can be
positive if <code class="docutils literal notranslate"><span class="pre">x</span></code> is negative. There is another caveat also resulting
from two’s complement representation:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">255</span><span class="p">;</span>
<span class="nf">assert</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">);</span>
</pre></div>
</div>
<p>This means that even if a number is negative, you cannot assume that
its negation will be positive.</p>
</div>
<div class="section" id="division">
<h6>Division<a class="headerlink" href="#division" title="Permalink to this headline">¶</a></h6>
<p>Since the type of the result of an operation is always the type of one of
the operands, division on integers always results in an integer.
In Solidity, division rounds towards zero. This mean that <code class="docutils literal notranslate"><span class="pre">int256(-5)</span> <span class="pre">/</span> <span class="pre">int256(2)</span> <span class="pre">==</span> <span class="pre">int256(-2)</span></code>.</p>
<p>Note that in contrast, division on <a class="reference internal" href="#rational-literals"><span class="std std-ref">literals</span></a> results in fractional values
of arbitrary precision.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Division by zero causes a failing assert.</p>
</div>
</div>
<div class="section" id="modulo">
<h6>Modulo<a class="headerlink" href="#modulo" title="Permalink to this headline">¶</a></h6>
<p>The modulo operation <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">%</span> <span class="pre">n</span></code> yields the remainder <code class="docutils literal notranslate"><span class="pre">r</span></code> after the division of the operand <code class="docutils literal notranslate"><span class="pre">a</span></code>
by the operand <code class="docutils literal notranslate"><span class="pre">n</span></code>, where <code class="docutils literal notranslate"><span class="pre">q</span> <span class="pre">=</span> <span class="pre">int(a</span> <span class="pre">/</span> <span class="pre">n)</span></code> and <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">-</span> <span class="pre">(n</span> <span class="pre">*</span> <span class="pre">q)</span></code>. This means that modulo
results in the same sign as its left operand (or zero) and <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">%</span> <span class="pre">n</span> <span class="pre">==</span> <span class="pre">-(abs(a)</span> <span class="pre">%</span> <span class="pre">n)</span></code> holds for negative <code class="docutils literal notranslate"><span class="pre">a</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">int256(5)</span> <span class="pre">%</span> <span class="pre">int256(2)</span> <span class="pre">==</span> <span class="pre">int256(1)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">int256(5)</span> <span class="pre">%</span> <span class="pre">int256(-2)</span> <span class="pre">==</span> <span class="pre">int256(1)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">int256(-5)</span> <span class="pre">%</span> <span class="pre">int256(2)</span> <span class="pre">==</span> <span class="pre">int256(-1)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">int256(-5)</span> <span class="pre">%</span> <span class="pre">int256(-2)</span> <span class="pre">==</span> <span class="pre">int256(-1)</span></code></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Modulo with zero causes a failing assert.</p>
</div>
</div>
<div class="section" id="exponentiation">
<h6>Exponentiation<a class="headerlink" href="#exponentiation" title="Permalink to this headline">¶</a></h6>
<p>Exponentiation is only available for unsigned types. Please take care that the types
you are using are large enough to hold the result and prepare for potential wrapping behaviour.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that <code class="docutils literal notranslate"><span class="pre">0**0</span></code> is defined by the EVM as <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="fixed-point-numbers">
<span id="index-4"></span><h5>Fixed Point Numbers<a class="headerlink" href="#fixed-point-numbers" title="Permalink to this headline">¶</a></h5>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Fixed point numbers are not fully supported by Solidity yet. They can be declared, but
cannot be assigned to or from.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fixed</span></code> / <code class="docutils literal notranslate"><span class="pre">ufixed</span></code>: Signed and unsigned fixed point number of various sizes. Keywords <code class="docutils literal notranslate"><span class="pre">ufixedMxN</span></code> and <code class="docutils literal notranslate"><span class="pre">fixedMxN</span></code>, where <code class="docutils literal notranslate"><span class="pre">M</span></code> represents the number of bits taken by
the type and <code class="docutils literal notranslate"><span class="pre">N</span></code> represents how many decimal points are available. <code class="docutils literal notranslate"><span class="pre">M</span></code> must be divisible by 8 and goes from 8 to 256 bits. <code class="docutils literal notranslate"><span class="pre">N</span></code> must be between 0 and 80, inclusive.
<code class="docutils literal notranslate"><span class="pre">ufixed</span></code> and <code class="docutils literal notranslate"><span class="pre">fixed</span></code> are aliases for <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> and <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code>, respectively.</p>
<p>Operators:</p>
<ul class="simple">
<li>Comparisons: <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal notranslate"><span class="pre">bool</span></code>)</li>
<li>Arithmetic operators: <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, unary <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> (modulo)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The main difference between floating point (<code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">double</span></code> in many languages, more precisely IEEE 754 numbers) and fixed point numbers is
that the number of bits used for the integer and the fractional part (the part after the decimal dot) is flexible in the former, while it is strictly
defined in the latter. Generally, in floating point almost the entire space is used to represent the number, while only a small number of bits define
where the decimal point is.</p>
</div>
</div>
<div class="section" id="address">
<span id="index-5"></span><span id="id3"></span><h5>Address<a class="headerlink" href="#address" title="Permalink to this headline">¶</a></h5>
<p>The address type comes in two flavours, which are largely identical:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">address</span></code>: Holds a 20 byte value (size of an Ethereum address).</li>
<li><code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>: Same as <code class="docutils literal notranslate"><span class="pre">address</span></code>, but with the additional members <code class="docutils literal notranslate"><span class="pre">transfer</span></code> and <code class="docutils literal notranslate"><span class="pre">send</span></code>.</li>
</ul>
</div></blockquote>
<p>The idea behind this distinction is that <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> is an address you can send Ether to,
while a plain <code class="docutils literal notranslate"><span class="pre">address</span></code> cannot be sent Ether.</p>
<p>Type conversions:</p>
<p>Implicit conversions from <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> to <code class="docutils literal notranslate"><span class="pre">address</span></code> are allowed, whereas conversions from <code class="docutils literal notranslate"><span class="pre">address</span></code> to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> are
not possible (the only way to perform such a conversion is by using an intermediate conversion to <code class="docutils literal notranslate"><span class="pre">uint160</span></code>).</p>
<p><a class="reference internal" href="#address-literals"><span class="std std-ref">Address literals</span></a> can be implicitly converted to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</p>
<p>Explicit conversions to and from <code class="docutils literal notranslate"><span class="pre">address</span></code> are allowed for integers, integer literals, <code class="docutils literal notranslate"><span class="pre">bytes20</span></code> and contract types with the following
caveat:
Conversions of the form <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable(x)</span></code> are not allowed. Instead the result of a conversion of the form <code class="docutils literal notranslate"><span class="pre">address(x)</span></code>
has the type <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>, if <code class="docutils literal notranslate"><span class="pre">x</span></code> is of integer or fixed bytes type, a literal or a contract with a payable fallback function.
If <code class="docutils literal notranslate"><span class="pre">x</span></code> is a contract without payable fallback function, then <code class="docutils literal notranslate"><span class="pre">address(x)</span></code> will be of type <code class="docutils literal notranslate"><span class="pre">address</span></code>.
In external function signatures <code class="docutils literal notranslate"><span class="pre">address</span></code> is used for both the <code class="docutils literal notranslate"><span class="pre">address</span></code> and the <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> type.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It might very well be that you do not need to care about the distinction between <code class="docutils literal notranslate"><span class="pre">address</span></code>
and <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> and just use <code class="docutils literal notranslate"><span class="pre">address</span></code> everywhere. For example,
if you are using the <a class="reference internal" href="index.html#withdrawal-pattern"><span class="std std-ref">withdrawal pattern</span></a>, you can (and should) store the
address itself as <code class="docutils literal notranslate"><span class="pre">address</span></code>, because you invoke the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function on
<code class="docutils literal notranslate"><span class="pre">msg.sender</span></code>, which is an <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</p>
</div>
<p>Operators:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code></li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>If you convert a type that uses a larger byte size to an <code class="docutils literal notranslate"><span class="pre">address</span></code>, for example <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>, then the <code class="docutils literal notranslate"><span class="pre">address</span></code> is truncated.
To reduce conversion ambiguity version 0.4.24 and higher of the compiler force you make the truncation explicit in the conversion.
Take for example the address <code class="docutils literal notranslate"><span class="pre">0x111122223333444455556666777788889999AAAABBBBCCCCDDDDEEEEFFFFCCCC</span></code>.</p>
<p class="last">You can use <code class="docutils literal notranslate"><span class="pre">address(uint160(bytes20(b)))</span></code>, which results in <code class="docutils literal notranslate"><span class="pre">0x111122223333444455556666777788889999aAaa</span></code>,
or you can use <code class="docutils literal notranslate"><span class="pre">address(uint160(uint256(b)))</span></code>, which results in <code class="docutils literal notranslate"><span class="pre">0x777788889999AaAAbBbbCcccddDdeeeEfFFfCcCc</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The distinction between <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> was introduced with version 0.5.0.
Also starting from that version, contracts do not derive from the address type, but can still be explicitly converted to
<code class="docutils literal notranslate"><span class="pre">address</span></code> or to <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>, if they have a payable fallback function.</p>
</div>
<div class="section" id="members-of-addresses">
<span id="id4"></span><h6>Members of Addresses<a class="headerlink" href="#members-of-addresses" title="Permalink to this headline">¶</a></h6>
<p>For a quick reference of all members of address, see <a class="reference internal" href="index.html#address-related"><span class="std std-ref">Members of Address Types</span></a>.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">balance</span></code> and <code class="docutils literal notranslate"><span class="pre">transfer</span></code></li>
</ul>
<p>It is possible to query the balance of an address using the property <code class="docutils literal notranslate"><span class="pre">balance</span></code>
and to send Ether (in units of wei) to a payable address using the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">x</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="mh">0x123</span><span class="p">);</span>
<span class="kt">address</span> <span class="n">myAddress</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="n">myAddress</span><span class="p">.</span><span class="nb">balance</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span> <span class="n">x</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function fails if the balance of the current contract is not large enough
or if the Ether transfer is rejected by the receiving account. The <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function
reverts on failure.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">x</span></code> is a contract address, its code (more specifically: its <a class="reference internal" href="index.html#fallback-function"><span class="std std-ref">Fallback Function</span></a>, if present) will be executed together with the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> call (this is a feature of the EVM and cannot be prevented). If that execution runs out of gas or fails in any way, the Ether transfer will be reverted and the current contract will stop with an exception.</p>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">send</span></code></li>
</ul>
<p>Send is the low-level counterpart of <code class="docutils literal notranslate"><span class="pre">transfer</span></code>. If the execution fails, the current contract will not stop with an exception, but <code class="docutils literal notranslate"><span class="pre">send</span></code> will return <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There are some dangers in using <code class="docutils literal notranslate"><span class="pre">send</span></code>: The transfer fails if the call stack depth is at 1024
(this can always be forced by the caller) and it also fails if the recipient runs out of gas. So in order
to make safe Ether transfers, always check the return value of <code class="docutils literal notranslate"><span class="pre">send</span></code>, use <code class="docutils literal notranslate"><span class="pre">transfer</span></code> or even better:
use a pattern where the recipient withdraws the money.</p>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code></li>
</ul>
<p>In order to interface with contracts that do not adhere to the ABI,
or to get more direct control over the encoding,
the functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> are provided.
They all take a single <code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code> parameter and
return the success condition (as a <code class="docutils literal notranslate"><span class="pre">bool</span></code>) and the returned data
(<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>).
The functions <code class="docutils literal notranslate"><span class="pre">abi.encode</span></code>, <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code>, <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector</span></code>
and <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSignature</span></code> can be used to encode structured data.</p>
<p>Example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">payload</span> <span class="o">=</span> <span class="nb">abi.encodeWithSignature</span><span class="p">(</span><span class="s">&quot;register(string)&quot;</span><span class="p">,</span> <span class="s">&quot;MyName&quot;</span><span class="p">);</span>
<span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">returnData</span><span class="p">)</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">nameReg</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="n">payload</span><span class="p">);</span>
<span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All these functions are low-level functions and should be used with care.
Specifically, any unknown contract might be malicious and if you call it, you
hand over control to that contract which could in turn call back into
your contract, so be prepared for changes to your state variables
when the call returns. The regular way to interact with other contracts
is to call a function on a contract object (<code class="docutils literal notranslate"><span class="pre">x.f()</span></code>).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Previous versions of Solidity allowed these functions to receive
arbitrary arguments and would also handle a first argument of type
<code class="docutils literal notranslate"><span class="pre">bytes4</span></code> differently. These edge cases were removed in version 0.5.0.</p>
</div>
<p>It is possible to adjust the supplied gas with the <code class="docutils literal notranslate"><span class="pre">.gas()</span></code> modifier:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span><span class="p">(</span><span class="n">nameReg</span><span class="p">).</span><span class="nf">call</span><span class="p">.</span><span class="n">gas</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)(</span><span class="nb">abi.encodeWithSignature</span><span class="p">(</span><span class="s">&quot;register(string)&quot;</span><span class="p">,</span> <span class="s">&quot;MyName&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>Similarly, the supplied Ether value can be controlled too:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span><span class="p">(</span><span class="n">nameReg</span><span class="p">).</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">)(</span><span class="nb">abi.encodeWithSignature</span><span class="p">(</span><span class="s">&quot;register(string)&quot;</span><span class="p">,</span> <span class="s">&quot;MyName&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>Lastly, these modifiers can be combined. Their order does not matter:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">address</span><span class="p">(</span><span class="n">nameReg</span><span class="p">).</span><span class="nf">call</span><span class="p">.</span><span class="n">gas</span><span class="p">(</span><span class="mi">1000000</span><span class="p">).</span><span class="n">value</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">)(</span><span class="nb">abi.encodeWithSignature</span><span class="p">(</span><span class="s">&quot;register(string)&quot;</span><span class="p">,</span> <span class="s">&quot;MyName&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>In a similar way, the function <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> can be used: the difference is that only the code of the given address is used, all other aspects (storage, balance, …) are taken from the current contract. The purpose of <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> is to use library code which is stored in another contract. The user has to ensure that the layout of storage in both contracts is suitable for delegatecall to be used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to homestead, only a limited variant called <code class="docutils literal notranslate"><span class="pre">callcode</span></code> was available that did not provide access to the original <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> values. This function was removed in version 0.5.0.</p>
</div>
<p>Since byzantium <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> can be used as well. This is basically the same as <code class="docutils literal notranslate"><span class="pre">call</span></code>, but will revert if the called function modifies the state in any way.</p>
<p>All three functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> are very low-level functions and should only be used as a <em>last resort</em> as they break the type-safety of Solidity.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">.gas()</span></code> option is available on all three methods, while the <code class="docutils literal notranslate"><span class="pre">.value()</span></code> option is not supported for <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All contracts can be converted to <code class="docutils literal notranslate"><span class="pre">address</span></code> type, so it is possible to query the balance of the
current contract using <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="contract-types">
<span id="index-6"></span><span id="id5"></span><h5>Contract Types<a class="headerlink" href="#contract-types" title="Permalink to this headline">¶</a></h5>
<p>Every <a class="reference internal" href="index.html#contracts"><span class="std std-ref">contract</span></a> defines its own type.
You can implicitly convert contracts to contracts they inherit from.
Contracts can be explicitly converted to and from all other contract types
and the <code class="docutils literal notranslate"><span class="pre">address</span></code> type.</p>
<p>Explicit conversion to and from the <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> type
is only possible if the contract type has a payable fallback function.
The conversion is still performed using <code class="docutils literal notranslate"><span class="pre">address(x)</span></code> and not
using <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable(x)</span></code>. You can find more information in the section about
the <a class="reference internal" href="#address"><span class="std std-ref">address type</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before version 0.5.0, contracts directly derived from the address type
and there was no distinction between <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</p>
</div>
<p>If you declare a local variable of contract type (<cite>MyContract c</cite>), you can call
functions on that contract. Take care to assign it from somewhere that is the
same contract type.</p>
<p>You can also instantiate contracts (which means they are newly created). You
can find more details in the <a class="reference internal" href="index.html#creating-contracts"><span class="std std-ref">‘Contracts via new’</span></a>
section.</p>
<p>The data representation of a contract is identical to that of the <code class="docutils literal notranslate"><span class="pre">address</span></code>
type and this type is also used in the <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>.</p>
<p>Contracts do not support any operators.</p>
<p>The members of contract types are the external functions of the contract
including public state variables.</p>
<p>For a contract <code class="docutils literal notranslate"><span class="pre">C</span></code> you can use <code class="docutils literal notranslate"><span class="pre">type(C)</span></code> to access
<a class="reference internal" href="index.html#meta-type"><span class="std std-ref">type information</span></a> about the contract.</p>
</div>
<div class="section" id="fixed-size-byte-arrays">
<span id="index-7"></span><h5>Fixed-size byte arrays<a class="headerlink" href="#fixed-size-byte-arrays" title="Permalink to this headline">¶</a></h5>
<p>The value types <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes2</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes3</span></code>, …, <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>
hold a sequence of bytes from one to up to 32.
<code class="docutils literal notranslate"><span class="pre">byte</span></code> is an alias for <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>.</p>
<p>Operators:</p>
<ul class="simple">
<li>Comparisons: <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> (evaluate to <code class="docutils literal notranslate"><span class="pre">bool</span></code>)</li>
<li>Bit operators: <code class="docutils literal notranslate"><span class="pre">&amp;</span></code>, <code class="docutils literal notranslate"><span class="pre">|</span></code>, <code class="docutils literal notranslate"><span class="pre">^</span></code> (bitwise exclusive or), <code class="docutils literal notranslate"><span class="pre">~</span></code> (bitwise negation)</li>
<li>Shift operators: <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> (left shift), <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> (right shift)</li>
<li>Index access: If <code class="docutils literal notranslate"><span class="pre">x</span></code> is of type <code class="docutils literal notranslate"><span class="pre">bytesI</span></code>, then <code class="docutils literal notranslate"><span class="pre">x[k]</span></code> for <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">I</span></code> returns the <code class="docutils literal notranslate"><span class="pre">k</span></code> th byte (read-only).</li>
</ul>
<p>The shifting operator works with any integer type as right operand (but
returns the type of the left operand), which denotes the number of bits to shift by.
Shifting by a negative amount causes a runtime exception.</p>
<p>Members:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">.length</span></code> yields the fixed length of the byte array (read-only).</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The type <code class="docutils literal notranslate"><span class="pre">byte[]</span></code> is an array of bytes, but due to padding rules, it wastes
31 bytes of space for each element (except in storage). It is better to use the <code class="docutils literal notranslate"><span class="pre">bytes</span></code>
type instead.</p>
</div>
</div>
<div class="section" id="dynamically-sized-byte-array">
<h5>Dynamically-sized byte array<a class="headerlink" href="#dynamically-sized-byte-array" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">bytes</span></code>:</dt>
<dd>Dynamically-sized byte array, see <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. Not a value-type!</dd>
<dt><code class="docutils literal notranslate"><span class="pre">string</span></code>:</dt>
<dd>Dynamically-sized UTF-8-encoded string, see <a class="reference internal" href="#arrays"><span class="std std-ref">Arrays</span></a>. Not a value-type!</dd>
</dl>
</div>
<div class="section" id="address-literals">
<span id="index-8"></span><span id="id6"></span><h5>Address Literals<a class="headerlink" href="#address-literals" title="Permalink to this headline">¶</a></h5>
<p>Hexadecimal literals that pass the address checksum test, for example
<code class="docutils literal notranslate"><span class="pre">0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF</span></code> are of <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> type.
Hexadecimal literals that are between 39 and 41 digits
long and do not pass the checksum test produce
a warning and are treated as regular rational number literals.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The mixed-case address checksum format is defined in <a class="reference external" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-55.md">EIP-55</a>.</p>
</div>
</div>
<div class="section" id="rational-and-integer-literals">
<span id="rational-literals"></span><span id="index-9"></span><h5>Rational and Integer Literals<a class="headerlink" href="#rational-and-integer-literals" title="Permalink to this headline">¶</a></h5>
<p>Integer literals are formed from a sequence of numbers in the range 0-9.
They are interpreted as decimals. For example, <code class="docutils literal notranslate"><span class="pre">69</span></code> means sixty nine.
Octal literals do not exist in Solidity and leading zeros are invalid.</p>
<p>Decimal fraction literals are formed by a <code class="docutils literal notranslate"><span class="pre">.</span></code> with at least one number on
one side.  Examples include <code class="docutils literal notranslate"><span class="pre">1.</span></code>, <code class="docutils literal notranslate"><span class="pre">.1</span></code> and <code class="docutils literal notranslate"><span class="pre">1.3</span></code>.</p>
<p>Scientific notation is also supported, where the base can have fractions, while the exponent cannot.
Examples include <code class="docutils literal notranslate"><span class="pre">2e10</span></code>, <code class="docutils literal notranslate"><span class="pre">-2e10</span></code>, <code class="docutils literal notranslate"><span class="pre">2e-10</span></code>, <code class="docutils literal notranslate"><span class="pre">2.5e1</span></code>.</p>
<p>Underscores can be used to separate the digits of a numeric literal to aid readability.
For example, decimal <code class="docutils literal notranslate"><span class="pre">123_000</span></code>, hexadecimal <code class="docutils literal notranslate"><span class="pre">0x2eff_abde</span></code>, scientific decimal notation <code class="docutils literal notranslate"><span class="pre">1_2e345_678</span></code> are all valid.
Underscores are only allowed between two digits and only one consecutive underscore is allowed.
There is no additional semantic meaning added to a number literal containing underscores,
the underscores are ignored.</p>
<p>Number literal expressions retain arbitrary precision until they are converted to a non-literal type (i.e. by
using them together with a non-literal expression or by explicit conversion).
This means that computations do not overflow and divisions do not truncate
in number literal expressions.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">(2**800</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">-</span> <span class="pre">2**800</span></code> results in the constant <code class="docutils literal notranslate"><span class="pre">1</span></code> (of type <code class="docutils literal notranslate"><span class="pre">uint8</span></code>)
although intermediate results would not even fit the machine word size. Furthermore, <code class="docutils literal notranslate"><span class="pre">.5</span> <span class="pre">*</span> <span class="pre">8</span></code> results
in the integer <code class="docutils literal notranslate"><span class="pre">4</span></code> (although non-integers were used in between).</p>
<p>Any operator that can be applied to integers can also be applied to number literal expressions as
long as the operands are integers. If any of the two is fractional, bit operations are disallowed
and exponentiation is disallowed if the exponent is fractional (because that might result in
a non-rational number).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Solidity has a number literal type for each rational number.
Integer literals and rational number literals belong to number literal types.
Moreover, all number literal expressions (i.e. the expressions that
contain only number literals and operators) belong to number literal
types.  So the number literal expressions <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">+</span> <span class="pre">2</span></code> and <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">+</span> <span class="pre">1</span></code> both
belong to the same number literal type for the rational number three.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Division on integer literals used to truncate in Solidity prior to version 0.4.0, but it now converts into a rational number, i.e. <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">2</span></code> is not equal to <code class="docutils literal notranslate"><span class="pre">2</span></code>, but to <code class="docutils literal notranslate"><span class="pre">2.5</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Number literal expressions are converted into a non-literal type as soon as they are used with non-literal
expressions. Disregarding types, the value of the expression assigned to <code class="docutils literal notranslate"><span class="pre">b</span></code>
below evaluates to an integer. Because <code class="docutils literal notranslate"><span class="pre">a</span></code> is of type <code class="docutils literal notranslate"><span class="pre">uint128</span></code>, the
expression <code class="docutils literal notranslate"><span class="pre">2.5</span> <span class="pre">+</span> <span class="pre">a</span></code> has to have a proper type, though. Since there is no common type
for the type of <code class="docutils literal notranslate"><span class="pre">2.5</span></code> and <code class="docutils literal notranslate"><span class="pre">uint128</span></code>, the Solidity compiler does not accept
this code.</p>
</div>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint128</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">uint128</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="string-literals-and-types">
<span id="string-literals"></span><span id="index-10"></span><h5>String Literals and Types<a class="headerlink" href="#string-literals-and-types" title="Permalink to this headline">¶</a></h5>
<p>String literals are written with either double or single-quotes (<code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">'bar'</span></code>).  They do not imply trailing zeroes as in C; <code class="docutils literal notranslate"><span class="pre">&quot;foo&quot;</span></code> represents three bytes, not four.  As with integer literals, their type can vary, but they are implicitly convertible to <code class="docutils literal notranslate"><span class="pre">bytes1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>, if they fit, to <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and to <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p>
<p>For example, with <code class="docutils literal notranslate"><span class="pre">bytes32</span> <span class="pre">samevar</span> <span class="pre">=</span> <span class="pre">&quot;stringliteral&quot;</span></code> the string literal is interpreted in its raw byte form when assigned to a <code class="docutils literal notranslate"><span class="pre">bytes32</span></code> type.</p>
<p>String literals support the following escape characters:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">\&lt;newline&gt;</span></code> (escapes an actual newline)</li>
<li><code class="docutils literal notranslate"><span class="pre">\\</span></code> (backslash)</li>
<li><code class="docutils literal notranslate"><span class="pre">\'</span></code> (single quote)</li>
<li><code class="docutils literal notranslate"><span class="pre">\&quot;</span></code> (double quote)</li>
<li><code class="docutils literal notranslate"><span class="pre">\b</span></code> (backspace)</li>
<li><code class="docutils literal notranslate"><span class="pre">\f</span></code> (form feed)</li>
<li><code class="docutils literal notranslate"><span class="pre">\n</span></code> (newline)</li>
<li><code class="docutils literal notranslate"><span class="pre">\r</span></code> (carriage return)</li>
<li><code class="docutils literal notranslate"><span class="pre">\t</span></code> (tab)</li>
<li><code class="docutils literal notranslate"><span class="pre">\v</span></code> (vertical tab)</li>
<li><code class="docutils literal notranslate"><span class="pre">\xNN</span></code> (hex escape, see below)</li>
<li><code class="docutils literal notranslate"><span class="pre">\uNNNN</span></code> (unicode escape, see below)</li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">\xNN</span></code> takes a hex value and inserts the appropriate byte, while <code class="docutils literal notranslate"><span class="pre">\uNNNN</span></code> takes a Unicode codepoint and inserts an UTF-8 sequence.</p>
<p>The string in the following example has a length of ten bytes.
It starts with a newline byte, followed by a double quote, a single
quote a backslash character and then (without separator) the
character sequence <code class="docutils literal notranslate"><span class="pre">abcdef</span></code>.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;</span><span class="se">\n\&quot;\&#39;\\</span><span class="s">abc</span><span class="se">\</span>
<span class="s">def&quot;</span>
</pre></div>
</div>
<p>Any unicode line terminator which is not a newline (i.e. LF, VF, FF, CR, NEL, LS, PS) is considered to
terminate the string literal. Newline only terminates the string literal if it is not preceded by a <code class="docutils literal notranslate"><span class="pre">\</span></code>.</p>
</div>
<div class="section" id="hexadecimal-literals">
<span id="index-11"></span><h5>Hexadecimal Literals<a class="headerlink" href="#hexadecimal-literals" title="Permalink to this headline">¶</a></h5>
<p>Hexadecimal literals are prefixed with the keyword <code class="docutils literal notranslate"><span class="pre">hex</span></code> and are enclosed in double or single-quotes (<code class="docutils literal notranslate"><span class="pre">hex&quot;001122FF&quot;</span></code>). Their content must be a hexadecimal string and their value will be the binary representation of those values.</p>
<p>Hexadecimal literals behave like <a class="reference internal" href="#string-literals"><span class="std std-ref">string literals</span></a> and have the same convertibility restrictions.</p>
</div>
<div class="section" id="enums">
<span id="index-12"></span><span id="id7"></span><h5>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">¶</a></h5>
<p>Enums are one way to create a user-defined type in Solidity. They are explicitly convertible
to and from all integer types but implicit conversion is not allowed.  The explicit conversion
from integer checks at runtime that the value lies inside the range of the enum and causes a failing assert otherwise.
Enums needs at least one member.</p>
<p>The data representation is the same as for enums in C: The options are represented by
subsequent unsigned integer values starting from <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">ActionChoices</span> <span class="p">{</span> <span class="n">GoLeft</span><span class="p">,</span> <span class="n">GoRight</span><span class="p">,</span> <span class="n">GoStraight</span><span class="p">,</span> <span class="n">SitStill</span> <span class="p">}</span>
    <span class="n">ActionChoices</span> <span class="n">choice</span><span class="p">;</span>
    <span class="n">ActionChoices</span> <span class="kr">constant</span> <span class="n">defaultChoice</span> <span class="o">=</span> <span class="n">ActionChoices</span><span class="p">.</span><span class="n">GoStraight</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">setGoStraight</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="n">ActionChoices</span><span class="p">.</span><span class="n">GoStraight</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Since enum types are not part of the ABI, the signature of &quot;getChoice&quot;</span>
    <span class="c1">// will automatically be changed to &quot;getChoice() returns (uint8)&quot;</span>
    <span class="c1">// for all matters external to Solidity. The integer type used is just</span>
    <span class="c1">// large enough to hold all enum values, i.e. if you have more than 256 values,</span>
    <span class="c1">// `uint16` will be used and so on.</span>
    <span class="kd">function</span> <span class="n">getChoice</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="n">ActionChoices</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">choice</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">getDefaultChoice</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">uint</span><span class="p">(</span><span class="n">defaultChoice</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-types">
<span id="index-13"></span><span id="id8"></span><h5>Function Types<a class="headerlink" href="#function-types" title="Permalink to this headline">¶</a></h5>
<p>Function types are the types of functions. Variables of function type
can be assigned from functions and function parameters of function type
can be used to pass functions to and return functions from function calls.
Function types come in two flavours - <em>internal</em> and <em>external</em> functions:</p>
<p>Internal functions can only be called inside the current contract (more specifically,
inside the current code unit, which also includes internal library functions
and inherited functions) because they cannot be executed outside of the
context of the current contract. Calling an internal function is realized
by jumping to its entry label, just like when calling a function of the current
contract internally.</p>
<p>External functions consist of an address and a function signature and they can
be passed via and returned from external function calls.</p>
<p>Function types are notated as follows:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">parameter</span> <span class="n">types</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span><span class="kr">internal</span><span class="o">|</span><span class="kr">external</span><span class="p">}</span> <span class="p">[</span><span class="kr">pure</span><span class="o">|</span><span class="kr">view</span><span class="o">|</span><span class="kr">payable</span><span class="p">]</span> <span class="p">[</span><span class="k">returns</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">return</span> <span class="n">types</span><span class="o">&gt;</span><span class="p">)]</span>
</pre></div>
</div>
<p>In contrast to the parameter types, the return types cannot be empty - if the
function type should not return anything, the whole <code class="docutils literal notranslate"><span class="pre">returns</span> <span class="pre">(&lt;return</span> <span class="pre">types&gt;)</span></code>
part has to be omitted.</p>
<p>By default, function types are internal, so the <code class="docutils literal notranslate"><span class="pre">internal</span></code> keyword can be
omitted. Note that this only applies to function types. Visibility has
to be specified explicitly for functions defined in contracts, they
do not have a default.</p>
<p>Conversions:</p>
<p>A value of external function type can be explicitly converted to <code class="docutils literal notranslate"><span class="pre">address</span></code>
resulting in the address of the contract of the function.</p>
<p>A function type <code class="docutils literal notranslate"><span class="pre">A</span></code> is implicitly convertible to a function type <code class="docutils literal notranslate"><span class="pre">B</span></code> if and only if
their parameter types are identical, their return types are identical,
their internal/external property is identical and the state mutability of <code class="docutils literal notranslate"><span class="pre">A</span></code>
is not more restrictive than the state mutability of <code class="docutils literal notranslate"><span class="pre">B</span></code>. In particular:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">pure</span></code> functions can be converted to <code class="docutils literal notranslate"><span class="pre">view</span></code> and <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions</li>
<li><code class="docutils literal notranslate"><span class="pre">view</span></code> functions can be converted to <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions</li>
<li><code class="docutils literal notranslate"><span class="pre">payable</span></code> functions can be converted to <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions</li>
</ul>
</div></blockquote>
<p>No other conversions between function types are possible.</p>
<p>The rule about <code class="docutils literal notranslate"><span class="pre">payable</span></code> and <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> might be a little
confusing, but in essence, if a function is <code class="docutils literal notranslate"><span class="pre">payable</span></code>, this means that it
also accepts a payment of zero Ether, so it also is <code class="docutils literal notranslate"><span class="pre">non-payable</span></code>.
On the other hand, a <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> function will reject Ether sent to it,
so <code class="docutils literal notranslate"><span class="pre">non-payable</span></code> functions cannot be converted to <code class="docutils literal notranslate"><span class="pre">payable</span></code> functions.</p>
<p>If a function type variable is not initialised, calling it results
in a failed assertion. The same happens if you call a function after using <code class="docutils literal notranslate"><span class="pre">delete</span></code>
on it.</p>
<p>If external function types are used outside of the context of Solidity,
they are treated as the <code class="docutils literal notranslate"><span class="pre">function</span></code> type, which encodes the address
followed by the function identifier together in a single <code class="docutils literal notranslate"><span class="pre">bytes24</span></code> type.</p>
<p>Note that public functions of the current contract can be used both as an
internal and as an external function. To use <code class="docutils literal notranslate"><span class="pre">f</span></code> as an internal function,
just use <code class="docutils literal notranslate"><span class="pre">f</span></code>, if you want to use its external form, use <code class="docutils literal notranslate"><span class="pre">this.f</span></code>.</p>
<p>Members:</p>
<p>Public (or external) functions also have a special member called <code class="docutils literal notranslate"><span class="pre">selector</span></code>,
which returns the <a class="reference internal" href="index.html#abi-function-selector"><span class="std std-ref">ABI function selector</span></a>:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Selector</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes4</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">this</span><span class="p">.</span><span class="n">f</span><span class="p">.</span><span class="nb">selector</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example that shows how to use internal function types:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">ArrayUtils</span> <span class="p">{</span>
  <span class="c1">// internal functions can be used in internal library functions because</span>
  <span class="c1">// they will be part of the same code context</span>
  <span class="kd">function</span> <span class="n">map</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">self</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">f</span><span class="p">)</span>
    <span class="kr">internal</span>
    <span class="kr">pure</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">r</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="n">self</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="n">reduce</span><span class="p">(</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">self</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="n">f</span>
  <span class="p">)</span>
    <span class="kr">internal</span>
    <span class="kr">pure</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">r</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">self</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="n">range</span><span class="p">(</span><span class="kt">uint</span> <span class="n">length</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="n">length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Pyramid</span> <span class="p">{</span>
  <span class="kn">using</span> <span class="n">ArrayUtils</span> <span class="k">for</span> <span class="o">*</span><span class="p">;</span>
  <span class="kd">function</span> <span class="n">pyramid</span><span class="p">(</span><span class="kt">uint</span> <span class="n">l</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ArrayUtils</span><span class="p">.</span><span class="n">range</span><span class="p">(</span><span class="n">l</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="n">square</span><span class="p">).</span><span class="n">reduce</span><span class="p">(</span><span class="n">sum</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="n">square</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="n">sum</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Another example that uses external function types:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Oracle</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="n">Request</span> <span class="p">{</span>
    <span class="kt">bytes</span> <span class="n">data</span><span class="p">;</span>
    <span class="kd">function</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">external</span> <span class="n">callback</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Request</span><span class="p">[]</span> <span class="n">requests</span><span class="p">;</span>
  <span class="kd">event</span> <span class="n">NewRequest</span><span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
  <span class="kd">function</span> <span class="n">query</span><span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">external</span> <span class="n">callback</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="n">requests</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">callback</span><span class="p">));</span>
    <span class="kr">emit</span> <span class="n">NewRequest</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="n">reply</span><span class="p">(</span><span class="kt">uint</span> <span class="n">requestID</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">response</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="c1">// Here goes the check that the reply comes from a trusted source</span>
    <span class="n">requests</span><span class="p">[</span><span class="n">requestID</span><span class="p">].</span><span class="n">callback</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">OracleUser</span> <span class="p">{</span>
  <span class="n">Oracle</span> <span class="kr">constant</span> <span class="n">oracle</span> <span class="o">=</span> <span class="n">Oracle</span><span class="p">(</span><span class="mh">0x1234567</span><span class="p">);</span> <span class="c1">// known contract</span>
  <span class="kt">uint</span> <span class="n">exchangeRate</span><span class="p">;</span>
  <span class="kd">function</span> <span class="n">buySomething</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="n">oracle</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="s">&quot;USD&quot;</span><span class="p">,</span> <span class="nb">this</span><span class="p">.</span><span class="n">oracleResponse</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kd">function</span> <span class="n">oracleResponse</span><span class="p">(</span><span class="kt">uint</span> <span class="n">response</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span>
        <span class="nb">msg.sender</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="n">oracle</span><span class="p">),</span>
        <span class="s">&quot;Only oracle can call this.&quot;</span>
    <span class="p">);</span>
    <span class="n">exchangeRate</span> <span class="o">=</span> <span class="n">response</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lambda or inline functions are planned but not yet supported.</p>
</div>
</div>
</div>
<div class="section" id="reference-types">
<span id="index-14"></span><span id="id9"></span><h4>Reference Types<a class="headerlink" href="#reference-types" title="Permalink to this headline">¶</a></h4>
<p>Values of reference type can be modified through multiple different names.
Contrast this with value types where you get an independent copy whenever
a variable of value type is used. Because of that, reference types have to be handled
more carefully than value types. Currently, reference types comprise structs,
arrays and mappings. If you use a reference type, you always have to explicitly
provide the data area where the type is stored: <code class="docutils literal notranslate"><span class="pre">memory</span></code> (whose lifetime is limited
to a function call), <code class="docutils literal notranslate"><span class="pre">storage</span></code> (the location where the state variables are stored)
or <code class="docutils literal notranslate"><span class="pre">calldata</span></code> (special data location that contains the function arguments,
only available for external function call parameters).</p>
<p>An assignment or type conversion that changes the data location will always incur an automatic copy operation,
while assignments inside the same data location only copy in some cases for storage types.</p>
<div class="section" id="data-location">
<span id="id10"></span><h5>Data location<a class="headerlink" href="#data-location" title="Permalink to this headline">¶</a></h5>
<p>Every reference type, i.e. <em>arrays</em> and <em>structs</em>, has an additional
annotation, the “data location”, about where it is stored. There are three data locations:
<code class="docutils literal notranslate"><span class="pre">memory</span></code>, <code class="docutils literal notranslate"><span class="pre">storage</span></code> and <code class="docutils literal notranslate"><span class="pre">calldata</span></code>. Calldata is only valid for parameters of external contract
functions and is required for this type of parameter. Calldata is a non-modifiable,
non-persistent area where function arguments are stored, and behaves mostly like memory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0 the data location could be omitted, and would default to different locations
depending on the kind of variable, function type, etc., but all complex types must now give an explicit
data location.</p>
</div>
<div class="section" id="data-location-and-assignment-behaviour">
<span id="data-location-assignment"></span><h6>Data location and assignment behaviour<a class="headerlink" href="#data-location-and-assignment-behaviour" title="Permalink to this headline">¶</a></h6>
<p>Data locations are not only relevant for persistency of data, but also for the semantics of assignments:</p>
<ul class="simple">
<li>Assignments between <code class="docutils literal notranslate"><span class="pre">storage</span></code> and <code class="docutils literal notranslate"><span class="pre">memory</span></code> (or from <code class="docutils literal notranslate"><span class="pre">calldata</span></code>) always create an independent copy.</li>
<li>Assignments from <code class="docutils literal notranslate"><span class="pre">memory</span></code> to <code class="docutils literal notranslate"><span class="pre">memory</span></code> only create references. This means that changes to one memory variable are also visible in all other memory variables that refer to the same data.</li>
<li>Assignments from <code class="docutils literal notranslate"><span class="pre">storage</span></code> to a local storage variable also only assign a reference.</li>
<li>All other assignments to <code class="docutils literal notranslate"><span class="pre">storage</span></code> always copy. Examples for this case are assignments to state variables or to members of local variables of storage struct type, even if the local variable itself is just a reference.</li>
</ul>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// the data location of x is storage</span>

    <span class="c1">// the data location of memoryArray is memory</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">memoryArray</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">memoryArray</span><span class="p">;</span> <span class="c1">// works, copies the whole array to storage</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="kr">storage</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// works, assigns a pointer, data location of y is storage</span>
        <span class="n">y</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span> <span class="c1">// fine, returns the 8th element</span>
        <span class="n">y</span><span class="p">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// fine, modifies x through y</span>
        <span class="k">delete</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// fine, clears the array, also modifies y</span>
        <span class="c1">// The following does not work; it would need to create a new temporary /</span>
        <span class="c1">// unnamed array in storage, but storage is &quot;statically&quot; allocated:</span>
        <span class="c1">// y = memoryArray;</span>
        <span class="c1">// This does not work either, since it would &quot;reset&quot; the pointer, but there</span>
        <span class="c1">// is no sensible location it could point to.</span>
        <span class="c1">// delete y;</span>
        <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="c1">// calls g, handing over a reference to x</span>
        <span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="c1">// calls h and creates an independent, temporary copy in memory</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">storage</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="p">{}</span>
    <span class="kd">function</span> <span class="n">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="arrays">
<span id="index-15"></span><span id="id11"></span><h5>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h5>
<p>Arrays can have a compile-time fixed size, or they can have a dynamic size.</p>
<p>The type of an array of fixed size <code class="docutils literal notranslate"><span class="pre">k</span></code> and element type <code class="docutils literal notranslate"><span class="pre">T</span></code> is written as <code class="docutils literal notranslate"><span class="pre">T[k]</span></code>,
and an array of dynamic size as <code class="docutils literal notranslate"><span class="pre">T[]</span></code>.</p>
<p>For example, an array of 5 dynamic arrays of <code class="docutils literal notranslate"><span class="pre">uint</span></code> is written as
<code class="docutils literal notranslate"><span class="pre">uint[][5]</span></code>. The notation is reversed compared to some other languages. In
Solidity, <code class="docutils literal notranslate"><span class="pre">X[3]</span></code> is always an array containing three elements of type <code class="docutils literal notranslate"><span class="pre">X</span></code>,
even if <code class="docutils literal notranslate"><span class="pre">X</span></code> is itself an array. This is not the case in other languages such
as C.</p>
<p>Indices are zero-based, and access is in the opposite direction of the
declaration.</p>
<p>For example, if you have a variable <code class="docutils literal notranslate"><span class="pre">uint[][5]</span> <span class="pre">x</span> <span class="pre">memory</span></code>, you access the
second <code class="docutils literal notranslate"><span class="pre">uint</span></code> in the third dynamic array using <code class="docutils literal notranslate"><span class="pre">x[2][1]</span></code>, and to access the
third dynamic array, use <code class="docutils literal notranslate"><span class="pre">x[2]</span></code>. Again,
if you have an array <code class="docutils literal notranslate"><span class="pre">T[5]</span> <span class="pre">a</span></code> for a type <code class="docutils literal notranslate"><span class="pre">T</span></code> that can also be an array,
then <code class="docutils literal notranslate"><span class="pre">a[2]</span></code> always has type <code class="docutils literal notranslate"><span class="pre">T</span></code>.</p>
<p>Array elements can be of any type, including mapping or struct. The general
restrictions for types apply, in that mappings can only be stored in the
<code class="docutils literal notranslate"><span class="pre">storage</span></code> data location and publicly-visible functions need parameters that are <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI types</span></a>.</p>
<p>Accessing an array past its end causes a failing assertion. You can use the <code class="docutils literal notranslate"><span class="pre">.push()</span></code> method to append a new element at the end or assign to the <code class="docutils literal notranslate"><span class="pre">.length</span></code> <a class="reference internal" href="#array-members"><span class="std std-ref">member</span></a> to change the size (see below for caveats).
method or increase the <code class="docutils literal notranslate"><span class="pre">.length</span></code> <a class="reference internal" href="#array-members"><span class="std std-ref">member</span></a> to add elements.</p>
<p>Variables of type <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code> are special arrays. A <code class="docutils literal notranslate"><span class="pre">bytes</span></code> is similar to <code class="docutils literal notranslate"><span class="pre">byte[]</span></code>,
but it is packed tightly in calldata and memory. <code class="docutils literal notranslate"><span class="pre">string</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">bytes</span></code> but does not allow
length or index access.</p>
<p>You should use <code class="docutils literal notranslate"><span class="pre">bytes</span></code> over <code class="docutils literal notranslate"><span class="pre">byte[]</span></code> because it is cheaper, since <code class="docutils literal notranslate"><span class="pre">byte[]</span></code> adds 31 padding bytes between the elements. As a general rule,
use <code class="docutils literal notranslate"><span class="pre">bytes</span></code> for arbitrary-length raw byte data and <code class="docutils literal notranslate"><span class="pre">string</span></code> for arbitrary-length
string (UTF-8) data. If you can limit the length to a certain number of bytes,
always use one of the value types <code class="docutils literal notranslate"><span class="pre">bytes1</span></code> to <code class="docutils literal notranslate"><span class="pre">bytes32</span></code> because they are much cheaper.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to access the byte-representation of a string <code class="docutils literal notranslate"><span class="pre">s</span></code>, use
<code class="docutils literal notranslate"><span class="pre">bytes(s).length</span></code> / <code class="docutils literal notranslate"><span class="pre">bytes(s)[7]</span> <span class="pre">=</span> <span class="pre">'x';</span></code>. Keep in mind
that you are accessing the low-level bytes of the UTF-8 representation,
and not the individual characters.</p>
</div>
<p>It is possible to mark arrays <code class="docutils literal notranslate"><span class="pre">public</span></code> and have Solidity create a <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a>.
The numeric index becomes a required parameter for the getter.</p>
<div class="section" id="allocating-memory-arrays">
<span id="index-16"></span><h6>Allocating Memory Arrays<a class="headerlink" href="#allocating-memory-arrays" title="Permalink to this headline">¶</a></h6>
<p>You must use the <code class="docutils literal notranslate"><span class="pre">new</span></code> keyword to create arrays with a runtime-dependent length in memory.
As opposed to storage arrays, it is <strong>not</strong> possible to resize memory arrays (e.g. by assigning to
the <code class="docutils literal notranslate"><span class="pre">.length</span></code> member). You either have to calculate the required size in advance
or create a new memory array and copy every element.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">len</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">a</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="mi">7</span><span class="p">);</span>
        <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">7</span><span class="p">);</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">len</span><span class="p">);</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="array-literals">
<span id="index-17"></span><h6>Array Literals<a class="headerlink" href="#array-literals" title="Permalink to this headline">¶</a></h6>
<p>An array literal is a comma-separated list of one or more expressions, enclosed
in square brackets (<code class="docutils literal notranslate"><span class="pre">[...]</span></code>). For example <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">a,</span> <span class="pre">f(3)]</span></code>. There must be a
common type all elements can be implicitly converted to. This is the elementary
type of the array.</p>
<p>Array literals are always statically-sized memory arrays.</p>
<p>In the example below, the type of <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">3]</span></code> is
<code class="docutils literal notranslate"><span class="pre">uint8[3]</span> <span class="pre">memory</span></code>. Because the type of each of these constants is <code class="docutils literal notranslate"><span class="pre">uint8</span></code>, if you want the result to be a <code class="docutils literal notranslate"><span class="pre">uint[3]</span> <span class="pre">memory</span></code> type, you need to convert the first element to <code class="docutils literal notranslate"><span class="pre">uint</span></code>.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="n">g</span><span class="p">([</span><span class="kt">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="kr">memory</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Fixed size memory arrays cannot be assigned to dynamically-sized memory arrays, i.e. the following is not possible:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// This will not compile.</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// The next line creates a type error because uint[3] memory</span>
        <span class="c1">// cannot be converted to uint[] memory.</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is planned to remove this restriction in the future, but it creates some
complications because of how arrays are passed in the ABI.</p>
</div>
<div class="section" id="array-members">
<span id="index-18"></span><span id="id12"></span><h6>Array Members<a class="headerlink" href="#array-members" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><strong>length</strong>:</dt>
<dd>Arrays have a <code class="docutils literal notranslate"><span class="pre">length</span></code> member that contains their number of elements.
The length of memory arrays is fixed (but dynamic, i.e. it can depend on runtime parameters) once they are created.
For dynamically-sized arrays (only available for storage), this member can be assigned to resize the array.
Accessing elements outside the current length does not automatically resize the array and instead causes a failing assertion.
Increasing the length adds new zero-initialised elements to the array.
Reducing the length performs an implicit :ref:<code class="docutils literal notranslate"><span class="pre">delete</span></code> on each of the
removed elements. If you try to resize a non-dynamic array that isn’t in
storage, you receive a <code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">an</span> <span class="pre">lvalue</span></code> error.</dd>
<dt><strong>push</strong>:</dt>
<dd>Dynamic storage arrays and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> (not <code class="docutils literal notranslate"><span class="pre">string</span></code>) have a member function called <code class="docutils literal notranslate"><span class="pre">push</span></code> that you can use to append an element at the end of the array. The element will be zero-initialised. The function returns the new length.</dd>
<dt><strong>pop</strong>:</dt>
<dd>Dynamic storage arrays and <code class="docutils literal notranslate"><span class="pre">bytes</span></code> (not <code class="docutils literal notranslate"><span class="pre">string</span></code>) have a member function called <code class="docutils literal notranslate"><span class="pre">pop</span></code> that you can use to remove an element from the end of the array. This also implicitly calls :ref:<code class="docutils literal notranslate"><span class="pre">delete</span></code> on the removed element.</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you use <code class="docutils literal notranslate"><span class="pre">.length--</span></code> on an empty array, it causes an underflow and
thus sets the length to <code class="docutils literal notranslate"><span class="pre">2**256-1</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Increasing the length of a storage array has constant gas costs because
storage is assumed to be zero-initialised, while decreasing
the length has at least linear cost (but in most cases worse than linear),
because it includes explicitly clearing the removed
elements similar to calling :ref:<code class="docutils literal notranslate"><span class="pre">delete</span></code> on them.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is not yet possible to use arrays of arrays in external functions
(but they are supported in public functions).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In EVM versions before Byzantium, it was not possible to access
dynamic arrays return from function calls. If you call functions
that return dynamic arrays, make sure to use an EVM that is set to
Byzantium mode.</p>
</div>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">ArrayContract</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="mi">20</span><span class="p">]</span> <span class="n">m_aLotOfIntegers</span><span class="p">;</span>
    <span class="c1">// Note that the following is not a pair of dynamic arrays but a</span>
    <span class="c1">// dynamic array of pairs (i.e. of fixed size arrays of length two).</span>
    <span class="c1">// Because of that, T[] is always a dynamic array of T, even if T</span>
    <span class="c1">// itself is an array.</span>
    <span class="c1">// Data location for all state variables is storage.</span>
    <span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="n">m_pairsOfFlags</span><span class="p">;</span>

    <span class="c1">// newPairs is stored in memory - the only possibility</span>
    <span class="c1">// for public contract function arguments</span>
    <span class="kd">function</span> <span class="n">setAllFlagPairs</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="kr">memory</span> <span class="n">newPairs</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// assignment to a storage array performs a copy of ``newPairs`` and</span>
        <span class="c1">// replaces the complete array ``m_pairsOfFlags``.</span>
        <span class="n">m_pairsOfFlags</span> <span class="o">=</span> <span class="n">newPairs</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="n">StructType</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="n">contents</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">moreInfo</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">StructType</span> <span class="n">s</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">c</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// stores a reference to ``s`` in ``g``</span>
        <span class="n">StructType</span> <span class="kr">storage</span> <span class="n">g</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
        <span class="c1">// also changes ``s.moreInfo``.</span>
        <span class="n">g</span><span class="p">.</span><span class="n">moreInfo</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="c1">// assigns a copy because ``g.contents``</span>
        <span class="c1">// is not a local variable, but a member of</span>
        <span class="c1">// a local variable.</span>
        <span class="n">g</span><span class="p">.</span><span class="n">contents</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">setFlagPair</span><span class="p">(</span><span class="kt">uint</span> <span class="n">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">flagA</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">flagB</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// access to a non-existing index will throw an exception</span>
        <span class="n">m_pairsOfFlags</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">flagA</span><span class="p">;</span>
        <span class="n">m_pairsOfFlags</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">flagB</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changeFlagArraySize</span><span class="p">(</span><span class="kt">uint</span> <span class="n">newSize</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// if the new size is smaller, removed array elements will be cleared</span>
        <span class="n">m_pairsOfFlags</span><span class="p">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">newSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">clear</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// these clear the arrays completely</span>
        <span class="k">delete</span> <span class="n">m_pairsOfFlags</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">m_aLotOfIntegers</span><span class="p">;</span>
        <span class="c1">// identical effect here</span>
        <span class="n">m_pairsOfFlags</span><span class="p">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bytes</span> <span class="n">m_byteData</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">byteArrays</span><span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">data</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// byte arrays (&quot;bytes&quot;) are different as they are stored without padding,</span>
        <span class="c1">// but can be treated identical to &quot;uint8[]&quot;</span>
        <span class="n">m_byteData</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="n">m_byteData</span><span class="p">.</span><span class="n">length</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
        <span class="n">m_byteData</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">m_byteData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">addFlag</span><span class="p">(</span><span class="kt">bool</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="kr">memory</span> <span class="n">flag</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">m_pairsOfFlags</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">createMemoryArray</span><span class="p">(</span><span class="kt">uint</span> <span class="n">size</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Dynamic memory arrays are created using `new`:</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="p">][]</span> <span class="kr">memory</span> <span class="n">arrayOfPairs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[</span><span class="mi">2</span><span class="p">][](</span><span class="n">size</span><span class="p">);</span>

        <span class="c1">// Inline arrays are always statically-sized and if you only</span>
        <span class="c1">// use literals, you have to provide at least one type.</span>
        <span class="n">arrayOfPairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kt">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">];</span>

        <span class="c1">// Create a dynamic byte array:</span>
        <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kt">byte</span><span class="p">(</span><span class="kt">uint8</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="structs">
<span id="index-19"></span><span id="id13"></span><h5>Structs<a class="headerlink" href="#structs" title="Permalink to this headline">¶</a></h5>
<p>Solidity provides a way to define new types in the form of structs, which is
shown in the following example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">CrowdFunding</span> <span class="p">{</span>
    <span class="c1">// Defines a new type with two fields.</span>
    <span class="kd">struct</span> <span class="n">Funder</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">addr</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="n">Campaign</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="kr">payable</span> <span class="n">beneficiary</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">fundingGoal</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">numFunders</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">amount</span><span class="p">;</span>
        <span class="kd">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="n">Funder</span><span class="p">)</span> <span class="n">funders</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">uint</span> <span class="n">numCampaigns</span><span class="p">;</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="n">Campaign</span><span class="p">)</span> <span class="n">campaigns</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">newCampaign</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">beneficiary</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">goal</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">campaignID</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">campaignID</span> <span class="o">=</span> <span class="n">numCampaigns</span><span class="o">++</span><span class="p">;</span> <span class="c1">// campaignID is return variable</span>
        <span class="c1">// Creates new struct in memory and copies it to storage.</span>
        <span class="c1">// We leave out the mapping type, because it is not valid in memory.</span>
        <span class="c1">// If structs are copied (even from storage to storage), mapping types</span>
        <span class="c1">// are always omitted, because they cannot be enumerated.</span>
        <span class="n">campaigns</span><span class="p">[</span><span class="n">campaignID</span><span class="p">]</span> <span class="o">=</span> <span class="n">Campaign</span><span class="p">(</span><span class="n">beneficiary</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">contribute</span><span class="p">(</span><span class="kt">uint</span> <span class="n">campaignID</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">Campaign</span> <span class="kr">storage</span> <span class="n">c</span> <span class="o">=</span> <span class="n">campaigns</span><span class="p">[</span><span class="n">campaignID</span><span class="p">];</span>
        <span class="c1">// Creates a new temporary memory struct, initialised with the given values</span>
        <span class="c1">// and copies it over to storage.</span>
        <span class="c1">// Note that you can also use Funder(msg.sender, msg.value) to initialise.</span>
        <span class="n">c</span><span class="p">.</span><span class="n">funders</span><span class="p">[</span><span class="n">c</span><span class="p">.</span><span class="n">numFunders</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">Funder</span><span class="p">({</span><span class="n">addr</span><span class="o">:</span> <span class="nb">msg.sender</span><span class="p">,</span> <span class="n">amount</span><span class="o">:</span> <span class="nb">msg.value</span><span class="p">});</span>
        <span class="n">c</span><span class="p">.</span><span class="n">amount</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">checkGoalReached</span><span class="p">(</span><span class="kt">uint</span> <span class="n">campaignID</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">reached</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Campaign</span> <span class="kr">storage</span> <span class="n">c</span> <span class="o">=</span> <span class="n">campaigns</span><span class="p">[</span><span class="n">campaignID</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">amount</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">.</span><span class="n">fundingGoal</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">amount</span><span class="p">;</span>
        <span class="n">c</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">c</span><span class="p">.</span><span class="n">beneficiary</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The contract does not provide the full functionality of a crowdfunding
contract, but it contains the basic concepts necessary to understand structs.
Struct types can be used inside mappings and arrays and they can itself
contain mappings and arrays.</p>
<p>It is not possible for a struct to contain a member of its own type,
although the struct itself can be the value type of a mapping member
or it can contain a dynamically-sized array of its type.
This restriction is necessary, as the size of the struct has to be finite.</p>
<p>Note how in all the functions, a struct type is assigned to a local variable
with data location <code class="docutils literal notranslate"><span class="pre">storage</span></code>.
This does not copy the struct but only stores a reference so that assignments to
members of the local variable actually write to the state.</p>
<p>Of course, you can also directly access the members of the struct without
assigning it to a local variable, as in
<code class="docutils literal notranslate"><span class="pre">campaigns[campaignID].amount</span> <span class="pre">=</span> <span class="pre">0</span></code>.</p>
</div>
</div>
<div class="section" id="mapping-types">
<span id="index-20"></span><span id="id14"></span><h4>Mapping Types<a class="headerlink" href="#mapping-types" title="Permalink to this headline">¶</a></h4>
<p>You declare mapping types with the syntax <code class="docutils literal notranslate"><span class="pre">mapping(_KeyType</span> <span class="pre">=&gt;</span> <span class="pre">_ValueType)</span></code>.
The <code class="docutils literal notranslate"><span class="pre">_KeyType</span></code> can be any elementary type. This means it can be any of
the built-in value types plus <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>. User-defined
or complex types like contract types, enums, mappings, structs and any array type
apart from <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code> are not allowed.
<code class="docutils literal notranslate"><span class="pre">_ValueType</span></code> can be any type, including mappings.</p>
<p>You can think of mappings as <a class="reference external" href="https://en.wikipedia.org/wiki/Hash_table">hash tables</a>, which are virtually initialised
such that every possible key exists and is mapped to a value whose
byte-representation is all zeros, a type’s <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a>. The similarity ends there, the key data is not stored in a
mapping, only its <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> hash is used to look up the value.</p>
<p>Because of this, mappings do not have a length or a concept of a key or
value being set.</p>
<p>Mappings can only have a data location of <code class="docutils literal notranslate"><span class="pre">storage</span></code> and thus
are allowed for state variables, as storage reference types
in functions, or as parameters for library functions.
They cannot be used as parameters or return parameters
of contract functions that are publicly visible.</p>
<p>You can mark variables of mapping type as <code class="docutils literal notranslate"><span class="pre">public</span></code> and Solidity creates a
<a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getter</span></a> for you. The <code class="docutils literal notranslate"><span class="pre">_KeyType</span></code> becomes a
parameter for the getter. If <code class="docutils literal notranslate"><span class="pre">_ValueType</span></code> is a value type or a struct,
the getter returns <code class="docutils literal notranslate"><span class="pre">_ValueType</span></code>.
If <code class="docutils literal notranslate"><span class="pre">_ValueType</span></code> is an array or a mapping, the getter has one parameter for
each <code class="docutils literal notranslate"><span class="pre">_KeyType</span></code>, recursively. For example with a mapping:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">MappingExample</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="n">balances</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">update</span><span class="p">(</span><span class="kt">uint</span> <span class="n">newBalance</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">newBalance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">MappingUser</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">MappingExample</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MappingExample</span><span class="p">();</span>
        <span class="n">m</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">.</span><span class="n">balances</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mappings are not iterable, but it is possible to implement a data structure
on top of them. For an example, see <a class="reference external" href="https://github.com/ethereum/dapp-bin/blob/master/library/iterable_mapping.sol">iterable mapping</a>.</p>
</div>
</div>
<div class="section" id="operators-involving-lvalues">
<span id="index-21"></span><h4>Operators Involving LValues<a class="headerlink" href="#operators-involving-lvalues" title="Permalink to this headline">¶</a></h4>
<p>If <code class="docutils literal notranslate"><span class="pre">a</span></code> is an LValue (i.e. a variable or something that can be assigned to), the following operators are available as shorthands:</p>
<p><code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">e</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">e</span></code>. The operators <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">/=</span></code>, <code class="docutils literal notranslate"><span class="pre">%=</span></code>, <code class="docutils literal notranslate"><span class="pre">|=</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;=</span></code> and <code class="docutils literal notranslate"><span class="pre">^=</span></code> are defined accordingly. <code class="docutils literal notranslate"><span class="pre">a++</span></code> and <code class="docutils literal notranslate"><span class="pre">a--</span></code> are equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">+=</span> <span class="pre">1</span></code> / <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">-=</span> <span class="pre">1</span></code> but the expression itself still has the previous value of <code class="docutils literal notranslate"><span class="pre">a</span></code>. In contrast, <code class="docutils literal notranslate"><span class="pre">--a</span></code> and <code class="docutils literal notranslate"><span class="pre">++a</span></code> have the same effect on <code class="docutils literal notranslate"><span class="pre">a</span></code> but return the value after the change.</p>
<div class="section" id="delete">
<h5>delete<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a</span></code> assigns the initial value for the type to <code class="docutils literal notranslate"><span class="pre">a</span></code>. I.e. for integers it is
equivalent to <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0</span></code>, but it can also be used on arrays, where it assigns a dynamic
array of length zero or a static array of the same length with all elements set to their
initial value. <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a[x]</span></code> deletes the item at index <code class="docutils literal notranslate"><span class="pre">x</span></code> of the array and leaves
all other elements and the length of the array untouched. This especially means that it leaves
a gap in the array. If you plan to remove items, a mapping is probably a better choice.</p>
<p>For structs, it assigns a struct with all members reset. In other words, the value of <code class="docutils literal notranslate"><span class="pre">a</span></code> after <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a</span></code> is the same as if <code class="docutils literal notranslate"><span class="pre">a</span></code> would be declared without assignment, with the following caveat:</p>
<p><code class="docutils literal notranslate"><span class="pre">delete</span></code> has no effect on mappings (as the keys of mappings may be arbitrary and are generally unknown). So if you delete a struct, it will reset all members that are not mappings and also recurse into the members unless they are mappings. However, individual keys and what they map to can be deleted: If <code class="docutils literal notranslate"><span class="pre">a</span></code> is a mapping, then <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a[x]</span></code> will delete the value stored at <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p>It is important to note that <code class="docutils literal notranslate"><span class="pre">delete</span> <span class="pre">a</span></code> really behaves like an assignment to <code class="docutils literal notranslate"><span class="pre">a</span></code>, i.e. it stores a new object in <code class="docutils literal notranslate"><span class="pre">a</span></code>.
This distinction is visible when <code class="docutils literal notranslate"><span class="pre">a</span></code> is reference variable: It will only reset <code class="docutils literal notranslate"><span class="pre">a</span></code> itself, not the
value it referred to previously.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">DeleteExample</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">data</span><span class="p">;</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="n">dataArray</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// sets x to 0, does not affect data</span>
        <span class="k">delete</span> <span class="n">data</span><span class="p">;</span> <span class="c1">// sets data to 0, does not affect x</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="kr">storage</span> <span class="n">y</span> <span class="o">=</span> <span class="n">dataArray</span><span class="p">;</span>
        <span class="k">delete</span> <span class="n">dataArray</span><span class="p">;</span> <span class="c1">// this sets dataArray.length to zero, but as uint[] is a complex object, also</span>
        <span class="c1">// y is affected which is an alias to the storage object</span>
        <span class="c1">// On the other hand: &quot;delete y&quot; is not valid, as assignments to local variables</span>
        <span class="c1">// referencing storage objects can only be made from existing storage objects.</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="conversions-between-elementary-types">
<span id="types-conversion-elementary-types"></span><span id="index-22"></span><h4>Conversions between Elementary Types<a class="headerlink" href="#conversions-between-elementary-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="implicit-conversions">
<h5>Implicit Conversions<a class="headerlink" href="#implicit-conversions" title="Permalink to this headline">¶</a></h5>
<p>If an operator is applied to different types, the compiler tries to
implicitly convert one of the operands to the type of the other (the same is
true for assignments). In general, an implicit conversion between value-types
is possible if it
makes sense semantically and no information is lost: <code class="docutils literal notranslate"><span class="pre">uint8</span></code> is convertible to
<code class="docutils literal notranslate"><span class="pre">uint16</span></code> and <code class="docutils literal notranslate"><span class="pre">int128</span></code> to <code class="docutils literal notranslate"><span class="pre">int256</span></code>, but <code class="docutils literal notranslate"><span class="pre">int8</span></code> is not convertible to <code class="docutils literal notranslate"><span class="pre">uint256</span></code>
(because <code class="docutils literal notranslate"><span class="pre">uint256</span></code> cannot hold e.g. <code class="docutils literal notranslate"><span class="pre">-1</span></code>).</p>
<p>For more details, please consult the sections about the types themselves.</p>
</div>
<div class="section" id="explicit-conversions">
<h5>Explicit Conversions<a class="headerlink" href="#explicit-conversions" title="Permalink to this headline">¶</a></h5>
<p>If the compiler does not allow implicit conversion but you know what you are
doing, an explicit type conversion is sometimes possible. Note that this may
give you some unexpected behaviour and allows you to bypass some security
features of the compiler, so be sure to test that the
result is what you want! Take the following example where you are converting
a negative <code class="docutils literal notranslate"><span class="pre">int8</span></code> to a <code class="docutils literal notranslate"><span class="pre">uint</span></code>:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">int8</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
<span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
<p>At the end of this code snippet, <code class="docutils literal notranslate"><span class="pre">x</span></code> will have the value <code class="docutils literal notranslate"><span class="pre">0xfffff..fd</span></code> (64 hex
characters), which is -3 in the two’s complement representation of 256 bits.</p>
<p>If an integer is explicitly converted to a smaller type, higher-order bits are
cut off:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint32</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0x12345678</span><span class="p">;</span>
<span class="kt">uint16</span> <span class="n">b</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// b will be 0x5678 now</span>
</pre></div>
</div>
<p>If an integer is explicitly converted to a larger type, it is padded on the left (i.e. at the higher order end).
The result of the conversion will compare equal to the original integer:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint16</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0x1234</span><span class="p">;</span>
<span class="kt">uint32</span> <span class="n">b</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// b will be 0x00001234 now</span>
<span class="nf">assert</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">);</span>
</pre></div>
</div>
<p>Fixed-size bytes types behave differently during conversions. They can be thought of as
sequences of individual bytes and converting to a smaller type will cut off the
sequence:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes2</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0x1234</span><span class="p">;</span>
<span class="kt">bytes1</span> <span class="n">b</span> <span class="o">=</span> <span class="kt">bytes1</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// b will be 0x12</span>
</pre></div>
</div>
<p>If a fixed-size bytes type is explicitly converted to a larger type, it is padded on
the right. Accessing the byte at a fixed index will result in the same value before and
after the conversion (if the index is still in range):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes2</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0x1234</span><span class="p">;</span>
<span class="kt">bytes4</span> <span class="n">b</span> <span class="o">=</span> <span class="kt">bytes4</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// b will be 0x12340000</span>
<span class="nf">assert</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="nf">assert</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
<p>Since integers and fixed-size byte arrays behave differently when truncating or
padding, explicit conversions between integers and fixed-size byte arrays are only allowed,
if both have the same size. If you want to convert between integers and fixed-size byte arrays of
different size, you have to use intermediate conversions that make the desired truncation and padding
rules explicit:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes2</span> <span class="n">a</span> <span class="o">=</span> <span class="mh">0x1234</span><span class="p">;</span>
<span class="kt">uint32</span> <span class="n">b</span> <span class="o">=</span> <span class="kt">uint16</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="c1">// b will be 0x00001234</span>
<span class="kt">uint32</span> <span class="n">c</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="kt">bytes4</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="c1">// c will be 0x12340000</span>
<span class="kt">uint8</span> <span class="n">d</span> <span class="o">=</span> <span class="kt">uint8</span><span class="p">(</span><span class="kt">uint16</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="c1">// d will be 0x34</span>
<span class="kt">uint8</span> <span class="n">e</span> <span class="o">=</span> <span class="kt">uint8</span><span class="p">(</span><span class="kt">bytes1</span><span class="p">(</span><span class="n">a</span><span class="p">));</span> <span class="c1">// e will be 0x12</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="conversions-between-literals-and-elementary-types">
<span id="types-conversion-literals"></span><h4>Conversions between Literals and Elementary Types<a class="headerlink" href="#conversions-between-literals-and-elementary-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="integer-types">
<h5>Integer Types<a class="headerlink" href="#integer-types" title="Permalink to this headline">¶</a></h5>
<p>Decimal and hexadecimal number literals can be implicitly converted to any integer type
that is large enough to represent it without truncation:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span> <span class="c1">// fine</span>
<span class="kt">uint32</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1234</span><span class="p">;</span> <span class="c1">// fine</span>
<span class="kt">uint16</span> <span class="n">c</span> <span class="o">=</span> <span class="mh">0x123456</span><span class="p">;</span> <span class="c1">// fails, since it would have to truncate to 0x3456</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h5>Fixed-Size Byte Arrays<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<p>Decimal number literals cannot be implicitly converted to fixed-size byte arrays. Hexadecimal
number literals can be, but only if the number of hex digits exactly fits the size of the bytes
type. As an exception both decimal and hexadecimal literals which have a value of zero can be
converted to any fixed-size bytes type:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes2</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">54321</span><span class="p">;</span> <span class="c1">// not allowed</span>
<span class="kt">bytes2</span> <span class="n">b</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span> <span class="c1">// not allowed</span>
<span class="kt">bytes2</span> <span class="n">c</span> <span class="o">=</span> <span class="mh">0x123</span><span class="p">;</span> <span class="c1">// not allowed</span>
<span class="kt">bytes2</span> <span class="n">d</span> <span class="o">=</span> <span class="mh">0x1234</span><span class="p">;</span> <span class="c1">// fine</span>
<span class="kt">bytes2</span> <span class="n">e</span> <span class="o">=</span> <span class="mh">0x0012</span><span class="p">;</span> <span class="c1">// fine</span>
<span class="kt">bytes4</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// fine</span>
<span class="kt">bytes4</span> <span class="n">g</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span> <span class="c1">// fine</span>
</pre></div>
</div>
<p>String literals and hex string literals can be implicitly converted to fixed-size byte arrays,
if their number of characters matches the size of the bytes type:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">bytes2</span> <span class="n">a</span> <span class="o">=</span> <span class="s">hex&quot;1234&quot;</span><span class="p">;</span> <span class="c1">// fine</span>
<span class="kt">bytes2</span> <span class="n">b</span> <span class="o">=</span> <span class="s">&quot;xy&quot;</span><span class="p">;</span> <span class="c1">// fine</span>
<span class="kt">bytes2</span> <span class="n">c</span> <span class="o">=</span> <span class="s">hex&quot;12&quot;</span><span class="p">;</span> <span class="c1">// not allowed</span>
<span class="kt">bytes2</span> <span class="n">d</span> <span class="o">=</span> <span class="s">hex&quot;123&quot;</span><span class="p">;</span> <span class="c1">// not allowed</span>
<span class="kt">bytes2</span> <span class="n">e</span> <span class="o">=</span> <span class="s">&quot;x&quot;</span><span class="p">;</span> <span class="c1">// not allowed</span>
<span class="kt">bytes2</span> <span class="n">f</span> <span class="o">=</span> <span class="s">&quot;xyz&quot;</span><span class="p">;</span> <span class="c1">// not allowed</span>
</pre></div>
</div>
</div>
<div class="section" id="addresses">
<h5>Addresses<a class="headerlink" href="#addresses" title="Permalink to this headline">¶</a></h5>
<p>As described in <a class="reference internal" href="#address-literals"><span class="std std-ref">Address Literals</span></a>, hex literals of the correct size that pass the checksum
test are of <code class="docutils literal notranslate"><span class="pre">address</span></code> type. No other literals can be implicitly converted to the <code class="docutils literal notranslate"><span class="pre">address</span></code> type.</p>
<p>Explicit conversions from <code class="docutils literal notranslate"><span class="pre">bytes20</span></code> or any integer type to <code class="docutils literal notranslate"><span class="pre">address</span></code> result in <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</p>
</div>
</div>
</div>
<span id="document-units-and-global-variables"></span><div class="section" id="units-and-globally-available-variables">
<h3>Units and Globally Available Variables<a class="headerlink" href="#units-and-globally-available-variables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ether-units">
<span id="index-0"></span><h4>Ether Units<a class="headerlink" href="#ether-units" title="Permalink to this headline">¶</a></h4>
<p>A literal number can take a suffix of <code class="docutils literal notranslate"><span class="pre">wei</span></code>, <code class="docutils literal notranslate"><span class="pre">finney</span></code>, <code class="docutils literal notranslate"><span class="pre">szabo</span></code> or <code class="docutils literal notranslate"><span class="pre">ether</span></code> to specify a subdenomination of Ether, where Ether numbers without a postfix are assumed to be Wei.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="nf">assert</span><span class="p">(</span><span class="mi">1</span> <span class="kc">wei</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
<span class="nf">assert</span><span class="p">(</span><span class="mi">1</span> <span class="kc">szabo</span> <span class="o">==</span> <span class="mi">1e12</span><span class="p">);</span>
<span class="nf">assert</span><span class="p">(</span><span class="mi">1</span> <span class="kc">finney</span> <span class="o">==</span> <span class="mi">1e15</span><span class="p">);</span>
<span class="nf">assert</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span> <span class="o">==</span> <span class="mi">1e18</span><span class="p">);</span>
</pre></div>
</div>
<p>The only effect of the subdenomination suffix is a multiplication by a power of ten.</p>
</div>
<div class="section" id="time-units">
<span id="index-1"></span><h4>Time Units<a class="headerlink" href="#time-units" title="Permalink to this headline">¶</a></h4>
<p>Suffixes like <code class="docutils literal notranslate"><span class="pre">seconds</span></code>, <code class="docutils literal notranslate"><span class="pre">minutes</span></code>, <code class="docutils literal notranslate"><span class="pre">hours</span></code>, <code class="docutils literal notranslate"><span class="pre">days</span></code> and <code class="docutils literal notranslate"><span class="pre">weeks</span></code>
after literal numbers can be used to specify units of time where seconds are the base
unit and units are considered naively in the following way:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">==</span> <span class="pre">1</span> <span class="pre">seconds</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">minutes</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">seconds</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">hours</span> <span class="pre">==</span> <span class="pre">60</span> <span class="pre">minutes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">days</span> <span class="pre">==</span> <span class="pre">24</span> <span class="pre">hours</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">weeks</span> <span class="pre">==</span> <span class="pre">7</span> <span class="pre">days</span></code></li>
</ul>
</div></blockquote>
<p>Take care if you perform calendar calculations using these units, because
not every year equals 365 days and not even every day has 24 hours
because of <a class="reference external" href="https://en.wikipedia.org/wiki/Leap_second">leap seconds</a>.
Due to the fact that leap seconds cannot be predicted, an exact calendar
library has to be updated by an external oracle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The suffix <code class="docutils literal notranslate"><span class="pre">years</span></code> has been removed in version 0.5.0 due to the reasons above.</p>
</div>
<p>These suffixes cannot be applied to variables. For example, if you want to
interpret a function parameter in days, you can in the following way:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">start</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">daysAfter</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">daysAfter</span> <span class="o">*</span> <span class="mi">1</span> <span class="kc">days</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="special-variables-and-functions">
<h4>Special Variables and Functions<a class="headerlink" href="#special-variables-and-functions" title="Permalink to this headline">¶</a></h4>
<p>There are special variables and functions which always exist in the global
namespace and are mainly used to provide information about the blockchain
or are general-use utility functions.</p>
<div class="section" id="block-and-transaction-properties">
<span id="index-2"></span><h5>Block and Transaction Properties<a class="headerlink" href="#block-and-transaction-properties" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block - only works for 256 most recent, excluding current, blocks</li>
<li><code class="docutils literal notranslate"><span class="pre">block.coinbase</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): current block miner’s address</li>
<li><code class="docutils literal notranslate"><span class="pre">block.difficulty</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block difficulty</li>
<li><code class="docutils literal notranslate"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block gaslimit</li>
<li><code class="docutils literal notranslate"><span class="pre">block.number</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block number</li>
<li><code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block timestamp as seconds since unix epoch</li>
<li><code class="docutils literal notranslate"><span class="pre">gasleft()</span> <span class="pre">returns</span> <span class="pre">(uint256)</span></code>: remaining gas</li>
<li><code class="docutils literal notranslate"><span class="pre">msg.data</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">calldata</span></code>): complete calldata</li>
<li><code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): sender of the message (current call)</li>
<li><code class="docutils literal notranslate"><span class="pre">msg.sig</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes4</span></code>): first four bytes of the calldata (i.e. function identifier)</li>
<li><code class="docutils literal notranslate"><span class="pre">msg.value</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): number of wei sent with the message</li>
<li><code class="docutils literal notranslate"><span class="pre">now</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block timestamp (alias for <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): gas price of the transaction</li>
<li><code class="docutils literal notranslate"><span class="pre">tx.origin</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): sender of the transaction (full call chain)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The values of all members of <code class="docutils literal notranslate"><span class="pre">msg</span></code>, including <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and
<code class="docutils literal notranslate"><span class="pre">msg.value</span></code> can change for every <strong>external</strong> function call.
This includes calls to library functions.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Do not rely on <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code>, <code class="docutils literal notranslate"><span class="pre">now</span></code> and <code class="docutils literal notranslate"><span class="pre">blockhash</span></code> as a source of randomness,
unless you know what you are doing.</p>
<p>Both the timestamp and the block hash can be influenced by miners to some degree.
Bad actors in the mining community can for example run a casino payout function on a chosen hash
and just retry a different hash if they did not receive any money.</p>
<p class="last">The current block timestamp must be strictly larger than the timestamp of the last block,
but the only guarantee is that it will be somewhere between the timestamps of two
consecutive blocks in the canonical chain.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The block hashes are not available for all blocks for scalability reasons.
You can only access the hashes of the most recent 256 blocks, all other
values will be zero.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The function <code class="docutils literal notranslate"><span class="pre">blockhash</span></code> was previously known as <code class="docutils literal notranslate"><span class="pre">block.blockhash</span></code>, which was deprecated in
version 0.4.22 and removed in version 0.5.0.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The function <code class="docutils literal notranslate"><span class="pre">gasleft</span></code> was previously known as <code class="docutils literal notranslate"><span class="pre">msg.gas</span></code>, which was deprecated in
version 0.4.21 and removed in version 0.5.0.</p>
</div>
</div>
<div class="section" id="abi-encoding-and-decoding-functions">
<span id="index-3"></span><h5>ABI Encoding and Decoding Functions<a class="headerlink" href="#abi-encoding-and-decoding-functions" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">abi.decode(bytes</span> <span class="pre">memory</span> <span class="pre">encodedData,</span> <span class="pre">(...))</span> <span class="pre">returns</span> <span class="pre">(...)</span></code>: ABI-decodes the given data, while the types are given in parentheses as second argument. Example: <code class="docutils literal notranslate"><span class="pre">(uint</span> <span class="pre">a,</span> <span class="pre">uint[2]</span> <span class="pre">memory</span> <span class="pre">b,</span> <span class="pre">bytes</span> <span class="pre">memory</span> <span class="pre">c)</span> <span class="pre">=</span> <span class="pre">abi.decode(data,</span> <span class="pre">(uint,</span> <span class="pre">uint[2],</span> <span class="pre">bytes))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">abi.encode(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: ABI-encodes the given arguments</li>
<li><code class="docutils literal notranslate"><span class="pre">abi.encodePacked(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Performs <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">packed encoding</span></a> of the given arguments</li>
<li><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4</span> <span class="pre">selector,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: ABI-encodes the given arguments starting from the second and prepends the given four-byte selector</li>
<li><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSignature(string</span> <span class="pre">memory</span> <span class="pre">signature,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Equivalent to <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4(keccak256(bytes(signature))),</span> <span class="pre">...)`</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These encoding functions can be used to craft data for external function calls without actually
calling an external function. Furthermore, <code class="docutils literal notranslate"><span class="pre">keccak256(abi.encodePacked(a,</span> <span class="pre">b))</span></code> is a way
to compute the hash of structured data (although be aware that it is possible to
craft a “hash collision” using different function parameter types).</p>
</div>
<p>See the documentation about the <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a> and the
<a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">tightly packed encoding</span></a> for details about the encoding.</p>
</div>
<div class="section" id="error-handling">
<span id="index-4"></span><h5>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h5>
<p>See the dedicated section on <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">assert and require</span></a> for
more details on error handling and when to use which function.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code>:</dt>
<dd>causes an invalid opcode and thus state change reversion if the condition is not met - to be used for internal errors.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition)</span></code>:</dt>
<dd>reverts if the condition is not met - to be used for errors in inputs or external components.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition,</span> <span class="pre">string</span> <span class="pre">memory</span> <span class="pre">message)</span></code>:</dt>
<dd>reverts if the condition is not met - to be used for errors in inputs or external components. Also provides an error message.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">revert()</span></code>:</dt>
<dd>abort execution and revert state changes</dd>
<dt><code class="docutils literal notranslate"><span class="pre">revert(string</span> <span class="pre">memory</span> <span class="pre">reason)</span></code>:</dt>
<dd>abort execution and revert state changes, providing an explanatory string</dd>
</dl>
</div>
<div class="section" id="mathematical-and-cryptographic-functions">
<span id="index-5"></span><h5>Mathematical and Cryptographic Functions<a class="headerlink" href="#mathematical-and-cryptographic-functions" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>:</dt>
<dd>compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the addition is performed with arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>:</dt>
<dd>compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the multiplication is performed with arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">keccak256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>compute the Keccak-256 hash of the input</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sha256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>:</dt>
<dd>compute the SHA-256 hash of the input</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ripemd160(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code>:</dt>
<dd>compute RIPEMD-160 hash of the input</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns</span> <span class="pre">(address)</span></code>:</dt>
<dd>recover the address associated with the public key from elliptic curve signature or return zero on error
(<a class="reference external" href="https://ethereum.stackexchange.com/q/1777/222">example usage</a>)</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Function <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code> returns an <code class="docutils literal notranslate"><span class="pre">address</span></code>, and not an <code class="docutils literal notranslate"><span class="pre">address</span>
<span class="pre">payable</span></code>. See <a class="reference internal" href="index.html#address"><span class="std std-ref">address payable</span></a> for conversion, in case you need
to transfer funds to the recovered address.</p>
</div>
<p>It might be that you run into Out-of-Gas for <code class="docutils literal notranslate"><span class="pre">sha256</span></code>, <code class="docutils literal notranslate"><span class="pre">ripemd160</span></code> or <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code> on a <em>private blockchain</em>. The reason for this is that those are implemented as so-called precompiled contracts and these contracts only really exist after they received the first message (although their contract code is hardcoded). Messages to non-existing contracts are more expensive and thus the execution runs into an Out-of-Gas error. A workaround for this problem is to first send e.g. 1 Wei to each of the contracts before you use them in your actual contracts. This is not an issue on the official or test net.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There used to be an alias for <code class="docutils literal notranslate"><span class="pre">keccak256</span></code> called <code class="docutils literal notranslate"><span class="pre">sha3</span></code>, which was removed in version 0.5.0.</p>
</div>
</div>
<div class="section" id="members-of-address-types">
<span id="address-related"></span><span id="index-6"></span><h5>Members of Address Types<a class="headerlink" href="#members-of-address-types" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal notranslate"><span class="pre">uint256</span></code>):</dt>
<dd>balance of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.transfer(uint256</span> <span class="pre">amount)</span></code>:</dt>
<dd>send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, reverts on failure, forwards 2300 gas stipend, not adjustable</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>:</dt>
<dd>send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, returns <code class="docutils literal notranslate"><span class="pre">false</span></code> on failure, forwards 2300 gas stipend, not adjustable</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.call(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code>:</dt>
<dd>issue low-level <code class="docutils literal notranslate"><span class="pre">CALL</span></code> with the given payload, returns success condition and return data, forwards all available gas, adjustable</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.delegatecall(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code>:</dt>
<dd>issue low-level <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> with the given payload, returns success condition and return data, forwards all available gas, adjustable</dd>
<dt><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.staticcall(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code>:</dt>
<dd>issue low-level <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> with the given payload, returns success condition and return data, forwards all available gas, adjustable</dd>
</dl>
<p>For more information, see the section on <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You should avoid using <code class="docutils literal notranslate"><span class="pre">.call()</span></code> whenever possible when executing another contract function as it bypasses type checking,
function existence check, and argument packing.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">There are some dangers in using <code class="docutils literal notranslate"><span class="pre">send</span></code>: The transfer fails if the call stack depth is at 1024
(this can always be forced by the caller) and it also fails if the recipient runs out of gas. So in order
to make safe Ether transfers, always check the return value of <code class="docutils literal notranslate"><span class="pre">send</span></code>, use <code class="docutils literal notranslate"><span class="pre">transfer</span></code> or even better:
Use a pattern where the recipient withdraws the money.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0, Solidity allowed address members to be accessed by a contract instance, for example <code class="docutils literal notranslate"><span class="pre">this.balance</span></code>.
This is now forbidden and an explicit conversion to address must be done: <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If state variables are accessed via a low-level delegatecall, the storage layout of the two contracts
must align in order for the called contract to correctly access the storage variables of the calling contract by name.
This is of course not the case if storage pointers are passed as function arguments as in the case for
the high-level libraries.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0, <code class="docutils literal notranslate"><span class="pre">.call</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall</span></code> only returned the
success condition and not the return data.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0, there was a member called <code class="docutils literal notranslate"><span class="pre">callcode</span></code> with similar but slightly different
semantics than <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>.</p>
</div>
</div>
<div class="section" id="contract-related">
<span id="index-7"></span><h5>Contract Related<a class="headerlink" href="#contract-related" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">this</span></code> (current contract’s type):</dt>
<dd>the current contract, explicitly convertible to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">selfdestruct(address</span> <span class="pre">payable</span> <span class="pre">recipient)</span></code>:</dt>
<dd>destroy the current contract, sending its funds to the given <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a></dd>
</dl>
<p>Furthermore, all functions of the current contract are callable directly including the current function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0, there was a function called <code class="docutils literal notranslate"><span class="pre">suicide</span></code> with the same
semantics as <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.</p>
</div>
</div>
<div class="section" id="type-information">
<span id="meta-type"></span><span id="index-8"></span><h5>Type Information<a class="headerlink" href="#type-information" title="Permalink to this headline">¶</a></h5>
<p>The expression <code class="docutils literal notranslate"><span class="pre">type(X)</span></code> can be used to retrieve information about the
type <code class="docutils literal notranslate"><span class="pre">X</span></code>. Currently, there is limited support for this feature, but
it might be expanded in the future. The following properties are
available for a conract type <code class="docutils literal notranslate"><span class="pre">C</span></code>:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">type(C).creationCode</span></code>:</dt>
<dd>Memory byte array that contains the creation bytecode of the contract.
This can be used in inline assembly to build custom creation routines,
especially by using the <code class="docutils literal notranslate"><span class="pre">create2</span></code> opcode.
This property can <strong>not</strong> be accessed in the contract itself or any
derived contract. It causes the bytecode to be included in the bytecode
of the call site and thus circular references like that are not possible.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type(C).runtimeCode</span></code>:</dt>
<dd>Memory byte array that contains the runtime bytecode of the contract.
This is the code that is usually deployed by the constructor of <code class="docutils literal notranslate"><span class="pre">C</span></code>.
If <code class="docutils literal notranslate"><span class="pre">C</span></code> has a constructor that uses inline assembly, this might be
different from the actually deployed bytecode. Also note that libraries
modify their runtime bytecode at time of deployment to guard against
regular calls.
The same restrictions as with <code class="docutils literal notranslate"><span class="pre">.creationCode</span></code> also apply for this
property.</dd>
</dl>
</div>
</div>
</div>
<span id="document-control-structures"></span><div class="section" id="expressions-and-control-structures">
<h3>Expressions and Control Structures<a class="headerlink" href="#expressions-and-control-structures" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-0"></span><div class="section" id="control-structures">
<span id="index-1"></span><h4>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this headline">¶</a></h4>
<p>Most of the control structures known from curly-braces languages are available in Solidity:</p>
<p>There is: <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">else</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">do</span></code>, <code class="docutils literal notranslate"><span class="pre">for</span></code>, <code class="docutils literal notranslate"><span class="pre">break</span></code>, <code class="docutils literal notranslate"><span class="pre">continue</span></code>, <code class="docutils literal notranslate"><span class="pre">return</span></code>, with
the usual semantics known from C or JavaScript.</p>
<p>Parentheses can <em>not</em> be omitted for conditionals, but curly brances can be omitted
around single-statement bodies.</p>
<p>Note that there is no type conversion from non-boolean to boolean types as
there is in C and JavaScript, so <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(1)</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> is <em>not</em> valid
Solidity.</p>
</div>
<div class="section" id="function-calls">
<span id="index-2"></span><span id="id1"></span><h4>Function Calls<a class="headerlink" href="#function-calls" title="Permalink to this headline">¶</a></h4>
<div class="section" id="internal-function-calls">
<span id="id2"></span><h5>Internal Function Calls<a class="headerlink" href="#internal-function-calls" title="Permalink to this headline">¶</a></h5>
<p>Functions of the current contract can be called directly (“internally”), also recursively, as seen in
this nonsensical example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">f</span><span class="p">();</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="n">f</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These function calls are translated into simple jumps inside the EVM. This has
the effect that the current memory is not cleared, i.e. passing memory references
to internally-called functions is very efficient. Only functions of the same
contract can be called internally.</p>
<p>You should still avoid excessive recursion, as every internal function call
uses up at least one stack slot and there are at most 1024 slots available.</p>
</div>
<div class="section" id="external-function-calls">
<span id="id3"></span><h5>External Function Calls<a class="headerlink" href="#external-function-calls" title="Permalink to this headline">¶</a></h5>
<p>The expressions <code class="docutils literal notranslate"><span class="pre">this.g(8);</span></code> and <code class="docutils literal notranslate"><span class="pre">c.g(2);</span></code> (where <code class="docutils literal notranslate"><span class="pre">c</span></code> is a contract
instance) are also valid function calls, but this time, the function
will be called “externally”, via a message call and not directly via jumps.
Please note that function calls on <code class="docutils literal notranslate"><span class="pre">this</span></code> cannot be used in the constructor,
as the actual contract has not been created yet.</p>
<p>Functions of other contracts have to be called externally. For an external call,
all function arguments have to be copied to memory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A function call from one contract to another does not create its own transaction,
it is a message call as part of the overall transaction.</p>
</div>
<p>When calling functions of other contracts, you can specify the amount of Wei or gas sent with the call with the special options <code class="docutils literal notranslate"><span class="pre">.value()</span></code> and <code class="docutils literal notranslate"><span class="pre">.gas()</span></code>, respectively. Any Wei you send to the contract is added to the total balance of the contract:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">InfoFeed</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">info</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">42</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Consumer</span> <span class="p">{</span>
    <span class="n">InfoFeed</span> <span class="n">feed</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">setFeed</span><span class="p">(</span><span class="n">InfoFeed</span> <span class="n">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">feed</span> <span class="o">=</span> <span class="n">addr</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">callFeed</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">feed</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="n">gas</span><span class="p">(</span><span class="mi">800</span><span class="p">)();</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You need to use the modifier <code class="docutils literal notranslate"><span class="pre">payable</span></code> with the <code class="docutils literal notranslate"><span class="pre">info</span></code> function because
otherwise, the <code class="docutils literal notranslate"><span class="pre">.value()</span></code> option would not be available.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful that <code class="docutils literal notranslate"><span class="pre">feed.info.value(10).gas(800)</span></code> only locally sets the <code class="docutils literal notranslate"><span class="pre">value</span></code> and amount of <code class="docutils literal notranslate"><span class="pre">gas</span></code> sent with the function call, and the parentheses at the end perform the actual call. So in this case, the function is not called.</p>
</div>
<p>Function calls cause exceptions if the called contract does not exist (in the
sense that the account does not contain code) or if the called contract itself
throws an exception or goes out of gas.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Any interaction with another contract imposes a potential danger, especially
if the source code of the contract is not known in advance. The
current contract hands over control to the called contract and that may potentially
do just about anything. Even if the called contract inherits from a known parent contract,
the inheriting contract is only required to have a correct interface. The
implementation of the contract, however, can be completely arbitrary and thus,
pose a danger. In addition, be prepared in case it calls into other contracts of
your system or even back into the calling contract before the first
call returns. This means
that the called contract can change state variables of the calling contract
via its functions. Write your functions in a way that, for example, calls to
external functions happen after any changes to state variables in your contract
so your contract is not vulnerable to a reentrancy exploit.</p>
</div>
</div>
<div class="section" id="named-calls-and-anonymous-function-parameters">
<h5>Named Calls and Anonymous Function Parameters<a class="headerlink" href="#named-calls-and-anonymous-function-parameters" title="Permalink to this headline">¶</a></h5>
<p>Function call arguments can be given by name, in any order,
if they are enclosed in <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code> as can be seen in the following
example. The argument list has to coincide by name with the list of
parameters from the function declaration, but can be in arbitrary order.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">set</span><span class="p">({</span><span class="n">value</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="o">:</span> <span class="mi">3</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span> <span class="n">key</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="omitted-function-parameter-names">
<h5>Omitted Function Parameter Names<a class="headerlink" href="#omitted-function-parameter-names" title="Permalink to this headline">¶</a></h5>
<p>The names of unused parameters (especially return parameters) can be omitted.
Those parameters will still be present on the stack, but they are inaccessible.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="c1">// omitted name for parameter</span>
    <span class="kd">function</span> <span class="n">func</span><span class="p">(</span><span class="kt">uint</span> <span class="n">k</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">k</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-contracts-via-new">
<span id="creating-contracts"></span><span id="index-3"></span><h4>Creating Contracts via <code class="docutils literal notranslate"><span class="pre">new</span></code><a class="headerlink" href="#creating-contracts-via-new" title="Permalink to this headline">¶</a></h4>
<p>A contract can create other contracts using the <code class="docutils literal notranslate"><span class="pre">new</span></code> keyword. The full
code of the contract being created has to be known when the creating contract
is compiled so recursive creation-dependencies are not possible.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">x</span><span class="p">;</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="n">D</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="n">D</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// will be executed as part of C&#39;s constructor</span>

    <span class="kd">function</span> <span class="n">createD</span><span class="p">(</span><span class="kt">uint</span> <span class="n">arg</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">D</span> <span class="n">newD</span> <span class="o">=</span> <span class="k">new</span> <span class="n">D</span><span class="p">(</span><span class="n">arg</span><span class="p">);</span>
        <span class="n">newD</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">createAndEndowD</span><span class="p">(</span><span class="kt">uint</span> <span class="n">arg</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="c1">// Send ether along with the creation</span>
        <span class="n">D</span> <span class="n">newD</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="n">D</span><span class="p">).</span><span class="n">value</span><span class="p">(</span><span class="n">amount</span><span class="p">)(</span><span class="n">arg</span><span class="p">);</span>
        <span class="n">newD</span><span class="p">.</span><span class="n">x</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As seen in the example, it is possible to send Ether while creating
an instance of <code class="docutils literal notranslate"><span class="pre">D</span></code> using the <code class="docutils literal notranslate"><span class="pre">.value()</span></code> option, but it is not possible
to limit the amount of gas.
If the creation fails (due to out-of-stack, not enough balance or other problems),
an exception is thrown.</p>
</div>
<div class="section" id="order-of-evaluation-of-expressions">
<h4>Order of Evaluation of Expressions<a class="headerlink" href="#order-of-evaluation-of-expressions" title="Permalink to this headline">¶</a></h4>
<p>The evaluation order of expressions is not specified (more formally, the order
in which the children of one node in the expression tree are evaluated is not
specified, but they are of course evaluated before the node itself). It is only
guaranteed that statements are executed in order and short-circuiting for
boolean expressions is done. See <a class="reference internal" href="index.html#order"><span class="std std-ref">Order of Precedence of Operators</span></a> for more information.</p>
</div>
<div class="section" id="assignment">
<span id="index-4"></span><h4>Assignment<a class="headerlink" href="#assignment" title="Permalink to this headline">¶</a></h4>
<div class="section" id="destructuring-assignments-and-returning-multiple-values">
<span id="index-5"></span><h5>Destructuring Assignments and Returning Multiple Values<a class="headerlink" href="#destructuring-assignments-and-returning-multiple-values" title="Permalink to this headline">¶</a></h5>
<p>Solidity internally allows tuple types, i.e. a list of objects of potentially different types whose number is a constant at compile-time. Those tuples can be used to return multiple values at the same time.
These can then either be assigned to newly declared variables or to pre-existing variables (or LValues in general).</p>
<p>Tuples are not proper types in Solidity, they can only be used to form syntactic
groupings of expressions.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">23</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="n">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">bool</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">g</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// Variables declared with type and assigned from the returned tuple,</span>
        <span class="c1">// not all elements have to be specified (but the number must match).</span>
        <span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">,</span> <span class="p">,</span> <span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span>
        <span class="c1">// Common trick to swap values -- does not work for non-value storage types.</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
        <span class="c1">// Components can be left out (also for variable declarations).</span>
        <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="p">,</span> <span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">f</span><span class="p">();</span> <span class="c1">// Sets the length to 7</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is not possible to mix variable declarations and non-declaration assignments,
i.e. the following is not valid: <code class="docutils literal notranslate"><span class="pre">(x,</span> <span class="pre">uint</span> <span class="pre">y)</span> <span class="pre">=</span> <span class="pre">(1,</span> <span class="pre">2);</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0 it was possible to assign to tuples of smaller size, either
filling up on the left or on the right side (which ever was empty). This is
now disallowed, so both sides have to have the same number of components.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful when assigning to multiple variables at the same time when
reference types are involved, because it could lead to unexpected
copying behaviour.</p>
</div>
</div>
<div class="section" id="complications-for-arrays-and-structs">
<h5>Complications for Arrays and Structs<a class="headerlink" href="#complications-for-arrays-and-structs" title="Permalink to this headline">¶</a></h5>
<p>The semantics of assignments are a bit more complicated for non-value types like arrays and structs.
Assigning <em>to</em> a state variable always creates an independent copy. On the other hand, assigning to a local variable creates an independent copy only for elementary types, i.e. static types that fit into 32 bytes. If structs or arrays (including <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>) are assigned from a state variable to a local variable, the local variable holds a reference to the original state variable. A second assignment to the local variable does not modify the state but only changes the reference. Assignments to members (or elements) of the local variable <em>do</em> change the state.</p>
<p>In the example below the call to <code class="docutils literal notranslate"><span class="pre">g(x)</span></code> has no effect on <code class="docutils literal notranslate"><span class="pre">x</span></code> because it needs
to create an independent copy of the storage value in memory. However <code class="docutils literal notranslate"><span class="pre">h(x)</span></code> modifies <code class="docutils literal notranslate"><span class="pre">x</span></code> because a reference and
not a copy is passed.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span> <span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

 <span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">x</span><span class="p">;</span>

     <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
        <span class="n">h</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="p">}</span>

     <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="kr">memory</span> <span class="n">y</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

     <span class="kd">function</span> <span class="n">h</span><span class="p">(</span><span class="kt">uint</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="kr">storage</span> <span class="n">y</span><span class="p">)</span> <span class="kr">internal</span> <span class="p">{</span>
        <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="scoping-and-declarations">
<span id="default-value"></span><span id="index-6"></span><h4>Scoping and Declarations<a class="headerlink" href="#scoping-and-declarations" title="Permalink to this headline">¶</a></h4>
<p>A variable which is declared will have an initial default value whose byte-representation is all zeros.
The “default values” of variables are the typical “zero-state” of whatever the type is. For example, the default value for a <code class="docutils literal notranslate"><span class="pre">bool</span></code>
is <code class="docutils literal notranslate"><span class="pre">false</span></code>. The default value for the <code class="docutils literal notranslate"><span class="pre">uint</span></code> or <code class="docutils literal notranslate"><span class="pre">int</span></code> types is <code class="docutils literal notranslate"><span class="pre">0</span></code>. For statically-sized arrays and <code class="docutils literal notranslate"><span class="pre">bytes1</span></code> to <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>, each individual
element will be initialized to the default value corresponding to its type. Finally, for dynamically-sized arrays, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>
and <code class="docutils literal notranslate"><span class="pre">string</span></code>, the default value is an empty array or string.</p>
<p>Scoping in Solidity follows the widespread scoping rules of C99
(and many other languages): Variables are visible from the point right after their declaration
until the end of the smallest <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">}</span></code>-block that contains the declaration. As an exception to this rule, variables declared in the
initialization part of a for-loop are only visible until the end of the for-loop.</p>
<p>Variables and other items declared outside of a code block, for example functions, contracts,
user-defined types, etc., are visible even before they were declared. This means you can
use state variables before they are declared and call functions recursively.</p>
<p>As a consequence, the following examples will compile without warnings, since
the two variables have the same name but disjoint scopes.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">minimalScoping</span><span class="p">()</span> <span class="kr">pure</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="p">{</span>
            <span class="kt">uint</span> <span class="n">same</span><span class="p">;</span>
            <span class="n">same</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="p">{</span>
            <span class="kt">uint</span> <span class="n">same</span><span class="p">;</span>
            <span class="n">same</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As a special example of the C99 scoping rules, note that in the following,
the first assignment to <code class="docutils literal notranslate"><span class="pre">x</span></code> will actually assign the outer and not the inner variable.
In any case, you will get a warning about the outer variable being shadowed.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="c1">// This will report a warning</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">pure</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// this will assign to the outer variable</span>
            <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// x has value 2</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<blockquote>
<div>Before version 0.5.0 Solidity followed the same scoping rules as JavaScript, that is, a variable declared anywhere within a function would be in scope
for the entire function, regardless where it was declared. The following example shows a code snippet that used
to compile but leads to an error starting from version 0.5.0.</div></blockquote>
<div class="last highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="c1">// This will not compile</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">pure</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="error-handling-assert-require-revert-and-exceptions">
<span id="assert-and-require"></span><span id="index-7"></span><h4>Error handling: Assert, Require, Revert and Exceptions<a class="headerlink" href="#error-handling-assert-require-revert-and-exceptions" title="Permalink to this headline">¶</a></h4>
<p>Solidity uses state-reverting exceptions to handle errors. Such an exception will undo all changes made to the
state in the current call (and all its sub-calls) and also flag an error to the caller.
The convenience functions <code class="docutils literal notranslate"><span class="pre">assert</span></code> and <code class="docutils literal notranslate"><span class="pre">require</span></code> can be used to check for conditions and throw an exception
if the condition is not met. The <code class="docutils literal notranslate"><span class="pre">assert</span></code> function should only be used to test for internal errors, and to check invariants.
The <code class="docutils literal notranslate"><span class="pre">require</span></code> function should be used to ensure valid conditions, such as inputs, or contract state variables are met, or to validate return values from calls to external contracts.
If used properly, analysis tools can evaluate your contract to identify the conditions and function calls which will reach a failing <code class="docutils literal notranslate"><span class="pre">assert</span></code>. Properly functioning code should never reach a failing assert statement; if this happens there is a bug in your contract which you should fix.</p>
<p>There are two other ways to trigger exceptions: The <code class="docutils literal notranslate"><span class="pre">revert</span></code> function can be used to flag an error and
revert the current call. It is possible to provide a string message containing details about the error
that will be passed back to the caller.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There used to be a keyword called <code class="docutils literal notranslate"><span class="pre">throw</span></code> with the same semantics as <code class="docutils literal notranslate"><span class="pre">revert()</span></code> which
was deprecated in version 0.4.13 and removed in version 0.5.0.</p>
</div>
<p>When exceptions happen in a sub-call, they “bubble up” (i.e. exceptions are rethrown) automatically. Exceptions to this rule are <code class="docutils literal notranslate"><span class="pre">send</span></code>
and the low-level functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> – those return <code class="docutils literal notranslate"><span class="pre">false</span></code> as their first return value in case
of an exception instead of “bubbling up”.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The low-level functions <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> return <code class="docutils literal notranslate"><span class="pre">true</span></code> as their first return value if the called account is non-existent, as part of the design of EVM. Existence must be checked prior to calling if desired.</p>
</div>
<p>Catching exceptions is not yet possible.</p>
<p>In the following example, you can see how <code class="docutils literal notranslate"><span class="pre">require</span></code> can be used to easily check conditions on inputs
and how <code class="docutils literal notranslate"><span class="pre">assert</span></code> can be used for internal error checking. Note that you can optionally provide
a message string for <code class="docutils literal notranslate"><span class="pre">require</span></code>, but not for <code class="docutils literal notranslate"><span class="pre">assert</span></code>.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Sharer</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">sendHalf</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">addr</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="nb">balance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Even value required.&quot;</span><span class="p">);</span>
        <span class="kt">uint</span> <span class="n">balanceBeforeTransfer</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
        <span class="n">addr</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="c1">// Since transfer throws an exception on failure and</span>
        <span class="c1">// cannot call back here, there should be no way for us to</span>
        <span class="c1">// still have half of the money.</span>
        <span class="nf">assert</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span> <span class="o">==</span> <span class="n">balanceBeforeTransfer</span> <span class="o">-</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An <code class="docutils literal notranslate"><span class="pre">assert</span></code>-style exception is generated in the following situations:</p>
<ol class="arabic simple">
<li>If you access an array at a too large or negative index (i.e. <code class="docutils literal notranslate"><span class="pre">x[i]</span></code> where <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">&gt;=</span> <span class="pre">x.length</span></code> or <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">0</span></code>).</li>
<li>If you access a fixed-length <code class="docutils literal notranslate"><span class="pre">bytesN</span></code> at a too large or negative index.</li>
<li>If you divide or modulo by zero (e.g. <code class="docutils literal notranslate"><span class="pre">5</span> <span class="pre">/</span> <span class="pre">0</span></code> or <code class="docutils literal notranslate"><span class="pre">23</span> <span class="pre">%</span> <span class="pre">0</span></code>).</li>
<li>If you shift by a negative amount.</li>
<li>If you convert a value too big or negative into an enum type.</li>
<li>If you call a zero-initialized variable of internal function type.</li>
<li>If you call <code class="docutils literal notranslate"><span class="pre">assert</span></code> with an argument that evaluates to false.</li>
</ol>
<p>A <code class="docutils literal notranslate"><span class="pre">require</span></code>-style exception is generated in the following situations:</p>
<ol class="arabic simple">
<li>Calling <code class="docutils literal notranslate"><span class="pre">require</span></code> with an argument that evaluates to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</li>
<li>If you call a function via a message call but it does not finish properly (i.e. it runs out of gas, has no matching function, or throws an exception itself), except when a low level operation <code class="docutils literal notranslate"><span class="pre">call</span></code>, <code class="docutils literal notranslate"><span class="pre">send</span></code>, <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>, <code class="docutils literal notranslate"><span class="pre">callcode</span></code> or <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> is used.  The low level operations never throw exceptions but indicate failures by returning <code class="docutils literal notranslate"><span class="pre">false</span></code>.</li>
<li>If you create a contract using the <code class="docutils literal notranslate"><span class="pre">new</span></code> keyword but the contract creation does not finish properly (see above for the definition of “not finish properly”).</li>
<li>If you perform an external function call targeting a contract that contains no code.</li>
<li>If your contract receives Ether via a public function without <code class="docutils literal notranslate"><span class="pre">payable</span></code> modifier (including the constructor and the fallback function).</li>
<li>If your contract receives Ether via a public getter function.</li>
<li>If a <code class="docutils literal notranslate"><span class="pre">.transfer()</span></code> fails.</li>
</ol>
<p>Internally, Solidity performs a revert operation (instruction <code class="docutils literal notranslate"><span class="pre">0xfd</span></code>) for a <code class="docutils literal notranslate"><span class="pre">require</span></code>-style exception and executes an invalid operation
(instruction <code class="docutils literal notranslate"><span class="pre">0xfe</span></code>) to throw an <code class="docutils literal notranslate"><span class="pre">assert</span></code>-style exception. In both cases, this causes
the EVM to revert all changes made to the state. The reason for reverting is that there is no safe way to continue execution, because an expected effect
did not occur. Because we want to retain the atomicity of transactions, the safest thing to do is to revert all changes and make the whole transaction
(or at least call) without effect. Note that <code class="docutils literal notranslate"><span class="pre">assert</span></code>-style exceptions consume all gas available to the call, while
<code class="docutils literal notranslate"><span class="pre">require</span></code>-style exceptions will not consume any gas starting from the Metropolis release.</p>
<p>The following example shows how an error string can be used together with revert and require:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">VendingMachine</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">buy</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">)</span>
            <span class="nf">revert</span><span class="p">(</span><span class="s">&quot;Not enough Ether provided.&quot;</span><span class="p">);</span>
        <span class="c1">// Alternative way to do it:</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="n">amount</span> <span class="o">&lt;=</span> <span class="nb">msg.value</span> <span class="o">/</span> <span class="mi">2</span> <span class="kc">ether</span><span class="p">,</span>
            <span class="s">&quot;Not enough Ether provided.&quot;</span>
        <span class="p">);</span>
        <span class="c1">// Perform the purchase.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The provided string will be <a class="reference internal" href="index.html#abi"><span class="std std-ref">abi-encoded</span></a> as if it were a call to a function <code class="docutils literal notranslate"><span class="pre">Error(string)</span></code>.
In the above example, <code class="docutils literal notranslate"><span class="pre">revert(&quot;Not</span> <span class="pre">enough</span> <span class="pre">Ether</span> <span class="pre">provided.&quot;);</span></code> will cause the following hexadecimal data be
set as error return data:</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="mh">0x08c379a0</span>                                                         <span class="c1">// Function selector for Error(string)</span>
<span class="mh">0x0000000000000000000000000000000000000000000000000000000000000020</span> <span class="c1">// Data offset</span>
<span class="mh">0x000000000000000000000000000000000000000000000000000000000000001a</span> <span class="c1">// String length</span>
<span class="mh">0x4e6f7420656e6f7567682045746865722070726f76696465642e000000000000</span> <span class="c1">// String data</span>
</pre></div>
</div>
</div>
</div>
<span id="document-contracts"></span><div class="section" id="contracts">
<span id="index-0"></span><span id="id1"></span><h3>Contracts<a class="headerlink" href="#contracts" title="Permalink to this headline">¶</a></h3>
<p>Contracts in Solidity are similar to classes in object-oriented languages. They
contain persistent data in state variables and functions that can modify these
variables. Calling a function on a different contract (instance) will perform
an EVM function call and thus switch the context such that state variables are
inaccessible. A contract and its functions need to be called for anything to happen.
There is no “cron” concept in Ethereum to call a function at a particular event automatically.</p>
<div class="section" id="creating-contracts">
<span id="index-1"></span><h4>Creating Contracts<a class="headerlink" href="#creating-contracts" title="Permalink to this headline">¶</a></h4>
<p>Contracts can be created “from outside” via Ethereum transactions or from within Solidity contracts.</p>
<p>IDEs, such as <a class="reference external" href="https://remix.ethereum.org/">Remix</a>, make the creation process seamless using UI elements.</p>
<p>Creating contracts programmatically on Ethereum is best done via using the JavaScript API <a class="reference external" href="https://github.com/ethereum/web3.js">web3.js</a>.
It has a function called <a class="reference external" href="https://web3js.readthedocs.io/en/1.0/web3-eth-contract.html#new-contract">web3.eth.Contract</a>
to facilitate contract creation.</p>
<p>When a contract is created, its <a class="reference internal" href="#constructor"><span class="std std-ref">constructor</span></a>  (a function declared with the <code class="docutils literal notranslate"><span class="pre">constructor</span></code> keyword) is executed once.</p>
<p>A constructor is optional. Only one constructor is allowed, which means
overloading is not supported.</p>
<p>After the constructor has executed, the final code of the contract is deployed to the
blockchain. This code includes all public and external functions and all functions
that are reachable from there through function calls. The deployed code does not
include the constructor code or internal functions only called from the constructor.</p>
<p id="index-2">Internally, constructor arguments are passed <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI encoded</span></a> after the code of
the contract itself, but you do not have to care about this if you use <code class="docutils literal notranslate"><span class="pre">web3.js</span></code>.</p>
<p>If a contract wants to create another contract, the source code
(and the binary) of the created contract has to be known to the creator.
This means that cyclic creation dependencies are impossible.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">OwnedToken</span> <span class="p">{</span>
    <span class="c1">// `TokenCreator` is a contract type that is defined below.</span>
    <span class="c1">// It is fine to reference it as long as it is not used</span>
    <span class="c1">// to create a new contract.</span>
    <span class="n">TokenCreator</span> <span class="n">creator</span><span class="p">;</span>
    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>
    <span class="kt">bytes32</span> <span class="n">name</span><span class="p">;</span>

    <span class="c1">// This is the constructor which registers the</span>
    <span class="c1">// creator and the assigned name.</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_name</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// State variables are accessed via their name</span>
        <span class="c1">// and not via e.g. `this.owner`. Functions can</span>
        <span class="c1">// be accessed directly or through `this.f`,</span>
        <span class="c1">// but the latter provides an external view</span>
        <span class="c1">// to the function. Especially in the constructor,</span>
        <span class="c1">// you should not access functions externally,</span>
        <span class="c1">// because the function does not exist yet.</span>
        <span class="c1">// See the next section for details.</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>

        <span class="c1">// We do an explicit type conversion from `address`</span>
        <span class="c1">// to `TokenCreator` and assume that the type of</span>
        <span class="c1">// the calling contract is `TokenCreator`, there is</span>
        <span class="c1">// no real way to check that.</span>
        <span class="n">creator</span> <span class="o">=</span> <span class="n">TokenCreator</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">);</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changeName</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">newName</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// Only the creator can alter the name --</span>
        <span class="c1">// the comparison is possible since contracts</span>
        <span class="c1">// are explicitly convertible to addresses.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="n">creator</span><span class="p">))</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">newName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// Only the current owner can transfer the token.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">!=</span> <span class="n">owner</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

        <span class="c1">// We ask the creator contract if the transfer</span>
        <span class="c1">// should proceed by using a function of the</span>
        <span class="c1">// `TokenCreator` contract defined below. If</span>
        <span class="c1">// the call fails (e.g. due to out-of-gas),</span>
        <span class="c1">// the execution also fails here.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">creator</span><span class="p">.</span><span class="n">isTokenTransferOK</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="n">newOwner</span><span class="p">))</span>
            <span class="n">owner</span> <span class="o">=</span> <span class="n">newOwner</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">TokenCreator</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">createToken</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">name</span><span class="p">)</span>
       <span class="kr">public</span>
       <span class="k">returns</span> <span class="p">(</span><span class="n">OwnedToken</span> <span class="n">tokenAddress</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Create a new `Token` contract and return its address.</span>
        <span class="c1">// From the JavaScript side, the return type is</span>
        <span class="c1">// `address`, as this is the closest type available in</span>
        <span class="c1">// the ABI.</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">OwnedToken</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changeName</span><span class="p">(</span><span class="n">OwnedToken</span> <span class="n">tokenAddress</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">name</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// Again, the external type of `tokenAddress` is</span>
        <span class="c1">// simply `address`.</span>
        <span class="n">tokenAddress</span><span class="p">.</span><span class="n">changeName</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Perform checks to determine if transferring a token to the</span>
    <span class="c1">// `OwnedToken` contract should proceed</span>
    <span class="kd">function</span> <span class="n">isTokenTransferOK</span><span class="p">(</span><span class="kt">address</span> <span class="n">currentOwner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">ok</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Check an arbitrary condition to see if transfer should proceed</span>
        <span class="k">return</span> <span class="nf">keccak256</span><span class="p">(</span><span class="nb">abi.encodePacked</span><span class="p">(</span><span class="n">currentOwner</span><span class="p">,</span> <span class="n">newOwner</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x7f</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="visibility-and-getters">
<span id="index-3"></span><span id="id2"></span><h4>Visibility and Getters<a class="headerlink" href="#visibility-and-getters" title="Permalink to this headline">¶</a></h4>
<p>Since Solidity knows two kinds of function calls (internal
ones that do not create an actual EVM call (also called
a “message call”) and external
ones that do), there are four types of visibilities for
functions and state variables.</p>
<p>Functions have to be specified as being <code class="docutils literal notranslate"><span class="pre">external</span></code>,
<code class="docutils literal notranslate"><span class="pre">public</span></code>, <code class="docutils literal notranslate"><span class="pre">internal</span></code> or <code class="docutils literal notranslate"><span class="pre">private</span></code>.
For state variables, <code class="docutils literal notranslate"><span class="pre">external</span></code> is not possible.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">external</span></code>:</dt>
<dd>External functions are part of the contract interface,
which means they can be called from other contracts and
via transactions. An external function <code class="docutils literal notranslate"><span class="pre">f</span></code> cannot be called
internally (i.e. <code class="docutils literal notranslate"><span class="pre">f()</span></code> does not work, but <code class="docutils literal notranslate"><span class="pre">this.f()</span></code> works).
External functions are sometimes more efficient when
they receive large arrays of data.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">public</span></code>:</dt>
<dd>Public functions are part of the contract interface
and can be either called internally or via
messages. For public state variables, an automatic getter
function (see below) is generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">internal</span></code>:</dt>
<dd>Those functions and state variables can only be
accessed internally (i.e. from within the current contract
or contracts deriving from it), without using <code class="docutils literal notranslate"><span class="pre">this</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">private</span></code>:</dt>
<dd>Private functions and state variables are only
visible for the contract they are defined in and not in
derived contracts.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Everything that is inside a contract is visible to
all observers external to the blockchain. Making something <code class="docutils literal notranslate"><span class="pre">private</span></code>
only prevents other contracts from accessing and modifying
the information, but it will still be visible to the
whole world outside of the blockchain.</p>
</div>
<p>The visibility specifier is given after the type for
state variables and between parameter list and
return parameter list for functions.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">private</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">setData</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">internal</span> <span class="p">{</span> <span class="n">data</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the following example, <code class="docutils literal notranslate"><span class="pre">D</span></code>, can call <code class="docutils literal notranslate"><span class="pre">c.getData()</span></code> to retrieve the value of
<code class="docutils literal notranslate"><span class="pre">data</span></code> in state storage, but is not able to call <code class="docutils literal notranslate"><span class="pre">f</span></code>. Contract <code class="docutils literal notranslate"><span class="pre">E</span></code> is derived from
<code class="docutils literal notranslate"><span class="pre">C</span></code> and, thus, can call <code class="docutils literal notranslate"><span class="pre">compute</span></code>.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">private</span> <span class="n">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">private</span> <span class="kr">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">setData</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">data</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">getData</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">data</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="n">compute</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This will not compile</span>
<span class="kd">contract</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">readData</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">C</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">C</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="n">local</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">f</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span> <span class="c1">// error: member `f` is not visible</span>
        <span class="n">c</span><span class="p">.</span><span class="n">setData</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="n">local</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">getData</span><span class="p">();</span>
        <span class="n">local</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// error: member `compute` is not visible</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">E</span> <span class="kr">is</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">g</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">C</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">C</span><span class="p">();</span>
        <span class="kt">uint</span> <span class="n">val</span> <span class="o">=</span> <span class="n">compute</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// access to internal member (from derived to parent contract)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="getter-functions">
<span id="index-4"></span><span id="id3"></span><h5>Getter Functions<a class="headerlink" href="#getter-functions" title="Permalink to this headline">¶</a></h5>
<p>The compiler automatically creates getter functions for
all <strong>public</strong> state variables. For the contract given below, the compiler will
generate a function called <code class="docutils literal notranslate"><span class="pre">data</span></code> that does not take any
arguments and returns a <code class="docutils literal notranslate"><span class="pre">uint</span></code>, the value of the state
variable <code class="docutils literal notranslate"><span class="pre">data</span></code>. State variables can be initialized
when they are declared.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">data</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Caller</span> <span class="p">{</span>
    <span class="n">C</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">C</span><span class="p">();</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The getter functions have external visibility. If the
symbol is accessed internally (i.e. without <code class="docutils literal notranslate"><span class="pre">this.</span></code>),
it evaluates to a state variable.  If it is accessed externally
(i.e. with <code class="docutils literal notranslate"><span class="pre">this.</span></code>), it evaluates to a function.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">data</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">x</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">data</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// internal access</span>
        <span class="k">return</span> <span class="nb">this</span><span class="p">.</span><span class="n">data</span><span class="p">();</span> <span class="c1">// external access</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you have a <code class="docutils literal notranslate"><span class="pre">public</span></code> state variable of array type, then you can only retrieve
single elements of the array via the generated getter function. This mechanism
exists to avoid high gas costs when returning an entire array. You can use
arguments to specify which individual element to return, for example
<code class="docutils literal notranslate"><span class="pre">data(0)</span></code>. If you want to return an entire array in one call, then you need
to write a function, for example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">arrayExample</span> <span class="p">{</span>
  <span class="c1">// public state variable</span>
  <span class="kt">uint</span><span class="p">[]</span> <span class="kr">public</span> <span class="n">myArray</span><span class="p">;</span>

  <span class="c1">// Getter function generated by the compiler</span>
  <span class="cm">/*</span>
<span class="cm">  function myArray(uint i) returns (uint) {</span>
<span class="cm">      return myArray[i];</span>
<span class="cm">  }</span>
<span class="cm">  */</span>

  <span class="c1">// function that returns entire array</span>
  <span class="kd">function</span> <span class="n">getArray</span><span class="p">()</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">myArray</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now you can use <code class="docutils literal notranslate"><span class="pre">getArray()</span></code> to retrieve the entire array, instead of
<code class="docutils literal notranslate"><span class="pre">myArray(i)</span></code>, which returns a single element per call.</p>
<p>The next example is more complex:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Complex</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="n">Data</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">a</span><span class="p">;</span>
        <span class="kt">bytes3</span> <span class="n">b</span><span class="p">;</span>
        <span class="kd">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">map</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kd">mapping</span><span class="p">(</span><span class="kt">bool</span> <span class="o">=&gt;</span> <span class="n">Data</span><span class="p">[]))</span> <span class="kr">public</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It generates a function of the following form. The mapping in the struct is omitted
because there is no good way to provide the key for the mapping:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">data</span><span class="p">(</span><span class="kt">uint</span> <span class="n">arg1</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">arg2</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">arg3</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">,</span> <span class="kt">bytes3</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">arg1</span><span class="p">][</span><span class="n">arg2</span><span class="p">][</span><span class="n">arg3</span><span class="p">].</span><span class="n">a</span><span class="p">;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">arg1</span><span class="p">][</span><span class="n">arg2</span><span class="p">][</span><span class="n">arg3</span><span class="p">].</span><span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="function-modifiers">
<span id="modifiers"></span><span id="index-5"></span><h4>Function Modifiers<a class="headerlink" href="#function-modifiers" title="Permalink to this headline">¶</a></h4>
<p>Modifiers can be used to easily change the behaviour of functions.  For example,
they can automatically check a condition prior to executing the function. Modifiers are
inheritable properties of contracts and may be overridden by derived contracts.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="n">owner</span><span class="p">;</span>

    <span class="c1">// This contract only defines a modifier but does not use</span>
    <span class="c1">// it: it will be used in derived contracts.</span>
    <span class="c1">// The function body is inserted where the special symbol</span>
    <span class="c1">// `_;` in the definition of a modifier appears.</span>
    <span class="c1">// This means that if the owner calls this function, the</span>
    <span class="c1">// function is executed and otherwise, an exception is</span>
    <span class="c1">// thrown.</span>
    <span class="kd">modifier</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">,</span>
            <span class="s">&quot;Only owner can call this function.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">mortal</span> <span class="kr">is</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="c1">// This contract inherits the `onlyOwner` modifier from</span>
    <span class="c1">// `owned` and applies it to the `close` function, which</span>
    <span class="c1">// causes that calls to `close` only have an effect if</span>
    <span class="c1">// they are made by the stored owner.</span>
    <span class="kd">function</span> <span class="n">close</span><span class="p">()</span> <span class="kr">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">priced</span> <span class="p">{</span>
    <span class="c1">// Modifiers can receive arguments:</span>
    <span class="kd">modifier</span> <span class="n">costs</span><span class="p">(</span><span class="kt">uint</span> <span class="n">price</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="n">price</span><span class="p">)</span> <span class="p">{</span>
            <span class="kr">_</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Register</span> <span class="kr">is</span> <span class="n">priced</span><span class="p">,</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">registeredAddresses</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">price</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">initialPrice</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">price</span> <span class="o">=</span> <span class="n">initialPrice</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">// It is important to also provide the</span>
    <span class="c1">// `payable` keyword here, otherwise the function will</span>
    <span class="c1">// automatically reject all Ether sent to it.</span>
    <span class="kd">function</span> <span class="n">register</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="n">costs</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">registeredAddresses</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changePrice</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_price</span><span class="p">)</span> <span class="kr">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">_price</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Mutex</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">locked</span><span class="p">;</span>
    <span class="kd">modifier</span> <span class="n">noReentrancy</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="o">!</span><span class="n">locked</span><span class="p">,</span>
            <span class="s">&quot;Reentrant call.&quot;</span>
        <span class="p">);</span>
        <span class="n">locked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kr">_</span><span class="p">;</span>
        <span class="n">locked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// This function is protected by a mutex, which means that</span>
    <span class="c1">/// reentrant calls from within `msg.sender.call` cannot call `f` again.</span>
    <span class="c1">/// The `return 7` statement assigns 7 to the return value but still</span>
    <span class="c1">/// executes the statement `locked = false` in the modifier.</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="n">noReentrancy</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">7</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Multiple modifiers are applied to a function by specifying them in a
whitespace-separated list and are evaluated in the order presented.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In an earlier version of Solidity, <code class="docutils literal notranslate"><span class="pre">return</span></code> statements in functions
having modifiers behaved differently.</p>
</div>
<p>Explicit returns from a modifier or function body only leave the current
modifier or function body. Return variables are assigned and
control flow continues after the “_” in the preceding modifier.</p>
<p>Arbitrary expressions are allowed for modifier arguments and in this context,
all symbols visible from the function are visible in the modifier. Symbols
introduced in the modifier are not visible in the function (as they might
change by overriding).</p>
</div>
<div class="section" id="constant-state-variables">
<span id="index-6"></span><h4>Constant State Variables<a class="headerlink" href="#constant-state-variables" title="Permalink to this headline">¶</a></h4>
<p>State variables can be declared as <code class="docutils literal notranslate"><span class="pre">constant</span></code>. In this case, they have to be
assigned from an expression which is a constant at compile time. Any expression
that accesses storage, blockchain data (e.g. <code class="docutils literal notranslate"><span class="pre">now</span></code>, <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code> or
<code class="docutils literal notranslate"><span class="pre">block.number</span></code>) or
execution data (<code class="docutils literal notranslate"><span class="pre">msg.value</span></code> or <code class="docutils literal notranslate"><span class="pre">gasleft()</span></code>) or makes calls to external contracts is disallowed. Expressions
that might have a side-effect on memory allocation are allowed, but those that
might have a side-effect on other memory objects are not. The built-in functions
<code class="docutils literal notranslate"><span class="pre">keccak256</span></code>, <code class="docutils literal notranslate"><span class="pre">sha256</span></code>, <code class="docutils literal notranslate"><span class="pre">ripemd160</span></code>, <code class="docutils literal notranslate"><span class="pre">ecrecover</span></code>, <code class="docutils literal notranslate"><span class="pre">addmod</span></code> and <code class="docutils literal notranslate"><span class="pre">mulmod</span></code>
are allowed (even though, with the exception of <code class="docutils literal notranslate"><span class="pre">keccak256</span></code>, they do call external contracts).</p>
<p>The reason behind allowing side-effects on the memory allocator is that it
should be possible to construct complex objects like e.g. lookup-tables.
This feature is not yet fully usable.</p>
<p>The compiler does not reserve a storage slot for these variables, and every occurrence is
replaced by the respective constant expression (which might be computed to a single value by the optimizer).</p>
<p>Not all types for constants are implemented at this time. The only supported types are
value types and strings.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">constant</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">32</span><span class="o">**</span><span class="mi">22</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
    <span class="kt">string</span> <span class="kr">constant</span> <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;abc&quot;</span><span class="p">;</span>
    <span class="kt">bytes32</span> <span class="kr">constant</span> <span class="n">myHash</span> <span class="o">=</span> <span class="nf">keccak256</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<span id="index-7"></span><span id="id4"></span><h4>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h4>
<div class="section" id="function-parameters-and-return-variables">
<span id="function-parameters-return-variables"></span><h5>Function Parameters and Return Variables<a class="headerlink" href="#function-parameters-and-return-variables" title="Permalink to this headline">¶</a></h5>
<p>As in JavaScript, functions may take parameters as input. Unlike in JavaScript
and C, functions may also return an arbitrary number of values as output.</p>
<div class="section" id="function-parameters">
<h6>Function Parameters<a class="headerlink" href="#function-parameters" title="Permalink to this headline">¶</a></h6>
<p>Function parameters are declared the same way as variables, and the name of
unused parameters can be omitted.</p>
<p>For example, if you want your contract to accept one kind of external call
with two integers, you would use something like:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Simple</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">sum</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">taker</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_b</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">sum</span> <span class="o">=</span> <span class="n">_a</span> <span class="o">+</span> <span class="n">_b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Function parameters can be used as any other local variable and they can also be assigned to.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>An <a class="reference internal" href="index.html#external-function-calls"><span class="std std-ref">external function</span></a> cannot accept a
multi-dimensional array as an input
parameter. This functionality is possible if you enable the new
experimental <code class="docutils literal notranslate"><span class="pre">ABIEncoderV2</span></code> feature by adding <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span> <span class="pre">ABIEncoderV2;</span></code> to your source file.</p>
<p class="last">An <a class="reference internal" href="index.html#external-function-calls"><span class="std std-ref">internal function</span></a> can accept a
multi-dimensional array without enabling the feature.</p>
</div>
</div>
<div class="section" id="return-variables">
<span id="index-8"></span><h6>Return Variables<a class="headerlink" href="#return-variables" title="Permalink to this headline">¶</a></h6>
<p>Function return variables are declared with the same syntax after the
<code class="docutils literal notranslate"><span class="pre">returns</span></code> keyword.</p>
<p>For example, suppose you want to return two results: the sum and the product of
two integers passed as function parameters, then you use something like:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Simple</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">arithmetic</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_b</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">o_sum</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">o_product</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">o_sum</span> <span class="o">=</span> <span class="n">_a</span> <span class="o">+</span> <span class="n">_b</span><span class="p">;</span>
        <span class="n">o_product</span> <span class="o">=</span> <span class="n">_a</span> <span class="o">*</span> <span class="n">_b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The names of return variables can be omitted.
Return variables can be used as any other local variable and they
are initialized with their <a class="reference internal" href="index.html#default-value"><span class="std std-ref">default value</span></a> and have that value unless explicitly set.</p>
<p>You can either explicitly assign to return variables and
then leave the function using <code class="docutils literal notranslate"><span class="pre">return;</span></code>,
or you can provide return values
(either a single or <a class="reference internal" href="#multi-return"><span class="std std-ref">multiple ones</span></a>) directly with the <code class="docutils literal notranslate"><span class="pre">return</span></code>
statement:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Simple</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">arithmetic</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_b</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">pure</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">o_sum</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">o_product</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">_a</span> <span class="o">+</span> <span class="n">_b</span><span class="p">,</span> <span class="n">_a</span> <span class="o">*</span> <span class="n">_b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This form is equivalent to first assigning values to the
return variables and then using <code class="docutils literal notranslate"><span class="pre">return;</span></code> to leave the function.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You cannot return some types from non-internal functions, notably
multi-dimensional dynamic arrays and structs. If you enable the
new experimental <code class="docutils literal notranslate"><span class="pre">ABIEncoderV2</span></code> feature by adding <code class="docutils literal notranslate"><span class="pre">pragma</span> <span class="pre">experimental</span>
<span class="pre">ABIEncoderV2;</span></code> to your source file then more types are available, but
<code class="docutils literal notranslate"><span class="pre">mapping</span></code> types are still limited to inside a single contract and you
cannot transfer them.</p>
</div>
</div>
<div class="section" id="returning-multiple-values">
<span id="multi-return"></span><h6>Returning Multiple Values<a class="headerlink" href="#returning-multiple-values" title="Permalink to this headline">¶</a></h6>
<p>When a function has multiple return types, the statement <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">(v0,</span> <span class="pre">v1,</span> <span class="pre">...,</span> <span class="pre">vn)</span></code> can be used to return multiple values.
The number of components must be the same as the number of return types.</p>
</div>
</div>
<div class="section" id="view-functions">
<span id="index-9"></span><span id="id5"></span><h5>View Functions<a class="headerlink" href="#view-functions" title="Permalink to this headline">¶</a></h5>
<p>Functions can be declared <code class="docutils literal notranslate"><span class="pre">view</span></code> in which case they promise not to modify the state.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the compiler’s EVM target is Byzantium or newer (default) the opcode
<code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> is used for <code class="docutils literal notranslate"><span class="pre">view</span></code> functions which enforces the state
to stay unmodified as part of the EVM execution. For library <code class="docutils literal notranslate"><span class="pre">view</span></code> functions
<code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> is used, because there is no combined <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> and <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code>.
This means library <code class="docutils literal notranslate"><span class="pre">view</span></code> functions do not have run-time checks that prevent state
modifications. This should not impact security negatively because library code is
usually known at compile-time and the static checker performs compile-time checks.</p>
</div>
<p>The following statements are considered modifying the state:</p>
<ol class="arabic simple">
<li>Writing to state variables.</li>
<li><a class="reference internal" href="#events"><span class="std std-ref">Emitting events</span></a>.</li>
<li><a class="reference internal" href="index.html#creating-contracts"><span class="std std-ref">Creating other contracts</span></a>.</li>
<li>Using <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.</li>
<li>Sending Ether via calls.</li>
<li>Calling any function not marked <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code>.</li>
<li>Using low-level calls.</li>
<li>Using inline assembly that contains certain opcodes.</li>
</ol>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">42</span><span class="p">)</span> <span class="o">+</span> <span class="nb">now</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">constant</span></code> on functions used to be an alias to <code class="docutils literal notranslate"><span class="pre">view</span></code>, but this was dropped in version 0.5.0.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Getter methods are automatically marked <code class="docutils literal notranslate"><span class="pre">view</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0, the compiler did not use the <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> opcode
for <code class="docutils literal notranslate"><span class="pre">view</span></code> functions.
This enabled state modifications in <code class="docutils literal notranslate"><span class="pre">view</span></code> functions through the use of
invalid explicit type conversions.
By using  <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> for <code class="docutils literal notranslate"><span class="pre">view</span></code> functions, modifications to the
state are prevented on the level of the EVM.</p>
</div>
</div>
<div class="section" id="pure-functions">
<span id="index-10"></span><span id="id6"></span><h5>Pure Functions<a class="headerlink" href="#pure-functions" title="Permalink to this headline">¶</a></h5>
<p>Functions can be declared <code class="docutils literal notranslate"><span class="pre">pure</span></code> in which case they promise not to read from or modify the state.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the compiler’s EVM target is Byzantium or newer (default) the opcode <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> is used,
which does not guarantee that the state is not read, but at least that it is not modified.</p>
</div>
<p>In addition to the list of state modifying statements explained above, the following are considered reading from the state:</p>
<ol class="arabic simple">
<li>Reading from state variables.</li>
<li>Accessing <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.balance</span></code>.</li>
<li>Accessing any of the members of <code class="docutils literal notranslate"><span class="pre">block</span></code>, <code class="docutils literal notranslate"><span class="pre">tx</span></code>, <code class="docutils literal notranslate"><span class="pre">msg</span></code> (with the exception of <code class="docutils literal notranslate"><span class="pre">msg.sig</span></code> and <code class="docutils literal notranslate"><span class="pre">msg.data</span></code>).</li>
<li>Calling any function not marked <code class="docutils literal notranslate"><span class="pre">pure</span></code>.</li>
<li>Using inline assembly that contains certain opcodes.</li>
</ol>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mi">42</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pure functions are able to use the <cite>revert()</cite> and <cite>require()</cite> functions to revert
potential state changes when an <a class="reference internal" href="index.html#assert-and-require"><span class="std std-ref">error occurs</span></a>.</p>
<p>Reverting a state change is not considered a “state modification”, as only changes to the
state made previously in code that did not have the <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code> restriction
are reverted and that code has the option to catch the <code class="docutils literal notranslate"><span class="pre">revert</span></code> and not pass it on.</p>
<p>This behaviour is also in line with the <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> opcode.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is not possible to prevent functions from reading the state at the level
of the EVM, it is only possible to prevent them from writing to the state
(i.e. only <code class="docutils literal notranslate"><span class="pre">view</span></code> can be enforced at the EVM level, <code class="docutils literal notranslate"><span class="pre">pure</span></code> can not).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.5.0, the compiler did not use the <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> opcode
for <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions.
This enabled state modifications in <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions through the use of
invalid explicit type conversions.
By using  <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code> for <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions, modifications to the
state are prevented on the level of the EVM.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Prior to version 0.4.17 the compiler did not enforce that <code class="docutils literal notranslate"><span class="pre">pure</span></code> is not reading the state.
It is a compile-time type check, which can be circumvented doing invalid explicit conversions
between contract types, because the compiler can verify that the type of the contract does
not do state-changing operations, but it cannot check that the contract that will be called
at runtime is actually of that type.</p>
</div>
</div>
<div class="section" id="fallback-function">
<span id="index-11"></span><span id="id7"></span><h5>Fallback Function<a class="headerlink" href="#fallback-function" title="Permalink to this headline">¶</a></h5>
<p>A contract can have exactly one unnamed function. This function cannot have
arguments, cannot return anything and has to have <code class="docutils literal notranslate"><span class="pre">external</span></code> visibility.
It is executed on a call to the contract if none of the other
functions match the given function identifier (or if no data was supplied at
all).</p>
<p>Furthermore, this function is executed whenever the contract receives plain
Ether (without data). To receive Ether and add it to the total balance of the contract, the fallback function
must be marked <code class="docutils literal notranslate"><span class="pre">payable</span></code>. If no such function exists, the contract cannot receive
Ether through regular transactions and throws an exception.</p>
<p>In the worst case, the fallback function can only rely on 2300 gas being
available (for example when <cite>send</cite> or <cite>transfer</cite> is used), leaving little
room to perform other operations except basic logging. The following operations
will consume more gas than the 2300 gas stipend:</p>
<ul class="simple">
<li>Writing to storage</li>
<li>Creating a contract</li>
<li>Calling an external function which consumes a large amount of gas</li>
<li>Sending Ether</li>
</ul>
<p>Like any function, the fallback function can execute complex operations as long as there is enough gas passed on to it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Even though the fallback function cannot have arguments, one can still use <code class="docutils literal notranslate"><span class="pre">msg.data</span></code> to retrieve
any payload supplied with the call.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The fallback function is also executed if the caller meant to call
a function that is not available. If you want to implement the fallback
function only to receive ether, you should add a check
like <code class="docutils literal notranslate"><span class="pre">require(msg.data.length</span> <span class="pre">==</span> <span class="pre">0)</span></code> to prevent invalid calls.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Contracts that receive Ether directly (without a function call, i.e. using <code class="docutils literal notranslate"><span class="pre">send</span></code> or <code class="docutils literal notranslate"><span class="pre">transfer</span></code>)
but do not define a fallback function
throw an exception, sending back the Ether (this was different
before Solidity v0.4.0). So if you want your contract to receive Ether,
you have to implement a payable fallback function.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>A contract without a payable fallback function can receive Ether as a recipient of a <cite>coinbase transaction</cite> (aka <cite>miner block reward</cite>)
or as a destination of a <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>.</p>
<p>A contract cannot react to such Ether transfers and thus also cannot reject them. This is a design choice of the EVM and Solidity cannot work around it.</p>
<p class="last">It also means that <code class="docutils literal notranslate"><span class="pre">address(this).balance</span></code> can be higher than the sum of some manual accounting implemented in a contract (i.e. having a counter updated in the fallback function).</p>
</div>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Test</span> <span class="p">{</span>
    <span class="c1">// This function is called for all messages sent to</span>
    <span class="c1">// this contract (there is no other function).</span>
    <span class="c1">// Sending Ether to this contract will cause an exception,</span>
    <span class="c1">// because the fallback function does not have the `payable`</span>
    <span class="c1">// modifier.</span>
    <span class="kd">function</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// This contract keeps all Ether sent to it with no way</span>
<span class="c1">// to get it back.</span>
<span class="kd">contract</span> <span class="n">Sink</span> <span class="p">{</span>
    <span class="kd">function</span><span class="p">()</span> <span class="kr">external</span> <span class="kr">payable</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Caller</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">callTest</span><span class="p">(</span><span class="n">Test</span> <span class="n">test</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,)</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">test</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="nb">abi.encodeWithSignature</span><span class="p">(</span><span class="s">&quot;nonExistingFunction()&quot;</span><span class="p">));</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">success</span><span class="p">);</span>
        <span class="c1">// results in test.x becoming == 1.</span>

        <span class="c1">// address(test) will not allow to call ``send`` directly, since ``test`` has no payable</span>
        <span class="c1">// fallback function. It has to be converted to the ``address payable`` type via an</span>
        <span class="c1">// intermediate conversion to ``uint160`` to even allow calling ``send`` on it.</span>
        <span class="kt">address</span> <span class="kr">payable</span> <span class="n">testPayable</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="kt">uint160</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">test</span><span class="p">)));</span>

        <span class="c1">// If someone sends ether to that contract,</span>
        <span class="c1">// the transfer will fail, i.e. this returns false here.</span>
        <span class="k">return</span> <span class="n">testPayable</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="mi">2</span> <span class="kc">ether</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-overloading">
<span id="overload-function"></span><span id="index-12"></span><h5>Function Overloading<a class="headerlink" href="#function-overloading" title="Permalink to this headline">¶</a></h5>
<p>A contract can have multiple functions of the same name but with different parameter
types.
This process is called “overloading” and also applies to inherited functions.
The following example shows overloading of the function
<code class="docutils literal notranslate"><span class="pre">f</span></code> in the scope of contract <code class="docutils literal notranslate"><span class="pre">A</span></code>.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_in</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">_in</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_in</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">_really</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_really</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">_in</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Overloaded functions are also present in the external interface. It is an error if two
externally visible functions differ by their Solidity types but not by their external types.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// This will not compile</span>
<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="n">B</span> <span class="n">_in</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="n">B</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">_in</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">address</span> <span class="n">_in</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">_in</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">B</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">f</span></code> function overloads above end up accepting the address type for the ABI although
they are considered different inside Solidity.</p>
<div class="section" id="overload-resolution-and-argument-matching">
<h6>Overload resolution and Argument matching<a class="headerlink" href="#overload-resolution-and-argument-matching" title="Permalink to this headline">¶</a></h6>
<p>Overloaded functions are selected by matching the function declarations in the current scope
to the arguments supplied in the function call. Functions are selected as overload candidates
if all arguments can be implicitly converted to the expected types. If there is not exactly one
candidate, resolution fails.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Return parameters are not taken into account for overload resolution.</p>
</div>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">_in</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">_in</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_in</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">_in</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">f(50)</span></code> would create a type error since <code class="docutils literal notranslate"><span class="pre">50</span></code> can be implicitly converted both to <code class="docutils literal notranslate"><span class="pre">uint8</span></code>
and <code class="docutils literal notranslate"><span class="pre">uint256</span></code> types. On another hand <code class="docutils literal notranslate"><span class="pre">f(256)</span></code> would resolve to <code class="docutils literal notranslate"><span class="pre">f(uint256)</span></code> overload as <code class="docutils literal notranslate"><span class="pre">256</span></code> cannot be implicitly
converted to <code class="docutils literal notranslate"><span class="pre">uint8</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="events">
<span id="index-13"></span><span id="id8"></span><h4>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h4>
<p>Solidity events give an abstraction on top of the EVM’s logging functionality.
Applications can subscribe and listen to these events through the RPC interface of an Ethereum client.</p>
<p>Events are inheritable members of contracts. When you call them, they cause the
arguments to be stored in the transaction’s log - a special data structure
in the blockchain. These logs are associated with the address of the contract,
are incorporated into the blockchain, and stay there as long as a block is
accessible (forever as of the Frontier and Homestead releases, but this might
change with Serenity). The Log and its event data is not accessible from within
contracts (not even from the contract that created them).</p>
<p>It is possible to request a simple payment verification (SPV) for logs, so if
an external entity supplies a contract with such a verification, it can check
that the log actually exists inside the blockchain. You have to supply block headers
because the contract can only see the last 256 block hashes.</p>
<p>You can add the attribute <code class="docutils literal notranslate"><span class="pre">indexed</span></code> to up to three parameters which adds them
to a special data structure known as <a class="reference internal" href="index.html#abi-events"><span class="std std-ref">“topics”</span></a> instead of
the data part of the log. If you use arrays (including <code class="docutils literal notranslate"><span class="pre">string</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code>)
as indexed arguments, its Keccak-256 hash is stored as a topic instead, this is
because a topic can only hold a single word (32 bytes).</p>
<p>All parameters without the <code class="docutils literal notranslate"><span class="pre">indexed</span></code> attribute are <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI-encoded</span></a>
into the data part of the log.</p>
<p>Topics allow you to search for events, for example when filtering a sequence of
blocks for certain events. You can also filter events by the address of the
contract that emitted the event.</p>
<p>For example, the code below uses the web3.js <code class="docutils literal notranslate"><span class="pre">subscribe(&quot;logs&quot;)</span></code>
<a class="reference external" href="https://web3js.readthedocs.io/en/1.0/web3-eth-subscribe.html#subscribe-logs">method</a> to filter
logs that match a topic with a certain address value:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">fromBlock</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">address</span><span class="o">:</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">defaultAccount</span><span class="p">,</span>
    <span class="nx">topics</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">]</span>
<span class="p">};</span>
<span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
<span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">log</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">log</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;changed&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">log</span><span class="p">)</span> <span class="p">{</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The hash of the signature of the event is one of the topics, except if you
declared the event with the <code class="docutils literal notranslate"><span class="pre">anonymous</span></code> specifier. This means that it is
not possible to filter for specific anonymous events by name.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">21</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">ClientReceipt</span> <span class="p">{</span>
    <span class="kd">event</span> <span class="n">Deposit</span><span class="p">(</span>
        <span class="kt">address</span> <span class="kr">indexed</span> <span class="n">_from</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="kr">indexed</span> <span class="n">_id</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">_value</span>
    <span class="p">);</span>

    <span class="kd">function</span> <span class="n">deposit</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_id</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="c1">// Events are emitted using `emit`, followed by</span>
        <span class="c1">// the name of the event and the arguments</span>
        <span class="c1">// (if any) in parentheses. Any such invocation</span>
        <span class="c1">// (even deeply nested) can be detected from</span>
        <span class="c1">// the JavaScript API by filtering for `Deposit`.</span>
        <span class="kr">emit</span> <span class="n">Deposit</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">,</span> <span class="n">_id</span><span class="p">,</span> <span class="nb">msg.value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The use in the JavaScript API is as follows:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="n">abi</span> <span class="o">=</span> <span class="cm">/* abi as generated by the compiler */</span><span class="p">;</span>
<span class="kd">var</span> <span class="n">ClientReceipt</span> <span class="o">=</span> <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="kd">contract</span><span class="p">(</span><span class="n">abi</span><span class="p">);</span>
<span class="kd">var</span> <span class="n">clientReceipt</span> <span class="o">=</span> <span class="n">ClientReceipt</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="s">&quot;0x1234...ab67&quot;</span> <span class="cm">/* address */</span><span class="p">);</span>

<span class="kd">var</span> <span class="kd">event</span> <span class="o">=</span> <span class="n">clientReceipt</span><span class="p">.</span><span class="n">Deposit</span><span class="p">();</span>

<span class="c1">// watch for changes</span>
<span class="kd">event</span><span class="p">.</span><span class="n">watch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">result</span><span class="p">){</span>
    <span class="c1">// result contains non-indexed arguments and topics</span>
    <span class="c1">// given to the `Deposit` call.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">});</span>


<span class="c1">// Or pass a callback to start watching immediately</span>
<span class="kd">var</span> <span class="kd">event</span> <span class="o">=</span> <span class="n">clientReceipt</span><span class="p">.</span><span class="n">Deposit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span>
        <span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The output of the above looks like the following (trimmed):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;returnValues&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="nt">&quot;_from&quot;</span><span class="p">:</span> <span class="s2">&quot;0x1111…FFFFCCCC&quot;</span><span class="p">,</span>
       <span class="nt">&quot;_id&quot;</span><span class="p">:</span> <span class="s2">&quot;0x50…sd5adb20&quot;</span><span class="p">,</span>
       <span class="nt">&quot;_value&quot;</span><span class="p">:</span> <span class="s2">&quot;0x420042&quot;</span>
   <span class="p">},</span>
   <span class="nt">&quot;raw&quot;</span><span class="p">:</span> <span class="p">{</span>
       <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;0x7f…91385&quot;</span><span class="p">,</span>
       <span class="nt">&quot;topics&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;0xfd4…b4ead7&quot;</span><span class="p">,</span> <span class="s2">&quot;0x7f…1a91385&quot;</span><span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="low-level-interface-to-logs">
<span id="index-14"></span><h5>Low-Level Interface to Logs<a class="headerlink" href="#low-level-interface-to-logs" title="Permalink to this headline">¶</a></h5>
<p>It is also possible to access the low-level interface to the logging
mechanism via the functions <code class="docutils literal notranslate"><span class="pre">log0</span></code>, <code class="docutils literal notranslate"><span class="pre">log1</span></code>, <code class="docutils literal notranslate"><span class="pre">log2</span></code>, <code class="docutils literal notranslate"><span class="pre">log3</span></code> and <code class="docutils literal notranslate"><span class="pre">log4</span></code>.
<code class="docutils literal notranslate"><span class="pre">logi</span></code> takes <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">+</span> <span class="pre">1</span></code> parameter of type <code class="docutils literal notranslate"><span class="pre">bytes32</span></code>, where the first
argument will be used for the data part of the log and the others
as topics. The event call above can be performed in the same way as</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">10</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="kt">uint256</span> <span class="n">_id</span> <span class="o">=</span> <span class="mh">0x420042</span><span class="p">;</span>
        <span class="n">log3</span><span class="p">(</span>
            <span class="kt">bytes32</span><span class="p">(</span><span class="nb">msg.value</span><span class="p">),</span>
            <span class="kt">bytes32</span><span class="p">(</span><span class="mh">0x50cb9fe53daa9737b786ab3646f04d0150dc50ef4e75f59509d83667ad5adb20</span><span class="p">),</span>
            <span class="kt">bytes32</span><span class="p">(</span><span class="kt">uint256</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">)),</span>
            <span class="kt">bytes32</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where the long hexadecimal number is equal to
<code class="docutils literal notranslate"><span class="pre">keccak256(&quot;Deposit(address,bytes32,uint256)&quot;)</span></code>, the signature of the event.</p>
</div>
<div class="section" id="additional-resources-for-understanding-events">
<h5>Additional Resources for Understanding Events<a class="headerlink" href="#additional-resources-for-understanding-events" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><a class="reference external" href="https://github.com/ethereum/wiki/wiki/JavaScript-API#contract-events">Javascript documentation</a></li>
<li><a class="reference external" href="https://github.com/debris/smart-exchange/blob/master/lib/contracts/SmartExchange.sol">Example usage of events</a></li>
<li><a class="reference external" href="https://github.com/debris/smart-exchange/blob/master/lib/exchange_transactions.js">How to access them in js</a></li>
</ul>
</div>
</div>
<div class="section" id="inheritance">
<span id="index-15"></span><h4>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h4>
<p>Solidity supports multiple inheritance including polymorphism.</p>
<p>All function calls are virtual, which means that the most derived function
is called, except when the contract name is explicitly given or the
<code class="docutils literal notranslate"><span class="pre">super</span></code> keyword is used.</p>
<p>When a contract inherits from other contracts, only a single
contract is created on the blockchain, and the code from all the base contracts
is compiled into the created contract.</p>
<p>The general inheritance system is very similar to
<a class="reference external" href="https://docs.python.org/3/tutorial/classes.html#inheritance">Python’s</a>,
especially concerning multiple inheritance, but there are also
some <a class="reference internal" href="#multi-inheritance"><span class="std std-ref">differences</span></a>.</p>
<p>Details are given in the following example.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="n">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Use `is` to derive from another contract. Derived</span>
<span class="c1">// contracts can access all non-private members including</span>
<span class="c1">// internal functions and state variables. These cannot be</span>
<span class="c1">// accessed externally via `this`, though.</span>
<span class="kd">contract</span> <span class="n">mortal</span> <span class="kr">is</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// These abstract contracts are only provided to make the</span>
<span class="c1">// interface known to the compiler. Note the function</span>
<span class="c1">// without body. If a contract does not implement all</span>
<span class="c1">// functions it can only be used as an interface.</span>
<span class="kd">contract</span> <span class="n">Config</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">lookup</span><span class="p">(</span><span class="kt">uint</span> <span class="n">id</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">adr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">NameReg</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">register</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">name</span><span class="p">)</span> <span class="kr">public</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">unregister</span><span class="p">()</span> <span class="kr">public</span><span class="p">;</span>
 <span class="p">}</span>

<span class="c1">// Multiple inheritance is possible. Note that `owned` is</span>
<span class="c1">// also a base class of `mortal`, yet there is only a single</span>
<span class="c1">// instance of `owned` (as for virtual inheritance in C++).</span>
<span class="kd">contract</span> <span class="n">named</span> <span class="kr">is</span> <span class="n">owned</span><span class="p">,</span> <span class="n">mortal</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">name</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">Config</span> <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="mh">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span><span class="p">);</span>
        <span class="n">NameReg</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">register</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Functions can be overridden by another function with the same name and</span>
    <span class="c1">// the same number/types of inputs.  If the overriding function has different</span>
    <span class="c1">// types of output parameters, that causes an error.</span>
    <span class="c1">// Both local and message-based function calls take these overrides</span>
    <span class="c1">// into account.</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Config</span> <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="mh">0xD5f9D8D94886E70b06E474c3fB14Fd43E2f23970</span><span class="p">);</span>
            <span class="n">NameReg</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">unregister</span><span class="p">();</span>
            <span class="c1">// It is still possible to call a specific</span>
            <span class="c1">// overridden function.</span>
            <span class="n">mortal</span><span class="p">.</span><span class="n">kill</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// If a constructor takes an argument, it needs to be</span>
<span class="c1">// provided in the header (or modifier-invocation-style at</span>
<span class="c1">// the constructor of the derived contract (see below)).</span>
<span class="kd">contract</span> <span class="n">PriceFeed</span> <span class="kr">is</span> <span class="n">owned</span><span class="p">,</span> <span class="n">mortal</span><span class="p">,</span> <span class="n">named</span><span class="p">(</span><span class="s">&quot;GoldFeed&quot;</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">updateInfo</span><span class="p">(</span><span class="kt">uint</span> <span class="n">newInfo</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">)</span> <span class="n">info</span> <span class="o">=</span> <span class="n">newInfo</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">function</span> <span class="n">get</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">info</span><span class="p">;</span> <span class="p">}</span>

   <span class="kt">uint</span> <span class="n">info</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that above, we call <code class="docutils literal notranslate"><span class="pre">mortal.kill()</span></code> to “forward” the
destruction request. The way this is done is problematic, as
seen in the following example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="n">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">mortal</span> <span class="kr">is</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Base1</span> <span class="kr">is</span> <span class="n">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 1 */</span> <span class="n">mortal</span><span class="p">.</span><span class="n">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Base2</span> <span class="kr">is</span> <span class="n">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 2 */</span> <span class="n">mortal</span><span class="p">.</span><span class="n">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Final</span> <span class="kr">is</span> <span class="n">Base1</span><span class="p">,</span> <span class="n">Base2</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A call to <code class="docutils literal notranslate"><span class="pre">Final.kill()</span></code> will call <code class="docutils literal notranslate"><span class="pre">Base2.kill</span></code> as the most
derived override, but this function will bypass
<code class="docutils literal notranslate"><span class="pre">Base1.kill</span></code>, basically because it does not even know about
<code class="docutils literal notranslate"><span class="pre">Base1</span></code>.  The way around this is to use <code class="docutils literal notranslate"><span class="pre">super</span></code>:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="n">owner</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">mortal</span> <span class="kr">is</span> <span class="n">owned</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">)</span> <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Base1</span> <span class="kr">is</span> <span class="n">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 1 */</span> <span class="nb">super</span><span class="p">.</span><span class="n">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="n">Base2</span> <span class="kr">is</span> <span class="n">mortal</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="cm">/* do cleanup 2 */</span> <span class="nb">super</span><span class="p">.</span><span class="n">kill</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Final</span> <span class="kr">is</span> <span class="n">Base1</span><span class="p">,</span> <span class="n">Base2</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">Base2</span></code> calls a function of <code class="docutils literal notranslate"><span class="pre">super</span></code>, it does not simply
call this function on one of its base contracts.  Rather, it
calls this function on the next base contract in the final
inheritance graph, so it will call <code class="docutils literal notranslate"><span class="pre">Base1.kill()</span></code> (note that
the final inheritance sequence is – starting with the most
derived contract: Final, Base2, Base1, mortal, owned).
The actual function that is called when using super is
not known in the context of the class where it is used,
although its type is known. This is similar for ordinary
virtual method lookup.</p>
<div class="section" id="constructors">
<span id="constructor"></span><span id="index-16"></span><h5>Constructors<a class="headerlink" href="#constructors" title="Permalink to this headline">¶</a></h5>
<p>A constructor is an optional function declared with the <code class="docutils literal notranslate"><span class="pre">constructor</span></code> keyword
which is executed upon contract creation, and where you can run contract
initialisation code.</p>
<p>Before the constructor code is executed, state variables are initialised to
their specified value if you initialise them inline, or zero if you do not.</p>
<p>After the constructor has run, the final code of the contract is deployed
to the blockchain. The deployment of
the code costs additional gas linear to the length of the code.
This code includes all functions that are part of the public interface
and all functions that are reachable from there through function calls.
It does not include the constructor code or internal functions that are
only called from the constructor.</p>
<p>Constructor functions can be either <code class="docutils literal notranslate"><span class="pre">public</span></code> or <code class="docutils literal notranslate"><span class="pre">internal</span></code>. If there is no
constructor, the contract will assume the default constructor, which is
equivalent to <code class="docutils literal notranslate"><span class="pre">constructor()</span> <span class="pre">public</span> <span class="pre">{}</span></code>. For example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">a</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_a</span><span class="p">)</span> <span class="kr">internal</span> <span class="p">{</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">B</span> <span class="kr">is</span> <span class="n">A</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A constructor set as <code class="docutils literal notranslate"><span class="pre">internal</span></code> causes the contract to be marked as <a class="reference internal" href="#abstract-contract"><span class="std std-ref">abstract</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Prior to version 0.4.22, constructors were defined as functions with the same name as the contract.
This syntax was deprecated and is not allowed anymore in version 0.5.0.</p>
</div>
</div>
<div class="section" id="arguments-for-base-constructors">
<span id="index-17"></span><h5>Arguments for Base Constructors<a class="headerlink" href="#arguments-for-base-constructors" title="Permalink to this headline">¶</a></h5>
<p>The constructors of all the base contracts will be called following the
linearization rules explained below. If the base constructors have arguments,
derived contracts need to specify all of them. This can be done in two ways:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Base</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_x</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">x</span> <span class="o">=</span> <span class="n">_x</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Either directly specify in the inheritance list...</span>
<span class="kd">contract</span> <span class="n">Derived1</span> <span class="kr">is</span> <span class="n">Base</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// or through a &quot;modifier&quot; of the derived constructor.</span>
<span class="kd">contract</span> <span class="n">Derived2</span> <span class="kr">is</span> <span class="n">Base</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_y</span><span class="p">)</span> <span class="n">Base</span><span class="p">(</span><span class="n">_y</span> <span class="o">*</span> <span class="n">_y</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>One way is directly in the inheritance list (<code class="docutils literal notranslate"><span class="pre">is</span> <span class="pre">Base(7)</span></code>).  The other is in
the way a modifier is invoked as part of
the derived constructor (<code class="docutils literal notranslate"><span class="pre">Base(_y</span> <span class="pre">*</span> <span class="pre">_y)</span></code>). The first way to
do it is more convenient if the constructor argument is a
constant and defines the behaviour of the contract or
describes it. The second way has to be used if the
constructor arguments of the base depend on those of the
derived contract. Arguments have to be given either in the
inheritance list or in modifier-style in the derived constructor.
Specifying arguments in both places is an error.</p>
<p>If a derived contract does not specify the arguments to all of its base
contracts’ constructors, it will be abstract.</p>
</div>
<div class="section" id="multiple-inheritance-and-linearization">
<span id="multi-inheritance"></span><span id="index-18"></span><h5>Multiple Inheritance and Linearization<a class="headerlink" href="#multiple-inheritance-and-linearization" title="Permalink to this headline">¶</a></h5>
<p>Languages that allow multiple inheritance have to deal with
several problems.  One is the <a class="reference external" href="https://en.wikipedia.org/wiki/Multiple_inheritance#The_diamond_problem">Diamond Problem</a>.
Solidity is similar to Python in that it uses “<a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization">C3 Linearization</a>”
to force a specific order in the directed acyclic graph (DAG) of base classes. This
results in the desirable property of monotonicity but
disallows some inheritance graphs. Especially, the order in
which the base classes are given in the <code class="docutils literal notranslate"><span class="pre">is</span></code> directive is
important: You have to list the direct base contracts
in the order from “most base-like” to “most derived”.
Note that this order is the reverse of the one used in Python.</p>
<p>Another simplifying way to explain this is that when a function is called that
is defined multiple times in different contracts, the given bases
are searched from right to left (left to right in Python) in a depth-first manner,
stopping at the first match. If a base contract has already been searched, it is skipped.</p>
<p>In the following code, Solidity will give the
error “Linearization of inheritance graph impossible”.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">X</span> <span class="p">{}</span>
<span class="kd">contract</span> <span class="n">A</span> <span class="kr">is</span> <span class="n">X</span> <span class="p">{}</span>
<span class="c1">// This will not compile</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="kr">is</span> <span class="n">A</span><span class="p">,</span> <span class="n">X</span> <span class="p">{}</span>
</pre></div>
</div>
<p>The reason for this is that <code class="docutils literal notranslate"><span class="pre">C</span></code> requests <code class="docutils literal notranslate"><span class="pre">X</span></code> to override <code class="docutils literal notranslate"><span class="pre">A</span></code>
(by specifying <code class="docutils literal notranslate"><span class="pre">A,</span> <span class="pre">X</span></code> in this order), but <code class="docutils literal notranslate"><span class="pre">A</span></code> itself
requests to override <code class="docutils literal notranslate"><span class="pre">X</span></code>, which is a contradiction that
cannot be resolved.</p>
</div>
<div class="section" id="inheriting-different-kinds-of-members-of-the-same-name">
<h5>Inheriting Different Kinds of Members of the Same Name<a class="headerlink" href="#inheriting-different-kinds-of-members-of-the-same-name" title="Permalink to this headline">¶</a></h5>
<p>When the inheritance results in a contract with a function and a modifier of the same name, it is considered as an error.
This error is produced also by an event and a modifier of the same name, and a function and an event of the same name.
As an exception, a state variable getter can override a public function.</p>
</div>
</div>
<div class="section" id="abstract-contracts">
<span id="abstract-contract"></span><span id="index-19"></span><h4>Abstract Contracts<a class="headerlink" href="#abstract-contracts" title="Permalink to this headline">¶</a></h4>
<p>Contracts are marked as abstract when at least one of their functions lacks an implementation as in the following example (note that the function declaration header is terminated by <code class="docutils literal notranslate"><span class="pre">;</span></code>):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">utterance</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Such contracts cannot be compiled (even if they contain implemented functions alongside non-implemented functions), but they can be used as base contracts:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">utterance</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Cat</span> <span class="kr">is</span> <span class="n">Feline</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">utterance</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&quot;miaow&quot;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If a contract inherits from an abstract contract and does not implement all non-implemented functions by overriding, it will itself be abstract.</p>
<p>Note that a function without implementation is different from a <a class="reference internal" href="index.html#function-types"><span class="std std-ref">Function Type</span></a> even though their syntax looks very similar.</p>
<p>Example of function without implementation (a function declaration):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">foo</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</pre></div>
</div>
<p>Example of a Function Type (a variable declaration, where the variable is of type <code class="docutils literal notranslate"><span class="pre">function</span></code>):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="n">foo</span><span class="p">;</span>
</pre></div>
</div>
<p>Abstract contracts decouple the definition of a contract from its implementation providing better extensibility and self-documentation and
facilitating patterns like the <a class="reference external" href="https://en.wikipedia.org/wiki/Template_method_pattern">Template method</a> and removing code duplication.
Abstract contracts are useful in the same way that defining methods in an interface is useful. It is a way for the designer of the abstract contract to say “any child of mine must implement this method”.</p>
</div>
<div class="section" id="interfaces">
<span id="index-20"></span><span id="id9"></span><h4>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h4>
<p>Interfaces are similar to abstract contracts, but they cannot have any functions implemented. There are further restrictions:</p>
<ul class="simple">
<li>They cannot inherit other contracts or interfaces.</li>
<li>All declared functions must be external.</li>
<li>They cannot declare a constructor.</li>
<li>They cannot declare state variables.</li>
</ul>
<p>Some of these restrictions might be lifted in the future.</p>
<p>Interfaces are basically limited to what the Contract ABI can represent, and the conversion between the ABI and
an interface should be possible without any information loss.</p>
<p>Interfaces are denoted by their own keyword:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">interface</span> <span class="n">Token</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">TokenType</span> <span class="p">{</span> <span class="n">Fungible</span><span class="p">,</span> <span class="n">NonFungible</span> <span class="p">}</span>
    <span class="kd">struct</span> <span class="n">Coin</span> <span class="p">{</span> <span class="kt">string</span> <span class="n">obverse</span><span class="p">;</span> <span class="kt">string</span> <span class="n">reverse</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Contracts can inherit interfaces as they would inherit other contracts.</p>
<p>Types defined inside interfaces and other contract-like structures
can be accessed from other contracts: <code class="docutils literal notranslate"><span class="pre">Token.TokenType</span></code> or <code class="docutils literal notranslate"><span class="pre">Token.Coin</span></code>.</p>
</div>
<div class="section" id="libraries">
<span id="index-21"></span><span id="id10"></span><h4>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h4>
<p>Libraries are similar to contracts, but their purpose is that they are deployed
only once at a specific address and their code is reused using the <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>
(<code class="docutils literal notranslate"><span class="pre">CALLCODE</span></code> until Homestead)
feature of the EVM. This means that if library functions are called, their code
is executed in the context of the calling contract, i.e. <code class="docutils literal notranslate"><span class="pre">this</span></code> points to the
calling contract, and especially the storage from the calling contract can be
accessed. As a library is an isolated piece of source code, it can only access
state variables of the calling contract if they are explicitly supplied (it
would have no way to name them, otherwise). Library functions can only be
called directly (i.e. without the use of <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>) if they do not modify
the state (i.e. if they are <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions),
because libraries are assumed to be stateless. In particular, it is
not possible to destroy a library.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Until version 0.4.20, it was possible to destroy libraries by
circumventing Solidity’s type system. Starting from that version,
libraries contain a <a class="reference internal" href="#call-protection"><span class="std std-ref">mechanism</span></a> that
disallows state-modifying functions
to be called directly (i.e. without <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>).</p>
</div>
<p>Libraries can be seen as implicit base contracts of the contracts that use them.
They will not be explicitly visible in the inheritance hierarchy, but calls
to library functions look just like calls to functions of explicit base
contracts (<code class="docutils literal notranslate"><span class="pre">L.f()</span></code> if <code class="docutils literal notranslate"><span class="pre">L</span></code> is the name of the library). Furthermore,
<code class="docutils literal notranslate"><span class="pre">internal</span></code> functions of libraries are visible in all contracts, just as
if the library were a base contract. Of course, calls to internal functions
use the internal calling convention, which means that all internal types
can be passed and types <a class="reference internal" href="index.html#data-location"><span class="std std-ref">stored in memory</span></a> will be passed by reference and not copied.
To realize this in the EVM, code of internal library functions
and all functions called from therein will at compile time be pulled into the calling
contract, and a regular <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> call will be used instead of a <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>.</p>
<p id="index-22">The following example illustrates how to use libraries (but manual method
be sure to check out <a class="reference internal" href="#using-for"><span class="std std-ref">using for</span></a> for a
more advanced example to implement a set).</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">Set</span> <span class="p">{</span>
  <span class="c1">// We define a new struct datatype that will be used to</span>
  <span class="c1">// hold its data in the calling contract.</span>
  <span class="kd">struct</span> <span class="n">Data</span> <span class="p">{</span> <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">flags</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Note that the first parameter is of type &quot;storage</span>
  <span class="c1">// reference&quot; and thus only its storage address and not</span>
  <span class="c1">// its contents is passed as part of the call.  This is a</span>
  <span class="c1">// special feature of library functions.  It is idiomatic</span>
  <span class="c1">// to call the first parameter `self`, if the function can</span>
  <span class="c1">// be seen as a method of that object.</span>
  <span class="kd">function</span> <span class="n">insert</span><span class="p">(</span><span class="n">Data</span> <span class="kr">storage</span> <span class="n">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span>
      <span class="kr">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// already there</span>
      <span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">remove</span><span class="p">(</span><span class="n">Data</span> <span class="kr">storage</span> <span class="n">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span>
      <span class="kr">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// not there</span>
      <span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">contains</span><span class="p">(</span><span class="n">Data</span> <span class="kr">storage</span> <span class="n">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span>
      <span class="kr">public</span>
      <span class="kr">view</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="n">Set</span><span class="p">.</span><span class="n">Data</span> <span class="n">knownValues</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">register</span><span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// The library functions can be called without a</span>
        <span class="c1">// specific instance of the library, since the</span>
        <span class="c1">// &quot;instance&quot; will be the current contract.</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">Set</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">knownValues</span><span class="p">,</span> <span class="n">value</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="c1">// In this contract, we can also directly access knownValues.flags, if we want.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Of course, you do not have to follow this way to use
libraries: they can also be used without defining struct
data types. Functions also work without any storage
reference parameters, and they can have multiple storage reference
parameters and in any position.</p>
<p>The calls to <code class="docutils literal notranslate"><span class="pre">Set.contains</span></code>, <code class="docutils literal notranslate"><span class="pre">Set.insert</span></code> and <code class="docutils literal notranslate"><span class="pre">Set.remove</span></code>
are all compiled as calls (<code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code>) to an external
contract/library. If you use libraries, be aware that an
actual external function call is performed.
<code class="docutils literal notranslate"><span class="pre">msg.sender</span></code>, <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> and <code class="docutils literal notranslate"><span class="pre">this</span></code> will retain their values
in this call, though (prior to Homestead, because of the use of <code class="docutils literal notranslate"><span class="pre">CALLCODE</span></code>, <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> and
<code class="docutils literal notranslate"><span class="pre">msg.value</span></code> changed, though).</p>
<p>The following example shows how to use <a class="reference internal" href="index.html#data-location"><span class="std std-ref">types stored in memory</span></a> and
internal functions in libraries in order to implement
custom types without the overhead of external function calls:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">BigInt</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="n">bigint</span> <span class="p">{</span>
        <span class="kt">uint</span><span class="p">[]</span> <span class="n">limbs</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">fromUint</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="n">bigint</span> <span class="kr">memory</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">r</span><span class="p">.</span><span class="n">limbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">r</span><span class="p">.</span><span class="n">limbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">add</span><span class="p">(</span><span class="n">bigint</span> <span class="kr">memory</span> <span class="n">_a</span><span class="p">,</span> <span class="n">bigint</span> <span class="kr">memory</span> <span class="n">_b</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="n">bigint</span> <span class="kr">memory</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">r</span><span class="p">.</span><span class="n">limbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="n">max</span><span class="p">(</span><span class="n">_a</span><span class="p">.</span><span class="n">limbs</span><span class="p">.</span><span class="n">length</span><span class="p">,</span> <span class="n">_b</span><span class="p">.</span><span class="n">limbs</span><span class="p">.</span><span class="n">length</span><span class="p">));</span>
        <span class="kt">uint</span> <span class="n">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">limbs</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">uint</span> <span class="n">a</span> <span class="o">=</span> <span class="n">limb</span><span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="kt">uint</span> <span class="n">b</span> <span class="o">=</span> <span class="n">limb</span><span class="p">(</span><span class="n">_b</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
            <span class="n">r</span><span class="p">.</span><span class="n">limbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">carry</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="o">||</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">==</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">carry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">carry</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="n">carry</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">carry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// too bad, we have to add a limb</span>
            <span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">newLimbs</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">uint</span><span class="p">[](</span><span class="n">r</span><span class="p">.</span><span class="n">limbs</span><span class="p">.</span><span class="n">length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="kt">uint</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">.</span><span class="n">limbs</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
                <span class="n">newLimbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">limbs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">newLimbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">carry</span><span class="p">;</span>
            <span class="n">r</span><span class="p">.</span><span class="n">limbs</span> <span class="o">=</span> <span class="n">newLimbs</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">limb</span><span class="p">(</span><span class="n">bigint</span> <span class="kr">memory</span> <span class="n">_a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_limb</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_limb</span> <span class="o">&lt;</span> <span class="n">_a</span><span class="p">.</span><span class="n">limbs</span><span class="p">.</span><span class="n">length</span> <span class="o">?</span> <span class="n">_a</span><span class="p">.</span><span class="n">limbs</span><span class="p">[</span><span class="n">_limb</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">max</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="kr">private</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span> <span class="o">?</span> <span class="n">a</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kn">using</span> <span class="n">BigInt</span> <span class="k">for</span> <span class="n">BigInt</span><span class="p">.</span><span class="n">bigint</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="n">BigInt</span><span class="p">.</span><span class="n">bigint</span> <span class="kr">memory</span> <span class="n">x</span> <span class="o">=</span> <span class="n">BigInt</span><span class="p">.</span><span class="n">fromUint</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
        <span class="n">BigInt</span><span class="p">.</span><span class="n">bigint</span> <span class="kr">memory</span> <span class="n">y</span> <span class="o">=</span> <span class="n">BigInt</span><span class="p">.</span><span class="n">fromUint</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
        <span class="n">BigInt</span><span class="p">.</span><span class="n">bigint</span> <span class="kr">memory</span> <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
        <span class="nf">assert</span><span class="p">(</span><span class="n">z</span><span class="p">.</span><span class="n">limb</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As the compiler cannot know where the library will be
deployed at, these addresses have to be filled into the
final bytecode by a linker
(see <a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> for how to use the
commandline compiler for linking). If the addresses are not
given as arguments to the compiler, the compiled hex code
will contain placeholders of the form <code class="docutils literal notranslate"><span class="pre">__Set______</span></code> (where
<code class="docutils literal notranslate"><span class="pre">Set</span></code> is the name of the library). The address can be filled
manually by replacing all those 40 symbols by the hex
encoding of the address of the library contract.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Manually linking libraries on the generated bytecode is discouraged, because
it is restricted to 36 characters.
You should ask the compiler to link the libraries at the time
a contract is compiled by either using
the <code class="docutils literal notranslate"><span class="pre">--libraries</span></code> option of <code class="docutils literal notranslate"><span class="pre">solc</span></code> or the <code class="docutils literal notranslate"><span class="pre">libraries</span></code> key if you use
the standard-JSON interface to the compiler.</p>
</div>
<p>Restrictions for libraries in comparison to contracts:</p>
<ul class="simple">
<li>No state variables</li>
<li>Cannot inherit nor be inherited</li>
<li>Cannot receive Ether</li>
</ul>
<p>(These might be lifted at a later point.)</p>
<div class="section" id="call-protection-for-libraries">
<span id="call-protection"></span><h5>Call Protection For Libraries<a class="headerlink" href="#call-protection-for-libraries" title="Permalink to this headline">¶</a></h5>
<p>As mentioned in the introduction, if a library’s code is executed
using a <code class="docutils literal notranslate"><span class="pre">CALL</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">DELEGATECALL</span></code> or <code class="docutils literal notranslate"><span class="pre">CALLCODE</span></code>,
it will revert unless a <code class="docutils literal notranslate"><span class="pre">view</span></code> or <code class="docutils literal notranslate"><span class="pre">pure</span></code> function is called.</p>
<p>The EVM does not provide a direct way for a contract to detect
whether it was called using <code class="docutils literal notranslate"><span class="pre">CALL</span></code> or not, but a contract
can use the <code class="docutils literal notranslate"><span class="pre">ADDRESS</span></code> opcode to find out “where” it is
currently running. The generated code compares this address
to the address used at construction time to determine the mode
of calling.</p>
<p>More specifically, the runtime code of a library always starts
with a push instruction, which is a zero of 20 bytes at
compilation time. When the deploy code runs, this constant
is replaced in memory by the current address and this
modified code is stored in the contract. At runtime,
this causes the deploy time address to be the first
constant to be pushed onto the stack and the dispatcher
code compares the current address against this constant
for any non-view and non-pure function.</p>
</div>
</div>
<div class="section" id="using-for">
<span id="index-23"></span><span id="id11"></span><h4>Using For<a class="headerlink" href="#using-for" title="Permalink to this headline">¶</a></h4>
<p>The directive <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B;</span></code> can be used to attach library
functions (from the library <code class="docutils literal notranslate"><span class="pre">A</span></code>) to any type (<code class="docutils literal notranslate"><span class="pre">B</span></code>).
These functions will receive the object they are called on
as their first parameter (like the <code class="docutils literal notranslate"><span class="pre">self</span></code> variable in Python).</p>
<p>The effect of <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">*;</span></code> is that the functions from
the library <code class="docutils literal notranslate"><span class="pre">A</span></code> are attached to <em>any</em> type.</p>
<p>In both situations, <em>all</em> functions in the library are attached,
even those where the type of the first parameter does not
match the type of the object. The type is checked at the
point the function is called and function overload
resolution is performed.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">A</span> <span class="pre">for</span> <span class="pre">B;</span></code> directive is active only within the current
contract, including within all of its functions, and has no effect
outside of the contract in which it is used. The directive
may only be used inside a contract, not inside any of its functions.</p>
<p>By including a library, its data types including library functions are
available without having to add further code.</p>
<p>Let us rewrite the set example from the
<a class="reference internal" href="#libraries"><span class="std std-ref">Libraries</span></a> in this way:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// This is the same code as before, just without comments</span>
<span class="kd">library</span> <span class="n">Set</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="n">Data</span> <span class="p">{</span> <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">flags</span><span class="p">;</span> <span class="p">}</span>

  <span class="kd">function</span> <span class="n">insert</span><span class="p">(</span><span class="n">Data</span> <span class="kr">storage</span> <span class="n">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span>
      <span class="kr">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// already there</span>
      <span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">remove</span><span class="p">(</span><span class="n">Data</span> <span class="kr">storage</span> <span class="n">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span>
      <span class="kr">public</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">])</span>
          <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// not there</span>
      <span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="n">contains</span><span class="p">(</span><span class="n">Data</span> <span class="kr">storage</span> <span class="n">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span>
      <span class="kr">public</span>
      <span class="kr">view</span>
      <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">flags</span><span class="p">[</span><span class="n">value</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kn">using</span> <span class="n">Set</span> <span class="k">for</span> <span class="n">Set</span><span class="p">.</span><span class="n">Data</span><span class="p">;</span> <span class="c1">// this is the crucial change</span>
    <span class="n">Set</span><span class="p">.</span><span class="n">Data</span> <span class="n">knownValues</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">register</span><span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// Here, all variables of type Set.Data have</span>
        <span class="c1">// corresponding member functions.</span>
        <span class="c1">// The following function call is identical to</span>
        <span class="c1">// `Set.insert(knownValues, value)`</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">knownValues</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also possible to extend elementary types in that way:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">Search</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">indexOf</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">storage</span> <span class="n">self</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span> <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
        <span class="k">return</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kn">using</span> <span class="n">Search</span> <span class="k">for</span> <span class="kt">uint</span><span class="p">[];</span>
    <span class="kt">uint</span><span class="p">[]</span> <span class="n">data</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">append</span><span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">data</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">replace</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_old</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_new</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// This performs the library function call</span>
        <span class="kt">uint</span> <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">_old</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">==</span> <span class="kt">uint</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">_new</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">_new</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that all library calls are actual EVM function calls. This means that
if you pass memory or value types, a copy will be performed, even of the
<code class="docutils literal notranslate"><span class="pre">self</span></code> variable. The only situation where no copy will be performed
is when storage reference variables are used.</p>
</div>
</div>
<span id="document-assembly"></span><div class="section" id="solidity-assembly">
<h3>Solidity Assembly<a class="headerlink" href="#solidity-assembly" title="Permalink to this headline">¶</a></h3>
<p id="index-0">Solidity defines an assembly language that you can use without Solidity and also
as “inline assembly” inside Solidity source code. This guide starts with describing
how to use inline assembly, how it differs from standalone assembly, and
specifies assembly itself.</p>
<div class="section" id="inline-assembly">
<span id="id1"></span><h4>Inline Assembly<a class="headerlink" href="#inline-assembly" title="Permalink to this headline">¶</a></h4>
<p>You can interleave Solidity statements with inline assembly in a language close
to the one of the virtual machine. This gives you more fine-grained control,
especially when you are enhancing the language by writing libraries.</p>
<p>As the EVM is a stack machine, it is often hard to address the correct stack slot
and provide arguments to opcodes at the correct point on the stack. Solidity’s inline
assembly helps you do this, and with other issues that arise when writing manual assembly.</p>
<p>Inline assembly has the following features:</p>
<ul class="simple">
<li>functional-style opcodes: <code class="docutils literal notranslate"><span class="pre">mul(1,</span> <span class="pre">add(2,</span> <span class="pre">3))</span></code></li>
<li>assembly-local variables: <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(2,</span> <span class="pre">3)</span>&#160; <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mload(0x40)</span>&#160; <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(x,</span> <span class="pre">y)</span></code></li>
<li>access to external variables: <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(uint</span> <span class="pre">x)</span> <span class="pre">public</span> <span class="pre">{</span> <span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">sub(x,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
<li>loops: <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">0</span> <span class="pre">}</span> <span class="pre">lt(i,</span> <span class="pre">x)</span> <span class="pre">{</span> <span class="pre">i</span> <span class="pre">:=</span> <span class="pre">add(i,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(2,</span> <span class="pre">y)</span> <span class="pre">}</span></code></li>
<li>if statements: <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">slt(x,</span> <span class="pre">0)</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">sub(0,</span> <span class="pre">x)</span> <span class="pre">}</span></code></li>
<li>switch statements: <code class="docutils literal notranslate"><span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">2)</span> <span class="pre">}</span> <span class="pre">default</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">0</span> <span class="pre">}</span></code></li>
<li>function calls: <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(x)</span> <span class="pre">-&gt;</span> <span class="pre">y</span> <span class="pre">{</span> <span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">0</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">1</span> <span class="pre">}</span> <span class="pre">default</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">mul(x,</span> <span class="pre">f(sub(x,</span> <span class="pre">1)))</span> <span class="pre">}</span>&#160;&#160; <span class="pre">}</span></code></li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Inline assembly is a way to access the Ethereum Virtual Machine
at a low level. This bypasses several important safety
features and checks of Solidity. You should only use it for
tasks that need it, and only if you are confident with using it.</p>
</div>
<div class="section" id="syntax">
<h5>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h5>
<p>Assembly parses comments, literals and identifiers in the same way as Solidity, so you can use the
usual <code class="docutils literal notranslate"><span class="pre">//</span></code> and <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">*/</span></code> comments. Inline assembly is marked by <code class="docutils literal notranslate"><span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> and inside
these curly braces, you can use the following (see the later sections for more details):</p>
<blockquote>
<div><ul class="simple">
<li>literals, i.e. <code class="docutils literal notranslate"><span class="pre">0x123</span></code>, <code class="docutils literal notranslate"><span class="pre">42</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;abc&quot;</span></code> (strings up to 32 characters)</li>
<li>opcodes in functional style, e.g. <code class="docutils literal notranslate"><span class="pre">add(1,</span> <span class="pre">mlod(0))</span></code></li>
<li>variable declarations, e.g. <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">7</span></code>, <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code> or <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">x</span></code> (initial value of empty (0) is assigned)</li>
<li>identifiers (assembly-local variables and externals if used as inline assembly), e.g. <code class="docutils literal notranslate"><span class="pre">add(3,</span> <span class="pre">x)</span></code>, <code class="docutils literal notranslate"><span class="pre">sstore(x_slot,</span> <span class="pre">2)</span></code></li>
<li>assignments, e.g. <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">add(y,</span> <span class="pre">3)</span></code></li>
<li>blocks where local variables are scoped inside, e.g. <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">let</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">3</span> <span class="pre">{</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">add(x,</span> <span class="pre">1)</span> <span class="pre">}</span> <span class="pre">}</span></code></li>
</ul>
</div></blockquote>
<p>The following features are only available for standalone assembly:</p>
<blockquote>
<div><ul class="simple">
<li>direct stack control via <code class="docutils literal notranslate"><span class="pre">dup1</span></code>, <code class="docutils literal notranslate"><span class="pre">swap1</span></code>, …</li>
<li>direct stack assignments (in “instruction style”), e.g. <code class="docutils literal notranslate"><span class="pre">3</span> <span class="pre">=:</span> <span class="pre">x</span></code></li>
<li>labels, e.g. <code class="docutils literal notranslate"><span class="pre">name:</span></code></li>
<li>jump opcodes</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Standalone assembly is supported for backwards compatibility but is not documented
here anymore.</p>
</div>
<p>At the end of the <code class="docutils literal notranslate"><span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">...</span> <span class="pre">}</span></code> block, the stack must be balanced,
unless you require it otherwise. If it is not balanced, the compiler generates
a warning.</p>
</div>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<p>The following example provides library code to access the code of another contract and
load it into a <code class="docutils literal notranslate"><span class="pre">bytes</span></code> variable. This is not possible with “plain Solidity” and the
idea is that assembly libraries will be used to enhance the Solidity language.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">GetCode</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">at</span><span class="p">(</span><span class="kt">address</span> <span class="n">_addr</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">o_code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="c1">// retrieve the size of the code, this needs assembly</span>
            <span class="ow">let</span> <span class="nv">size</span> <span class="o">:=</span> <span class="nf">extcodesize</span><span class="p">(</span><span class="n">_addr</span><span class="p">)</span>
            <span class="c1">// allocate output byte array - this could also be done without assembly</span>
            <span class="c1">// by using o_code = new bytes(size)</span>
            <span class="n">o_code</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
            <span class="c1">// new &quot;memory end&quot; including padding</span>
            <span class="nf">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">o_code</span><span class="p">,</span> <span class="nf">and</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="mh">0x1f</span><span class="p">),</span> <span class="nf">not</span><span class="p">(</span><span class="mh">0x1f</span><span class="p">))))</span>
            <span class="c1">// store length in memory</span>
            <span class="nf">mstore</span><span class="p">(</span><span class="n">o_code</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="c1">// actually retrieve the code, this needs assembly</span>
            <span class="nf">extcodecopy</span><span class="p">(</span><span class="n">_addr</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="n">o_code</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Inline assembly is also beneficial in cases where the optimizer fails to produce
efficient code, for example:</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">VectorSum</span> <span class="p">{</span>
    <span class="c1">// This function is less efficient because the optimizer currently fails to</span>
    <span class="c1">// remove the bounds checks in array access.</span>
    <span class="kd">function</span> <span class="n">sumSolidity</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">_data</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_data</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
            <span class="n">o_sum</span> <span class="o">+=</span> <span class="n">_data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// We know that we only access the array in bounds, so we can avoid the check.</span>
    <span class="c1">// 0x20 needs to be added to an array because the first slot contains the</span>
    <span class="c1">// array length.</span>
    <span class="kd">function</span> <span class="n">sumAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">_data</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">_data</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">assembly</span> <span class="p">{</span>
                <span class="n">o_sum</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">o_sum</span><span class="p">,</span> <span class="nf">mload</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="nf">add</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">),</span> <span class="nf">mul</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">))))</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Same as above, but accomplish the entire code within inline assembly.</span>
    <span class="kd">function</span> <span class="n">sumPureAsm</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">_data</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">o_sum</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
           <span class="c1">// Load the length (first 32 bytes)</span>
           <span class="ow">let</span> <span class="nv">len</span> <span class="o">:=</span> <span class="nf">mload</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>

           <span class="c1">// Skip over the length field.</span>
           <span class="c1">//</span>
           <span class="c1">// Keep temporary variable so it can be incremented in place.</span>
           <span class="c1">//</span>
           <span class="c1">// NOTE: incrementing _data would result in an unusable</span>
           <span class="c1">//       _data variable after this assembly block</span>
           <span class="ow">let</span> <span class="nv">data</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>

           <span class="c1">// Iterate until the bound is not met.</span>
           <span class="nf">for</span>
               <span class="p">{</span> <span class="ow">let</span> <span class="nv">end</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nf">mul</span><span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">))</span> <span class="p">}</span>
               <span class="nf">lt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
               <span class="p">{</span> <span class="n">data</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">}</span>
           <span class="p">{</span>
               <span class="n">o_sum</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">o_sum</span><span class="p">,</span> <span class="nf">mload</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
           <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="opcodes">
<span id="id2"></span><h5>Opcodes<a class="headerlink" href="#opcodes" title="Permalink to this headline">¶</a></h5>
<p>This document does not want to be a full description of the Ethereum virtual machine, but the
following list can be used as a reference of its opcodes.</p>
<p>If an opcode takes arguments (always from the top of the stack), they are given in parentheses.
Note that the order of arguments can be seen to be reversed in non-functional style (explained below).
Opcodes marked with <code class="docutils literal notranslate"><span class="pre">-</span></code> do not push an item onto the stack (do not return a result),
those marked with <code class="docutils literal notranslate"><span class="pre">*</span></code> are special and all others push exactly one item onto the stack (their “return value”).
Opcodes marked with <code class="docutils literal notranslate"><span class="pre">F</span></code>, <code class="docutils literal notranslate"><span class="pre">H</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code> or <code class="docutils literal notranslate"><span class="pre">C</span></code> are present since Frontier, Homestead, Byzantium or Constantinople, respectively.
Constantinople is still in planning and all instructions marked as such will result in an invalid instruction exception.</p>
<p>In the following, <code class="docutils literal notranslate"><span class="pre">mem[a...b)</span></code> signifies the bytes of memory starting at position <code class="docutils literal notranslate"><span class="pre">a</span></code> up to
but not including position <code class="docutils literal notranslate"><span class="pre">b</span></code> and <code class="docutils literal notranslate"><span class="pre">storage[p]</span></code> signifies the storage contents at position <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p>
<p>The opcodes <code class="docutils literal notranslate"><span class="pre">pushi</span></code> and <code class="docutils literal notranslate"><span class="pre">jumpdest</span></code> cannot be used directly.</p>
<p>In the grammar, opcodes are represented as pre-defined identifiers.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="5%" />
<col width="3%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Instruction</th>
<th class="head">&#160;</th>
<th class="head">&#160;</th>
<th class="head">Explanation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2">stop</td>
<td rowspan="2"><cite>-</cite></td>
<td rowspan="2">F</td>
<td rowspan="2">stop execution, identical to return(0,0)</td>
</tr>
<tr class="row-odd"></tr>
<tr class="row-even"><td>add(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x + y</td>
</tr>
<tr class="row-odd"><td>sub(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x - y</td>
</tr>
<tr class="row-even"><td>mul(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x * y</td>
</tr>
<tr class="row-odd"><td>div(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x / y</td>
</tr>
<tr class="row-even"><td>sdiv(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x / y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-odd"><td>mod(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x % y</td>
</tr>
<tr class="row-even"><td>smod(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x % y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-odd"><td>exp(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>x to the power of y</td>
</tr>
<tr class="row-even"><td>not(x)</td>
<td>&#160;</td>
<td>F</td>
<td>~x, every bit of x is negated</td>
</tr>
<tr class="row-odd"><td>lt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &lt; y, 0 otherwise</td>
</tr>
<tr class="row-even"><td>gt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &gt; y, 0 otherwise</td>
</tr>
<tr class="row-odd"><td>slt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &lt; y, 0 otherwise, for signed numbers in two’s complement</td>
</tr>
<tr class="row-even"><td>sgt(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x &gt; y, 0 otherwise, for signed numbers in two’s complement</td>
</tr>
<tr class="row-odd"><td>eq(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x == y, 0 otherwise</td>
</tr>
<tr class="row-even"><td>iszero(x)</td>
<td>&#160;</td>
<td>F</td>
<td>1 if x == 0, 0 otherwise</td>
</tr>
<tr class="row-odd"><td>and(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>bitwise and of x and y</td>
</tr>
<tr class="row-even"><td>or(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>bitwise or of x and y</td>
</tr>
<tr class="row-odd"><td>xor(x, y)</td>
<td>&#160;</td>
<td>F</td>
<td>bitwise xor of x and y</td>
</tr>
<tr class="row-even"><td>byte(n, x)</td>
<td>&#160;</td>
<td>F</td>
<td>nth byte of x, where the most significant byte is the 0th byte</td>
</tr>
<tr class="row-odd"><td>shl(x, y)</td>
<td>&#160;</td>
<td>C</td>
<td>logical shift left y by x bits</td>
</tr>
<tr class="row-even"><td>shr(x, y)</td>
<td>&#160;</td>
<td>C</td>
<td>logical shift right y by x bits</td>
</tr>
<tr class="row-odd"><td>sar(x, y)</td>
<td>&#160;</td>
<td>C</td>
<td>arithmetic shift right y by x bits</td>
</tr>
<tr class="row-even"><td>addmod(x, y, m)</td>
<td>&#160;</td>
<td>F</td>
<td>(x + y) % m with arbitrary precision arithmetic</td>
</tr>
<tr class="row-odd"><td>mulmod(x, y, m)</td>
<td>&#160;</td>
<td>F</td>
<td>(x * y) % m with arbitrary precision arithmetic</td>
</tr>
<tr class="row-even"><td>signextend(i, x)</td>
<td>&#160;</td>
<td>F</td>
<td>sign extend from (i*8+7)th bit counting from least significant</td>
</tr>
<tr class="row-odd"><td>keccak256(p, n)</td>
<td>&#160;</td>
<td>F</td>
<td>keccak(mem[p…(p+n)))</td>
</tr>
<tr class="row-even"><td>jump(label)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>jump to label / code position</td>
</tr>
<tr class="row-odd"><td>jumpi(label, cond)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>jump to label if cond is nonzero</td>
</tr>
<tr class="row-even"><td>pc</td>
<td>&#160;</td>
<td>F</td>
<td>current position in code</td>
</tr>
<tr class="row-odd"><td>pop(x)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>remove the element pushed by x</td>
</tr>
<tr class="row-even"><td>dup1 … dup16</td>
<td>&#160;</td>
<td>F</td>
<td>copy nth stack slot to the top (counting from top)</td>
</tr>
<tr class="row-odd"><td>swap1 … swap16</td>
<td><cite>*</cite></td>
<td>F</td>
<td>swap topmost and nth stack slot below it</td>
</tr>
<tr class="row-even"><td>mload(p)</td>
<td>&#160;</td>
<td>F</td>
<td>mem[p…(p+32))</td>
</tr>
<tr class="row-odd"><td>mstore(p, v)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>mem[p…(p+32)) := v</td>
</tr>
<tr class="row-even"><td>mstore8(p, v)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>mem[p] := v &amp; 0xff (only modifies a single byte)</td>
</tr>
<tr class="row-odd"><td>sload(p)</td>
<td>&#160;</td>
<td>F</td>
<td>storage[p]</td>
</tr>
<tr class="row-even"><td>sstore(p, v)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>storage[p] := v</td>
</tr>
<tr class="row-odd"><td>msize</td>
<td>&#160;</td>
<td>F</td>
<td>size of memory, i.e. largest accessed memory index</td>
</tr>
<tr class="row-even"><td>gas</td>
<td>&#160;</td>
<td>F</td>
<td>gas still available to execution</td>
</tr>
<tr class="row-odd"><td>address</td>
<td>&#160;</td>
<td>F</td>
<td>address of the current contract / execution context</td>
</tr>
<tr class="row-even"><td>balance(a)</td>
<td>&#160;</td>
<td>F</td>
<td>wei balance at address a</td>
</tr>
<tr class="row-odd"><td>caller</td>
<td>&#160;</td>
<td>F</td>
<td>call sender (excluding <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>)</td>
</tr>
<tr class="row-even"><td>callvalue</td>
<td>&#160;</td>
<td>F</td>
<td>wei sent together with the current call</td>
</tr>
<tr class="row-odd"><td>calldataload(p)</td>
<td>&#160;</td>
<td>F</td>
<td>call data starting from position p (32 bytes)</td>
</tr>
<tr class="row-even"><td>calldatasize</td>
<td>&#160;</td>
<td>F</td>
<td>size of call data in bytes</td>
</tr>
<tr class="row-odd"><td>calldatacopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>copy s bytes from calldata at position f to mem at position t</td>
</tr>
<tr class="row-even"><td>codesize</td>
<td>&#160;</td>
<td>F</td>
<td>size of the code of the current contract / execution context</td>
</tr>
<tr class="row-odd"><td>codecopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>copy s bytes from code at position f to mem at position t</td>
</tr>
<tr class="row-even"><td>extcodesize(a)</td>
<td>&#160;</td>
<td>F</td>
<td>size of the code at address a</td>
</tr>
<tr class="row-odd"><td>extcodecopy(a, t, f, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>like codecopy(t, f, s) but take code at address a</td>
</tr>
<tr class="row-even"><td>returndatasize</td>
<td>&#160;</td>
<td>B</td>
<td>size of the last returndata</td>
</tr>
<tr class="row-odd"><td>returndatacopy(t, f, s)</td>
<td><cite>-</cite></td>
<td>B</td>
<td>copy s bytes from returndata at position f to mem at position t</td>
</tr>
<tr class="row-even"><td>extcodehash(a)</td>
<td>&#160;</td>
<td>C</td>
<td>code hash of address a</td>
</tr>
<tr class="row-odd"><td>create(v, p, n)</td>
<td>&#160;</td>
<td>F</td>
<td>create new contract with code mem[p…(p+n)) and send v wei
and return the new address</td>
</tr>
<tr class="row-even"><td>create2(v, p, n, s)</td>
<td>&#160;</td>
<td>C</td>
<td>create new contract with code mem[p…(p+n)) at address
keccak256(0xff . this . s . keccak256(mem[p…(p+n)))
and send v wei and return the new address, where <code class="docutils literal notranslate"><span class="pre">0xff</span></code> is a
8 byte value, <code class="docutils literal notranslate"><span class="pre">this</span></code> is the current contract’s address
as a 20 byte value and <code class="docutils literal notranslate"><span class="pre">s</span></code> is a big-endian 256-bit value</td>
</tr>
<tr class="row-odd"><td>call(g, a, v, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>F</td>
<td>call contract at address a with input mem[in…(in+insize))
providing g gas and v wei and output area
mem[out…(out+outsize)) returning 0 on error (eg. out of gas)
and 1 on success</td>
</tr>
<tr class="row-even"><td>callcode(g, a, v, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>F</td>
<td>identical to <code class="docutils literal notranslate"><span class="pre">call</span></code> but only use the code from a and stay
in the context of the current contract otherwise</td>
</tr>
<tr class="row-odd"><td>delegatecall(g, a, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>H</td>
<td>identical to <code class="docutils literal notranslate"><span class="pre">callcode</span></code> but also keep <code class="docutils literal notranslate"><span class="pre">caller</span></code>
and <code class="docutils literal notranslate"><span class="pre">callvalue</span></code></td>
</tr>
<tr class="row-even"><td>staticcall(g, a, in,
insize, out, outsize)</td>
<td>&#160;</td>
<td>B</td>
<td>identical to <code class="docutils literal notranslate"><span class="pre">call(g,</span> <span class="pre">a,</span> <span class="pre">0,</span> <span class="pre">in,</span> <span class="pre">insize,</span> <span class="pre">out,</span> <span class="pre">outsize)</span></code> but do
not allow state modifications</td>
</tr>
<tr class="row-odd"><td>return(p, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>end execution, return data mem[p…(p+s))</td>
</tr>
<tr class="row-even"><td>revert(p, s)</td>
<td><cite>-</cite></td>
<td>B</td>
<td>end execution, revert state changes, return data mem[p…(p+s))</td>
</tr>
<tr class="row-odd"><td>selfdestruct(a)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>end execution, destroy current contract and send funds to a</td>
</tr>
<tr class="row-even"><td>invalid</td>
<td><cite>-</cite></td>
<td>F</td>
<td>end execution with invalid instruction</td>
</tr>
<tr class="row-odd"><td>log0(p, s)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log without topics and data mem[p…(p+s))</td>
</tr>
<tr class="row-even"><td>log1(p, s, t1)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topic t1 and data mem[p…(p+s))</td>
</tr>
<tr class="row-odd"><td>log2(p, s, t1, t2)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topics t1, t2 and data mem[p…(p+s))</td>
</tr>
<tr class="row-even"><td>log3(p, s, t1, t2, t3)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topics t1, t2, t3 and data mem[p…(p+s))</td>
</tr>
<tr class="row-odd"><td>log4(p, s, t1, t2, t3,
t4)</td>
<td><cite>-</cite></td>
<td>F</td>
<td>log with topics t1, t2, t3, t4 and data mem[p…(p+s))</td>
</tr>
<tr class="row-even"><td>origin</td>
<td>&#160;</td>
<td>F</td>
<td>transaction sender</td>
</tr>
<tr class="row-odd"><td>gasprice</td>
<td>&#160;</td>
<td>F</td>
<td>gas price of the transaction</td>
</tr>
<tr class="row-even"><td>blockhash(b)</td>
<td>&#160;</td>
<td>F</td>
<td>hash of block nr b - only for last 256 blocks excluding current</td>
</tr>
<tr class="row-odd"><td>coinbase</td>
<td>&#160;</td>
<td>F</td>
<td>current mining beneficiary</td>
</tr>
<tr class="row-even"><td>timestamp</td>
<td>&#160;</td>
<td>F</td>
<td>timestamp of the current block in seconds since the epoch</td>
</tr>
<tr class="row-odd"><td>number</td>
<td>&#160;</td>
<td>F</td>
<td>current block number</td>
</tr>
<tr class="row-even"><td>difficulty</td>
<td>&#160;</td>
<td>F</td>
<td>difficulty of the current block</td>
</tr>
<tr class="row-odd"><td>gaslimit</td>
<td>&#160;</td>
<td>F</td>
<td>block gas limit of the current block</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="literals">
<h5>Literals<a class="headerlink" href="#literals" title="Permalink to this headline">¶</a></h5>
<p>You can use integer constants by typing them in decimal or hexadecimal notation and an
appropriate <code class="docutils literal notranslate"><span class="pre">PUSHi</span></code> instruction will automatically be generated. The following creates code
to add 2 and 3 resulting in 5 and then computes the bitwise <code class="docutils literal notranslate"><span class="pre">AND</span></code> with the string “abc”.
The final value is assigned to a local variable called <code class="docutils literal notranslate"><span class="pre">x</span></code>.
Strings are stored left-aligned and cannot be longer than 32 bytes.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">assembly</span> <span class="p">{</span> <span class="ow">let</span> <span class="nv">x</span> <span class="o">:=</span> <span class="nf">and</span><span class="p">(</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functional-style">
<h5>Functional Style<a class="headerlink" href="#functional-style" title="Permalink to this headline">¶</a></h5>
<p>For a sequence of opcodes, it is often hard to see what the actual
arguments for certain opcodes are. In the following example,
<code class="docutils literal notranslate"><span class="pre">3</span></code> is added to the contents in memory at position <code class="docutils literal notranslate"><span class="pre">0x80</span></code>.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="mi">3</span> <span class="mh">0x80</span> <span class="n">mload</span> <span class="n">add</span> <span class="mh">0x80</span> <span class="n">mstore</span>
</pre></div>
</div>
<p>Solidity inline assembly has a “functional style” notation where the same code
would be written as follows:</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">mstore</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">mload</span><span class="p">(</span><span class="mh">0x80</span><span class="p">),</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<p>If you read the code from right to left, you end up with exactly the same
sequence of constants and opcodes, but it is much clearer where the
values end up.</p>
<p>If you care about the exact stack layout, just note that the
syntactically first argument for a function or opcode will be put at the
top of the stack.</p>
</div>
<div class="section" id="access-to-external-variables-functions-and-libraries">
<h5>Access to External Variables, Functions and Libraries<a class="headerlink" href="#access-to-external-variables-functions-and-libraries" title="Permalink to this headline">¶</a></h5>
<p>You can access Solidity variables and other identifiers by using their name.
For variables stored in the memory data location, this pushes the address, and not the value
onto the stack. Variables stored in the storage data location are different, as they might not
occupy a full storage slot, so their “address” is composed of a slot and a byte-offset
inside that slot. To retrieve the slot pointed to by the variable <code class="docutils literal notranslate"><span class="pre">x</span></code>, you
use <code class="docutils literal notranslate"><span class="pre">x_slot</span></code>, and to retrieve the byte-offset you use <code class="docutils literal notranslate"><span class="pre">x_offset</span></code>.</p>
<p>Local Solidity variables are available for assignments, for example:</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">b</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="n">r</span> <span class="o">:=</span> <span class="nf">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nf">sload</span><span class="p">(</span><span class="n">b_slot</span><span class="p">))</span> <span class="c1">// ignore the offset, we know it is zero</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you access variables of a type that spans less than 256 bits
(for example <code class="docutils literal notranslate"><span class="pre">uint64</span></code>, <code class="docutils literal notranslate"><span class="pre">address</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes16</span></code> or <code class="docutils literal notranslate"><span class="pre">byte</span></code>),
you cannot make any assumptions about bits not part of the
encoding of the type. Especially, do not assume them to be zero.
To be safe, always clear the data properly before you use it
in a context where this is important:
<code class="docutils literal notranslate"><span class="pre">uint32</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">f();</span> <span class="pre">assembly</span> <span class="pre">{</span> <span class="pre">x</span> <span class="pre">:=</span> <span class="pre">and(x,</span> <span class="pre">0xffffffff)</span> <span class="pre">/*</span> <span class="pre">now</span> <span class="pre">use</span> <span class="pre">x</span> <span class="pre">*/</span> <span class="pre">}</span></code>
To clean signed types, you can use the <code class="docutils literal notranslate"><span class="pre">signextend</span></code> opcode.</p>
</div>
</div>
<div class="section" id="labels">
<h5>Labels<a class="headerlink" href="#labels" title="Permalink to this headline">¶</a></h5>
<p>Support for labels has been removed in version 0.5.0 of Solidity.
Please use functions, loops, if or switch statements instead.</p>
</div>
<div class="section" id="declaring-assembly-local-variables">
<h5>Declaring Assembly-Local Variables<a class="headerlink" href="#declaring-assembly-local-variables" title="Permalink to this headline">¶</a></h5>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">let</span></code> keyword to declare variables that are only visible in
inline assembly and actually only in the current <code class="docutils literal notranslate"><span class="pre">{...}</span></code>-block. What happens
is that the <code class="docutils literal notranslate"><span class="pre">let</span></code> instruction will create a new stack slot that is reserved
for the variable and automatically removed again when the end of the block
is reached. You need to provide an initial value for the variable which can
be just <code class="docutils literal notranslate"><span class="pre">0</span></code>, but it can also be a complex functional-style expression.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">assembly</span> <span class="p">{</span>
            <span class="ow">let</span> <span class="nv">v</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="nf">mstore</span><span class="p">(</span><span class="mh">0x80</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="ow">let</span> <span class="nv">y</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="nf">sload</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">:=</span> <span class="n">y</span>
            <span class="p">}</span> <span class="c1">// y is &quot;deallocated&quot; here</span>
            <span class="n">b</span> <span class="o">:=</span> <span class="nf">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="p">}</span> <span class="c1">// v is &quot;deallocated&quot; here</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="assignments">
<h5>Assignments<a class="headerlink" href="#assignments" title="Permalink to this headline">¶</a></h5>
<p>Assignments are possible to assembly-local variables and to function-local
variables. Take care that when you assign to variables that point to
memory or storage, you will only change the pointer and not the data.</p>
<p>Variables can only be assigned expressions that result in exactly one value.
If you want to assign the values returned from a function that has
multiple return parameters, you have to provide multiple variables.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">let</span> <span class="n">v</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="n">let</span> <span class="n">g</span> <span class="o">:=</span> <span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kd">function</span> <span class="n">f</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">let</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">:=</span> <span class="n">f</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="if">
<h5>If<a class="headerlink" href="#if" title="Permalink to this headline">¶</a></h5>
<p>The if statement can be used for conditionally executing code.
There is no “else” part, consider using “switch” (see below) if
you need multiple alternatives.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="k">if</span> <span class="n">eq</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The curly braces for the body are required.</p>
</div>
<div class="section" id="switch">
<h5>Switch<a class="headerlink" href="#switch" title="Permalink to this headline">¶</a></h5>
<p>You can use a switch statement as a very basic version of “if/else”.
It takes the value of an expression and compares it to several constants.
The branch corresponding to the matching constant is taken. Contrary to the
error-prone behaviour of some programming languages, control flow does
not continue from one case to the next. There can be a fallback or default
case called <code class="docutils literal notranslate"><span class="pre">default</span></code>.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">let</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="n">switch</span> <span class="n">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">case</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="n">calldataload</span><span class="p">(</span><span class="mh">0x24</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kr">default</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="n">calldataload</span><span class="p">(</span><span class="mh">0x44</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">sstore</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The list of cases does not require curly braces, but the body of a
case does require them.</p>
</div>
<div class="section" id="loops">
<h5>Loops<a class="headerlink" href="#loops" title="Permalink to this headline">¶</a></h5>
<p>Assembly supports a simple for-style loop. For-style loops have
a header containing an initializing part, a condition and a post-iteration
part. The condition has to be a functional-style expression, while
the other two are blocks. If the initializing part
declares any variables, the scope of these variables is extended into the
body (including the condition and the post-iteration part).</p>
<p>The following example computes the sum of an area in memory.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">let</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="n">let</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="n">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">}</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mload</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For loops can also be written so that they behave like while loops:
Simply leave the initialization and post-iteration parts empty.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">let</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="n">let</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span> <span class="p">}</span> <span class="n">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="p">{</span>     <span class="c1">// while(i &lt; 0x100)</span>
        <span class="n">x</span> <span class="o">:=</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mload</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">:=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="functions">
<h5>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h5>
<p>Assembly allows the definition of low-level functions. These take their
arguments (and a return PC) from the stack and also put the results onto the
stack. Calling a function looks the same way as executing a functional-style
opcode.</p>
<p>Functions can be defined anywhere and are visible in the block they are
declared in. Inside a function, you cannot access local variables
defined outside of that function. There is no explicit <code class="docutils literal notranslate"><span class="pre">return</span></code>
statement.</p>
<p>If you call a function that returns multiple values, you have to assign
them to a tuple using <code class="docutils literal notranslate"><span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code> or <code class="docutils literal notranslate"><span class="pre">let</span> <span class="pre">a,</span> <span class="pre">b</span> <span class="pre">:=</span> <span class="pre">f(x)</span></code>.</p>
<p>The following example implements the power function by square-and-multiply.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kd">function</span> <span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">result</span> <span class="p">{</span>
        <span class="n">switch</span> <span class="n">exponent</span>
        <span class="n">case</span> <span class="mi">0</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="mi">1</span> <span class="p">}</span>
        <span class="n">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">base</span> <span class="p">}</span>
        <span class="kr">default</span> <span class="p">{</span>
            <span class="n">result</span> <span class="o">:=</span> <span class="n">power</span><span class="p">(</span><span class="n">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">base</span><span class="p">),</span> <span class="n">div</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">switch</span> <span class="n">mod</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">case</span> <span class="mi">1</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="things-to-avoid">
<h5>Things to Avoid<a class="headerlink" href="#things-to-avoid" title="Permalink to this headline">¶</a></h5>
<p>Inline assembly might have a quite high-level look, but it actually is extremely
low-level. Function calls, loops, ifs and switches are converted by simple
rewriting rules and after that, the only thing the assembler does for you is re-arranging
functional-style opcodes, counting stack height for
variable access and removing stack slots for assembly-local variables when the end
of their block is reached.</p>
</div>
<div class="section" id="conventions-in-solidity">
<h5>Conventions in Solidity<a class="headerlink" href="#conventions-in-solidity" title="Permalink to this headline">¶</a></h5>
<p>In contrast to EVM assembly, Solidity knows types which are narrower than 256 bits,
e.g. <code class="docutils literal notranslate"><span class="pre">uint24</span></code>. In order to make them more efficient, most arithmetic operations just
treat them as 256-bit numbers and the higher-order bits are only cleaned at the
point where it is necessary, i.e. just shortly before they are written to memory
or before comparisons are performed. This means that if you access such a variable
from within inline assembly, you might have to manually clean the higher order bits
first.</p>
<p>Solidity manages memory in a very simple way: There is a “free memory pointer”
at position <code class="docutils literal notranslate"><span class="pre">0x40</span></code> in memory. If you want to allocate memory, just use the memory
starting from where this pointer points at and update it accordingly.
There is no guarantee that the memory has not been used before and thus
you cannot assume that its contents are zero bytes.
There is no built-in mechanism to release or free allocated memory.
Here is an assembly snippet that can be used for allocating memory:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">allocate</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pos</span> <span class="p">{</span>
  <span class="n">pos</span> <span class="o">:=</span> <span class="n">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
  <span class="n">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first 64 bytes of memory can be used as “scratch space” for short-term
allocation. The 32 bytes after the free memory pointer (i.e. starting at <code class="docutils literal notranslate"><span class="pre">0x60</span></code>)
is meant to be zero permanently and is used as the initial value for
empty dynamic memory arrays.
This means that the allocatable memory starts at <code class="docutils literal notranslate"><span class="pre">0x80</span></code>, which is the initial value
of the free memory pointer.</p>
<p>Elements in memory arrays in Solidity always occupy multiples of 32 bytes (yes, this is
even true for <code class="docutils literal notranslate"><span class="pre">byte[]</span></code>, but not for <code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code>). Multi-dimensional memory
arrays are pointers to memory arrays. The length of a dynamic array is stored at the
first slot of the array and followed by the array elements.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Statically-sized memory arrays do not have a length field, but it might be added later
to allow better convertibility between statically- and dynamically-sized arrays, so
please do not rely on that.</p>
</div>
</div>
</div>
<div class="section" id="standalone-assembly">
<h4>Standalone Assembly<a class="headerlink" href="#standalone-assembly" title="Permalink to this headline">¶</a></h4>
<p>The assembly language described as inline assembly above can also be used
standalone and in fact, the plan is to use it as an intermediate language
for the Solidity compiler. In this form, it tries to achieve several goals:</p>
<ol class="arabic simple">
<li>Programs written in it should be readable, even if the code is generated by a compiler from Solidity.</li>
<li>The translation from assembly to bytecode should contain as few “surprises” as possible.</li>
<li>Control flow should be easy to detect to help in formal verification and optimization.</li>
</ol>
<p>In order to achieve the first and last goal, assembly provides high-level constructs
like <code class="docutils literal notranslate"><span class="pre">for</span></code> loops, <code class="docutils literal notranslate"><span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">switch</span></code> statements and function calls. It should be possible
to write assembly programs that do not make use of explicit <code class="docutils literal notranslate"><span class="pre">SWAP</span></code>, <code class="docutils literal notranslate"><span class="pre">DUP</span></code>,
<code class="docutils literal notranslate"><span class="pre">JUMP</span></code> and <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> statements, because the first two obfuscate the data flow
and the last two obfuscate control flow. Furthermore, functional statements of
the form <code class="docutils literal notranslate"><span class="pre">mul(add(x,</span> <span class="pre">y),</span> <span class="pre">7)</span></code> are preferred over pure opcode statements like
<code class="docutils literal notranslate"><span class="pre">7</span> <span class="pre">y</span> <span class="pre">x</span> <span class="pre">add</span> <span class="pre">mul</span></code> because in the first form, it is much easier to see which
operand is used for which opcode.</p>
<p>The second goal is achieved by compiling the
higher level constructs to bytecode in a very regular way.
The only non-local operation performed
by the assembler is name lookup of user-defined identifiers (functions, variables, …),
which follow very simple and regular scoping rules and cleanup of local variables from the stack.</p>
<p>Scoping: An identifier that is declared (label, variable, function, assembly)
is only visible in the block where it was declared (including nested blocks
inside the current block). It is not legal to access local variables across
function borders, even if they would be in scope. Shadowing is not allowed.
Local variables cannot be accessed before they were declared, but
functions and assemblies can. Assemblies are special blocks that are used
for e.g. returning runtime code or creating contracts. No identifier from an
outer assembly is visible in a sub-assembly.</p>
<p>If control flow passes over the end of a block, pop instructions are inserted
that match the number of local variables declared in that block.
Whenever a local variable is referenced, the code generator needs
to know its current relative position in the stack and thus it needs to
keep track of the current so-called stack height. Since all local variables
are removed at the end of a block, the stack height before and after the block
should be the same. If this is not the case, compilation fails.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">switch</span></code>, <code class="docutils literal notranslate"><span class="pre">for</span></code> and functions, it should be possible to write
complex code without using <code class="docutils literal notranslate"><span class="pre">jump</span></code> or <code class="docutils literal notranslate"><span class="pre">jumpi</span></code> manually. This makes it much
easier to analyze the control flow, which allows for improved formal
verification and optimization.</p>
<p>Furthermore, if manual jumps are allowed, computing the stack height is rather complicated.
The position of all local variables on the stack needs to be known, otherwise
neither references to local variables nor removing local variables automatically
from the stack at the end of a block will work properly.</p>
<p>Example:</p>
<p>We will follow an example compilation from Solidity to assembly.
We consider the runtime bytecode of the following Solidity program:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
      <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following assembly will be generated:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="n">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">)</span> <span class="c1">// store the &quot;free memory pointer&quot;</span>
  <span class="c1">// function dispatcher</span>
  <span class="n">switch</span> <span class="n">div</span><span class="p">(</span><span class="n">calldataload</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">226</span><span class="p">))</span>
  <span class="n">case</span> <span class="mh">0xb3de648b</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">r</span> <span class="o">:=</span> <span class="n">f</span><span class="p">(</span><span class="n">calldataload</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">let</span> <span class="n">ret</span> <span class="o">:=</span> <span class="err">$</span><span class="n">allocate</span><span class="p">(</span><span class="mh">0x20</span><span class="p">)</span>
    <span class="n">mstore</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="kr">default</span> <span class="p">{</span> <span class="nf">revert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">}</span>
  <span class="c1">// memory allocator</span>
  <span class="kd">function</span> <span class="err">$</span><span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pos</span> <span class="p">{</span>
    <span class="n">pos</span> <span class="o">:=</span> <span class="n">mload</span><span class="p">(</span><span class="mh">0x40</span><span class="p">)</span>
    <span class="n">mstore</span><span class="p">(</span><span class="mh">0x40</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="c1">// the contract function</span>
  <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">y</span> <span class="p">{</span>
    <span class="n">y</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="p">{</span> <span class="n">let</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span> <span class="p">}</span> <span class="n">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span> <span class="p">{</span>
      <span class="n">y</span> <span class="o">:=</span> <span class="n">mul</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="assembly-grammar">
<h5>Assembly Grammar<a class="headerlink" href="#assembly-grammar" title="Permalink to this headline">¶</a></h5>
<p>The tasks of the parser are the following:</p>
<ul class="simple">
<li>Turn the byte stream into a token stream, discarding C++-style comments
(a special comment exists for source references, but we will not explain it here).</li>
<li>Turn the token stream into an AST according to the grammar below</li>
<li>Register identifiers with the block they are defined in (annotation to the
AST node) and note from which point on, variables can be accessed.</li>
</ul>
<p>The assembly lexer follows the one defined by Solidity itself.</p>
<p>Whitespace is used to delimit tokens and it consists of the characters
Space, Tab and Linefeed. Comments are regular JavaScript/C++ comments and
are interpreted in the same way as Whitespace.</p>
<p>Grammar:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">AssemblyBlock</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span> <span class="n">AssemblyItem</span><span class="o">*</span> <span class="s">&#39;}&#39;</span>
<span class="n">AssemblyItem</span> <span class="o">=</span>
    <span class="n">Identifier</span> <span class="o">|</span>
    <span class="n">AssemblyBlock</span> <span class="o">|</span>
    <span class="n">AssemblyExpression</span> <span class="o">|</span>
    <span class="n">AssemblyLocalDefinition</span> <span class="o">|</span>
    <span class="n">AssemblyAssignment</span> <span class="o">|</span>
    <span class="n">AssemblyStackAssignment</span> <span class="o">|</span>
    <span class="n">LabelDefinition</span> <span class="o">|</span>
    <span class="n">AssemblyIf</span> <span class="o">|</span>
    <span class="n">AssemblySwitch</span> <span class="o">|</span>
    <span class="n">AssemblyFunctionDefinition</span> <span class="o">|</span>
    <span class="n">AssemblyFor</span> <span class="o">|</span>
    <span class="s">&#39;break&#39;</span> <span class="o">|</span>
    <span class="s">&#39;continue&#39;</span> <span class="o">|</span>
    <span class="n">SubAssembly</span>
<span class="n">AssemblyExpression</span> <span class="o">=</span> <span class="n">AssemblyCall</span> <span class="o">|</span> <span class="n">Identifier</span> <span class="o">|</span> <span class="n">AssemblyLiteral</span>
<span class="n">AssemblyLiteral</span> <span class="o">=</span> <span class="n">NumberLiteral</span> <span class="o">|</span> <span class="n">StringLiteral</span> <span class="o">|</span> <span class="n">HexLiteral</span>
<span class="n">Identifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_</span><span class="err">$</span><span class="p">]</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span>
<span class="n">AssemblyCall</span> <span class="o">=</span> <span class="n">Identifier</span> <span class="s">&#39;(&#39;</span> <span class="p">(</span> <span class="n">AssemblyExpression</span> <span class="p">(</span> <span class="s">&#39;,&#39;</span> <span class="n">AssemblyExpression</span> <span class="p">)</span><span class="o">*</span> <span class="p">)</span><span class="o">?</span> <span class="s">&#39;)&#39;</span>
<span class="n">AssemblyLocalDefinition</span> <span class="o">=</span> <span class="s">&#39;let&#39;</span> <span class="n">IdentifierOrList</span> <span class="p">(</span> <span class="s">&#39;:=&#39;</span> <span class="n">AssemblyExpression</span> <span class="p">)</span><span class="o">?</span>
<span class="n">AssemblyAssignment</span> <span class="o">=</span> <span class="n">IdentifierOrList</span> <span class="s">&#39;:=&#39;</span> <span class="n">AssemblyExpression</span>
<span class="n">IdentifierOrList</span> <span class="o">=</span> <span class="n">Identifier</span> <span class="o">|</span> <span class="s">&#39;(&#39;</span> <span class="n">IdentifierList</span> <span class="s">&#39;)&#39;</span>
<span class="n">IdentifierList</span> <span class="o">=</span> <span class="n">Identifier</span> <span class="p">(</span> <span class="s">&#39;,&#39;</span> <span class="n">Identifier</span><span class="p">)</span><span class="o">*</span>
<span class="n">AssemblyStackAssignment</span> <span class="o">=</span> <span class="s">&#39;=:&#39;</span> <span class="n">Identifier</span>
<span class="n">LabelDefinition</span> <span class="o">=</span> <span class="n">Identifier</span> <span class="s">&#39;:&#39;</span>
<span class="n">AssemblyIf</span> <span class="o">=</span> <span class="s">&#39;if&#39;</span> <span class="n">AssemblyExpression</span> <span class="n">AssemblyBlock</span>
<span class="n">AssemblySwitch</span> <span class="o">=</span> <span class="s">&#39;switch&#39;</span> <span class="n">AssemblyExpression</span> <span class="n">AssemblyCase</span><span class="o">*</span>
    <span class="p">(</span> <span class="s">&#39;default&#39;</span> <span class="n">AssemblyBlock</span> <span class="p">)</span><span class="o">?</span>
<span class="n">AssemblyCase</span> <span class="o">=</span> <span class="s">&#39;case&#39;</span> <span class="n">AssemblyExpression</span> <span class="n">AssemblyBlock</span>
<span class="n">AssemblyFunctionDefinition</span> <span class="o">=</span> <span class="s">&#39;function&#39;</span> <span class="n">Identifier</span> <span class="s">&#39;(&#39;</span> <span class="n">IdentifierList</span><span class="o">?</span> <span class="s">&#39;)&#39;</span>
    <span class="p">(</span> <span class="s">&#39;-&gt;&#39;</span> <span class="s">&#39;(&#39;</span> <span class="n">IdentifierList</span> <span class="s">&#39;)&#39;</span> <span class="p">)</span><span class="o">?</span> <span class="n">AssemblyBlock</span>
<span class="n">AssemblyFor</span> <span class="o">=</span> <span class="s">&#39;for&#39;</span> <span class="p">(</span> <span class="n">AssemblyBlock</span> <span class="o">|</span> <span class="n">AssemblyExpression</span> <span class="p">)</span>
    <span class="n">AssemblyExpression</span> <span class="p">(</span> <span class="n">AssemblyBlock</span> <span class="o">|</span> <span class="n">AssemblyExpression</span> <span class="p">)</span> <span class="n">AssemblyBlock</span>
<span class="n">SubAssembly</span> <span class="o">=</span> <span class="s">&#39;assembly&#39;</span> <span class="n">Identifier</span> <span class="n">AssemblyBlock</span>
<span class="n">NumberLiteral</span> <span class="o">=</span> <span class="n">HexNumber</span> <span class="o">|</span> <span class="n">DecimalNumber</span>
<span class="n">HexLiteral</span> <span class="o">=</span> <span class="s">&#39;hex&#39;</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">|</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">StringLiteral</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="p">([</span><span class="o">^</span><span class="s">&quot;</span><span class="se">\r\n\\</span><span class="s">] | &#39;</span><span class="se">\\</span><span class="s">&#39; .)* &#39;&quot;&#39;</span>
<span class="n">HexNumber</span> <span class="o">=</span> <span class="s">&#39;0x&#39;</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]</span><span class="o">+</span>
<span class="n">DecimalNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-miscellaneous"></span><div class="section" id="miscellaneous">
<h3>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h3>
<div class="section" id="layout-of-state-variables-in-storage">
<span id="index-0"></span><h4>Layout of State Variables in Storage<a class="headerlink" href="#layout-of-state-variables-in-storage" title="Permalink to this headline">¶</a></h4>
<p>Statically-sized variables (everything except mapping and dynamically-sized array types) are laid out contiguously in storage starting from position <code class="docutils literal notranslate"><span class="pre">0</span></code>. Multiple, contiguous items that need less than 32 bytes are packed into a single storage slot if possible, according to the following rules:</p>
<ul class="simple">
<li>The first item in a storage slot is stored lower-order aligned.</li>
<li>Elementary types use only that many bytes that are necessary to store them.</li>
<li>If an elementary type does not fit the remaining part of a storage slot, it is moved to the next storage slot.</li>
<li>Structs and array data always start a new slot and occupy whole slots (but items inside a struct or array are packed tightly according to these rules).</li>
</ul>
<p>For contracts that use inheritance, the ordering of state variables is determined by the
C3-linearized order of contracts starting with the most base-ward contract. If allowed
by the above rules, state variables from different contracts do share the same storage slot.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<blockquote>
<div><p>When using elements that are smaller than 32 bytes, your contract’s gas usage may be higher.
This is because the EVM operates on 32 bytes at a time. Therefore, if the element is smaller
than that, the EVM must use more operations in order to reduce the size of the element from 32
bytes to the desired size.</p>
<p>It is only beneficial to use reduced-size arguments if you are dealing with storage values
because the compiler will pack multiple elements into one storage slot, and thus, combine
multiple reads or writes into a single operation. When dealing with function arguments or memory
values, there is no inherent benefit because the compiler does not pack these values.</p>
<p>Finally, in order to allow the EVM to optimize for this, ensure that you try to order your
storage variables and <code class="docutils literal notranslate"><span class="pre">struct</span></code> members such that they can be packed tightly. For example,
declaring your storage variables in the order of <code class="docutils literal notranslate"><span class="pre">uint128,</span> <span class="pre">uint128,</span> <span class="pre">uint256</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">uint128,</span> <span class="pre">uint256,</span> <span class="pre">uint128</span></code>, as the former will only take up two slots of storage whereas the
latter will take up three.</p>
</div></blockquote>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The layout of state variables in storage is considered to be part of the external interface
of Solidity due to the fact that storage pointers can be passed to libraries. This means that
any change to the rules outlined in this section is considered a breaking change
of the language and due to its critical nature should be considered very carefully before
being executed.</p>
</div>
</div>
<p>The elements of structs and arrays are stored after each other, just as if they were given explicitly.</p>
<div class="section" id="mappings-and-dynamic-arrays">
<h5>Mappings and Dynamic Arrays<a class="headerlink" href="#mappings-and-dynamic-arrays" title="Permalink to this headline">¶</a></h5>
<p>Due to their unpredictable size, mapping and dynamically-sized array types use a Keccak-256 hash
computation to find the starting position of the value or the array data. These starting positions are always full stack slots.</p>
<p>The mapping or the dynamic array itself occupies a slot in storage at some position <code class="docutils literal notranslate"><span class="pre">p</span></code>
according to the above rule (or by recursively applying this rule for mappings of mappings or arrays of arrays). For dynamic arrays,
this slot stores the number of elements in the array (byte arrays and strings are an exception, see <a class="reference internal" href="#bytes-and-string"><span class="std std-ref">below</span></a>).
For mappings, the slot is unused (but it is needed so that two equal mappings after each other will use a different
hash distribution). Array data is located at <code class="docutils literal notranslate"><span class="pre">keccak256(p)</span></code> and the value corresponding to a mapping key
<code class="docutils literal notranslate"><span class="pre">k</span></code> is located at <code class="docutils literal notranslate"><span class="pre">keccak256(k</span> <span class="pre">.</span> <span class="pre">p)</span></code> where <code class="docutils literal notranslate"><span class="pre">.</span></code> is concatenation. If the value is again a
non-elementary type, the positions are found by adding an offset of <code class="docutils literal notranslate"><span class="pre">keccak256(k</span> <span class="pre">.</span> <span class="pre">p)</span></code>.</p>
<p>So for the following contract snippet:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="n">s</span> <span class="p">{</span> <span class="kt">uint</span> <span class="n">a</span><span class="p">;</span> <span class="kt">uint</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
  <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="n">s</span><span class="p">))</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The position of <code class="docutils literal notranslate"><span class="pre">data[4][9].b</span></code> is at <code class="docutils literal notranslate"><span class="pre">keccak256(uint256(9)</span> <span class="pre">.</span> <span class="pre">keccak256(uint256(4)</span> <span class="pre">.</span> <span class="pre">uint256(1)))</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
<div class="section" id="bytes-and-string">
<span id="id1"></span><h6><code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code><a class="headerlink" href="#bytes-and-string" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">bytes</span></code> and <code class="docutils literal notranslate"><span class="pre">string</span></code> are encoded identically. For short byte arrays, they store their data in the same
slot where the length is also stored. In particular: if the data is at most <code class="docutils literal notranslate"><span class="pre">31</span></code> bytes long, it is stored
in the higher-order bytes (left aligned) and the lowest-order byte stores <code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span></code>.
For byte arrays that store data which is <code class="docutils literal notranslate"><span class="pre">32</span></code> or more bytes long, the main slot stores <code class="docutils literal notranslate"><span class="pre">length</span> <span class="pre">*</span> <span class="pre">2</span> <span class="pre">+</span> <span class="pre">1</span></code> and the data is
stored as usual in <code class="docutils literal notranslate"><span class="pre">keccak256(slot)</span></code>. This means that you can distinguish a short array from a long array
by checking if the lowest bit is set: short (not set) and long (set).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Handling invalidly encoded slots is currently not supported but may be added in the future.</p>
</div>
</div>
</div>
</div>
<div class="section" id="layout-in-memory">
<h4>Layout in Memory<a class="headerlink" href="#layout-in-memory" title="Permalink to this headline">¶</a></h4>
<p>Solidity reserves four 32-byte slots, with specific byte ranges (inclusive of endpoints) being used as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x00</span></code> - <code class="docutils literal notranslate"><span class="pre">0x3f</span></code> (64 bytes): scratch space for hashing methods</li>
<li><code class="docutils literal notranslate"><span class="pre">0x40</span></code> - <code class="docutils literal notranslate"><span class="pre">0x5f</span></code> (32 bytes): currently allocated memory size (aka. free memory pointer)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x60</span></code> - <code class="docutils literal notranslate"><span class="pre">0x7f</span></code> (32 bytes): zero slot</li>
</ul>
<p>Scratch space can be used between statements (i.e. within inline assembly). The zero slot
is used as initial value for dynamic memory arrays and should never be written to
(the free memory pointer points to <code class="docutils literal notranslate"><span class="pre">0x80</span></code> initially).</p>
<p>Solidity always places new objects at the free memory pointer and memory is never freed (this might change in the future).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>There are some operations in Solidity that need a temporary memory area larger than 64 bytes and therefore will not fit into the scratch space. They will be placed where the free memory points to, but given their short lifetime, the pointer is not updated. The memory may or may not be zeroed out. Because of this, one shouldn’t expect the free memory to point to zeroed out memory.</p>
<p class="last">While it may seem like a good idea to use <code class="docutils literal notranslate"><span class="pre">msize</span></code> to arrive at a definitely zeroed out memory area, using such a pointer non-temporarily without updating the free memory pointer can have adverse results.</p>
</div>
</div>
<div class="section" id="layout-of-call-data">
<h4>Layout of Call Data<a class="headerlink" href="#layout-of-call-data" title="Permalink to this headline">¶</a></h4>
<p>The input data for a function call is assumed to be in the format defined by the <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI
specification</span></a>. Among others, the ABI specification requires arguments to be padded to multiples of 32
bytes. The internal function calls use a different convention.</p>
<p>Arguments for the constructor of a contract are directly appended at the end of the
contract’s code, also in ABI encoding. The constructor will access them through a hard-coded offset, and
not by using the <code class="docutils literal notranslate"><span class="pre">codesize</span></code> opcode, since this of course changes when appending
data to the code.</p>
</div>
<div class="section" id="internals-cleaning-up-variables">
<h4>Internals - Cleaning Up Variables<a class="headerlink" href="#internals-cleaning-up-variables" title="Permalink to this headline">¶</a></h4>
<p>When a value is shorter than 256-bit, in some cases the remaining bits
must be cleaned.
The Solidity compiler is designed to clean such remaining bits before any operations
that might be adversely affected by the potential garbage in the remaining bits.
For example, before writing a value to the memory, the remaining bits need
to be cleared because the memory contents can be used for computing
hashes or sent as the data of a message call.  Similarly, before
storing a value in the storage, the remaining bits need to be cleaned
because otherwise the garbled value can be observed.</p>
<p>On the other hand, we do not clean the bits if the immediately
following operation is not affected.  For instance, since any non-zero
value is considered <code class="docutils literal notranslate"><span class="pre">true</span></code> by <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> instruction, we do not clean
the boolean values before they are used as the condition for
<code class="docutils literal notranslate"><span class="pre">JUMPI</span></code>.</p>
<p>In addition to the design principle above, the Solidity compiler
cleans input data when it is loaded onto the stack.</p>
<p>Different types have different rules for cleaning up invalid values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="31%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Valid Values</th>
<th class="head">Invalid Values Mean</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>enum of n
members</td>
<td>0 until n - 1</td>
<td>exception</td>
</tr>
<tr class="row-odd"><td>bool</td>
<td>0 or 1</td>
<td>1</td>
</tr>
<tr class="row-even"><td>signed integers</td>
<td>sign-extended
word</td>
<td>currently silently
wraps; in the
future exceptions
will be thrown</td>
</tr>
<tr class="row-odd"><td>unsigned
integers</td>
<td>higher bits
zeroed</td>
<td>currently silently
wraps; in the
future exceptions
will be thrown</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="internals-the-optimiser">
<span id="index-1"></span><h4>Internals - The Optimiser<a class="headerlink" href="#internals-the-optimiser" title="Permalink to this headline">¶</a></h4>
<p>The Solidity optimiser operates on assembly so that other languages can use it. It splits the sequence of instructions into basic blocks at <code class="docutils literal notranslate"><span class="pre">JUMPs</span></code> and <code class="docutils literal notranslate"><span class="pre">JUMPDESTs</span></code>. Inside these blocks, the optimiser analyses the instructions and records every modification to the stack, memory, or storage as an expression which consists of an instruction and a list of arguments which are pointers to other expressions. The optimiser uses a component called “CommonSubexpressionEliminator” that amongst other tasks, finds expressions that are always equal (on every input) and combines them into an expression class. The optimiser first tries to find each new expression in a list of already known expressions. If this does not work, it simplifies the expression according to rules like <code class="docutils literal notranslate"><span class="pre">constant</span> <span class="pre">+</span> <span class="pre">constant</span> <span class="pre">=</span> <span class="pre">sum_of_constants</span></code> or <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">1</span> <span class="pre">=</span> <span class="pre">X</span></code>. Since this is a recursive process, we can also apply the latter rule if the second factor is a more complex expression where we know that it always evaluates to one. Modifications to storage and memory locations have to erase knowledge about storage and memory locations which are not known to be different. If we first write to location x and then to location y and both are input variables, the second could overwrite the first, so we do not know what is stored at x after we wrote to y. If simplification of the expression x - y evaluates to a non-zero constant, we know that we can keep our knowledge about what is stored at x.</p>
<p>After this process, we know which expressions have to be on the stack at the end, and have a list of modifications to memory and storage. This information is stored together with the basic blocks and is used to link them. Furthermore, knowledge about the stack, storage and memory configuration is forwarded to the next block(s). If we know the targets of all <code class="docutils literal notranslate"><span class="pre">JUMP</span></code> and <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> instructions, we can build a complete control flow graph of the program. If there is only one target we do not know (this can happen as in principle, jump targets can be computed from inputs), we have to erase all knowledge about the input state of a block as it can be the target of the unknown <code class="docutils literal notranslate"><span class="pre">JUMP</span></code>. If the optimiser finds a <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> whose condition evaluates to a constant, it transforms it to an unconditional jump.</p>
<p>As the last step, the code in each block is re-generated. The optimiser creates a dependency graph from the expressions on the stack at the end of the block, and it drops every operation that is not part of this graph. It generates code that applies the modifications to memory and storage in the order they were made in the original code (dropping modifications which were found not to be needed). Finally, it generates all values that are required to be on the stack in the correct place.</p>
<p>These steps are applied to each basic block and the newly generated code is used as replacement if it is smaller. If a basic block is split at a <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> and during the analysis, the condition evaluates to a constant, the <code class="docutils literal notranslate"><span class="pre">JUMPI</span></code> is replaced depending on the value of the constant. Thus code like</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">!=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">else</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>still simplifies to code which you can compile even though the instructions contained
a jump in the beginning of the process:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="source-mappings">
<span id="index-2"></span><h4>Source Mappings<a class="headerlink" href="#source-mappings" title="Permalink to this headline">¶</a></h4>
<p>As part of the AST output, the compiler provides the range of the source
code that is represented by the respective node in the AST. This can be
used for various purposes ranging from static analysis tools that report
errors based on the AST and debugging tools that highlight local variables
and their uses.</p>
<p>Furthermore, the compiler can also generate a mapping from the bytecode
to the range in the source code that generated the instruction. This is again
important for static analysis tools that operate on bytecode level and
for displaying the current position in the source code inside a debugger
or for breakpoint handling.</p>
<p>Both kinds of source mappings use integer identifiers to refer to source files.
The identifier of a source file is stored in
<code class="docutils literal notranslate"><span class="pre">output['sources'][sourceName]['id']</span></code> where <code class="docutils literal notranslate"><span class="pre">output</span></code> is the output of the
standard-json compiler interface parsed as JSON.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the case of instructions that are not associated with any particular source file,
the source mapping assigns an integer identifier of <code class="docutils literal notranslate"><span class="pre">-1</span></code>. This may happen for
bytecode sections stemming from compiler-generated inline assembly statements.</p>
</div>
<p>The source mappings inside the AST use the following
notation:</p>
<p><code class="docutils literal notranslate"><span class="pre">s:l:f</span></code></p>
<p>Where <code class="docutils literal notranslate"><span class="pre">s</span></code> is the byte-offset to the start of the range in the source file,
<code class="docutils literal notranslate"><span class="pre">l</span></code> is the length of the source range in bytes and <code class="docutils literal notranslate"><span class="pre">f</span></code> is the source
index mentioned above.</p>
<p>The encoding in the source mapping for the bytecode is more complicated:
It is a list of <code class="docutils literal notranslate"><span class="pre">s:l:f:j</span></code> separated by <code class="docutils literal notranslate"><span class="pre">;</span></code>. Each of these
elements corresponds to an instruction, i.e. you cannot use the byte offset
but have to use the instruction offset (push instructions are longer than a single byte).
The fields <code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">l</span></code> and <code class="docutils literal notranslate"><span class="pre">f</span></code> are as above and <code class="docutils literal notranslate"><span class="pre">j</span></code> can be either
<code class="docutils literal notranslate"><span class="pre">i</span></code>, <code class="docutils literal notranslate"><span class="pre">o</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> signifying whether a jump instruction goes into a
function, returns from a function or is a regular jump as part of e.g. a loop.</p>
<p>In order to compress these source mappings especially for bytecode, the
following rules are used:</p>
<blockquote>
<div><ul class="simple">
<li>If a field is empty, the value of the preceding element is used.</li>
<li>If a <code class="docutils literal notranslate"><span class="pre">:</span></code> is missing, all following fields are considered empty.</li>
</ul>
</div></blockquote>
<p>This means the following source mappings represent the same information:</p>
<p><code class="docutils literal notranslate"><span class="pre">1:2:1;1:9:1;2:1:2;2:1:2;2:1:2</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">1:2:1;:9;2:1:2;;</span></code></p>
</div>
<div class="section" id="tips-and-tricks">
<h4>Tips and Tricks<a class="headerlink" href="#tips-and-tricks" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Use <code class="docutils literal notranslate"><span class="pre">delete</span></code> on arrays to delete all its elements.</li>
<li>Use shorter types for struct elements and sort them such that short types are grouped together. This can lower the gas costs as multiple <code class="docutils literal notranslate"><span class="pre">SSTORE</span></code> operations might be combined into a single (<code class="docutils literal notranslate"><span class="pre">SSTORE</span></code> costs 5000 or 20000 gas, so this is what you want to optimise). Use the gas price estimator (with optimiser enabled) to check!</li>
<li>Make your state variables public - the compiler will create <a class="reference internal" href="index.html#visibility-and-getters"><span class="std std-ref">getters</span></a> for you automatically.</li>
<li>If you end up checking conditions on input or state a lot at the beginning of your functions, try using <a class="reference internal" href="index.html#modifiers"><span class="std std-ref">Function Modifiers</span></a>.</li>
<li>Initialize storage structs with a single assignment: <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">MyStruct({a:</span> <span class="pre">1,</span> <span class="pre">b:</span> <span class="pre">2});</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the storage struct has tightly packed properties, initialize it with separate assignments: <code class="docutils literal notranslate"><span class="pre">x.a</span> <span class="pre">=</span> <span class="pre">1;</span> <span class="pre">x.b</span> <span class="pre">=</span> <span class="pre">2;</span></code>. In this way it will be easier for the optimizer to update storage in one go, thus making assignment cheaper.</p>
</div>
</div>
<div class="section" id="cheatsheet">
<h4>Cheatsheet<a class="headerlink" href="#cheatsheet" title="Permalink to this headline">¶</a></h4>
<div class="section" id="order-of-precedence-of-operators">
<span id="order"></span><span id="index-3"></span><h5>Order of Precedence of Operators<a class="headerlink" href="#order-of-precedence-of-operators" title="Permalink to this headline">¶</a></h5>
<p>The following is the order of precedence for operators, listed in order of evaluation.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="40%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Precedence</th>
<th class="head">Description</th>
<th class="head">Operator</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="6"><em>1</em></td>
<td>Postfix increment and decrement</td>
<td><code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code></td>
</tr>
<tr class="row-odd"><td>New expression</td>
<td><code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">&lt;typename&gt;</span></code></td>
</tr>
<tr class="row-even"><td>Array subscripting</td>
<td><code class="docutils literal notranslate"><span class="pre">&lt;array&gt;[&lt;index&gt;]</span></code></td>
</tr>
<tr class="row-odd"><td>Member access</td>
<td><code class="docutils literal notranslate"><span class="pre">&lt;object&gt;.&lt;member&gt;</span></code></td>
</tr>
<tr class="row-even"><td>Function-like call</td>
<td><code class="docutils literal notranslate"><span class="pre">&lt;func&gt;(&lt;args...&gt;)</span></code></td>
</tr>
<tr class="row-odd"><td>Parentheses</td>
<td><code class="docutils literal notranslate"><span class="pre">(&lt;statement&gt;)</span></code></td>
</tr>
<tr class="row-even"><td rowspan="5"><em>2</em></td>
<td>Prefix increment and decrement</td>
<td><code class="docutils literal notranslate"><span class="pre">++</span></code>, <code class="docutils literal notranslate"><span class="pre">--</span></code></td>
</tr>
<tr class="row-odd"><td>Unary minus</td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
</tr>
<tr class="row-even"><td>Unary operations</td>
<td><code class="docutils literal notranslate"><span class="pre">delete</span></code></td>
</tr>
<tr class="row-odd"><td>Logical NOT</td>
<td><code class="docutils literal notranslate"><span class="pre">!</span></code></td>
</tr>
<tr class="row-even"><td>Bitwise NOT</td>
<td><code class="docutils literal notranslate"><span class="pre">~</span></code></td>
</tr>
<tr class="row-odd"><td><em>3</em></td>
<td>Exponentiation</td>
<td><code class="docutils literal notranslate"><span class="pre">**</span></code></td>
</tr>
<tr class="row-even"><td><em>4</em></td>
<td>Multiplication, division and modulo</td>
<td><code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code></td>
</tr>
<tr class="row-odd"><td><em>5</em></td>
<td>Addition and subtraction</td>
<td><code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code></td>
</tr>
<tr class="row-even"><td><em>6</em></td>
<td>Bitwise shift operators</td>
<td><code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code></td>
</tr>
<tr class="row-odd"><td><em>7</em></td>
<td>Bitwise AND</td>
<td><code class="docutils literal notranslate"><span class="pre">&amp;</span></code></td>
</tr>
<tr class="row-even"><td><em>8</em></td>
<td>Bitwise XOR</td>
<td><code class="docutils literal notranslate"><span class="pre">^</span></code></td>
</tr>
<tr class="row-odd"><td><em>9</em></td>
<td>Bitwise OR</td>
<td><code class="docutils literal notranslate"><span class="pre">|</span></code></td>
</tr>
<tr class="row-even"><td><em>10</em></td>
<td>Inequality operators</td>
<td><code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code></td>
</tr>
<tr class="row-odd"><td><em>11</em></td>
<td>Equality operators</td>
<td><code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code></td>
</tr>
<tr class="row-even"><td><em>12</em></td>
<td>Logical AND</td>
<td><code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code></td>
</tr>
<tr class="row-odd"><td><em>13</em></td>
<td>Logical OR</td>
<td><code class="docutils literal notranslate"><span class="pre">||</span></code></td>
</tr>
<tr class="row-even"><td><em>14</em></td>
<td>Ternary operator</td>
<td><code class="docutils literal notranslate"><span class="pre">&lt;conditional&gt;</span> <span class="pre">?</span> <span class="pre">&lt;if-true&gt;</span> <span class="pre">:</span> <span class="pre">&lt;if-false&gt;</span></code></td>
</tr>
<tr class="row-odd"><td><em>15</em></td>
<td>Assignment operators</td>
<td><code class="docutils literal notranslate"><span class="pre">=</span></code>, <code class="docutils literal notranslate"><span class="pre">|=</span></code>, <code class="docutils literal notranslate"><span class="pre">^=</span></code>, <code class="docutils literal notranslate"><span class="pre">&amp;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;=</span></code>,
<code class="docutils literal notranslate"><span class="pre">&gt;&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">+=</span></code>, <code class="docutils literal notranslate"><span class="pre">-=</span></code>, <code class="docutils literal notranslate"><span class="pre">*=</span></code>, <code class="docutils literal notranslate"><span class="pre">/=</span></code>,
<code class="docutils literal notranslate"><span class="pre">%=</span></code></td>
</tr>
<tr class="row-even"><td><em>16</em></td>
<td>Comma operator</td>
<td><code class="docutils literal notranslate"><span class="pre">,</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="global-variables">
<span id="index-4"></span><h5>Global Variables<a class="headerlink" href="#global-variables" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">abi.decode(bytes</span> <span class="pre">memory</span> <span class="pre">encodedData,</span> <span class="pre">(...))</span> <span class="pre">returns</span> <span class="pre">(...)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-decodes the provided data. The types are given in parentheses as second argument. Example: <code class="docutils literal notranslate"><span class="pre">(uint</span> <span class="pre">a,</span> <span class="pre">uint[2]</span> <span class="pre">memory</span> <span class="pre">b,</span> <span class="pre">bytes</span> <span class="pre">memory</span> <span class="pre">c)</span> <span class="pre">=</span> <span class="pre">abi.decode(data,</span> <span class="pre">(uint,</span> <span class="pre">uint[2],</span> <span class="pre">bytes))</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">abi.encode(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-encodes the given arguments</li>
<li><code class="docutils literal notranslate"><span class="pre">abi.encodePacked(...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Performs <a class="reference internal" href="index.html#abi-packed-mode"><span class="std std-ref">packed encoding</span></a> of the given arguments</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4</span> <span class="pre">selector,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: <a class="reference internal" href="index.html#abi"><span class="std std-ref">ABI</span></a>-encodes the given arguments</dt>
<dd>starting from the second and prepends the given four-byte selector</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">abi.encodeWithSignature(string</span> <span class="pre">memory</span> <span class="pre">signature,</span> <span class="pre">...)</span> <span class="pre">returns</span> <span class="pre">(bytes</span> <span class="pre">memory)</span></code>: Equivalent to <code class="docutils literal notranslate"><span class="pre">abi.encodeWithSelector(bytes4(keccak256(bytes(signature)),</span> <span class="pre">...)`</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">block.coinbase</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): current block miner’s address</li>
<li><code class="docutils literal notranslate"><span class="pre">block.difficulty</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block difficulty</li>
<li><code class="docutils literal notranslate"><span class="pre">block.gaslimit</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block gaslimit</li>
<li><code class="docutils literal notranslate"><span class="pre">block.number</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block number</li>
<li><code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block timestamp</li>
<li><code class="docutils literal notranslate"><span class="pre">gasleft()</span> <span class="pre">returns</span> <span class="pre">(uint256)</span></code>: remaining gas</li>
<li><code class="docutils literal notranslate"><span class="pre">msg.data</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span></code>): complete calldata</li>
<li><code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): sender of the message (current call)</li>
<li><code class="docutils literal notranslate"><span class="pre">msg.value</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): number of wei sent with the message</li>
<li><code class="docutils literal notranslate"><span class="pre">now</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): current block timestamp (alias for <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">tx.gasprice</span></code> (<code class="docutils literal notranslate"><span class="pre">uint</span></code>): gas price of the transaction</li>
<li><code class="docutils literal notranslate"><span class="pre">tx.origin</span></code> (<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>): sender of the transaction (full call chain)</li>
<li><code class="docutils literal notranslate"><span class="pre">assert(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal notranslate"><span class="pre">false</span></code> (use for internal error)</li>
<li><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal notranslate"><span class="pre">false</span></code> (use for malformed input or error in external component)</li>
<li><code class="docutils literal notranslate"><span class="pre">require(bool</span> <span class="pre">condition,</span> <span class="pre">string</span> <span class="pre">memory</span> <span class="pre">message)</span></code>: abort execution and revert state changes if condition is <code class="docutils literal notranslate"><span class="pre">false</span></code> (use for malformed input or error in external component). Also provide error message.</li>
<li><code class="docutils literal notranslate"><span class="pre">revert()</span></code>: abort execution and revert state changes</li>
<li><code class="docutils literal notranslate"><span class="pre">revert(string</span> <span class="pre">memory</span> <span class="pre">message)</span></code>: abort execution and revert state changes providing an explanatory string</li>
<li><code class="docutils literal notranslate"><span class="pre">blockhash(uint</span> <span class="pre">blockNumber)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: hash of the given block - only works for 256 most recent blocks</li>
<li><code class="docutils literal notranslate"><span class="pre">keccak256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the Keccak-256 hash of the input</li>
<li><code class="docutils literal notranslate"><span class="pre">sha256(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes32)</span></code>: compute the SHA-256 hash of the input</li>
<li><code class="docutils literal notranslate"><span class="pre">ripemd160(bytes</span> <span class="pre">memory)</span> <span class="pre">returns</span> <span class="pre">(bytes20)</span></code>: compute the RIPEMD-160 hash of the input</li>
<li><code class="docutils literal notranslate"><span class="pre">ecrecover(bytes32</span> <span class="pre">hash,</span> <span class="pre">uint8</span> <span class="pre">v,</span> <span class="pre">bytes32</span> <span class="pre">r,</span> <span class="pre">bytes32</span> <span class="pre">s)</span> <span class="pre">returns</span> <span class="pre">(address)</span></code>: recover address associated with the public key from elliptic curve signature, return zero on error</li>
<li><code class="docutils literal notranslate"><span class="pre">addmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">+</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the addition is performed with arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</li>
<li><code class="docutils literal notranslate"><span class="pre">mulmod(uint</span> <span class="pre">x,</span> <span class="pre">uint</span> <span class="pre">y,</span> <span class="pre">uint</span> <span class="pre">k)</span> <span class="pre">returns</span> <span class="pre">(uint)</span></code>: compute <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">*</span> <span class="pre">y)</span> <span class="pre">%</span> <span class="pre">k</span></code> where the multiplication is performed with arbitrary precision and does not wrap around at <code class="docutils literal notranslate"><span class="pre">2**256</span></code>. Assert that <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">!=</span> <span class="pre">0</span></code> starting from version 0.5.0.</li>
<li><code class="docutils literal notranslate"><span class="pre">this</span></code> (current contract’s type): the current contract, explicitly convertible to <code class="docutils literal notranslate"><span class="pre">address</span></code> or <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">super</span></code>: the contract one level higher in the inheritance hierarchy</li>
<li><code class="docutils literal notranslate"><span class="pre">selfdestruct(address</span> <span class="pre">payable</span> <span class="pre">recipient)</span></code>: destroy the current contract, sending its funds to the given address</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;address&gt;.balance</span></code> (<code class="docutils literal notranslate"><span class="pre">uint256</span></code>): balance of the <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a> in Wei</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.send(uint256</span> <span class="pre">amount)</span> <span class="pre">returns</span> <span class="pre">(bool)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, returns <code class="docutils literal notranslate"><span class="pre">false</span></code> on failure</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;address</span> <span class="pre">payable&gt;.transfer(uint256</span> <span class="pre">amount)</span></code>: send given amount of Wei to <a class="reference internal" href="index.html#address"><span class="std std-ref">Address</span></a>, throws on failure</li>
<li><code class="docutils literal notranslate"><span class="pre">type(C).creationCode</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>): creation bytecode of the given contract, see <a class="reference internal" href="index.html#meta-type"><span class="std std-ref">Type Information</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">type(C).runtimeCode</span></code> (<code class="docutils literal notranslate"><span class="pre">bytes</span> <span class="pre">memory</span></code>): runtime bytecode of the given contract, see <a class="reference internal" href="index.html#meta-type"><span class="std std-ref">Type Information</span></a>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Do not rely on <code class="docutils literal notranslate"><span class="pre">block.timestamp</span></code>, <code class="docutils literal notranslate"><span class="pre">now</span></code> and <code class="docutils literal notranslate"><span class="pre">blockhash</span></code> as a source of randomness,
unless you know what you are doing.</p>
<p>Both the timestamp and the block hash can be influenced by miners to some degree.
Bad actors in the mining community can for example run a casino payout function on a chosen hash
and just retry a different hash if they did not receive any money.</p>
<p class="last">The current block timestamp must be strictly larger than the timestamp of the last block,
but the only guarantee is that it will be somewhere between the timestamps of two
consecutive blocks in the canonical chain.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The block hashes are not available for all blocks for scalability reasons.
You can only access the hashes of the most recent 256 blocks, all other
values will be zero.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In version 0.5.0, the following aliases were removed: <code class="docutils literal notranslate"><span class="pre">suicide</span></code> as alias for <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>,
<code class="docutils literal notranslate"><span class="pre">msg.gas</span></code> as alias for <code class="docutils literal notranslate"><span class="pre">gasleft</span></code>, <code class="docutils literal notranslate"><span class="pre">block.blockhash</span></code> as alias for <code class="docutils literal notranslate"><span class="pre">blockhash</span></code> and
<code class="docutils literal notranslate"><span class="pre">sha3</span></code> as alias for <code class="docutils literal notranslate"><span class="pre">keccak256</span></code>.</p>
</div>
</div>
<div class="section" id="function-visibility-specifiers">
<span id="index-5"></span><h5>Function Visibility Specifiers<a class="headerlink" href="#function-visibility-specifiers" title="Permalink to this headline">¶</a></h5>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">myFunction</span><span class="p">()</span> <span class="o">&lt;</span><span class="n">visibility</span> <span class="n">specifier</span><span class="o">&gt;</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">public</span></code>: visible externally and internally (creates a <a class="reference internal" href="index.html#getter-functions"><span class="std std-ref">getter function</span></a> for storage/state variables)</li>
<li><code class="docutils literal notranslate"><span class="pre">private</span></code>: only visible in the current contract</li>
<li><code class="docutils literal notranslate"><span class="pre">external</span></code>: only visible externally (only for functions) - i.e. can only be message-called (via <code class="docutils literal notranslate"><span class="pre">this.func</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">internal</span></code>: only visible internally</li>
</ul>
</div>
<div class="section" id="modifiers">
<span id="index-6"></span><h5>Modifiers<a class="headerlink" href="#modifiers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">pure</span></code> for functions: Disallows modification or access of state.</li>
<li><code class="docutils literal notranslate"><span class="pre">view</span></code> for functions: Disallows modification of state.</li>
<li><code class="docutils literal notranslate"><span class="pre">payable</span></code> for functions: Allows them to receive Ether together with a call.</li>
<li><code class="docutils literal notranslate"><span class="pre">constant</span></code> for state variables: Disallows assignment (except initialisation), does not occupy storage slot.</li>
<li><code class="docutils literal notranslate"><span class="pre">anonymous</span></code> for events: Does not store event signature as topic.</li>
<li><code class="docutils literal notranslate"><span class="pre">indexed</span></code> for event parameters: Stores the parameter as topic.</li>
</ul>
</div>
<div class="section" id="reserved-keywords">
<h5>Reserved Keywords<a class="headerlink" href="#reserved-keywords" title="Permalink to this headline">¶</a></h5>
<p>These keywords are reserved in Solidity. They might become part of the syntax in the future:</p>
<p><code class="docutils literal notranslate"><span class="pre">abstract</span></code>, <code class="docutils literal notranslate"><span class="pre">after</span></code>, <code class="docutils literal notranslate"><span class="pre">alias</span></code>, <code class="docutils literal notranslate"><span class="pre">apply</span></code>, <code class="docutils literal notranslate"><span class="pre">auto</span></code>, <code class="docutils literal notranslate"><span class="pre">case</span></code>, <code class="docutils literal notranslate"><span class="pre">catch</span></code>, <code class="docutils literal notranslate"><span class="pre">copyof</span></code>, <code class="docutils literal notranslate"><span class="pre">default</span></code>,
<code class="docutils literal notranslate"><span class="pre">define</span></code>, <code class="docutils literal notranslate"><span class="pre">final</span></code>, <code class="docutils literal notranslate"><span class="pre">immutable</span></code>, <code class="docutils literal notranslate"><span class="pre">implements</span></code>, <code class="docutils literal notranslate"><span class="pre">in</span></code>, <code class="docutils literal notranslate"><span class="pre">inline</span></code>, <code class="docutils literal notranslate"><span class="pre">let</span></code>, <code class="docutils literal notranslate"><span class="pre">macro</span></code>, <code class="docutils literal notranslate"><span class="pre">match</span></code>,
<code class="docutils literal notranslate"><span class="pre">mutable</span></code>, <code class="docutils literal notranslate"><span class="pre">null</span></code>, <code class="docutils literal notranslate"><span class="pre">of</span></code>, <code class="docutils literal notranslate"><span class="pre">override</span></code>, <code class="docutils literal notranslate"><span class="pre">partial</span></code>, <code class="docutils literal notranslate"><span class="pre">promise</span></code>, <code class="docutils literal notranslate"><span class="pre">reference</span></code>, <code class="docutils literal notranslate"><span class="pre">relocatable</span></code>,
<code class="docutils literal notranslate"><span class="pre">sealed</span></code>, <code class="docutils literal notranslate"><span class="pre">sizeof</span></code>, <code class="docutils literal notranslate"><span class="pre">static</span></code>, <code class="docutils literal notranslate"><span class="pre">supports</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code>, <code class="docutils literal notranslate"><span class="pre">try</span></code>, <code class="docutils literal notranslate"><span class="pre">typedef</span></code>, <code class="docutils literal notranslate"><span class="pre">typeof</span></code>,
<code class="docutils literal notranslate"><span class="pre">unchecked</span></code>.</p>
</div>
<div class="section" id="language-grammar">
<h5>Language Grammar<a class="headerlink" href="#language-grammar" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SourceUnit = (PragmaDirective | ImportDirective | ContractDefinition)*

// Pragma actually parses anything up to the trailing &#39;;&#39; to be fully forward-compatible.
PragmaDirective = &#39;pragma&#39; Identifier ([^;]+) &#39;;&#39;

ImportDirective = &#39;import&#39; StringLiteral (&#39;as&#39; Identifier)? &#39;;&#39;
        | &#39;import&#39; (&#39;*&#39; | Identifier) (&#39;as&#39; Identifier)? &#39;from&#39; StringLiteral &#39;;&#39;
        | &#39;import&#39; &#39;{&#39; Identifier (&#39;as&#39; Identifier)? ( &#39;,&#39; Identifier (&#39;as&#39; Identifier)? )* &#39;}&#39; &#39;from&#39; StringLiteral &#39;;&#39;

ContractDefinition = ( &#39;contract&#39; | &#39;library&#39; | &#39;interface&#39; ) Identifier
                     ( &#39;is&#39; InheritanceSpecifier (&#39;,&#39; InheritanceSpecifier )* )?
                     &#39;{&#39; ContractPart* &#39;}&#39;

ContractPart = StateVariableDeclaration | UsingForDeclaration
             | StructDefinition | ModifierDefinition | FunctionDefinition | EventDefinition | EnumDefinition

InheritanceSpecifier = UserDefinedTypeName ( &#39;(&#39; Expression ( &#39;,&#39; Expression )* &#39;)&#39; )?

StateVariableDeclaration = TypeName ( &#39;public&#39; | &#39;internal&#39; | &#39;private&#39; | &#39;constant&#39; )* Identifier (&#39;=&#39; Expression)? &#39;;&#39;
UsingForDeclaration = &#39;using&#39; Identifier &#39;for&#39; (&#39;*&#39; | TypeName) &#39;;&#39;
StructDefinition = &#39;struct&#39; Identifier &#39;{&#39;
                     ( VariableDeclaration &#39;;&#39; (VariableDeclaration &#39;;&#39;)* ) &#39;}&#39;

ModifierDefinition = &#39;modifier&#39; Identifier ParameterList? Block
ModifierInvocation = Identifier ( &#39;(&#39; ExpressionList? &#39;)&#39; )?

FunctionDefinition = &#39;function&#39; Identifier? ParameterList
                     ( ModifierInvocation | StateMutability | &#39;external&#39; | &#39;public&#39; | &#39;internal&#39; | &#39;private&#39; )*
                     ( &#39;returns&#39; ParameterList )? ( &#39;;&#39; | Block )
EventDefinition = &#39;event&#39; Identifier EventParameterList &#39;anonymous&#39;? &#39;;&#39;

EnumValue = Identifier
EnumDefinition = &#39;enum&#39; Identifier &#39;{&#39; EnumValue? (&#39;,&#39; EnumValue)* &#39;}&#39;

ParameterList = &#39;(&#39; ( Parameter (&#39;,&#39; Parameter)* )? &#39;)&#39;
Parameter = TypeName StorageLocation? Identifier?

EventParameterList = &#39;(&#39; ( EventParameter (&#39;,&#39; EventParameter )* )? &#39;)&#39;
EventParameter = TypeName &#39;indexed&#39;? Identifier?

FunctionTypeParameterList = &#39;(&#39; ( FunctionTypeParameter (&#39;,&#39; FunctionTypeParameter )* )? &#39;)&#39;
FunctionTypeParameter = TypeName StorageLocation?

// semantic restriction: mappings and structs (recursively) containing mappings
// are not allowed in argument lists
VariableDeclaration = TypeName StorageLocation? Identifier

TypeName = ElementaryTypeName
         | UserDefinedTypeName
         | Mapping
         | ArrayTypeName
         | FunctionTypeName
         | ( &#39;address&#39; &#39;payable&#39; )

UserDefinedTypeName = Identifier ( &#39;.&#39; Identifier )*

Mapping = &#39;mapping&#39; &#39;(&#39; ElementaryTypeName &#39;=&gt;&#39; TypeName &#39;)&#39;
ArrayTypeName = TypeName &#39;[&#39; Expression? &#39;]&#39;
FunctionTypeName = &#39;function&#39; FunctionTypeParameterList ( &#39;internal&#39; | &#39;external&#39; | StateMutability )*
                   ( &#39;returns&#39; FunctionTypeParameterList )?
StorageLocation = &#39;memory&#39; | &#39;storage&#39; | &#39;calldata&#39;
StateMutability = &#39;pure&#39; | &#39;view&#39; | &#39;payable&#39;

Block = &#39;{&#39; Statement* &#39;}&#39;
Statement = IfStatement | WhileStatement | ForStatement | Block | InlineAssemblyStatement |
            ( DoWhileStatement | PlaceholderStatement | Continue | Break | Return |
              Throw | EmitStatement | SimpleStatement ) &#39;;&#39;

ExpressionStatement = Expression
IfStatement = &#39;if&#39; &#39;(&#39; Expression &#39;)&#39; Statement ( &#39;else&#39; Statement )?
WhileStatement = &#39;while&#39; &#39;(&#39; Expression &#39;)&#39; Statement
PlaceholderStatement = &#39;_&#39;
SimpleStatement = VariableDefinition | ExpressionStatement
ForStatement = &#39;for&#39; &#39;(&#39; (SimpleStatement)? &#39;;&#39; (Expression)? &#39;;&#39; (ExpressionStatement)? &#39;)&#39; Statement
InlineAssemblyStatement = &#39;assembly&#39; StringLiteral? AssemblyBlock
DoWhileStatement = &#39;do&#39; Statement &#39;while&#39; &#39;(&#39; Expression &#39;)&#39;
Continue = &#39;continue&#39;
Break = &#39;break&#39;
Return = &#39;return&#39; Expression?
Throw = &#39;throw&#39;
EmitStatement = &#39;emit&#39; FunctionCall
VariableDefinition = (VariableDeclaration | &#39;(&#39; VariableDeclaration? (&#39;,&#39; VariableDeclaration? )* &#39;)&#39; ) ( &#39;=&#39; Expression )?

// Precedence by order (see github.com/ethereum/solidity/pull/732)
Expression
  = Expression (&#39;++&#39; | &#39;--&#39;)
  | NewExpression
  | IndexAccess
  | MemberAccess
  | FunctionCall
  | &#39;(&#39; Expression &#39;)&#39;
  | (&#39;!&#39; | &#39;~&#39; | &#39;delete&#39; | &#39;++&#39; | &#39;--&#39; | &#39;+&#39; | &#39;-&#39;) Expression
  | Expression &#39;**&#39; Expression
  | Expression (&#39;*&#39; | &#39;/&#39; | &#39;%&#39;) Expression
  | Expression (&#39;+&#39; | &#39;-&#39;) Expression
  | Expression (&#39;&lt;&lt;&#39; | &#39;&gt;&gt;&#39;) Expression
  | Expression &#39;&amp;&#39; Expression
  | Expression &#39;^&#39; Expression
  | Expression &#39;|&#39; Expression
  | Expression (&#39;&lt;&#39; | &#39;&gt;&#39; | &#39;&lt;=&#39; | &#39;&gt;=&#39;) Expression
  | Expression (&#39;==&#39; | &#39;!=&#39;) Expression
  | Expression &#39;&amp;&amp;&#39; Expression
  | Expression &#39;||&#39; Expression
  | Expression &#39;?&#39; Expression &#39;:&#39; Expression
  | Expression (&#39;=&#39; | &#39;|=&#39; | &#39;^=&#39; | &#39;&amp;=&#39; | &#39;&lt;&lt;=&#39; | &#39;&gt;&gt;=&#39; | &#39;+=&#39; | &#39;-=&#39; | &#39;*=&#39; | &#39;/=&#39; | &#39;%=&#39;) Expression
  | PrimaryExpression

PrimaryExpression = BooleanLiteral
                  | NumberLiteral
                  | HexLiteral
                  | StringLiteral
                  | TupleExpression
                  | Identifier
                  | ElementaryTypeNameExpression

ExpressionList = Expression ( &#39;,&#39; Expression )*
NameValueList = Identifier &#39;:&#39; Expression ( &#39;,&#39; Identifier &#39;:&#39; Expression )*

FunctionCall = Expression &#39;(&#39; FunctionCallArguments &#39;)&#39;
FunctionCallArguments = &#39;{&#39; NameValueList? &#39;}&#39;
                      | ExpressionList?

NewExpression = &#39;new&#39; TypeName
MemberAccess = Expression &#39;.&#39; Identifier
IndexAccess = Expression &#39;[&#39; Expression? &#39;]&#39;

BooleanLiteral = &#39;true&#39; | &#39;false&#39;
NumberLiteral = ( HexNumber | DecimalNumber ) (&#39; &#39; NumberUnit)?
NumberUnit = &#39;wei&#39; | &#39;szabo&#39; | &#39;finney&#39; | &#39;ether&#39;
           | &#39;seconds&#39; | &#39;minutes&#39; | &#39;hours&#39; | &#39;days&#39; | &#39;weeks&#39; | &#39;years&#39;
HexLiteral = &#39;hex&#39; (&#39;&quot;&#39; ([0-9a-fA-F]{2})* &#39;&quot;&#39; | &#39;\&#39;&#39; ([0-9a-fA-F]{2})* &#39;\&#39;&#39;)
StringLiteral = &#39;&quot;&#39; ([^&quot;\r\n\\] | &#39;\\&#39; .)* &#39;&quot;&#39;
Identifier = [a-zA-Z_$] [a-zA-Z_$0-9]*

HexNumber = &#39;0x&#39; [0-9a-fA-F]+
DecimalNumber = [0-9]+ ( &#39;.&#39; [0-9]* )? ( [eE] [0-9]+ )?

TupleExpression = &#39;(&#39; ( Expression? ( &#39;,&#39; Expression? )*  )? &#39;)&#39;
                | &#39;[&#39; ( Expression  ( &#39;,&#39; Expression  )*  )? &#39;]&#39;

ElementaryTypeNameExpression = ElementaryTypeName

ElementaryTypeName = &#39;address&#39; | &#39;bool&#39; | &#39;string&#39; | Int | Uint | Byte | Fixed | Ufixed

Int = &#39;int&#39; | &#39;int8&#39; | &#39;int16&#39; | &#39;int24&#39; | &#39;int32&#39; | &#39;int40&#39; | &#39;int48&#39; | &#39;int56&#39; | &#39;int64&#39; | &#39;int72&#39; | &#39;int80&#39; | &#39;int88&#39; | &#39;int96&#39; | &#39;int104&#39; | &#39;int112&#39; | &#39;int120&#39; | &#39;int128&#39; | &#39;int136&#39; | &#39;int144&#39; | &#39;int152&#39; | &#39;int160&#39; | &#39;int168&#39; | &#39;int176&#39; | &#39;int184&#39; | &#39;int192&#39; | &#39;int200&#39; | &#39;int208&#39; | &#39;int216&#39; | &#39;int224&#39; | &#39;int232&#39; | &#39;int240&#39; | &#39;int248&#39; | &#39;int256&#39;

Uint = &#39;uint&#39; | &#39;uint8&#39; | &#39;uint16&#39; | &#39;uint24&#39; | &#39;uint32&#39; | &#39;uint40&#39; | &#39;uint48&#39; | &#39;uint56&#39; | &#39;uint64&#39; | &#39;uint72&#39; | &#39;uint80&#39; | &#39;uint88&#39; | &#39;uint96&#39; | &#39;uint104&#39; | &#39;uint112&#39; | &#39;uint120&#39; | &#39;uint128&#39; | &#39;uint136&#39; | &#39;uint144&#39; | &#39;uint152&#39; | &#39;uint160&#39; | &#39;uint168&#39; | &#39;uint176&#39; | &#39;uint184&#39; | &#39;uint192&#39; | &#39;uint200&#39; | &#39;uint208&#39; | &#39;uint216&#39; | &#39;uint224&#39; | &#39;uint232&#39; | &#39;uint240&#39; | &#39;uint248&#39; | &#39;uint256&#39;

Byte = &#39;byte&#39; | &#39;bytes&#39; | &#39;bytes1&#39; | &#39;bytes2&#39; | &#39;bytes3&#39; | &#39;bytes4&#39; | &#39;bytes5&#39; | &#39;bytes6&#39; | &#39;bytes7&#39; | &#39;bytes8&#39; | &#39;bytes9&#39; | &#39;bytes10&#39; | &#39;bytes11&#39; | &#39;bytes12&#39; | &#39;bytes13&#39; | &#39;bytes14&#39; | &#39;bytes15&#39; | &#39;bytes16&#39; | &#39;bytes17&#39; | &#39;bytes18&#39; | &#39;bytes19&#39; | &#39;bytes20&#39; | &#39;bytes21&#39; | &#39;bytes22&#39; | &#39;bytes23&#39; | &#39;bytes24&#39; | &#39;bytes25&#39; | &#39;bytes26&#39; | &#39;bytes27&#39; | &#39;bytes28&#39; | &#39;bytes29&#39; | &#39;bytes30&#39; | &#39;bytes31&#39; | &#39;bytes32&#39;

Fixed = &#39;fixed&#39; | ( &#39;fixed&#39; [0-9]+ &#39;x&#39; [0-9]+ )

Ufixed = &#39;ufixed&#39; | ( &#39;ufixed&#39; [0-9]+ &#39;x&#39; [0-9]+ )


AssemblyBlock = &#39;{&#39; AssemblyStatement* &#39;}&#39;

AssemblyStatement = AssemblyBlock
                  | AssemblyFunctionDefinition
                  | AssemblyVariableDeclaration
                  | AssemblyAssignment
                  | AssemblyIf
                  | AssemblyExpression
                  | AssemblySwitch
                  | AssemblyForLoop
                  | AssemblyBreakContinue
AssemblyFunctionDefinition =
    &#39;function&#39; Identifier &#39;(&#39; AssemblyIdentifierList? &#39;)&#39;
    ( &#39;-&gt;&#39; AssemblyIdentifierList )? AssemblyBlock
AssemblyVariableDeclaration = &#39;let&#39; AssemblyIdentifierList ( &#39;:=&#39; AssemblyExpression )?
AssemblyAssignment = AssemblyIdentifierList &#39;:=&#39; AssemblyExpression
AssemblyExpression = AssemblyFunctionCall | Identifier | Literal
AssemblyIf = &#39;if&#39; AssemblyExpression AssemblyBlock
AssemblySwitch = &#39;switch&#39; AssemblyExpression ( Case+ AssemblyDefault? | AssemblyDefault )
AssemblyCase = &#39;case&#39; Literal AssemblyBlock
AssemblyDefault = &#39;default&#39; AssemblyBlock
AssemblyForLoop = &#39;for&#39; AssemblyBlock AssemblyExpression AssemblyBlock AssemblyBlock
AssemblyBreakContinue = &#39;break&#39; | &#39;continue&#39;
AssemblyFunctionCall = Identifier &#39;(&#39; ( AssemblyExpression ( &#39;,&#39; AssemblyExpression )* )? &#39;)&#39;

AssemblyIdentifierList = Identifier ( &#39;,&#39; Identifier )*
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-050-breaking-changes"></span><div class="section" id="solidity-v0-5-0-breaking-changes">
<h3>Solidity v0.5.0 Breaking Changes<a class="headerlink" href="#solidity-v0-5-0-breaking-changes" title="Permalink to this headline">¶</a></h3>
<p>This section highlights the main breaking changes introduced in Solidity
version 0.5.0, along with the reasoning behind the changes and how to update
affected code.
For the full list check
<a class="reference external" href="https://github.com/ethereum/solidity/releases/tag/v0.5.0">the release changelog</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Contracts compiled with Solidity v0.5.0 can still interface with contracts
and even libraries compiled with older versions without recompiling or
redeploying them.  Changing the interfaces to include data locations and
visibility and mutability specifiers suffices. See the
<a class="reference internal" href="#interoperability"><span class="std std-ref">Interoperability With Older Contracts</span></a> section below.</p>
</div>
<div class="section" id="semantic-only-changes">
<h4>Semantic Only Changes<a class="headerlink" href="#semantic-only-changes" title="Permalink to this headline">¶</a></h4>
<p>This section lists the changes that are semantic-only, thus potentially
hiding new and different behavior in existing code.</p>
<ul class="simple">
<li>Signed right shift now uses proper arithmetic shift, i.e. rounding towards
negative infinity, instead of rounding towards zero.  Signed and unsigned
shift will have dedicated opcodes in Constantinople, and are emulated by
Solidity for the moment.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">continue</span></code> statement in a <code class="docutils literal notranslate"><span class="pre">do...while</span></code> loop now jumps to the
condition, which is the common behavior in such cases. It used to jump to the
loop body. Thus, if the condition is false, the loop terminates.</li>
<li>The functions <code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> do not
pad anymore when given a single <code class="docutils literal notranslate"><span class="pre">bytes</span></code> parameter.</li>
<li>Pure and view functions are now called using the opcode <code class="docutils literal notranslate"><span class="pre">STATICCALL</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">CALL</span></code> if the EVM version is Byzantium or later. This
disallows state changes on the EVM level.</li>
<li>The ABI encoder now properly pads byte arrays and strings from calldata
(<code class="docutils literal notranslate"><span class="pre">msg.data</span></code> and external function parameters) when used in external
function calls and in <code class="docutils literal notranslate"><span class="pre">abi.encode</span></code>. For unpadded encoding, use
<code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code>.</li>
<li>The ABI decoder reverts in the beginning of functions and in
<code class="docutils literal notranslate"><span class="pre">abi.decode()</span></code> if passed calldata is too short or points out of bounds.
Note that dirty higher order bits are still simply ignored.</li>
<li>Forward all available gas with external function calls starting from
Tangerine Whistle.</li>
</ul>
</div>
<div class="section" id="semantic-and-syntactic-changes">
<h4>Semantic and Syntactic Changes<a class="headerlink" href="#semantic-and-syntactic-changes" title="Permalink to this headline">¶</a></h4>
<p>This section highlights changes that affect syntax and semantics.</p>
<ul class="simple">
<li>The functions <code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code>, <code class="docutils literal notranslate"><span class="pre">staticcall()</span></code>,
<code class="docutils literal notranslate"><span class="pre">keccak256()</span></code>, <code class="docutils literal notranslate"><span class="pre">sha256()</span></code> and <code class="docutils literal notranslate"><span class="pre">ripemd160()</span></code> now accept only a single
<code class="docutils literal notranslate"><span class="pre">bytes</span></code> argument. Moreover, the argument is not padded. This was changed to
make more explicit and clear how the arguments are concatenated. Change every
<code class="docutils literal notranslate"><span class="pre">.call()</span></code> (and family) to a <code class="docutils literal notranslate"><span class="pre">.call(&quot;&quot;)</span></code> and every <code class="docutils literal notranslate"><span class="pre">.call(signature,</span> <span class="pre">a,</span>
<span class="pre">b,</span> <span class="pre">c)</span></code> to use <code class="docutils literal notranslate"><span class="pre">.call(abi.encodeWithSignature(signature,</span> <span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c))</span></code> (the
last one only works for value types).  Change every <code class="docutils literal notranslate"><span class="pre">keccak256(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></code> to
<code class="docutils literal notranslate"><span class="pre">keccak256(abi.encodePacked(a,</span> <span class="pre">b,</span> <span class="pre">c))</span></code>. Even though it is not a breaking
change, it is suggested that developers change
<code class="docutils literal notranslate"><span class="pre">x.call(bytes4(keccak256(&quot;f(uint256)&quot;),</span> <span class="pre">a,</span> <span class="pre">b)</span></code> to
<code class="docutils literal notranslate"><span class="pre">x.call(abi.encodeWithSignature(&quot;f(uint256)&quot;,</span> <span class="pre">a,</span> <span class="pre">b))</span></code>.</li>
<li>Functions <code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> now return
<code class="docutils literal notranslate"><span class="pre">(bool,</span> <span class="pre">bytes</span> <span class="pre">memory)</span></code> to provide access to the return data.  Change
<code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">success</span> <span class="pre">=</span> <span class="pre">otherContract.call(&quot;f&quot;)</span></code> to <code class="docutils literal notranslate"><span class="pre">(bool</span> <span class="pre">success,</span> <span class="pre">bytes</span> <span class="pre">memory</span>
<span class="pre">data)</span> <span class="pre">=</span> <span class="pre">otherContract.call(&quot;f&quot;)</span></code>.</li>
<li>Solidity now implements C99-style scoping rules for function local
variables, that is, variables can only be used after they have been
declared and only in the same or nested scopes. Variables declared in the
initialization block of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop are valid at any point inside the
loop.</li>
</ul>
</div>
<div class="section" id="explicitness-requirements">
<h4>Explicitness Requirements<a class="headerlink" href="#explicitness-requirements" title="Permalink to this headline">¶</a></h4>
<p>This section lists changes where the code now needs to be more explicit.
For most of the topics the compiler will provide suggestions.</p>
<ul class="simple">
<li>Explicit function visibility is now mandatory.  Add <code class="docutils literal notranslate"><span class="pre">public</span></code> to every
function and constructor, and <code class="docutils literal notranslate"><span class="pre">external</span></code> to every fallback or interface
function that does not specify its visibility already.</li>
<li>Explicit data location for all variables of struct, array or mapping types is
now mandatory. This is also applied to function parameters and return
variables.  For example, change <code class="docutils literal notranslate"><span class="pre">uint[]</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">m_x</span></code> to <code class="docutils literal notranslate"><span class="pre">uint[]</span> <span class="pre">storage</span> <span class="pre">x</span> <span class="pre">=</span>
<span class="pre">m_x</span></code>, and <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(uint[][]</span> <span class="pre">x)</span></code> to <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">f(uint[][]</span> <span class="pre">memory</span> <span class="pre">x)</span></code>
where <code class="docutils literal notranslate"><span class="pre">memory</span></code> is the data location and might be replaced by <code class="docutils literal notranslate"><span class="pre">storage</span></code> or
<code class="docutils literal notranslate"><span class="pre">calldata</span></code> accordingly.  Note that <code class="docutils literal notranslate"><span class="pre">external</span></code> functions require
parameters with a data location of <code class="docutils literal notranslate"><span class="pre">calldata</span></code>.</li>
<li>Contract types do not include <code class="docutils literal notranslate"><span class="pre">address</span></code> members anymore in
order to separate the namespaces.  Therefore, it is now necessary to
explicitly convert values of contract type to addresses before using an
<code class="docutils literal notranslate"><span class="pre">address</span></code> member.  Example: if <code class="docutils literal notranslate"><span class="pre">c</span></code> is a contract, change
<code class="docutils literal notranslate"><span class="pre">c.transfer(...)</span></code> to <code class="docutils literal notranslate"><span class="pre">address(c).transfer(...)</span></code>,
and <code class="docutils literal notranslate"><span class="pre">c.balance</span></code> to <code class="docutils literal notranslate"><span class="pre">address(c).balance</span></code>.</li>
<li>Explicit conversions between unrelated contract types are now disallowed. You can only
convert from a contract type to one of its base or ancestor types. If you are sure that
a contract is compatible with the contract type you want to convert to, although it does not
inherit from it, you can work around this by converting to <code class="docutils literal notranslate"><span class="pre">address</span></code> first.
Example: if <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> are contract types, <code class="docutils literal notranslate"><span class="pre">B</span></code> does not inherit from <code class="docutils literal notranslate"><span class="pre">A</span></code> and
<code class="docutils literal notranslate"><span class="pre">b</span></code> is a contract of type <code class="docutils literal notranslate"><span class="pre">B</span></code>, you can still convert <code class="docutils literal notranslate"><span class="pre">b</span></code> to type <code class="docutils literal notranslate"><span class="pre">A</span></code> using <code class="docutils literal notranslate"><span class="pre">A(address(b))</span></code>.
Note that you still need to watch out for matching payable fallback functions, as explained below.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">address</span></code> type  was split into <code class="docutils literal notranslate"><span class="pre">address</span></code> and <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>,
where only <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> provides the <code class="docutils literal notranslate"><span class="pre">transfer</span></code> function.  An
<code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> can be directly converted to an <code class="docutils literal notranslate"><span class="pre">address</span></code>, but the
other way around is not allowed. Converting <code class="docutils literal notranslate"><span class="pre">address</span></code> to <code class="docutils literal notranslate"><span class="pre">address</span>
<span class="pre">payable</span></code> is possible via conversion through <code class="docutils literal notranslate"><span class="pre">uint160</span></code>. If <code class="docutils literal notranslate"><span class="pre">c</span></code> is a
contract, <code class="docutils literal notranslate"><span class="pre">address(c)</span></code> results in <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code> only if <code class="docutils literal notranslate"><span class="pre">c</span></code> has a
payable fallback function. If you use the <a class="reference internal" href="index.html#withdrawal-pattern"><span class="std std-ref">withdraw pattern</span></a>,
you most likely do not have to change your code because <code class="docutils literal notranslate"><span class="pre">transfer</span></code>
is only used on <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> instead of stored addresses and <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code>
is an <code class="docutils literal notranslate"><span class="pre">address</span> <span class="pre">payable</span></code>.</li>
<li>Conversions between <code class="docutils literal notranslate"><span class="pre">bytesX</span></code> and <code class="docutils literal notranslate"><span class="pre">uintY</span></code> of different size are now
disallowed due to <code class="docutils literal notranslate"><span class="pre">bytesX</span></code> padding on the right and <code class="docutils literal notranslate"><span class="pre">uintY</span></code> padding on
the left which may cause unexpected conversion results.  The size must now be
adjusted within the type before the conversion.  For example, you can convert
a <code class="docutils literal notranslate"><span class="pre">bytes4</span></code> (4 bytes) to a <code class="docutils literal notranslate"><span class="pre">uint64</span></code> (8 bytes) by first converting the
<code class="docutils literal notranslate"><span class="pre">bytes4</span></code> variable to <code class="docutils literal notranslate"><span class="pre">bytes8</span></code> and then to <code class="docutils literal notranslate"><span class="pre">uint64</span></code>. You get the
opposite padding when converting through <code class="docutils literal notranslate"><span class="pre">uint32</span></code>.</li>
<li>Using <code class="docutils literal notranslate"><span class="pre">msg.value</span></code> in non-payable functions (or introducing it via a
modifier) is disallowed as a security feature. Turn the function into
<code class="docutils literal notranslate"><span class="pre">payable</span></code> or create a new internal function for the program logic that
uses <code class="docutils literal notranslate"><span class="pre">msg.value</span></code>.</li>
<li>For clarity reasons, the command line interface now requires <code class="docutils literal notranslate"><span class="pre">-</span></code> if the
standard input is used as source.</li>
</ul>
</div>
<div class="section" id="deprecated-elements">
<h4>Deprecated Elements<a class="headerlink" href="#deprecated-elements" title="Permalink to this headline">¶</a></h4>
<p>This section lists changes that deprecate prior features or syntax.  Note that
many of these changes were already enabled in the experimental mode
<code class="docutils literal notranslate"><span class="pre">v0.5.0</span></code>.</p>
<div class="section" id="command-line-and-json-interfaces">
<h5>Command Line and JSON Interfaces<a class="headerlink" href="#command-line-and-json-interfaces" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The command line option <code class="docutils literal notranslate"><span class="pre">--formal</span></code> (used to generate Why3 output for
further formal verification) was deprecated and is now removed.  A new
formal verification module, the SMTChecker, is enabled via <code class="docutils literal notranslate"><span class="pre">pragma</span>
<span class="pre">experimental</span> <span class="pre">SMTChecker;</span></code>.</li>
<li>The command line option <code class="docutils literal notranslate"><span class="pre">--julia</span></code> was renamed to <code class="docutils literal notranslate"><span class="pre">--yul</span></code> due to the
renaming of the intermediate language <code class="docutils literal notranslate"><span class="pre">Julia</span></code> to <code class="docutils literal notranslate"><span class="pre">Yul</span></code>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">--clone-bin</span></code> and <code class="docutils literal notranslate"><span class="pre">--combined-json</span> <span class="pre">clone-bin</span></code> command line options
were removed.</li>
<li>Remappings with empty prefix are disallowed.</li>
<li>The JSON AST fields <code class="docutils literal notranslate"><span class="pre">constant</span></code> and <code class="docutils literal notranslate"><span class="pre">payable</span></code> were removed. The
information is now present in the <code class="docutils literal notranslate"><span class="pre">stateMutability</span></code> field.</li>
<li>The JSON AST field <code class="docutils literal notranslate"><span class="pre">isConstructor</span></code> of the <code class="docutils literal notranslate"><span class="pre">FunctionDefinition</span></code>
node was replaced by a field called <code class="docutils literal notranslate"><span class="pre">kind</span></code> which can have the
value <code class="docutils literal notranslate"><span class="pre">&quot;constructor&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;fallback&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;function&quot;</span></code>.</li>
<li>In unlinked binary hex files, library address placeholders are now
the first 36 hex characters of the keccak256 hash of the fully qualified
library name, surrounded by <code class="docutils literal notranslate"><span class="pre">$...$</span></code>. Previously,
just the fully qualified library name was used.
This reduces the chances of collisions, especially when long paths are used.
Binary files now also contain a list of mappings from these placeholders
to the fully qualified names.</li>
</ul>
</div>
<div class="section" id="constructors">
<h5>Constructors<a class="headerlink" href="#constructors" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Constructors must now be defined using the <code class="docutils literal notranslate"><span class="pre">constructor</span></code> keyword.</li>
<li>Calling base constructors without parentheses is now disallowed.</li>
<li>Specifying base constructor arguments multiple times in the same inheritance
hierarchy is now disallowed.</li>
<li>Calling a constructor with arguments but with wrong argument count is now
disallowed.  If you only want to specify an inheritance relation without
giving arguments, do not provide parentheses at all.</li>
</ul>
</div>
<div class="section" id="functions">
<h5>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Function <code class="docutils literal notranslate"><span class="pre">callcode</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">delegatecall</span></code>). It
is still possible to use it via inline assembly.</li>
<li><code class="docutils literal notranslate"><span class="pre">suicide</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">selfdestruct</span></code>).</li>
<li><code class="docutils literal notranslate"><span class="pre">sha3</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">keccak256</span></code>).</li>
<li><code class="docutils literal notranslate"><span class="pre">throw</span></code> is now disallowed (in favor of <code class="docutils literal notranslate"><span class="pre">revert</span></code>, <code class="docutils literal notranslate"><span class="pre">require</span></code> and
<code class="docutils literal notranslate"><span class="pre">assert</span></code>).</li>
</ul>
</div>
<div class="section" id="conversions">
<h5>Conversions<a class="headerlink" href="#conversions" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Explicit and implicit conversions from decimal literals to <code class="docutils literal notranslate"><span class="pre">bytesXX</span></code> types
is now disallowed.</li>
<li>Explicit and implicit conversions from hex literals to <code class="docutils literal notranslate"><span class="pre">bytesXX</span></code> types
of different size is now disallowed.</li>
</ul>
</div>
<div class="section" id="literals-and-suffixes">
<h5>Literals and Suffixes<a class="headerlink" href="#literals-and-suffixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The unit denomination <code class="docutils literal notranslate"><span class="pre">years</span></code> is now disallowed due to complications and
confusions about leap years.</li>
<li>Trailing dots that are not followed by a number are now disallowed.</li>
<li>Combining hex numbers with unit denominations (e.g. <code class="docutils literal notranslate"><span class="pre">0x1e</span> <span class="pre">wei</span></code>) is now
disallowed.</li>
<li>The prefix <code class="docutils literal notranslate"><span class="pre">0X</span></code> for hex numbers is disallowed, only <code class="docutils literal notranslate"><span class="pre">0x</span></code> is possible.</li>
</ul>
</div>
<div class="section" id="variables">
<h5>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Declaring empty structs is now disallowed for clarity.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">var</span></code> keyword is now disallowed to favor explicitness.</li>
<li>Assignments between tuples with different number of components is now
disallowed.</li>
<li>Values for constants that are not compile-time constants are disallowed.</li>
<li>Multi-variable declarations with mismatching number of values are now
disallowed.</li>
<li>Uninitialized storage variables are now disallowed.</li>
<li>Empty tuple components are now disallowed.</li>
<li>Detecting cyclic dependencies in variables and structs is limited in
recursion to 256.</li>
<li>Fixed-size arrays with a length of zero are now disallowed.</li>
</ul>
</div>
<div class="section" id="syntax">
<h5>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Using <code class="docutils literal notranslate"><span class="pre">constant</span></code> as function state mutability modifier is now disallowed.</li>
<li>Boolean expressions cannot use arithmetic operations.</li>
<li>The unary <code class="docutils literal notranslate"><span class="pre">+</span></code> operator is now disallowed.</li>
<li>Literals cannot anymore be used with <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code> without prior
conversion to an explicit type.</li>
<li>Empty return statements for functions with one or more return values are now
disallowed.</li>
<li>The “loose assembly” syntax is now disallowed entirely, that is, jump labels,
jumps and non-functional instructions cannot be used anymore. Use the new
<code class="docutils literal notranslate"><span class="pre">while</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code> and <code class="docutils literal notranslate"><span class="pre">if</span></code> constructs instead.</li>
<li>Functions without implementation cannot use modifiers anymore.</li>
<li>Function types with named return values are now disallowed.</li>
<li>Single statement variable declarations inside if/while/for bodies that are
not blocks are now disallowed.</li>
<li>New keywords: <code class="docutils literal notranslate"><span class="pre">calldata</span></code> and <code class="docutils literal notranslate"><span class="pre">constructor</span></code>.</li>
<li>New reserved keywords: <code class="docutils literal notranslate"><span class="pre">alias</span></code>, <code class="docutils literal notranslate"><span class="pre">apply</span></code>, <code class="docutils literal notranslate"><span class="pre">auto</span></code>, <code class="docutils literal notranslate"><span class="pre">copyof</span></code>,
<code class="docutils literal notranslate"><span class="pre">define</span></code>, <code class="docutils literal notranslate"><span class="pre">immutable</span></code>, <code class="docutils literal notranslate"><span class="pre">implements</span></code>, <code class="docutils literal notranslate"><span class="pre">macro</span></code>, <code class="docutils literal notranslate"><span class="pre">mutable</span></code>,
<code class="docutils literal notranslate"><span class="pre">override</span></code>, <code class="docutils literal notranslate"><span class="pre">partial</span></code>, <code class="docutils literal notranslate"><span class="pre">promise</span></code>, <code class="docutils literal notranslate"><span class="pre">reference</span></code>, <code class="docutils literal notranslate"><span class="pre">sealed</span></code>,
<code class="docutils literal notranslate"><span class="pre">sizeof</span></code>, <code class="docutils literal notranslate"><span class="pre">supports</span></code>, <code class="docutils literal notranslate"><span class="pre">typedef</span></code> and <code class="docutils literal notranslate"><span class="pre">unchecked</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="interoperability-with-older-contracts">
<span id="interoperability"></span><h4>Interoperability With Older Contracts<a class="headerlink" href="#interoperability-with-older-contracts" title="Permalink to this headline">¶</a></h4>
<p>It is still possible to interface with contracts written for Solidity versions prior to
v0.5.0 (or the other way around) by defining interfaces for them.
Consider you have the following pre-0.5.0 contract already deployed:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// This will not compile with the current version of the compiler</span>
<span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">25</span><span class="p">;</span>
<span class="kd">contract</span> <span class="n">OldContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//...</span>
   <span class="p">}</span>
   <span class="kd">function</span> <span class="n">anotherOldFunction</span><span class="p">()</span> <span class="kr">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//...</span>
   <span class="p">}</span>
   <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will no longer compile with Solidity v0.5.0. However, you can define a compatible interface for it:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kd">interface</span> <span class="n">OldContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">anotherOldFunction</span><span class="p">()</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that we did not declare <code class="docutils literal notranslate"><span class="pre">anotherOldFunction</span></code> to be <code class="docutils literal notranslate"><span class="pre">view</span></code>, despite it being declared <code class="docutils literal notranslate"><span class="pre">constant</span></code> in the original
contract. This is due to the fact that starting with Solidity v0.5.0 <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> is used to call <code class="docutils literal notranslate"><span class="pre">view</span></code> functions.
Prior to v0.5.0 the <code class="docutils literal notranslate"><span class="pre">constant</span></code> keyword was not enforced, so calling a function declared <code class="docutils literal notranslate"><span class="pre">constant</span></code> with <code class="docutils literal notranslate"><span class="pre">staticcall</span></code>
may still revert, since the <code class="docutils literal notranslate"><span class="pre">constant</span></code> function may still attempt to modify storage. Consequently, when defining an
interface for older contracts, you should only use <code class="docutils literal notranslate"><span class="pre">view</span></code> in place of <code class="docutils literal notranslate"><span class="pre">constant</span></code> in case you are absolutely sure that
the function will work with <code class="docutils literal notranslate"><span class="pre">staticcall</span></code>.</p>
<p>Given the interface defined above, you can now easily use the already deployed pre-0.5.0 contract:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">interface</span> <span class="n">OldContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someOldFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">anotherOldFunction</span><span class="p">()</span> <span class="kr">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">NewContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">doSomething</span><span class="p">(</span><span class="n">OldContract</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">a</span><span class="p">.</span><span class="n">someOldFunction</span><span class="p">(</span><span class="mh">0x42</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">anotherOldFunction</span><span class="p">();</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Similarly, pre-0.5.0 libraries can be used by defining the functions of the library without implementation and
supplying the address of the pre-0.5.0 library during linking (see <a class="reference internal" href="index.html#commandline-compiler"><span class="std std-ref">Using the Commandline Compiler</span></a> for how to use the
commandline compiler for linking):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">OldLibrary</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">someFunction</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">NewContract</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint8</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">OldLibrary</span><span class="p">.</span><span class="n">someFunction</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>The following example shows a contract and its updated version for Solidity
v0.5.0 with some of the changes listed in this section.</p>
<p>Old version:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// This will not compile</span>
<span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">25</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">OtherContract</span> <span class="p">{</span>
   <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="kr">external</span> <span class="p">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">external</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">Old</span> <span class="p">{</span>
   <span class="n">OtherContract</span> <span class="n">other</span><span class="p">;</span>
   <span class="kt">uint</span> <span class="n">myNumber</span><span class="p">;</span>

   <span class="c1">// Function mutability not provided, not an error.</span>
   <span class="kd">function</span> <span class="n">someInteger</span><span class="p">()</span> <span class="kr">internal</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

   <span class="c1">// Function visibility not provided, not an error.</span>
   <span class="c1">// Function mutability not provided, not an error.</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Var is fine in this version.</span>
      <span class="kd">var</span> <span class="n">z</span> <span class="o">=</span> <span class="n">someInteger</span><span class="p">();</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">z</span><span class="p">;</span>
      <span class="c1">// Throw is fine in this version.</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
         <span class="k">throw</span><span class="p">;</span>
      <span class="kt">bytes</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
      <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
      <span class="c1">// y == -1 (wrong, should be -2)</span>
      <span class="k">do</span> <span class="p">{</span>
         <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
         <span class="c1">// &#39;Continue&#39; causes an infinite loop.</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">);</span>
      <span class="c1">// Call returns only a Bool.</span>
      <span class="kt">bool</span> <span class="n">success</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">other</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span>
         <span class="nf">revert</span><span class="p">();</span>
      <span class="k">else</span> <span class="p">{</span>
         <span class="c1">// Local variables could be declared after their use.</span>
         <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="c1">// No need for an explicit data location for &#39;arr&#39;</span>
   <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="n">arr</span><span class="p">,</span> <span class="kt">bytes8</span> <span class="n">x</span><span class="p">,</span> <span class="n">OtherContract</span> <span class="n">otherContract</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
      <span class="n">otherContract</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>

      <span class="c1">// Since uint32 (4 bytes) is smaller than bytes8 (8 bytes),</span>
      <span class="c1">// the first 4 bytes of x will be lost. This might lead to</span>
      <span class="c1">// unexpected behavior since bytesX are right padded.</span>
      <span class="kt">uint32</span> <span class="n">y</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
      <span class="n">myNumber</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">+</span> <span class="nb">msg.value</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>New version:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">OtherContract</span> <span class="p">{</span>
   <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">y</span><span class="p">)</span> <span class="kr">external</span> <span class="p">{</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="kd">function</span><span class="p">()</span> <span class="kr">payable</span> <span class="kr">external</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">New</span> <span class="p">{</span>
   <span class="n">OtherContract</span> <span class="n">other</span><span class="p">;</span>
   <span class="kt">uint</span> <span class="n">myNumber</span><span class="p">;</span>

   <span class="c1">// Function mutability must be specified.</span>
   <span class="kd">function</span> <span class="n">someInteger</span><span class="p">()</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>

   <span class="c1">// Function visibility must be specified.</span>
   <span class="c1">// Function mutability must be specified.</span>
   <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// The type must now be explicitly given.</span>
      <span class="kt">uint</span> <span class="n">z</span> <span class="o">=</span> <span class="n">someInteger</span><span class="p">();</span>
      <span class="n">x</span> <span class="o">+=</span> <span class="n">z</span><span class="p">;</span>
      <span class="c1">// Throw is now disallowed.</span>
      <span class="nf">require</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
      <span class="c1">// y == -2 (correct)</span>
      <span class="k">do</span> <span class="p">{</span>
         <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
         <span class="c1">// &#39;Continue&#39; jumps to the condition below.</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">);</span>

      <span class="c1">// Call returns (bool, bytes).</span>
      <span class="c1">// Data location must be specified.</span>
      <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">other</span><span class="p">).</span><span class="nf">call</span><span class="p">(</span><span class="s">&quot;f&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span>
         <span class="nf">revert</span><span class="p">();</span>
      <span class="k">return</span> <span class="n">data</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kn">using</span> <span class="n">address_make_payable</span> <span class="k">for</span> <span class="kt">address</span><span class="p">;</span>
   <span class="c1">// Data location for &#39;arr&#39; must be specified</span>
   <span class="kd">function</span> <span class="n">g</span><span class="p">(</span><span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span> <span class="n">arr</span><span class="p">,</span> <span class="kt">bytes8</span> <span class="n">x</span><span class="p">,</span> <span class="n">OtherContract</span> <span class="n">otherContract</span><span class="p">,</span> <span class="kt">address</span> <span class="n">unknownContract</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
      <span class="c1">// &#39;otherContract.transfer&#39; is not provided.</span>
      <span class="c1">// Since the code of &#39;OtherContract&#39; is known and has the fallback</span>
      <span class="c1">// function, address(otherContract) has type &#39;address payable&#39;.</span>
      <span class="kt">address</span><span class="p">(</span><span class="n">otherContract</span><span class="p">).</span><span class="nf">transfer</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">);</span>

      <span class="c1">// &#39;unknownContract.transfer&#39; is not provided.</span>
      <span class="c1">// &#39;address(unknownContract).transfer&#39; is not provided</span>
      <span class="c1">// since &#39;address(unknownContract)&#39; is not &#39;address payable&#39;.</span>
      <span class="c1">// If the function takes an &#39;address&#39; which you want to send</span>
      <span class="c1">// funds to, you can convert it to &#39;address payable&#39; via &#39;uint160&#39;.</span>
      <span class="c1">// Note: This is not recommended and the explicit type</span>
      <span class="c1">// &#39;address payable&#39; should be used whenever possible.</span>
      <span class="c1">// To increase clarity, we suggest the use of a library for</span>
      <span class="c1">// the conversion (provided after the contract in this example).</span>
      <span class="kt">address</span> <span class="kr">payable</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">unknownContract</span><span class="p">.</span><span class="n">make_payable</span><span class="p">();</span>
      <span class="nf">require</span><span class="p">(</span><span class="n">addr</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="mi">1</span> <span class="kc">ether</span><span class="p">));</span>

      <span class="c1">// Since uint32 (4 bytes) is smaller than bytes8 (8 bytes),</span>
      <span class="c1">// the conversion is not allowed.</span>
      <span class="c1">// We need to convert to a common size first:</span>
      <span class="kt">bytes4</span> <span class="n">x4</span> <span class="o">=</span> <span class="kt">bytes4</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="c1">// Padding happens on the right</span>
      <span class="kt">uint32</span> <span class="n">y</span> <span class="o">=</span> <span class="kt">uint32</span><span class="p">(</span><span class="n">x4</span><span class="p">);</span> <span class="c1">// Conversion is consistent</span>
      <span class="c1">// &#39;msg.value&#39; cannot be used in a &#39;non-payable&#39; function.</span>
      <span class="c1">// We need to make the function payable</span>
      <span class="n">myNumber</span> <span class="o">+=</span> <span class="n">y</span> <span class="o">+</span> <span class="nb">msg.value</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// We can define a library for explicitly converting ``address``</span>
<span class="c1">// to ``address payable`` as a workaround.</span>
<span class="kd">library</span> <span class="n">address_make_payable</span> <span class="p">{</span>
   <span class="kd">function</span> <span class="n">make_payable</span><span class="p">(</span><span class="kt">address</span> <span class="n">x</span><span class="p">)</span> <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kt">address</span><span class="p">(</span><span class="kt">uint160</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-security-considerations"></span><div class="section" id="security-considerations">
<span id="id1"></span><h2>Security Considerations<a class="headerlink" href="#security-considerations" title="Permalink to this headline">¶</a></h2>
<p>While it is usually quite easy to build software that works as expected,
it is much harder to check that nobody can use it in a way that was <strong>not</strong> anticipated.</p>
<p>In Solidity, this is even more important because you can use smart contracts
to handle tokens or, possibly, even more valuable things. Furthermore, every
execution of a smart contract happens in public and, in addition to that,
the source code is often available.</p>
<p>Of course you always have to consider how much is at stake:
You can compare a smart contract with a web service that is open to the
public (and thus, also to malicious actors) and perhaps even open source.
If you only store your grocery list on that web service, you might not have
to take too much care, but if you manage your bank account using that web service,
you should be more careful.</p>
<p>This section will list some pitfalls and general security recommendations but
can, of course, never be complete. Also, keep in mind that even if your
smart contract code is bug-free, the compiler or the platform itself might
have a bug. A list of some publicly known security-relevant bugs of the compiler
can be found in the
<a class="reference internal" href="index.html#known-bugs"><span class="std std-ref">list of known bugs</span></a>, which is also machine-readable. Note
that there is a bug bounty program that covers the code generator of the
Solidity compiler.</p>
<p>As always, with open source documentation, please help us extend this section
(especially, some examples would not hurt)!</p>
<div class="section" id="pitfalls">
<h3>Pitfalls<a class="headerlink" href="#pitfalls" title="Permalink to this headline">¶</a></h3>
<div class="section" id="private-information-and-randomness">
<h4>Private Information and Randomness<a class="headerlink" href="#private-information-and-randomness" title="Permalink to this headline">¶</a></h4>
<p>Everything you use in a smart contract is publicly visible, even
local variables and state variables marked <code class="docutils literal notranslate"><span class="pre">private</span></code>.</p>
<p>Using random numbers in smart contracts is quite tricky if you do not want
miners to be able to cheat.</p>
</div>
<div class="section" id="re-entrancy">
<h4>Re-Entrancy<a class="headerlink" href="#re-entrancy" title="Permalink to this headline">¶</a></h4>
<p>Any interaction from a contract (A) with another contract (B) and any transfer
of Ether hands over control to that contract (B). This makes it possible for B
to call back into A before this interaction is completed. To give an example,
the following code contains a bug (it is just a snippet and not a
complete contract):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="n">Fund</span> <span class="p">{</span>
    <span class="c1">/// Mapping of ether shares of the contract.</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">shares</span><span class="p">;</span>
    <span class="c1">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.sender</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]))</span>
            <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The problem is not too serious here because of the limited gas as part
of <code class="docutils literal notranslate"><span class="pre">send</span></code>, but it still exposes a weakness: Ether transfer can always
include code execution, so the recipient could be a contract that calls
back into <code class="docutils literal notranslate"><span class="pre">withdraw</span></code>. This would let it get multiple refunds and
basically retrieve all the Ether in the contract. In particular, the
following contract will allow an attacker to refund multiple times
as it uses <code class="docutils literal notranslate"><span class="pre">call</span></code> which forwards all remaining gas by default:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="n">Fund</span> <span class="p">{</span>
    <span class="c1">/// Mapping of ether shares of the contract.</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">shares</span><span class="p">;</span>
    <span class="c1">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">call</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">])(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span>
            <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To avoid re-entrancy, you can use the Checks-Effects-Interactions pattern as
outlined further below:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">11</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Fund</span> <span class="p">{</span>
    <span class="c1">/// Mapping of ether shares of the contract.</span>
    <span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">shares</span><span class="p">;</span>
    <span class="c1">/// Withdraw your share.</span>
    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">share</span> <span class="o">=</span> <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="n">shares</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">share</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that re-entrancy is not only an effect of Ether transfer but of any
function call on another contract. Furthermore, you also have to take
multi-contract situations into account. A called contract could modify the
state of another contract you depend on.</p>
</div>
<div class="section" id="gas-limit-and-loops">
<h4>Gas Limit and Loops<a class="headerlink" href="#gas-limit-and-loops" title="Permalink to this headline">¶</a></h4>
<p>Loops that do not have a fixed number of iterations, for example, loops that depend on storage values, have to be used carefully:
Due to the block gas limit, transactions can only consume a certain amount of gas. Either explicitly or just due to
normal operation, the number of iterations in a loop can grow beyond the block gas limit which can cause the complete
contract to be stalled at a certain point. This may not apply to <code class="docutils literal notranslate"><span class="pre">view</span></code> functions that are only executed
to read data from the blockchain. Still, such functions may be called by other contracts as part of on-chain operations
and stall those. Please be explicit about such cases in the documentation of your contracts.</p>
</div>
<div class="section" id="sending-and-receiving-ether">
<h4>Sending and Receiving Ether<a class="headerlink" href="#sending-and-receiving-ether" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Neither contracts nor “external accounts” are currently able to prevent that someone sends them Ether.
Contracts can react on and reject a regular transfer, but there are ways
to move Ether without creating a message call. One way is to simply “mine to”
the contract address and the second way is using <code class="docutils literal notranslate"><span class="pre">selfdestruct(x)</span></code>.</li>
<li>If a contract receives Ether (without a function being called), the fallback function is executed.
If it does not have a fallback function, the Ether will be rejected (by throwing an exception).
During the execution of the fallback function, the contract can only rely
on the “gas stipend” it is passed (2300 gas) being available to it at that time. This stipend is not enough to modify storage
(do not take this for granted though, the stipend might change with future hard forks).
To be sure that your contract can receive Ether in that way, check the gas requirements of the fallback function
(for example in the “details” section in Remix).</li>
<li>There is a way to forward more gas to the receiving contract using
<code class="docutils literal notranslate"><span class="pre">addr.call.value(x)(&quot;&quot;)</span></code>. This is essentially the same as <code class="docutils literal notranslate"><span class="pre">addr.transfer(x)</span></code>,
only that it forwards all remaining gas and opens up the ability for the
recipient to perform more expensive actions (and it returns a failure code
instead of automatically propagating the error). This might include calling back
into the sending contract or other state changes you might not have thought of.
So it allows for great flexibility for honest users but also for malicious actors.</li>
<li>If you want to send Ether using <code class="docutils literal notranslate"><span class="pre">address.transfer</span></code>, there are certain details to be aware of:<ol class="arabic">
<li>If the recipient is a contract, it causes its fallback function to be executed which can, in turn, call back the sending contract.</li>
<li>Sending Ether can fail due to the call depth going above 1024. Since the caller is in total control of the call
depth, they can force the transfer to fail; take this possibility into account or use <code class="docutils literal notranslate"><span class="pre">send</span></code> and make sure to always check its return value. Better yet,
write your contract using a pattern where the recipient can withdraw Ether instead.</li>
<li>Sending Ether can also fail because the execution of the recipient contract
requires more than the allotted amount of gas (explicitly by using <code class="docutils literal notranslate"><span class="pre">require</span></code>,
<code class="docutils literal notranslate"><span class="pre">assert</span></code>, <code class="docutils literal notranslate"><span class="pre">revert</span></code>, <code class="docutils literal notranslate"><span class="pre">throw</span></code> or
because the operation is just too expensive) - it “runs out of gas” (OOG).
If you use <code class="docutils literal notranslate"><span class="pre">transfer</span></code> or <code class="docutils literal notranslate"><span class="pre">send</span></code> with a return value check, this might provide a
means for the recipient to block progress in the sending contract. Again, the best practice here is to use
a <a class="reference internal" href="index.html#withdrawal-pattern"><span class="std std-ref">“withdraw” pattern instead of a “send” pattern</span></a>.</li>
</ol>
</li>
</ul>
</div>
<div class="section" id="callstack-depth">
<h4>Callstack Depth<a class="headerlink" href="#callstack-depth" title="Permalink to this headline">¶</a></h4>
<p>External function calls can fail any time because they exceed the maximum
call stack of 1024. In such situations, Solidity throws an exception.
Malicious actors might be able to force the call stack to a high value
before they interact with your contract.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">.send()</span></code> does <strong>not</strong> throw an exception if the call stack is
depleted but rather returns <code class="docutils literal notranslate"><span class="pre">false</span></code> in that case. The low-level functions
<code class="docutils literal notranslate"><span class="pre">.call()</span></code>, <code class="docutils literal notranslate"><span class="pre">.callcode()</span></code>, <code class="docutils literal notranslate"><span class="pre">.delegatecall()</span></code> and <code class="docutils literal notranslate"><span class="pre">.staticcall()</span></code> behave
in the same way.</p>
</div>
<div class="section" id="tx-origin">
<h4>tx.origin<a class="headerlink" href="#tx-origin" title="Permalink to this headline">¶</a></h4>
<p>Never use tx.origin for authorization. Let’s say you have a wallet contract like this:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// THIS CONTRACT CONTAINS A BUG - DO NOT USE</span>
<span class="kd">contract</span> <span class="n">TxUserWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nb">tx.origin</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
        <span class="n">dest</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now someone tricks you into sending ether to the address of this attack wallet:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">interface</span> <span class="n">TxUserWallet</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">transferTo</span><span class="p">(</span><span class="kt">address</span> <span class="kr">payable</span> <span class="n">dest</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount</span><span class="p">)</span> <span class="kr">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">TxAttackWallet</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
        <span class="n">TxUserWallet</span><span class="p">(</span><span class="nb">msg.sender</span><span class="p">).</span><span class="n">transferTo</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="nb">msg.sender</span><span class="p">.</span><span class="nb">balance</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If your wallet had checked <code class="docutils literal notranslate"><span class="pre">msg.sender</span></code> for authorization, it would get the address of the attack wallet, instead of the owner address. But by checking <code class="docutils literal notranslate"><span class="pre">tx.origin</span></code>, it gets the original address that kicked off the transaction, which is still the owner address. The attack wallet instantly drains all your funds.</p>
</div>
<div class="section" id="two-s-complement-underflows-overflows">
<span id="underflow-overflow"></span><h4>Two’s Complement / Underflows / Overflows<a class="headerlink" href="#two-s-complement-underflows-overflows" title="Permalink to this headline">¶</a></h4>
<p>As in many programming languages, Solidity’s integer types are not actually integers.
They resemble integers when the values are small, but behave differently if the numbers are larger.
For example, the following is true: <code class="docutils literal notranslate"><span class="pre">uint8(255)</span> <span class="pre">+</span> <span class="pre">uint8(1)</span> <span class="pre">==</span> <span class="pre">0</span></code>. This situation is called
an <em>overflow</em>. It occurs when an operation is performed that requires a fixed size variable
to store a number (or piece of data) that is outside the range of the variable’s data type.
An <em>underflow</em> is the converse situation: <code class="docutils literal notranslate"><span class="pre">uint8(0)</span> <span class="pre">-</span> <span class="pre">uint8(1)</span> <span class="pre">==</span> <span class="pre">255</span></code>.</p>
<p>In general, read about the limits of two’s complement representation, which even has some
more special edge cases for signed numbers.</p>
<p>Try to use <code class="docutils literal notranslate"><span class="pre">require</span></code> to limit the size of inputs to a reasonable range and use the
<a class="reference internal" href="index.html#smt-checker"><span class="std std-ref">SMT checker</span></a> to find potential overflows, or
use a library like
<a class="reference external" href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol">SafeMath</a>
if you want all overflows to cause a revert.</p>
<p>Code such as <code class="docutils literal notranslate"><span class="pre">require((balanceOf[_to]</span> <span class="pre">+</span> <span class="pre">_value)</span> <span class="pre">&gt;=</span> <span class="pre">balanceOf[_to])</span></code> can also help you check if values are what you expect.</p>
</div>
<div class="section" id="minor-details">
<h4>Minor Details<a class="headerlink" href="#minor-details" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Types that do not occupy the full 32 bytes might contain “dirty higher order bits”.
This is especially important if you access <code class="docutils literal notranslate"><span class="pre">msg.data</span></code> - it poses a malleability risk:
You can craft transactions that call a function <code class="docutils literal notranslate"><span class="pre">f(uint8</span> <span class="pre">x)</span></code> with a raw byte argument
of <code class="docutils literal notranslate"><span class="pre">0xff000001</span></code> and with <code class="docutils literal notranslate"><span class="pre">0x00000001</span></code>. Both are fed to the contract and both will
look like the number <code class="docutils literal notranslate"><span class="pre">1</span></code> as far as <code class="docutils literal notranslate"><span class="pre">x</span></code> is concerned, but <code class="docutils literal notranslate"><span class="pre">msg.data</span></code> will
be different, so if you use <code class="docutils literal notranslate"><span class="pre">keccak256(msg.data)</span></code> for anything, you will get different results.</li>
</ul>
</div>
</div>
<div class="section" id="recommendations">
<h3>Recommendations<a class="headerlink" href="#recommendations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="take-warnings-seriously">
<h4>Take Warnings Seriously<a class="headerlink" href="#take-warnings-seriously" title="Permalink to this headline">¶</a></h4>
<p>If the compiler warns you about something, you should better change it.
Even if you do not think that this particular warning has security
implications, there might be another issue buried beneath it.
Any compiler warning we issue can be silenced by slight changes to the
code.</p>
<p>Always use the latest version of the compiler to be notified about all recently
introduced warnings.</p>
</div>
<div class="section" id="restrict-the-amount-of-ether">
<h4>Restrict the Amount of Ether<a class="headerlink" href="#restrict-the-amount-of-ether" title="Permalink to this headline">¶</a></h4>
<p>Restrict the amount of Ether (or other tokens) that can be stored in a smart
contract. If your source code, the compiler or the platform has a bug, these
funds may be lost. If you want to limit your loss, limit the amount of Ether.</p>
</div>
<div class="section" id="keep-it-small-and-modular">
<h4>Keep it Small and Modular<a class="headerlink" href="#keep-it-small-and-modular" title="Permalink to this headline">¶</a></h4>
<p>Keep your contracts small and easily understandable. Single out unrelated
functionality in other contracts or into libraries. General recommendations
about source code quality of course apply: Limit the amount of local variables,
the length of functions and so on. Document your functions so that others
can see what your intention was and whether it is different than what the code does.</p>
</div>
<div class="section" id="use-the-checks-effects-interactions-pattern">
<h4>Use the Checks-Effects-Interactions Pattern<a class="headerlink" href="#use-the-checks-effects-interactions-pattern" title="Permalink to this headline">¶</a></h4>
<p>Most functions will first perform some checks (who called the function,
are the arguments in range, did they send enough Ether, does the person
have tokens, etc.). These checks should be done first.</p>
<p>As the second step, if all checks passed, effects to the state variables
of the current contract should be made. Interaction with other contracts
should be the very last step in any function.</p>
<p>Early contracts delayed some effects and waited for external function
calls to return in a non-error state. This is often a serious mistake
because of the re-entrancy problem explained above.</p>
<p>Note that, also, calls to known contracts might in turn cause calls to
unknown contracts, so it is probably better to just always apply this pattern.</p>
</div>
<div class="section" id="include-a-fail-safe-mode">
<h4>Include a Fail-Safe Mode<a class="headerlink" href="#include-a-fail-safe-mode" title="Permalink to this headline">¶</a></h4>
<p>While making your system fully decentralised will remove any intermediary,
it might be a good idea, especially for new code, to include some kind
of fail-safe mechanism:</p>
<p>You can add a function in your smart contract that performs some
self-checks like “Has any Ether leaked?”,
“Is the sum of the tokens equal to the balance of the contract?” or similar things.
Keep in mind that you cannot use too much gas for that, so help through off-chain
computations might be needed there.</p>
<p>If the self-check fails, the contract automatically switches into some kind
of “failsafe” mode, which, for example, disables most of the features, hands over
control to a fixed and trusted third party or just converts the contract into
a simple “give me back my money” contract.</p>
</div>
<div class="section" id="ask-for-peer-review">
<h4>Ask for Peer Review<a class="headerlink" href="#ask-for-peer-review" title="Permalink to this headline">¶</a></h4>
<p>The more people examine a piece of code, the more issues are found.
Asking people to review your code also helps as a cross-check to find out whether your code
is easy to understand - a very important criterion for good smart contracts.</p>
</div>
</div>
<div class="section" id="formal-verification">
<h3>Formal Verification<a class="headerlink" href="#formal-verification" title="Permalink to this headline">¶</a></h3>
<p>Using formal verification, it is possible to perform an automated mathematical
proof that your source code fulfills a certain formal specification.
The specification is still formal (just as the source code), but usually much
simpler.</p>
<p>Note that formal verification itself can only help you understand the
difference between what you did (the specification) and how you did it
(the actual implementation). You still need to check whether the specification
is what you wanted and that you did not miss any unintended effects of it.</p>
</div>
</div>
<span id="document-resources"></span><div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general">
<h3>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://ethereum.org">Ethereum</a></li>
<li><a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/Changelog.md">Changelog</a></li>
<li><a class="reference external" href="https://github.com/ethereum/solidity/">Source Code</a></li>
<li><a class="reference external" href="https://ethereum.stackexchange.com/">Ethereum Stackexchange</a></li>
<li><a class="reference external" href="https://gitter.im/ethereum/solidity/">Language Users Chat</a></li>
<li><a class="reference external" href="https://gitter.im/ethereum/solidity-dev/">Compiler Developers Chat</a></li>
</ul>
</div>
<div class="section" id="solidity-integrations">
<h3>Solidity Integrations<a class="headerlink" href="#solidity-integrations" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Generic:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://ethfiddle.com/">EthFiddle</a></dt>
<dd>Solidity IDE in the Browser. Write and share your Solidity code. Uses server-side components.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://remix.ethereum.org/">Remix</a></dt>
<dd>Browser-based IDE with integrated compiler and Solidity runtime environment without server-side components.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/duaraghav8/Solium/">Solium</a></dt>
<dd>Linter to identify and fix style and security issues in Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/protofire/solhint">Solhint</a></dt>
<dd>Solidity linter that provides security, style guide and best practice rules for smart contract validation.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://lab.superblocks.com/">Superblocks Lab</a></dt>
<dd>Browser-based IDE. Built-in browser-based VM and Metamask integration (one click deployment to Testnet/Mainnet).</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Atom:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/0mkara/etheratom">Etheratom</a></dt>
<dd>Plugin for the Atom editor that features syntax highlighting, compilation and a runtime environment (Backend node &amp; VM compatible).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://atom.io/packages/linter-solidity">Atom Solidity Linter</a></dt>
<dd>Plugin for the Atom editor that provides Solidity linting.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://atom.io/packages/linter-solium">Atom Solium Linter</a></dt>
<dd>Configurable Solidty linter for Atom using Solium as a base.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Eclipse:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://yakindu.github.io/solidity-ide/">YAKINDU Solidity Tools</a></dt>
<dd>Eclipse based IDE. Features context sensitive code completion and help, code navigation, syntax coloring, built in compiler, quick fixes and templates.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Emacs:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ethereum/emacs-solidity/">Emacs Solidity</a></dt>
<dd>Plugin for the Emacs editor providing syntax highlighting and compilation error reporting.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">IntelliJ:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://plugins.jetbrains.com/plugin/9475-intellij-solidity">IntelliJ IDEA plugin</a></dt>
<dd>Solidity plugin for IntelliJ IDEA (and all other JetBrains IDEs)</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Sublime:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://packagecontrol.io/packages/Ethereum/">Package for SublimeText - Solidity language syntax</a></dt>
<dd>Solidity syntax highlighting for SublimeText editor.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Vim:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/tomlion/vim-solidity/">Vim Solidity</a></dt>
<dd>Plugin for the Vim editor providing syntax highlighting.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/scrooloose/syntastic">Vim Syntastic</a></dt>
<dd>Plugin for the Vim editor providing compile checking.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Visual Studio Code:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="http://juan.blanco.ws/solidity-contracts-in-visual-studio-code/">Visual Studio Code extension</a></dt>
<dd>Solidity plugin for Microsoft Visual Studio Code that includes syntax highlighting and the Solidity compiler.</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Discontinued:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ethereum/mix/">Mix IDE</a></dt>
<dd>Qt based IDE for designing, debugging and testing solidity smart contracts.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://live.ether.camp/">Ethereum Studio</a></dt>
<dd>Specialized web IDE that also provides shell access to a complete Ethereum environment.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://visualstudiogallery.msdn.microsoft.com/96221853-33c4-4531-bdd5-d2ea5acc4799/">Visual Studio Extension</a></dt>
<dd>Solidity plugin for Microsoft Visual Studio that includes the Solidity compiler.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="solidity-tools">
<h3>Solidity Tools<a class="headerlink" href="#solidity-tools" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://dapp.tools/dapp/">Dapp</a></dt>
<dd>Build tool, package manager, and deployment assistant for Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/raineorshine/solidity-repl">Solidity REPL</a></dt>
<dd>Try Solidity instantly with a command-line Solidity console.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/raineorshine/solgraph">solgraph</a></dt>
<dd>Visualize Solidity control flow and highlight potential security vulnerabilities.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/DigixGlobal/doxity">Doxity</a></dt>
<dd>Documentation Generator for Solidity.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/Arachnid/evmdis">evmdis</a></dt>
<dd>EVM Disassembler that performs static analysis on the bytecode to provide a higher level of abstraction than raw EVM operations.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://gist.github.com/chriseth/8f533d133fa0c15b0d6eaf3ec502c82b">ABI to solidity interface converter</a></dt>
<dd>A script for generating contract interfaces from the ABI of a smart contract.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://securify.ch/">Securify</a></dt>
<dd>Fully automated online static analyzer for smart contracts, providing a security report based on vulnerability patterns.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ConsenSys/surya/">Sūrya</a></dt>
<dd>Utility tool for smart contract systems, offering a number of visual outputs and information about the contracts’ structure. Also supports querying the function call graph.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ethereum/evmlab/">EVM Lab</a></dt>
<dd>Rich tool package to interact with the EVM. Includes a VM, Etherchain API, and a trace-viewer with gas cost display.</dd>
</dl>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Information like variable names, comments, and source code formatting is lost in the compilation process and it is not possible to completely recover the original source code. Decompiling smart contracts to view the original source code might not be possible, or the end result that useful.</p>
</div>
</div>
<div class="section" id="third-party-solidity-parsers-and-grammars">
<h3>Third-Party Solidity Parsers and Grammars<a class="headerlink" href="#third-party-solidity-parsers-and-grammars" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/ConsenSys/solidity-parser">solidity-parser</a></dt>
<dd>Solidity parser for JavaScript</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a class="reference external" href="https://github.com/federicobond/solidity-antlr4">Solidity Grammar for ANTLR 4</a></dt>
<dd>Solidity grammar for the ANTLR 4 parser generator</dd>
</dl>
</li>
</ul>
</div>
</div>
<span id="document-using-the-compiler"></span><div class="section" id="using-the-compiler">
<h2>Using the compiler<a class="headerlink" href="#using-the-compiler" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-the-commandline-compiler">
<span id="commandline-compiler"></span><span id="index-0"></span><h3>Using the Commandline Compiler<a class="headerlink" href="#using-the-commandline-compiler" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section does not apply to <a class="reference internal" href="index.html#solcjs"><span class="std std-ref">solcjs</span></a>, not even if it is used in commandline mode.</p>
</div>
<p>One of the build targets of the Solidity repository is <code class="docutils literal notranslate"><span class="pre">solc</span></code>, the solidity commandline compiler.
Using <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--help</span></code> provides you with an explanation of all options. The compiler can produce various outputs, ranging from simple binaries and assembly over an abstract syntax tree (parse tree) to estimations of gas usage.
If you only want to compile a single file, you run it as <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code> and it will print the binary. If you want to get some of the more advanced output variants of <code class="docutils literal notranslate"><span class="pre">solc</span></code>, it is probably better to tell it to output everything to separate files using <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">-o</span> <span class="pre">outputDirectory</span> <span class="pre">--bin</span> <span class="pre">--ast</span> <span class="pre">--asm</span> <span class="pre">sourceFile.sol</span></code>.</p>
<p>Before you deploy your contract, activate the optimizer when compiling using <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--optimize</span> <span class="pre">--bin</span> <span class="pre">sourceFile.sol</span></code>.
By default, the optimizer will optimize the contract assuming it is called 200 times across its lifetime.
If you want the initial contract deployment to be cheaper and the later function executions to be more expensive,
set it to <code class="docutils literal notranslate"><span class="pre">--runs=1</span></code>. If you expect many transactions and do not care for higher deployment cost and
output size, set <code class="docutils literal notranslate"><span class="pre">--runs</span></code> to a high number.</p>
<p>The commandline compiler will automatically read imported files from the filesystem, but
it is also possible to provide path redirects using <code class="docutils literal notranslate"><span class="pre">prefix=path</span></code> in the following way:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">solc</span> <span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ethereum</span><span class="o">/</span><span class="n">dapp</span><span class="o">-</span><span class="n">bin</span><span class="o">/=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dapp</span><span class="o">-</span><span class="n">bin</span><span class="o">/</span> <span class="n">file</span><span class="p">.</span><span class="n">sol</span>
</pre></div>
</div>
<p>This essentially instructs the compiler to search for anything starting with
<code class="docutils literal notranslate"><span class="pre">github.com/ethereum/dapp-bin/</span></code> under <code class="docutils literal notranslate"><span class="pre">/usr/local/lib/dapp-bin</span></code>.
<code class="docutils literal notranslate"><span class="pre">solc</span></code> will not read files from the filesystem that lie outside of
the remapping targets and outside of the directories where explicitly specified source
files reside, so things like <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">&quot;/etc/passwd&quot;;</span></code> only work if you add <code class="docutils literal notranslate"><span class="pre">/=/</span></code> as a remapping.</p>
<p>An empty remapping prefix is not allowed.</p>
<p>If there are multiple matches due to remappings, the one with the longest common prefix is selected.</p>
<p>For security reasons the compiler has restrictions what directories it can access. Paths (and their subdirectories) of source files specified on the commandline and paths defined by remappings are allowed for import statements, but everything else is rejected. Additional paths (and their subdirectories) can be allowed via the <code class="docutils literal notranslate"><span class="pre">--allow-paths</span> <span class="pre">/sample/path,/another/sample/path</span></code> switch.</p>
<p>If your contracts use <a class="reference internal" href="index.html#libraries"><span class="std std-ref">libraries</span></a>, you will notice that the bytecode contains substrings of the form <code class="docutils literal notranslate"><span class="pre">__$53aea86b7d70b31448b230b20ae141a537$__</span></code>. These are placeholders for the actual library addresses.
The placeholder is a 34 character prefix of the hex encoding of the keccak256 hash of the fully qualified library name.
The bytecode file will also contain lines of the form <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">&lt;placeholder&gt;</span> <span class="pre">-&gt;</span> <span class="pre">&lt;fq</span> <span class="pre">library</span> <span class="pre">name&gt;</span></code> at the end to help
identify which libraries the placeholders represent. Note that the fully qualified library name
is the path of its source file and the library name separated by <code class="docutils literal notranslate"><span class="pre">:</span></code>.
You can use <code class="docutils literal notranslate"><span class="pre">solc</span></code> as a linker meaning that it will insert the library addresses for you at those points:</p>
<p>Either add <code class="docutils literal notranslate"><span class="pre">--libraries</span> <span class="pre">&quot;file.sol:Math:0x1234567890123456789012345678901234567890</span> <span class="pre">file.sol:Heap:0xabCD567890123456789012345678901234567890&quot;</span></code> to your command to provide an address for each library or store the string in a file (one library per line) and run <code class="docutils literal notranslate"><span class="pre">solc</span></code> using <code class="docutils literal notranslate"><span class="pre">--libraries</span> <span class="pre">fileName</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">solc</span></code> is called with the option <code class="docutils literal notranslate"><span class="pre">--link</span></code>, all input files are interpreted to be unlinked binaries (hex-encoded) in the <code class="docutils literal notranslate"><span class="pre">__$53aea86b7d70b31448b230b20ae141a537$__</span></code>-format given above and are linked in-place (if the input is read from stdin, it is written to stdout). All options except <code class="docutils literal notranslate"><span class="pre">--libraries</span></code> are ignored (including <code class="docutils literal notranslate"><span class="pre">-o</span></code>) in this case.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">solc</span></code> is called with the option <code class="docutils literal notranslate"><span class="pre">--standard-json</span></code>, it will expect a JSON input (as explained below) on the standard input, and return a JSON output on the standard output. This is the recommended interface for more complex and especially automated uses.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The library placeholder used to be the fully qualified name of the library itself
instead of the hash of it. This format is still supported by <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--link</span></code> but
the compiler will no longer output it. This change was made to reduce
the likelihood of a collision between libraries, since only the first 36 characters
of the fully qualified library name could be used.</p>
</div>
<span class="target" id="evm-version"></span></div>
<div class="section" id="setting-the-evm-version-to-target">
<span id="index-1"></span><h3>Setting the EVM version to target<a class="headerlink" href="#setting-the-evm-version-to-target" title="Permalink to this headline">¶</a></h3>
<p>When you compile your contract code you can specify the Ethereum virtual machine
version to compile for to avoid particular features or behaviours.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Compiling for the wrong EVM version can result in wrong, strange and failing
behaviour. Please ensure, especially if running a private chain, that you
use matching EVM versions.</p>
</div>
<p>On the command line, you can select the EVM version as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>solc --evm-version &lt;VERSION&gt; contract.sol
</pre></div>
</div>
<p>In the <a class="reference internal" href="#compiler-api"><span class="std std-ref">standard JSON interface</span></a>, use the <code class="docutils literal notranslate"><span class="pre">&quot;evmVersion&quot;</span></code>
key in the <code class="docutils literal notranslate"><span class="pre">&quot;settings&quot;</span></code> field:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
  &quot;sources&quot;: { ... },
  &quot;settings&quot;: {
    &quot;optimizer&quot;: { ... },
    &quot;evmVersion&quot;: &quot;&lt;VERSION&gt;&quot;
  }
}
</pre></div>
</div>
<div class="section" id="target-options">
<h4>Target options<a class="headerlink" href="#target-options" title="Permalink to this headline">¶</a></h4>
<p>Below is a list of target EVM versions and the compiler-relevant changes introduced
at each version. Backward compatibility is not guaranteed between each version.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">homestead</span></code> (oldest version)</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">tangerineWhistle</span></code></dt>
<dd><ul class="first last">
<li>gas cost for access to other accounts increased, relevant for gas estimation and the optimizer.</li>
<li>all gas sent by default for external calls, previously a certain amount had to be retained.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">spuriousDragon</span></code></dt>
<dd><ul class="first last">
<li>gas cost for the <code class="docutils literal notranslate"><span class="pre">exp</span></code> opcode increased, relevant for gas estimation and the optimizer.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">byzantium</span></code> (<strong>default</strong>)</dt>
<dd><ul class="first last">
<li>opcodes <code class="docutils literal notranslate"><span class="pre">returndatacopy</span></code>, <code class="docutils literal notranslate"><span class="pre">returndatasize</span></code> and <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> are available in assembly.</li>
<li>the <code class="docutils literal notranslate"><span class="pre">staticcall</span></code> opcode is used when calling non-library view or pure functions, which prevents the functions from modifying state at the EVM level, i.e., even applies when you use invalid type conversions.</li>
<li>it is possible to access dynamic data returned from function calls.</li>
<li><code class="docutils literal notranslate"><span class="pre">revert</span></code> opcode introduced, which means that <code class="docutils literal notranslate"><span class="pre">revert()</span></code> will not waste gas.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">constantinople</span></code> (still in progress)</dt>
<dd><ul class="first last">
<li>opcodes <code class="docutils literal notranslate"><span class="pre">shl</span></code>, <code class="docutils literal notranslate"><span class="pre">shr</span></code> and <code class="docutils literal notranslate"><span class="pre">sar</span></code> are available in assembly.</li>
<li>shifting operators use shifting opcodes and thus need less gas.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="compiler-input-and-output-json-description">
<span id="compiler-api"></span><h3>Compiler Input and Output JSON Description<a class="headerlink" href="#compiler-input-and-output-json-description" title="Permalink to this headline">¶</a></h3>
<p>The recommended way to interface with the Solidity compiler especially for
more complex and automated setups is the so-called JSON-input-output interface.
The same interface is provided by all distributions of the compiler.</p>
<p>The fields are generally subject to change,
some are optional (as noted), but we try to only make backwards compatible changes.</p>
<p>The compiler API expects a JSON formatted input and outputs the compilation result in a JSON formatted output.</p>
<p>The following subsections describe the format through an example.
Comments are of course not permitted and used here only for explanatory purposes.</p>
<div class="section" id="input-description">
<h4>Input Description<a class="headerlink" href="#input-description" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
  // Required: Source code language, such as &quot;Solidity&quot;, &quot;Vyper&quot;, &quot;lll&quot;, &quot;assembly&quot;, etc.
  language: &quot;Solidity&quot;,
  // Required
  sources:
  {
    // The keys here are the &quot;global&quot; names of the source files,
    // imports can use other files via remappings (see below).
    &quot;myFile.sol&quot;:
    {
      // Optional: keccak256 hash of the source file
      // It is used to verify the retrieved content if imported via URLs.
      &quot;keccak256&quot;: &quot;0x123...&quot;,
      // Required (unless &quot;content&quot; is used, see below): URL(s) to the source file.
      // URL(s) should be imported in this order and the result checked against the
      // keccak256 hash (if available). If the hash doesn&#39;t match or none of the
      // URL(s) result in success, an error should be raised.
      &quot;urls&quot;:
      [
        &quot;bzzr://56ab...&quot;,
        &quot;ipfs://Qma...&quot;,
        // If files are used, their directories should be added to the command line via
        // `--allow-paths &lt;path&gt;`.
        &quot;file:///tmp/path/to/file.sol&quot;
      ]
    },
    &quot;mortal&quot;:
    {
      // Optional: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x234...&quot;,
      // Required (unless &quot;urls&quot; is used): literal contents of the source file
      &quot;content&quot;: &quot;contract mortal is owned { function kill() { if (msg.sender == owner) selfdestruct(owner); } }&quot;
    }
  },
  // Optional
  settings:
  {
    // Optional: Sorted list of remappings
    remappings: [ &quot;:g/dir&quot; ],
    // Optional: Optimizer settings
    optimizer: {
      // disabled by default
      enabled: true,
      // Optimize for how many times you intend to run the code.
      // Lower values will optimize more for initial deployment cost, higher values will optimize more for high-frequency usage.
      runs: 200
    },
    evmVersion: &quot;byzantium&quot;, // Version of the EVM to compile for. Affects type checking and code generation. Can be homestead, tangerineWhistle, spuriousDragon, byzantium or constantinople
    // Metadata settings (optional)
    metadata: {
      // Use only literal content and not URLs (false by default)
      useLiteralContent: true
    },
    // Addresses of the libraries. If not all libraries are given here, it can result in unlinked objects whose output data is different.
    libraries: {
      // The top level key is the the name of the source file where the library is used.
      // If remappings are used, this source file should match the global path after remappings were applied.
      // If this key is an empty string, that refers to a global level.
      &quot;myFile.sol&quot;: {
        &quot;MyLib&quot;: &quot;0x123123...&quot;
      }
    }
    // The following can be used to select desired outputs based
    // on file and contract names.
    // If this field is omitted, then the compiler loads and does type checking,
    // but will not generate any outputs apart from errors.
    // The first level key is the file name and the second level key is the contract name.
    // An empty contract name is used for outputs that are not tied to a contract
    // but to the whole source file like the AST.
    // A star as contract name refers to all contracts in the file.
    // Similarly, a star as a file name matches all files.
    // To select all outputs the compiler can possibly generate, use
    // &quot;outputSelection: { &quot;*&quot;: { &quot;*&quot;: [ &quot;*&quot; ], &quot;&quot;: [ &quot;*&quot; ] } }&quot;
    // but note that this might slow down the compilation process needlessly.
    //
    // The available output types are as follows:
    //
    // File level (needs empty string as contract name):
    //   ast - AST of all source files
    //   legacyAST - legacy AST of all source files
    //
    // Contract level (needs the contract name or &quot;*&quot;):
    //   abi - ABI
    //   devdoc - Developer documentation (natspec)
    //   userdoc - User documentation (natspec)
    //   metadata - Metadata
    //   ir - New assembly format before desugaring
    //   evm.assembly - New assembly format after desugaring
    //   evm.legacyAssembly - Old-style assembly format in JSON
    //   evm.bytecode.object - Bytecode object
    //   evm.bytecode.opcodes - Opcodes list
    //   evm.bytecode.sourceMap - Source mapping (useful for debugging)
    //   evm.bytecode.linkReferences - Link references (if unlinked object)
    //   evm.deployedBytecode* - Deployed bytecode (has the same options as evm.bytecode)
    //   evm.methodIdentifiers - The list of function hashes
    //   evm.gasEstimates - Function gas estimates
    //   ewasm.wast - eWASM S-expressions format (not supported atm)
    //   ewasm.wasm - eWASM binary format (not supported atm)
    //
    // Note that using a using `evm`, `evm.bytecode`, `ewasm`, etc. will select every
    // target part of that output. Additionally, `*` can be used as a wildcard to request everything.
    //
    outputSelection: {
      // Enable the metadata and bytecode outputs of every single contract.
      &quot;*&quot;: {
        &quot;*&quot;: [ &quot;metadata&quot;, &quot;evm.bytecode&quot; ]
      },
      // Enable the abi and opcodes output of MyContract defined in file def.
      &quot;def&quot;: {
        &quot;MyContract&quot;: [ &quot;abi&quot;, &quot;evm.bytecode.opcodes&quot; ]
      },
      // Enable the source map output of every single contract.
      &quot;*&quot;: {
        &quot;*&quot;: [ &quot;evm.bytecode.sourceMap&quot; ]
      },
      // Enable the legacy AST output of every single file.
      &quot;*&quot;: {
        &quot;&quot;: [ &quot;legacyAST&quot; ]
      }
    }
  }
}
</pre></div>
</div>
</div>
<div class="section" id="output-description">
<h4>Output Description<a class="headerlink" href="#output-description" title="Permalink to this headline">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
  // Optional: not present if no errors/warnings were encountered
  errors: [
    {
      // Optional: Location within the source file.
      sourceLocation: {
        file: &quot;sourceFile.sol&quot;,
        start: 0,
        end: 100
      ],
      // Mandatory: Error type, such as &quot;TypeError&quot;, &quot;InternalCompilerError&quot;, &quot;Exception&quot;, etc.
      // See below for complete list of types.
      type: &quot;TypeError&quot;,
      // Mandatory: Component where the error originated, such as &quot;general&quot;, &quot;ewasm&quot;, etc.
      component: &quot;general&quot;,
      // Mandatory (&quot;error&quot; or &quot;warning&quot;)
      severity: &quot;error&quot;,
      // Mandatory
      message: &quot;Invalid keyword&quot;
      // Optional: the message formatted with source location
      formattedMessage: &quot;sourceFile.sol:100: Invalid keyword&quot;
    }
  ],
  // This contains the file-level outputs. In can be limited/filtered by the outputSelection settings.
  sources: {
    &quot;sourceFile.sol&quot;: {
      // Identifier of the source (used in source maps)
      id: 1,
      // The AST object
      ast: {},
      // The legacy AST object
      legacyAST: {}
    }
  },
  // This contains the contract-level outputs. It can be limited/filtered by the outputSelection settings.
  contracts: {
    &quot;sourceFile.sol&quot;: {
      // If the language used has no contract names, this field should equal to an empty string.
      &quot;ContractName&quot;: {
        // The Ethereum Contract ABI. If empty, it is represented as an empty array.
        // See https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI
        abi: [],
        // See the Metadata Output documentation (serialised JSON string)
        metadata: &quot;{...}&quot;,
        // User documentation (natspec)
        userdoc: {},
        // Developer documentation (natspec)
        devdoc: {},
        // Intermediate representation (string)
        ir: &quot;&quot;,
        // EVM-related outputs
        evm: {
          // Assembly (string)
          assembly: &quot;&quot;,
          // Old-style assembly (object)
          legacyAssembly: {},
          // Bytecode and related details.
          bytecode: {
            // The bytecode as a hex string.
            object: &quot;00fe&quot;,
            // Opcodes list (string)
            opcodes: &quot;&quot;,
            // The source mapping as a string. See the source mapping definition.
            sourceMap: &quot;&quot;,
            // If given, this is an unlinked object.
            linkReferences: {
              &quot;libraryFile.sol&quot;: {
                // Byte offsets into the bytecode. Linking replaces the 20 bytes located there.
                &quot;Library1&quot;: [
                  { start: 0, length: 20 },
                  { start: 200, length: 20 }
                ]
              }
            }
          },
          // The same layout as above.
          deployedBytecode: { },
          // The list of function hashes
          methodIdentifiers: {
            &quot;delegate(address)&quot;: &quot;5c19a95c&quot;
          },
          // Function gas estimates
          gasEstimates: {
            creation: {
              codeDepositCost: &quot;420000&quot;,
              executionCost: &quot;infinite&quot;,
              totalCost: &quot;infinite&quot;
            },
            external: {
              &quot;delegate(address)&quot;: &quot;25000&quot;
            },
            internal: {
              &quot;heavyLifting()&quot;: &quot;infinite&quot;
            }
          }
        },
        // eWASM related outputs
        ewasm: {
          // S-expressions format
          wast: &quot;&quot;,
          // Binary format (hex string)
          wasm: &quot;&quot;
        }
      }
    }
  }
}
</pre></div>
</div>
<div class="section" id="error-types">
<h5>Error types<a class="headerlink" href="#error-types" title="Permalink to this headline">¶</a></h5>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">JSONError</span></code>: JSON input doesn’t conform to the required format, e.g. input is not a JSON object, the language is not supported, etc.</li>
<li><code class="docutils literal notranslate"><span class="pre">IOError</span></code>: IO and import processing errors, such as unresolvable URL or hash mismatch in supplied sources.</li>
<li><code class="docutils literal notranslate"><span class="pre">ParserError</span></code>: Source code doesn’t conform to the language rules.</li>
<li><code class="docutils literal notranslate"><span class="pre">DocstringParsingError</span></code>: The NatSpec tags in the comment block cannot be parsed.</li>
<li><code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>: Syntactical error, such as <code class="docutils literal notranslate"><span class="pre">continue</span></code> is used outside of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop.</li>
<li><code class="docutils literal notranslate"><span class="pre">DeclarationError</span></code>: Invalid, unresolvable or clashing identifier names. e.g. <code class="docutils literal notranslate"><span class="pre">Identifier</span> <span class="pre">not</span> <span class="pre">found</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TypeError</span></code>: Error within the type system, such as invalid type conversions, invalid assignments, etc.</li>
<li><code class="docutils literal notranslate"><span class="pre">UnimplementedFeatureError</span></code>: Feature is not supported by the compiler, but is expected to be supported in future versions.</li>
<li><code class="docutils literal notranslate"><span class="pre">InternalCompilerError</span></code>: Internal bug triggered in the compiler - this should be reported as an issue.</li>
<li><code class="docutils literal notranslate"><span class="pre">Exception</span></code>: Unknown failure during compilation - this should be reported as an issue.</li>
<li><code class="docutils literal notranslate"><span class="pre">CompilerError</span></code>: Invalid use of the compiler stack - this should be reported as an issue.</li>
<li><code class="docutils literal notranslate"><span class="pre">FatalError</span></code>: Fatal error not processed correctly - this should be reported as an issue.</li>
<li><code class="docutils literal notranslate"><span class="pre">Warning</span></code>: A warning, which didn’t stop the compilation, but should be addressed if possible.</li>
</ol>
</div>
</div>
</div>
</div>
<span id="document-metadata"></span><div class="section" id="contract-metadata">
<h2>Contract Metadata<a class="headerlink" href="#contract-metadata" title="Permalink to this headline">¶</a></h2>
<p id="index-0">The Solidity compiler automatically generates a JSON file, the contract
metadata, that contains information about the current contract. You can use
this file to query the compiler version, the sources used, the ABI and NatSpec
documentation to more safely interact with the contract and verify its source
code.</p>
<p>The compiler appends a Swarm hash of the metadata file to the end of the
bytecode (for details, see below) of each contract, so that you can retrieve
the file in an authenticated way without having to resort to a centralized
data provider.</p>
<p>You have to publish the metadata file to Swarm (or another service) so that
others can access it. You create the file by using the <code class="docutils literal notranslate"><span class="pre">solc</span> <span class="pre">--metadata</span></code>
command that generates a file called <code class="docutils literal notranslate"><span class="pre">ContractName_meta.json</span></code>. It contains
Swarm references to the source code, so you have to upload all source files and
the metadata file.</p>
<p>The metadata file has the following format. The example below is presented in a
human-readable way. Properly formatted metadata should use quotes correctly,
reduce whitespace to a minimum and sort the keys of all objects to arrive at a
unique formatting. Comments are not permitted and used here only for
explanatory purposes.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
  // Required: The version of the metadata format
  version: &quot;1&quot;,
  // Required: Source code language, basically selects a &quot;sub-version&quot;
  // of the specification
  language: &quot;Solidity&quot;,
  // Required: Details about the compiler, contents are specific
  // to the language.
  compiler: {
    // Required for Solidity: Version of the compiler
    version: &quot;0.4.6+commit.2dabbdf0.Emscripten.clang&quot;,
    // Optional: Hash of the compiler binary which produced this output
    keccak256: &quot;0x123...&quot;
  },
  // Required: Compilation source files/source units, keys are file names
  sources:
  {
    &quot;myFile.sol&quot;: {
      // Required: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x123...&quot;,
      // Required (unless &quot;content&quot; is used, see below): Sorted URL(s)
      // to the source file, protocol is more or less arbitrary, but a
      // Swarm URL is recommended
      &quot;urls&quot;: [ &quot;bzzr://56ab...&quot; ]
    },
    &quot;mortal&quot;: {
      // Required: keccak256 hash of the source file
      &quot;keccak256&quot;: &quot;0x234...&quot;,
      // Required (unless &quot;url&quot; is used): literal contents of the source file
      &quot;content&quot;: &quot;contract mortal is owned { function kill() { if (msg.sender == owner) selfdestruct(owner); } }&quot;
    }
  },
  // Required: Compiler settings
  settings:
  {
    // Required for Solidity: Sorted list of remappings
    remappings: [ &quot;:g/dir&quot; ],
    // Optional: Optimizer settings (enabled defaults to false)
    optimizer: {
      enabled: true,
      runs: 500
    },
    // Required for Solidity: File and name of the contract or library this
    // metadata is created for.
    compilationTarget: {
      &quot;myFile.sol&quot;: &quot;MyContract&quot;
    },
    // Required for Solidity: Addresses for libraries used
    libraries: {
      &quot;MyLib&quot;: &quot;0x123123...&quot;
    }
  },
  // Required: Generated information about the contract.
  output:
  {
    // Required: ABI definition of the contract
    abi: [ ... ],
    // Required: NatSpec user documentation of the contract
    userdoc: [ ... ],
    // Required: NatSpec developer documentation of the contract
    devdoc: [ ... ],
  }
}
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since the bytecode of the resulting contract contains the metadata hash, any
change to the metadata results in a change of the bytecode. This includes
changes to a filename or path, and since the metadata includes a hash of all the
sources used, a single whitespace change results in different metadata, and
different bytecode.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note the ABI definition above has no fixed order. It can change with compiler versions.</p>
</div>
<div class="section" id="encoding-of-the-metadata-hash-in-the-bytecode">
<h3>Encoding of the Metadata Hash in the Bytecode<a class="headerlink" href="#encoding-of-the-metadata-hash-in-the-bytecode" title="Permalink to this headline">¶</a></h3>
<p>Because we might support other ways to retrieve the metadata file in the future,
the mapping <code class="docutils literal notranslate"><span class="pre">{&quot;bzzr0&quot;:</span> <span class="pre">&lt;Swarm</span> <span class="pre">hash&gt;}</span></code> is stored
<a class="reference external" href="https://tools.ietf.org/html/rfc7049">CBOR</a>-encoded. Since the beginning of that
encoding is not easy to find, its length is added in a two-byte big-endian
encoding. The current version of the Solidity compiler thus adds the following
to the end of the deployed bytecode:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="mh">0xa1</span> <span class="mh">0x65</span> <span class="s">&#39;b&#39;</span> <span class="s">&#39;z&#39;</span> <span class="s">&#39;z&#39;</span> <span class="s">&#39;r&#39;</span> <span class="s">&#39;0&#39;</span> <span class="mh">0x58</span> <span class="mh">0x20</span> <span class="o">&lt;</span><span class="mi">32</span> <span class="kt">bytes</span> <span class="n">swarm</span> <span class="n">hash</span><span class="o">&gt;</span> <span class="mh">0x00</span> <span class="mh">0x29</span>
</pre></div>
</div>
<p>So in order to retrieve the data, the end of the deployed bytecode can be checked
to match that pattern and use the Swarm hash to retrieve the file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The compiler currently uses the “swarm version 0” hash of the metadata,
but this might change in the future, so do not rely on this sequence
to start with <code class="docutils literal notranslate"><span class="pre">0xa1</span> <span class="pre">0x65</span> <span class="pre">'b'</span> <span class="pre">'z'</span> <span class="pre">'z'</span> <span class="pre">'r'</span> <span class="pre">'0'</span></code>. We might also
add additional data to this CBOR structure, so the
best option is to use a proper CBOR parser.</p>
</div>
</div>
<div class="section" id="usage-for-automatic-interface-generation-and-natspec">
<h3>Usage for Automatic Interface Generation and NatSpec<a class="headerlink" href="#usage-for-automatic-interface-generation-and-natspec" title="Permalink to this headline">¶</a></h3>
<p>The metadata is used in the following way: A component that wants to interact
with a contract (e.g. Mist or any wallet) retrieves the code of the contract, from that
the Swarm hash of a file which is then retrieved.
That file is JSON-decoded into a structure like above.</p>
<p>The component can then use the ABI to automatically generate a rudimentary
user interface for the contract.</p>
<p>Furthermore, the wallet can use the NatSpec user documentation to display a confirmation message to the user
whenever they interact with the contract, together with requesting
authorization for the transaction signature.</p>
<p>Additional information about Ethereum Natural Specification (NatSpec) can be found <a class="reference external" href="https://github.com/ethereum/wiki/wiki/Ethereum-Natural-Specification-Format">here</a>.</p>
</div>
<div class="section" id="usage-for-source-code-verification">
<h3>Usage for Source Code Verification<a class="headerlink" href="#usage-for-source-code-verification" title="Permalink to this headline">¶</a></h3>
<p>In order to verify the compilation, sources can be retrieved from Swarm
via the link in the metadata file.
The compiler of the correct version (which is checked to be part of the “official” compilers)
is invoked on that input with the specified settings. The resulting
bytecode is compared to the data of the creation transaction or <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> opcode data.
This automatically verifies the metadata since its hash is part of the bytecode.
Excess data corresponds to the constructor input data, which should be decoded
according to the interface and presented to the user.</p>
</div>
</div>
<span id="document-abi-spec"></span><div class="section" id="contract-abi-specification">
<span id="abi"></span><span id="index-0"></span><h2>Contract ABI Specification<a class="headerlink" href="#contract-abi-specification" title="Permalink to this headline">¶</a></h2>
<div class="section" id="basic-design">
<h3>Basic Design<a class="headerlink" href="#basic-design" title="Permalink to this headline">¶</a></h3>
<p>The Contract Application Binary Interface (ABI) is the standard way to interact with contracts in the Ethereum ecosystem, both
from outside the blockchain and for contract-to-contract interaction. Data is encoded according to its type,
as described in this specification.  The encoding is not self describing and thus requires a schema in order to decode.</p>
<p>We assume the interface functions of a contract are strongly typed, known at compilation time and static. We assume that all contracts will have the interface definitions of any contracts they call available at compile-time.</p>
<p>This specification does not address contracts whose interface is dynamic or otherwise known only at run-time.</p>
</div>
<div class="section" id="function-selector">
<span id="abi-function-selector"></span><h3>Function Selector<a class="headerlink" href="#function-selector" title="Permalink to this headline">¶</a></h3>
<p>The first four bytes of the call data for a function call specifies the function to be called. It is the
first (left, high-order in big-endian) four bytes of the Keccak-256 (SHA-3) hash of the signature of the function. The signature is defined as the canonical expression of the basic prototype without data location specifier, i.e.
the function name with the parenthesised list of parameter types. Parameter types are split by a single comma - no spaces are used.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The return type of a function is not part of this signature. In <a class="reference internal" href="index.html#overload-function"><span class="std std-ref">Solidity’s function overloading</span></a> return types are not considered. The reason is to keep function call resolution context-independent.
The <a class="reference internal" href="#abi-json"><span class="std std-ref">JSON description of the ABI</span></a> however contains both inputs and outputs.</p>
</div>
</div>
<div class="section" id="argument-encoding">
<h3>Argument Encoding<a class="headerlink" href="#argument-encoding" title="Permalink to this headline">¶</a></h3>
<p>Starting from the fifth byte, the encoded arguments follow. This encoding is also used in other places, e.g. the return values and also event arguments are encoded in the same way, without the four bytes specifying the function.</p>
</div>
<div class="section" id="types">
<h3>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h3>
<p>The following elementary types exist:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">uint&lt;M&gt;</span></code>: unsigned integer type of <code class="docutils literal notranslate"><span class="pre">M</span></code> bits, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==</span> <span class="pre">0</span></code>. e.g. <code class="docutils literal notranslate"><span class="pre">uint32</span></code>, <code class="docutils literal notranslate"><span class="pre">uint8</span></code>, <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">int&lt;M&gt;</span></code>: two’s complement signed integer type of <code class="docutils literal notranslate"><span class="pre">M</span></code> bits, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==</span> <span class="pre">0</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">address</span></code>: equivalent to <code class="docutils literal notranslate"><span class="pre">uint160</span></code>, except for the assumed interpretation and language typing. For computing the function selector, <code class="docutils literal notranslate"><span class="pre">address</span></code> is used.</li>
<li><code class="docutils literal notranslate"><span class="pre">uint</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>: synonyms for <code class="docutils literal notranslate"><span class="pre">uint256</span></code>, <code class="docutils literal notranslate"><span class="pre">int256</span></code> respectively. For computing the function selector, <code class="docutils literal notranslate"><span class="pre">uint256</span></code> and <code class="docutils literal notranslate"><span class="pre">int256</span></code> have to be used.</li>
<li><code class="docutils literal notranslate"><span class="pre">bool</span></code>: equivalent to <code class="docutils literal notranslate"><span class="pre">uint8</span></code> restricted to the values 0 and 1. For computing the function selector, <code class="docutils literal notranslate"><span class="pre">bool</span></code> is used.</li>
<li><code class="docutils literal notranslate"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>: signed fixed-point decimal number of <code class="docutils literal notranslate"><span class="pre">M</span></code> bits, <code class="docutils literal notranslate"><span class="pre">8</span> <span class="pre">&lt;=</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">256</span></code>, <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">%</span> <span class="pre">8</span> <span class="pre">==0</span></code>, and <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">N</span> <span class="pre">&lt;=</span> <span class="pre">80</span></code>, which denotes the value <code class="docutils literal notranslate"><span class="pre">v</span></code> as <code class="docutils literal notranslate"><span class="pre">v</span> <span class="pre">/</span> <span class="pre">(10</span> <span class="pre">**</span> <span class="pre">N)</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">ufixed&lt;M&gt;x&lt;N&gt;</span></code>: unsigned variant of <code class="docutils literal notranslate"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">fixed</span></code>, <code class="docutils literal notranslate"><span class="pre">ufixed</span></code>: synonyms for <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code>, <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> respectively. For computing the function selector, <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code> and <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> have to be used.</li>
<li><code class="docutils literal notranslate"><span class="pre">bytes&lt;M&gt;</span></code>: binary type of <code class="docutils literal notranslate"><span class="pre">M</span></code> bytes, <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">&lt;</span> <span class="pre">M</span> <span class="pre">&lt;=</span> <span class="pre">32</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">function</span></code>: an address (20 bytes) followed by a function selector (4 bytes). Encoded identical to <code class="docutils literal notranslate"><span class="pre">bytes24</span></code>.</li>
</ul>
<p>The following (fixed-size) array type exists:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">&lt;type&gt;[M]</span></code>: a fixed-length array of <code class="docutils literal notranslate"><span class="pre">M</span></code> elements, <code class="docutils literal notranslate"><span class="pre">M</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code>, of the given type.</li>
</ul>
<p>The following non-fixed-size types exist:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">bytes</span></code>: dynamic sized byte sequence.</li>
<li><code class="docutils literal notranslate"><span class="pre">string</span></code>: dynamic sized unicode string assumed to be UTF-8 encoded.</li>
<li><code class="docutils literal notranslate"><span class="pre">&lt;type&gt;[]</span></code>: a variable-length array of elements of the given type.</li>
</ul>
<p>Types can be combined to a tuple by enclosing them inside parentheses, separated by commas:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">(T1,T2,...,Tn)</span></code>: tuple consisting of the types <code class="docutils literal notranslate"><span class="pre">T1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">Tn</span></code>, <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></li>
</ul>
<p>It is possible to form tuples of tuples, arrays of tuples and so on.  It is also possible to form zero-tuples (where <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code>).</p>
<div class="section" id="mapping-solidity-to-abi-types">
<h4>Mapping Solidity to ABI types<a class="headerlink" href="#mapping-solidity-to-abi-types" title="Permalink to this headline">¶</a></h4>
<p>Solidity supports all the types presented above with the same names with the
exception of tuples. On the other hand, some Solidity types are not supported
by the ABI.  The following table shows on the left column Solidity types that
are not part of the ABI, and on the right column the ABI types that represent
them.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Solidity</th>
<th class="head">ABI</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="index.html#address"><span class="std std-ref">address payable</span></a></td>
<td><code class="docutils literal notranslate"><span class="pre">address</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="index.html#contracts"><span class="std std-ref">contract</span></a></td>
<td><code class="docutils literal notranslate"><span class="pre">address</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="index.html#enums"><span class="std std-ref">enum</span></a></td>
<td><p class="first">smallest <code class="docutils literal notranslate"><span class="pre">uint</span></code> type that is large enough to hold all values</p>
<p class="last">For example, an <code class="docutils literal notranslate"><span class="pre">enum</span></code> of 255 values or less is mapped to <code class="docutils literal notranslate"><span class="pre">uint8</span></code> and
an <code class="docutils literal notranslate"><span class="pre">enum</span></code> of 256 values is mapped to <code class="docutils literal notranslate"><span class="pre">uint16</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="index.html#structs"><span class="std std-ref">struct</span></a></td>
<td><code class="docutils literal notranslate"><span class="pre">tuple</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="design-criteria-for-the-encoding">
<h3>Design Criteria for the Encoding<a class="headerlink" href="#design-criteria-for-the-encoding" title="Permalink to this headline">¶</a></h3>
<p>The encoding is designed to have the following properties, which are especially useful if some arguments are nested arrays:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The number of reads necessary to access a value is at most the depth of the value inside the argument array structure, i.e. four reads are needed to retrieve <code class="docutils literal notranslate"><span class="pre">a_i[k][l][r]</span></code>. In a previous version of the ABI, the number of reads scaled linearly with the total number of dynamic parameters in the worst case.</li>
<li>The data of a variable or array element is not interleaved with other data and it is relocatable, i.e. it only uses relative “addresses”.</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="formal-specification-of-the-encoding">
<h3>Formal Specification of the Encoding<a class="headerlink" href="#formal-specification-of-the-encoding" title="Permalink to this headline">¶</a></h3>
<p>We distinguish static and dynamic types. Static types are encoded in-place and dynamic types are encoded at a separately allocated location after the current block.</p>
<p><strong>Definition:</strong> The following types are called “dynamic”:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">bytes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">string</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">T[]</span></code> for any <code class="docutils literal notranslate"><span class="pre">T</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">T[k]</span></code> for any dynamic <code class="docutils literal notranslate"><span class="pre">T</span></code> and any <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">(T1,...,Tk)</span></code> if <code class="docutils literal notranslate"><span class="pre">Ti</span></code> is dynamic for some <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">k</span></code></li>
</ul>
<p>All other types are called “static”.</p>
<p><strong>Definition:</strong> <code class="docutils literal notranslate"><span class="pre">len(a)</span></code> is the number of bytes in a binary string <code class="docutils literal notranslate"><span class="pre">a</span></code>.
The type of <code class="docutils literal notranslate"><span class="pre">len(a)</span></code> is assumed to be <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</p>
<p>We define <code class="docutils literal notranslate"><span class="pre">enc</span></code>, the actual encoding, as a mapping of values of the ABI types to binary strings such
that <code class="docutils literal notranslate"><span class="pre">len(enc(X))</span></code> depends on the value of <code class="docutils literal notranslate"><span class="pre">X</span></code> if and only if the type of <code class="docutils literal notranslate"><span class="pre">X</span></code> is dynamic.</p>
<p><strong>Definition:</strong> For any ABI value <code class="docutils literal notranslate"><span class="pre">X</span></code>, we recursively define <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code>, depending
on the type of <code class="docutils literal notranslate"><span class="pre">X</span></code> being</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">(T1,...,Tk)</span></code> for <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">0</span></code> and any types <code class="docutils literal notranslate"><span class="pre">T1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">Tk</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">head(X(1))</span> <span class="pre">...</span> <span class="pre">head(X(k))</span> <span class="pre">tail(X(1))</span> <span class="pre">...</span> <span class="pre">tail(X(k))</span></code></p>
<p>where <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">=</span> <span class="pre">(X(1),</span> <span class="pre">...,</span> <span class="pre">X(k))</span></code> and
<code class="docutils literal notranslate"><span class="pre">head</span></code> and <code class="docutils literal notranslate"><span class="pre">tail</span></code> are defined for <code class="docutils literal notranslate"><span class="pre">Ti</span></code> being a static type as</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">head(X(i))</span> <span class="pre">=</span> <span class="pre">enc(X(i))</span></code> and <code class="docutils literal notranslate"><span class="pre">tail(X(i))</span> <span class="pre">=</span> <span class="pre">&quot;&quot;</span></code> (the empty string)</p>
</div></blockquote>
<p>and as</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">head(X(i))</span> <span class="pre">=</span> <span class="pre">enc(len(head(X(1))</span> <span class="pre">...</span> <span class="pre">head(X(k))</span> <span class="pre">tail(X(1))</span> <span class="pre">...</span> <span class="pre">tail(X(i-1))</span> <span class="pre">))</span></code>
<code class="docutils literal notranslate"><span class="pre">tail(X(i))</span> <span class="pre">=</span> <span class="pre">enc(X(i))</span></code></p>
</div></blockquote>
<p>otherwise, i.e. if <code class="docutils literal notranslate"><span class="pre">Ti</span></code> is a dynamic type.</p>
<p>Note that in the dynamic case, <code class="docutils literal notranslate"><span class="pre">head(X(i))</span></code> is well-defined since the lengths of
the head parts only depend on the types and not the values. Its value is the offset
of the beginning of <code class="docutils literal notranslate"><span class="pre">tail(X(i))</span></code> relative to the start of <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">T[k]</span></code> for any <code class="docutils literal notranslate"><span class="pre">T</span></code> and <code class="docutils literal notranslate"><span class="pre">k</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc((X[0],</span> <span class="pre">...,</span> <span class="pre">X[k-1]))</span></code></p>
<p>i.e. it is encoded as if it were a tuple with <code class="docutils literal notranslate"><span class="pre">k</span></code> elements
of the same type.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">T[]</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span></code> has <code class="docutils literal notranslate"><span class="pre">k</span></code> elements (<code class="docutils literal notranslate"><span class="pre">k</span></code> is assumed to be of type <code class="docutils literal notranslate"><span class="pre">uint256</span></code>):</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(k)</span> <span class="pre">enc([X[0],</span> <span class="pre">...,</span> <span class="pre">X[k-1]])</span></code></p>
<p>i.e. it is encoded as if it were an array of static size <code class="docutils literal notranslate"><span class="pre">k</span></code>, prefixed with
the number of elements.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">bytes</span></code>, of length <code class="docutils literal notranslate"><span class="pre">k</span></code> (which is assumed to be of type <code class="docutils literal notranslate"><span class="pre">uint256</span></code>):</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(k)</span> <span class="pre">pad_right(X)</span></code>, i.e. the number of bytes is encoded as a
<code class="docutils literal notranslate"><span class="pre">uint256</span></code> followed by the actual value of <code class="docutils literal notranslate"><span class="pre">X</span></code> as a byte sequence, followed by
the minimum number of zero-bytes such that <code class="docutils literal notranslate"><span class="pre">len(enc(X))</span></code> is a multiple of 32.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">string</span></code>:</p>
<p><code class="docutils literal notranslate"><span class="pre">enc(X)</span> <span class="pre">=</span> <span class="pre">enc(enc_utf8(X))</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">X</span></code> is utf-8 encoded and this value is interpreted as of <code class="docutils literal notranslate"><span class="pre">bytes</span></code> type and encoded further. Note that the length used in this subsequent encoding is the number of bytes of the utf-8 encoded string, not its number of characters.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">uint&lt;M&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is the big-endian encoding of <code class="docutils literal notranslate"><span class="pre">X</span></code>, padded on the higher-order (left) side with zero-bytes such that the length is 32 bytes.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">address</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">uint160</span></code> case</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">int&lt;M&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is the big-endian two’s complement encoding of <code class="docutils literal notranslate"><span class="pre">X</span></code>, padded on the higher-order (left) side with <code class="docutils literal notranslate"><span class="pre">0xff</span></code> for negative <code class="docutils literal notranslate"><span class="pre">X</span></code> and with zero bytes for positive <code class="docutils literal notranslate"><span class="pre">X</span></code> such that the length is 32 bytes.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">bool</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">uint8</span></code> case, where <code class="docutils literal notranslate"><span class="pre">1</span></code> is used for <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">0</span></code> for <code class="docutils literal notranslate"><span class="pre">false</span></code></p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">fixed&lt;M&gt;x&lt;N&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is <code class="docutils literal notranslate"><span class="pre">enc(X</span> <span class="pre">*</span> <span class="pre">10**N)</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">10**N</span></code> is interpreted as a <code class="docutils literal notranslate"><span class="pre">int256</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">fixed</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">fixed128x18</span></code> case</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">ufixed&lt;M&gt;x&lt;N&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is <code class="docutils literal notranslate"><span class="pre">enc(X</span> <span class="pre">*</span> <span class="pre">10**N)</span></code> where <code class="docutils literal notranslate"><span class="pre">X</span> <span class="pre">*</span> <span class="pre">10**N</span></code> is interpreted as a <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">ufixed</span></code>: as in the <code class="docutils literal notranslate"><span class="pre">ufixed128x18</span></code> case</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">bytes&lt;M&gt;</span></code>: <code class="docutils literal notranslate"><span class="pre">enc(X)</span></code> is the sequence of bytes in <code class="docutils literal notranslate"><span class="pre">X</span></code> padded with trailing zero-bytes to a length of 32 bytes.</p>
</li>
</ul>
<p>Note that for any <code class="docutils literal notranslate"><span class="pre">X</span></code>, <code class="docutils literal notranslate"><span class="pre">len(enc(X))</span></code> is a multiple of 32.</p>
</div>
<div class="section" id="function-selector-and-argument-encoding">
<h3>Function Selector and Argument Encoding<a class="headerlink" href="#function-selector-and-argument-encoding" title="Permalink to this headline">¶</a></h3>
<p>All in all, a call to the function <code class="docutils literal notranslate"><span class="pre">f</span></code> with parameters <code class="docutils literal notranslate"><span class="pre">a_1,</span> <span class="pre">...,</span> <span class="pre">a_n</span></code> is encoded as</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">function_selector(f)</span> <span class="pre">enc((a_1,</span> <span class="pre">...,</span> <span class="pre">a_n))</span></code></div></blockquote>
<p>and the return values <code class="docutils literal notranslate"><span class="pre">v_1,</span> <span class="pre">...,</span> <span class="pre">v_k</span></code> of <code class="docutils literal notranslate"><span class="pre">f</span></code> are encoded as</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">enc((v_1,</span> <span class="pre">...,</span> <span class="pre">v_k))</span></code></div></blockquote>
<p>i.e. the values are combined into a tuple and encoded.</p>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>Given the contract:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">16</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Foo</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="n">bar</span><span class="p">(</span><span class="kt">bytes3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="kr">memory</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{}</span>
  <span class="kd">function</span> <span class="n">baz</span><span class="p">(</span><span class="kt">uint32</span> <span class="n">x</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">y</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span> <span class="n">r</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">32</span> <span class="o">||</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">function</span> <span class="n">sam</span><span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span><span class="p">,</span> <span class="kt">bool</span><span class="p">,</span> <span class="kt">uint</span><span class="p">[]</span> <span class="kr">memory</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Thus for our <code class="docutils literal notranslate"><span class="pre">Foo</span></code> example if we wanted to call <code class="docutils literal notranslate"><span class="pre">baz</span></code> with the parameters <code class="docutils literal notranslate"><span class="pre">69</span></code> and <code class="docutils literal notranslate"><span class="pre">true</span></code>, we would pass 68 bytes total, which can be broken down into:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0xcdcd77c0</span></code>: the Method ID. This is derived as the first 4 bytes of the Keccak hash of the ASCII form of the signature <code class="docutils literal notranslate"><span class="pre">baz(uint32,bool)</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000045</span></code>: the first parameter, a uint32 value <code class="docutils literal notranslate"><span class="pre">69</span></code> padded to 32 bytes</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the second parameter - boolean <code class="docutils literal notranslate"><span class="pre">true</span></code>, padded to 32 bytes</li>
</ul>
<p>In total:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xcdcd77c000000000000000000000000000000000000000000000000000000000000000450000000000000000000000000000000000000000000000000000000000000001
</pre></div>
</div>
<p>It returns a single <code class="docutils literal notranslate"><span class="pre">bool</span></code>. If, for example, it were to return <code class="docutils literal notranslate"><span class="pre">false</span></code>, its output would be the single byte array <code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000000</span></code>, a single bool.</p>
<p>If we wanted to call <code class="docutils literal notranslate"><span class="pre">bar</span></code> with the argument <code class="docutils literal notranslate"><span class="pre">[&quot;abc&quot;,</span> <span class="pre">&quot;def&quot;]</span></code>, we would pass 68 bytes total, broken down into:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0xfce353f6</span></code>: the Method ID. This is derived from the signature <code class="docutils literal notranslate"><span class="pre">bar(bytes3[2])</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x6162630000000000000000000000000000000000000000000000000000000000</span></code>: the first part of the first parameter, a <code class="docutils literal notranslate"><span class="pre">bytes3</span></code> value <code class="docutils literal notranslate"><span class="pre">&quot;abc&quot;</span></code> (left-aligned).</li>
<li><code class="docutils literal notranslate"><span class="pre">0x6465660000000000000000000000000000000000000000000000000000000000</span></code>: the second part of the first parameter, a <code class="docutils literal notranslate"><span class="pre">bytes3</span></code> value <code class="docutils literal notranslate"><span class="pre">&quot;def&quot;</span></code> (left-aligned).</li>
</ul>
<p>In total:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xfce353f661626300000000000000000000000000000000000000000000000000000000006465660000000000000000000000000000000000000000000000000000000000
</pre></div>
</div>
<p>If we wanted to call <code class="docutils literal notranslate"><span class="pre">sam</span></code> with the arguments <code class="docutils literal notranslate"><span class="pre">&quot;dave&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">[1,2,3]</span></code>, we would pass 292 bytes total, broken down into:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0xa5643bf2</span></code>: the Method ID. This is derived from the signature <code class="docutils literal notranslate"><span class="pre">sam(bytes,bool,uint256[])</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">uint</span></code> is replaced with its canonical representation <code class="docutils literal notranslate"><span class="pre">uint256</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000060</span></code>: the location of the data part of the first parameter (dynamic type), measured in bytes from the start of the arguments block. In this case, <code class="docutils literal notranslate"><span class="pre">0x60</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the second parameter: boolean true.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x00000000000000000000000000000000000000000000000000000000000000a0</span></code>: the location of the data part of the third parameter (dynamic type), measured in bytes. In this case, <code class="docutils literal notranslate"><span class="pre">0xa0</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000004</span></code>: the data part of the first argument, it starts with the length of the byte array in elements, in this case, 4.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x6461766500000000000000000000000000000000000000000000000000000000</span></code>: the contents of the first argument: the UTF-8 (equal to ASCII in this case) encoding of <code class="docutils literal notranslate"><span class="pre">&quot;dave&quot;</span></code>, padded on the right to 32 bytes.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code>: the data part of the third argument, it starts with the length of the array in elements, in this case, 3.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code>: the first entry of the third parameter.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code>: the second entry of the third parameter.</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code>: the third entry of the third parameter.</li>
</ul>
<p>In total:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xa5643bf20000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000464617665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000003
</pre></div>
</div>
</div>
<div class="section" id="use-of-dynamic-types">
<h3>Use of Dynamic Types<a class="headerlink" href="#use-of-dynamic-types" title="Permalink to this headline">¶</a></h3>
<p>A call to a function with the signature <code class="docutils literal notranslate"><span class="pre">f(uint,uint32[],bytes10,bytes)</span></code> with values <code class="docutils literal notranslate"><span class="pre">(0x123,</span> <span class="pre">[0x456,</span> <span class="pre">0x789],</span> <span class="pre">&quot;1234567890&quot;,</span> <span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;)</span></code> is encoded in the following way:</p>
<p>We take the first four bytes of <code class="docutils literal notranslate"><span class="pre">sha3(&quot;f(uint256,uint32[],bytes10,bytes)&quot;)</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">0x8be65246</span></code>.
Then we encode the head parts of all four arguments. For the static types <code class="docutils literal notranslate"><span class="pre">uint256</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes10</span></code>, these are directly the values we want to pass, whereas for the dynamic types <code class="docutils literal notranslate"><span class="pre">uint32[]</span></code> and <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, we use the offset in bytes to the start of their data area, measured from the start of the value encoding (i.e. not counting the first four bytes containing the hash of the function signature). These are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000123</span></code> (<code class="docutils literal notranslate"><span class="pre">0x123</span></code> padded to 32 bytes)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000080</span></code> (offset to start of data part of second parameter, 4*32 bytes, exactly the size of the head part)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x3132333435363738393000000000000000000000000000000000000000000000</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;1234567890&quot;</span></code> padded to 32 bytes on the right)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x00000000000000000000000000000000000000000000000000000000000000e0</span></code> (offset to start of data part of fourth parameter = offset to start of data part of first dynamic parameter + size of data part of first dynamic parameter = 4*32 + 3*32 (see below))</li>
</ul>
</div></blockquote>
<p>After this, the data part of the first dynamic argument, <code class="docutils literal notranslate"><span class="pre">[0x456,</span> <span class="pre">0x789]</span></code> follows:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (number of elements of the array, 2)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000456</span></code> (first element)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000789</span></code> (second element)</li>
</ul>
</div></blockquote>
<p>Finally, we encode the data part of the second dynamic argument, <code class="docutils literal notranslate"><span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x000000000000000000000000000000000000000000000000000000000000000d</span></code> (number of elements (bytes in this case): 13)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x48656c6c6f2c20776f726c642100000000000000000000000000000000000000</span></code> (<code class="docutils literal notranslate"><span class="pre">&quot;Hello,</span> <span class="pre">world!&quot;</span></code> padded to 32 bytes on the right)</li>
</ul>
</div></blockquote>
<p>All together, the encoding is (newline after function selector and each 32-bytes for clarity):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x8be65246
  0000000000000000000000000000000000000000000000000000000000000123
  0000000000000000000000000000000000000000000000000000000000000080
  3132333435363738393000000000000000000000000000000000000000000000
  00000000000000000000000000000000000000000000000000000000000000e0
  0000000000000000000000000000000000000000000000000000000000000002
  0000000000000000000000000000000000000000000000000000000000000456
  0000000000000000000000000000000000000000000000000000000000000789
  000000000000000000000000000000000000000000000000000000000000000d
  48656c6c6f2c20776f726c642100000000000000000000000000000000000000
</pre></div>
</div>
<p>Let us apply the same principle to encode the data for a function with a signature <code class="docutils literal notranslate"><span class="pre">g(uint[][],string[])</span></code> with values <code class="docutils literal notranslate"><span class="pre">([[1,</span> <span class="pre">2],</span> <span class="pre">[3]],</span> <span class="pre">[&quot;one&quot;,</span> <span class="pre">&quot;two&quot;,</span> <span class="pre">&quot;three&quot;])</span></code> but start from the most atomic parts of the encoding:</p>
<p>First we encode the length and data of the first embedded dynamic array <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> of the first root array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (number of elements in the first array, 2; the elements themselves are <code class="docutils literal notranslate"><span class="pre">1</span></code>  and <code class="docutils literal notranslate"><span class="pre">2</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code> (first element)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (second element)</li>
</ul>
</div></blockquote>
<p>Then we encode the length and data of the second embedded dynamic array <code class="docutils literal notranslate"><span class="pre">[3]</span></code> of the first root array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000001</span></code> (number of elements in the second array, 1; the element is <code class="docutils literal notranslate"><span class="pre">3</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (first element)</li>
</ul>
</div></blockquote>
<p>Then we need to find the offsets <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> for their respective dynamic arrays  <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> and <code class="docutils literal notranslate"><span class="pre">[3]</span></code>. To calculate the offsets we can take a look at the encoded data of the first root array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code> enumerating each line in the encoding:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 - a                                                                - offset of [1, 2]
1 - b                                                                - offset of [3]
2 - 0000000000000000000000000000000000000000000000000000000000000002 - count for [1, 2]
3 - 0000000000000000000000000000000000000000000000000000000000000001 - encoding of 1
4 - 0000000000000000000000000000000000000000000000000000000000000002 - encoding of 2
5 - 0000000000000000000000000000000000000000000000000000000000000001 - count for [3]
6 - 0000000000000000000000000000000000000000000000000000000000000003 - encoding of 3
</pre></div>
</div>
<p>Offset <code class="docutils literal notranslate"><span class="pre">a</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code> which is line 2 (64 bytes); thus <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000040</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">b</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[3]</span></code> which is line 5 (160 bytes); thus <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">=</span> <span class="pre">0x00000000000000000000000000000000000000000000000000000000000000a0</span></code>.</p>
<p>Then we encode the embedded strings of the second root array:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (number of characters in word <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x6f6e650000000000000000000000000000000000000000000000000000000000</span></code> (utf8 representation of word <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (number of characters in word <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x74776f0000000000000000000000000000000000000000000000000000000000</span></code> (utf8 representation of word <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000005</span></code> (number of characters in word <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">0x7468726565000000000000000000000000000000000000000000000000000000</span></code> (utf8 representation of word <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code>)</li>
</ul>
</div></blockquote>
<p>In parallel to the first root array, since strings are dynamic elements we need to find their offsets <code class="docutils literal notranslate"><span class="pre">c</span></code>, <code class="docutils literal notranslate"><span class="pre">d</span></code> and <code class="docutils literal notranslate"><span class="pre">e</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0 - c                                                                - offset for &quot;one&quot;
1 - d                                                                - offset for &quot;two&quot;
2 - e                                                                - offset for &quot;three&quot;
3 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;one&quot;
4 - 6f6e650000000000000000000000000000000000000000000000000000000000 - encoding of &quot;one&quot;
5 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;two&quot;
6 - 74776f0000000000000000000000000000000000000000000000000000000000 - encoding of &quot;two&quot;
7 - 0000000000000000000000000000000000000000000000000000000000000005 - count for &quot;three&quot;
8 - 7468726565000000000000000000000000000000000000000000000000000000 - encoding of &quot;three&quot;
</pre></div>
</div>
<p>Offset <code class="docutils literal notranslate"><span class="pre">c</span></code> points to the start of the content of the string <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code> which is line 3 (96 bytes); thus <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000060</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">d</span></code> points to the start of the content of the string <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code> which is line 5 (160 bytes); thus <code class="docutils literal notranslate"><span class="pre">d</span> <span class="pre">=</span> <span class="pre">0x00000000000000000000000000000000000000000000000000000000000000a0</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">e</span></code> points to the start of the content of the string <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code> which is line 7 (224 bytes); thus <code class="docutils literal notranslate"><span class="pre">e</span> <span class="pre">=</span> <span class="pre">0x00000000000000000000000000000000000000000000000000000000000000e0</span></code>.</p>
<p>Note that the encodings of the embedded elements of the root arrays are not dependent on each other and have the same encodings for a function with a signature <code class="docutils literal notranslate"><span class="pre">g(string[],uint[][])</span></code>.</p>
<p>Then we encode the length of the first root array:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000002</span></code> (number of elements in the first root array, 2; the elements themselves are <code class="docutils literal notranslate"><span class="pre">[1,</span> <span class="pre">2]</span></code>  and <code class="docutils literal notranslate"><span class="pre">[3]</span></code>)</li>
</ul>
</div></blockquote>
<p>Then we encode the length of the second root array:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">0x0000000000000000000000000000000000000000000000000000000000000003</span></code> (number of strings in the second root array, 3; the strings themselves are <code class="docutils literal notranslate"><span class="pre">&quot;one&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;two&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code>)</li>
</ul>
</div></blockquote>
<p>Finally we find the offsets <code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code> for their respective root dynamic arrays <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code> and <code class="docutils literal notranslate"><span class="pre">[&quot;one&quot;,</span> <span class="pre">&quot;two&quot;,</span> <span class="pre">&quot;three&quot;]</span></code>, and assemble parts in the correct order:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0x2289b18c                                                            - function signature
 0 - f                                                                - offset of [[1, 2], [3]]
 1 - g                                                                - offset of [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]
 2 - 0000000000000000000000000000000000000000000000000000000000000002 - count for [[1, 2], [3]]
 3 - 0000000000000000000000000000000000000000000000000000000000000040 - offset of [1, 2]
 4 - 00000000000000000000000000000000000000000000000000000000000000a0 - offset of [3]
 5 - 0000000000000000000000000000000000000000000000000000000000000002 - count for [1, 2]
 6 - 0000000000000000000000000000000000000000000000000000000000000001 - encoding of 1
 7 - 0000000000000000000000000000000000000000000000000000000000000002 - encoding of 2
 8 - 0000000000000000000000000000000000000000000000000000000000000001 - count for [3]
 9 - 0000000000000000000000000000000000000000000000000000000000000003 - encoding of 3
10 - 0000000000000000000000000000000000000000000000000000000000000003 - count for [&quot;one&quot;, &quot;two&quot;, &quot;three&quot;]
11 - 0000000000000000000000000000000000000000000000000000000000000060 - offset for &quot;one&quot;
12 - 00000000000000000000000000000000000000000000000000000000000000a0 - offset for &quot;two&quot;
13 - 00000000000000000000000000000000000000000000000000000000000000e0 - offset for &quot;three&quot;
14 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;one&quot;
15 - 6f6e650000000000000000000000000000000000000000000000000000000000 - encoding of &quot;one&quot;
16 - 0000000000000000000000000000000000000000000000000000000000000003 - count for &quot;two&quot;
17 - 74776f0000000000000000000000000000000000000000000000000000000000 - encoding of &quot;two&quot;
18 - 0000000000000000000000000000000000000000000000000000000000000005 - count for &quot;three&quot;
19 - 7468726565000000000000000000000000000000000000000000000000000000 - encoding of &quot;three&quot;
</pre></div>
</div>
<p>Offset <code class="docutils literal notranslate"><span class="pre">f</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[[1,</span> <span class="pre">2],</span> <span class="pre">[3]]</span></code> which is line 2 (64 bytes); thus <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000040</span></code>.</p>
<p>Offset <code class="docutils literal notranslate"><span class="pre">g</span></code> points to the start of the content of the array <code class="docutils literal notranslate"><span class="pre">[&quot;one&quot;,</span> <span class="pre">&quot;two&quot;,</span> <span class="pre">&quot;three&quot;]</span></code> which is line 10 (320 bytes); thus <code class="docutils literal notranslate"><span class="pre">g</span> <span class="pre">=</span> <span class="pre">0x0000000000000000000000000000000000000000000000000000000000000140</span></code>.</p>
</div>
<div class="section" id="events">
<span id="abi-events"></span><h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p>Events are an abstraction of the Ethereum logging/event-watching protocol. Log entries provide the contract’s address, a series of up to four topics and some arbitrary length binary data. Events leverage the existing function ABI in order to interpret this (together with an interface spec) as a properly typed structure.</p>
<p>Given an event name and series of event parameters, we split them into two sub-series: those which are indexed and those which are not. Those which are indexed, which may number up to 3, are used alongside the Keccak hash of the event signature to form the topics of the log entry. Those which are not indexed form the byte array of the event.</p>
<p>In effect, a log entry using this ABI is described as:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">address</span></code>: the address of the contract (intrinsically provided by Ethereum);</li>
<li><code class="docutils literal notranslate"><span class="pre">topics[0]</span></code>: <code class="docutils literal notranslate"><span class="pre">keccak(EVENT_NAME+&quot;(&quot;+EVENT_ARGS.map(canonical_type_of).join(&quot;,&quot;)+&quot;)&quot;)</span></code> (<code class="docutils literal notranslate"><span class="pre">canonical_type_of</span></code> is a function that simply returns the canonical type of a given argument, e.g. for <code class="docutils literal notranslate"><span class="pre">uint</span> <span class="pre">indexed</span> <span class="pre">foo</span></code>, it would return <code class="docutils literal notranslate"><span class="pre">uint256</span></code>). If the event is declared as <code class="docutils literal notranslate"><span class="pre">anonymous</span></code> the <code class="docutils literal notranslate"><span class="pre">topics[0]</span></code> is not generated;</li>
<li><code class="docutils literal notranslate"><span class="pre">topics[n]</span></code>: <code class="docutils literal notranslate"><span class="pre">EVENT_INDEXED_ARGS[n</span> <span class="pre">-</span> <span class="pre">1]</span></code> (<code class="docutils literal notranslate"><span class="pre">EVENT_INDEXED_ARGS</span></code> is the series of <code class="docutils literal notranslate"><span class="pre">EVENT_ARGS</span></code> that are indexed);</li>
<li><code class="docutils literal notranslate"><span class="pre">data</span></code>: <code class="docutils literal notranslate"><span class="pre">abi_serialise(EVENT_NON_INDEXED_ARGS)</span></code> (<code class="docutils literal notranslate"><span class="pre">EVENT_NON_INDEXED_ARGS</span></code> is the series of <code class="docutils literal notranslate"><span class="pre">EVENT_ARGS</span></code> that are not indexed, <code class="docutils literal notranslate"><span class="pre">abi_serialise</span></code> is the ABI serialisation function used for returning a series of typed values from a function, as described above).</li>
</ul>
<p>For all fixed-length Solidity types, the <code class="docutils literal notranslate"><span class="pre">EVENT_INDEXED_ARGS</span></code> array contains the 32-byte encoded value directly. However, for <em>types of dynamic length</em>, which include <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code>, and arrays, <code class="docutils literal notranslate"><span class="pre">EVENT_INDEXED_ARGS</span></code> will contain the <em>Keccak hash</em> of the packed encoded value (see <a class="reference internal" href="#abi-packed-mode"><span class="std std-ref">Strict Encoding Mode</span></a>), rather than the encoded value directly. This allows applications to efficiently query for values of dynamic-length types (by setting the hash of the encoded value as the topic), but leaves applications unable to decode indexed values they have not queried for. For dynamic-length types, application developers face a trade-off between fast search for predetermined values (if the argument is indexed) and legibility of arbitrary values (which requires that the arguments not be indexed). Developers may overcome this tradeoff and achieve both efficient search and arbitrary legibility by defining events with two arguments — one indexed, one not — intended to hold the same value.</p>
</div>
<div class="section" id="json">
<span id="abi-json"></span><h3>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h3>
<p>The JSON format for a contract’s interface is given by an array of function and/or event descriptions.
A function description is a JSON object with the fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: <code class="docutils literal notranslate"><span class="pre">&quot;function&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;constructor&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;fallback&quot;</span></code> (the <a class="reference internal" href="index.html#fallback-function"><span class="std std-ref">unnamed “default” function</span></a>);</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the function;</li>
<li><code class="docutils literal notranslate"><span class="pre">inputs</span></code>: an array of objects, each of which contains:<ul>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the parameter;</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: the canonical type of the parameter (more below).</li>
<li><code class="docutils literal notranslate"><span class="pre">components</span></code>: used for tuple types (more below).</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">outputs</span></code>: an array of objects similar to <code class="docutils literal notranslate"><span class="pre">inputs</span></code>, can be omitted if function doesn’t return anything;</li>
<li><code class="docutils literal notranslate"><span class="pre">stateMutability</span></code>: a string with one of the following values: <code class="docutils literal notranslate"><span class="pre">pure</span></code> (<a class="reference internal" href="index.html#pure-functions"><span class="std std-ref">specified to not read blockchain state</span></a>), <code class="docutils literal notranslate"><span class="pre">view</span></code> (<a class="reference internal" href="index.html#view-functions"><span class="std std-ref">specified to not modify the blockchain state</span></a>), <code class="docutils literal notranslate"><span class="pre">nonpayable</span></code> (function does not accept Ether) and <code class="docutils literal notranslate"><span class="pre">payable</span></code> (function accepts Ether);</li>
<li><code class="docutils literal notranslate"><span class="pre">payable</span></code>: <code class="docutils literal notranslate"><span class="pre">true</span></code> if function accepts Ether, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise;</li>
<li><code class="docutils literal notranslate"><span class="pre">constant</span></code>: <code class="docutils literal notranslate"><span class="pre">true</span></code> if function is either <code class="docutils literal notranslate"><span class="pre">pure</span></code> or <code class="docutils literal notranslate"><span class="pre">view</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code> otherwise.</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">type</span></code> can be omitted, defaulting to <code class="docutils literal notranslate"><span class="pre">&quot;function&quot;</span></code>, likewise <code class="docutils literal notranslate"><span class="pre">payable</span></code> and <code class="docutils literal notranslate"><span class="pre">constant</span></code> can be omitted, both defaulting to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>Constructor and fallback function never have <code class="docutils literal notranslate"><span class="pre">name</span></code> or <code class="docutils literal notranslate"><span class="pre">outputs</span></code>. Fallback function doesn’t have <code class="docutils literal notranslate"><span class="pre">inputs</span></code> either.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The fields <code class="docutils literal notranslate"><span class="pre">constant</span></code> and <code class="docutils literal notranslate"><span class="pre">payable</span></code> are deprecated and will be removed in the future. Instead, the <code class="docutils literal notranslate"><span class="pre">stateMutability</span></code> field can be used to determine the same properties.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sending non-zero Ether to non-payable function will revert the transaction.</p>
</div>
<p>An event description is a JSON object with fairly similar fields:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: always <code class="docutils literal notranslate"><span class="pre">&quot;event&quot;</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the event;</li>
<li><code class="docutils literal notranslate"><span class="pre">inputs</span></code>: an array of objects, each of which contains:<ul>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of the parameter;</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code>: the canonical type of the parameter (more below).</li>
<li><code class="docutils literal notranslate"><span class="pre">components</span></code>: used for tuple types (more below).</li>
<li><code class="docutils literal notranslate"><span class="pre">indexed</span></code>: <code class="docutils literal notranslate"><span class="pre">true</span></code> if the field is part of the log’s topics, <code class="docutils literal notranslate"><span class="pre">false</span></code> if it one of the log’s data segment.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">anonymous</span></code>: <code class="docutils literal notranslate"><span class="pre">true</span></code> if the event was declared as <code class="docutils literal notranslate"><span class="pre">anonymous</span></code>.</li>
</ul>
<p>For example,</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Test</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">b</span> <span class="o">=</span> <span class="s">hex&quot;12345678901234567890123456789012&quot;</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">event</span> <span class="n">Event</span><span class="p">(</span><span class="kt">uint</span> <span class="kr">indexed</span> <span class="n">a</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">b</span><span class="p">);</span>
  <span class="kd">event</span> <span class="n">Event2</span><span class="p">(</span><span class="kt">uint</span> <span class="kr">indexed</span> <span class="n">a</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">b</span><span class="p">);</span>
  <span class="kd">function</span> <span class="n">foo</span><span class="p">(</span><span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span> <span class="kr">emit</span> <span class="n">Event</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
  <span class="kt">bytes32</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>would result in the JSON:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span>
<span class="nt">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">},{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">}],</span>
<span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Event&quot;</span>
<span class="p">},</span> <span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;event&quot;</span><span class="p">,</span>
<span class="nt">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">},{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;bytes32&quot;</span><span class="p">,</span><span class="nt">&quot;indexed&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">}],</span>
<span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Event2&quot;</span>
<span class="p">},</span> <span class="p">{</span>
<span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;function&quot;</span><span class="p">,</span>
<span class="nt">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="s2">&quot;uint256&quot;</span><span class="p">}],</span>
<span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
<span class="nt">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}]</span>
</pre></div>
</div>
<div class="section" id="handling-tuple-types">
<h4>Handling tuple types<a class="headerlink" href="#handling-tuple-types" title="Permalink to this headline">¶</a></h4>
<p>Despite that names are intentionally not part of the ABI encoding they do make a lot of sense to be included
in the JSON to enable displaying it to the end user. The structure is nested in the following way:</p>
<p>An object with members <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">type</span></code> and potentially <code class="docutils literal notranslate"><span class="pre">components</span></code> describes a typed variable.
The canonical type is determined until a tuple type is reached and the string description up
to that point is stored in <code class="docutils literal notranslate"><span class="pre">type</span></code> prefix with the word <code class="docutils literal notranslate"><span class="pre">tuple</span></code>, i.e. it will be <code class="docutils literal notranslate"><span class="pre">tuple</span></code> followed by
a sequence of <code class="docutils literal notranslate"><span class="pre">[]</span></code> and <code class="docutils literal notranslate"><span class="pre">[k]</span></code> with
integers <code class="docutils literal notranslate"><span class="pre">k</span></code>. The components of the tuple are then stored in the member <code class="docutils literal notranslate"><span class="pre">components</span></code>,
which is of array type and has the same structure as the top-level object except that
<code class="docutils literal notranslate"><span class="pre">indexed</span></code> is not allowed there.</p>
<p>As an example, the code</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">19</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="kr">pragma experimental</span> <span class="n">ABIEncoderV2</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Test</span> <span class="p">{</span>
  <span class="kd">struct</span> <span class="n">S</span> <span class="p">{</span> <span class="kt">uint</span> <span class="n">a</span><span class="p">;</span> <span class="kt">uint</span><span class="p">[]</span> <span class="n">b</span><span class="p">;</span> <span class="n">T</span><span class="p">[]</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">struct</span> <span class="n">T</span> <span class="p">{</span> <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span> <span class="kt">uint</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span>
  <span class="kd">function</span> <span class="n">f</span><span class="p">(</span><span class="n">S</span> <span class="kr">memory</span> <span class="n">s</span><span class="p">,</span> <span class="n">T</span> <span class="kr">memory</span> <span class="n">t</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">a</span><span class="p">)</span> <span class="kr">public</span><span class="p">;</span>
  <span class="kd">function</span> <span class="n">g</span><span class="p">()</span> <span class="kr">public</span> <span class="k">returns</span> <span class="p">(</span><span class="n">S</span> <span class="kr">memory</span> <span class="n">s</span><span class="p">,</span> <span class="n">T</span> <span class="kr">memory</span> <span class="n">t</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>would result in the JSON:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span>
    <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span>
    <span class="nt">&quot;inputs&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tuple&quot;</span><span class="p">,</span>
        <span class="nt">&quot;components&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256[]&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tuple[]&quot;</span><span class="p">,</span>
            <span class="nt">&quot;components&quot;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
                <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;t&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;tuple&quot;</span><span class="p">,</span>
        <span class="nt">&quot;components&quot;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;uint256&quot;</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;outputs&quot;</span><span class="p">:</span> <span class="p">[]</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="strict-encoding-mode">
<span id="abi-packed-mode"></span><h3>Strict Encoding Mode<a class="headerlink" href="#strict-encoding-mode" title="Permalink to this headline">¶</a></h3>
<p>Strict encoding mode is the mode that leads to exactly the same encoding as defined in the formal specification above.
This means offsets have to be as small as possible while still not creating overlaps in the data areas and thus no gaps are
allowed.</p>
<p>Usually, ABI decoders are written in a straightforward way just following offset pointers, but some decoders
might enforce strict mode. The Solidity ABI decoder currently does not enforce strict mode, but the encoder
always creates data in strict mode.</p>
</div>
<div class="section" id="non-standard-packed-mode">
<h3>Non-standard Packed Mode<a class="headerlink" href="#non-standard-packed-mode" title="Permalink to this headline">¶</a></h3>
<p>Through <code class="docutils literal notranslate"><span class="pre">abi.encodePacked()</span></code>, Solidity supports a non-standard packed mode where:</p>
<ul class="simple">
<li>types shorter than 32 bytes are neither zero padded nor sign extended and</li>
<li>dynamic types are encoded in-place and without the length.</li>
</ul>
<p>This packed mode is mainly used for indexed event parameters.</p>
<p>As an example, the encoding of <code class="docutils literal notranslate"><span class="pre">int16(-1),</span> <span class="pre">bytes1(0x42),</span> <span class="pre">uint16(0x03),</span> <span class="pre">string(&quot;Hello,</span> <span class="pre">world!&quot;)</span></code> results in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0xffff42000348656c6c6f2c20776f726c6421
  ^^^^                                 int16(-1)
      ^^                               bytes1(0x42)
        ^^^^                           uint16(0x03)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^ string(&quot;Hello, world!&quot;) without a length field
</pre></div>
</div>
<dl class="docutils">
<dt>More specifically:</dt>
<dd><ul class="first last simple">
<li>Each value type takes as many bytes as its range has.</li>
<li>The encoding of a struct or fixed-size array is the concatenation of the
encoding of its members/elements without any separator or padding.</li>
<li>Mapping members of structs are ignored as usual.</li>
<li>Dynamically-sized types like <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">bytes</span></code> or <code class="docutils literal notranslate"><span class="pre">uint[]</span></code> are encoded without
their length field.</li>
</ul>
</dd>
</dl>
<p>In general, the encoding is ambiguous as soon as there are two dynamically-sized elements,
because of the missing length field.</p>
<p>If padding is needed, explicit type conversions can be used: <code class="docutils literal notranslate"><span class="pre">abi.encodePacked(uint16(0x12))</span> <span class="pre">==</span> <span class="pre">hex&quot;0012&quot;</span></code>.</p>
<p>Since packed encoding is not used when calling functions, there is no special support
for prepending a function selector. Since the encoding is ambiguous, there is no decoding function.</p>
</div>
</div>
<span id="document-yul"></span><div class="section" id="yul">
<h2>Yul<a class="headerlink" href="#yul" title="Permalink to this headline">¶</a></h2>
<span class="target" id="id1"></span><p id="index-0">Yul (previously also called JULIA or IULIA) is an intermediate language that can
compile to various different backends
(EVM 1.0, EVM 1.5 and eWASM are planned).
Because of that, it is designed to be a usable common denominator of all three
platforms.
It can already be used for “inline assembly” inside Solidity and
future versions of the Solidity compiler will even use Yul as intermediate
language. It should also be easy to build high-level optimizer stages for Yul.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the flavour used for “inline assembly” does not have types
(everything is <code class="docutils literal notranslate"><span class="pre">u256</span></code>) and the built-in functions are identical
to the EVM opcodes. Please resort to the inline assembly documentation
for details.</p>
</div>
<p>The core components of Yul are functions, blocks, variables, literals,
for-loops, if-statements, switch-statements, expressions and assignments to variables.</p>
<p>Yul is typed, both variables and literals must specify the type with postfix
notation. The supported types are <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">u8</span></code>, <code class="docutils literal notranslate"><span class="pre">s8</span></code>, <code class="docutils literal notranslate"><span class="pre">u32</span></code>, <code class="docutils literal notranslate"><span class="pre">s32</span></code>,
<code class="docutils literal notranslate"><span class="pre">u64</span></code>, <code class="docutils literal notranslate"><span class="pre">s64</span></code>, <code class="docutils literal notranslate"><span class="pre">u128</span></code>, <code class="docutils literal notranslate"><span class="pre">s128</span></code>, <code class="docutils literal notranslate"><span class="pre">u256</span></code> and <code class="docutils literal notranslate"><span class="pre">s256</span></code>.</p>
<p>Yul in itself does not even provide operators. If the EVM is targeted,
opcodes will be available as built-in functions, but they can be reimplemented
if the backend changes. For a list of mandatory built-in functions, see the section below.</p>
<p>The following example program assumes that the EVM opcodes <code class="docutils literal notranslate"><span class="pre">mul</span></code>, <code class="docutils literal notranslate"><span class="pre">div</span></code>
and <code class="docutils literal notranslate"><span class="pre">mod</span></code> are available either natively or as functions and computes exponentiation.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kd">function</span> <span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="o">:</span><span class="n">u256</span><span class="p">,</span> <span class="n">exponent</span><span class="o">:</span><span class="n">u256</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">result</span><span class="o">:</span><span class="n">u256</span>
    <span class="p">{</span>
        <span class="n">switch</span> <span class="n">exponent</span>
        <span class="n">case</span> <span class="mi">0</span><span class="o">:</span><span class="n">u256</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">:</span><span class="n">u256</span> <span class="p">}</span>
        <span class="n">case</span> <span class="mi">1</span><span class="o">:</span><span class="n">u256</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">base</span> <span class="p">}</span>
        <span class="kr">default</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">:=</span> <span class="n">power</span><span class="p">(</span><span class="n">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">base</span><span class="p">),</span> <span class="n">div</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="n">u256</span><span class="p">))</span>
            <span class="n">switch</span> <span class="n">mod</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="mi">2</span><span class="o">:</span><span class="n">u256</span><span class="p">)</span>
                <span class="n">case</span> <span class="mi">1</span><span class="o">:</span><span class="n">u256</span> <span class="p">{</span> <span class="n">result</span> <span class="o">:=</span> <span class="n">mul</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also possible to implement the same function using a for-loop
instead of with recursion. Here, we need the EVM opcodes <code class="docutils literal notranslate"><span class="pre">lt</span></code> (less-than)
and <code class="docutils literal notranslate"><span class="pre">add</span></code> to be available.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="kd">function</span> <span class="n">power</span><span class="p">(</span><span class="n">base</span><span class="o">:</span><span class="n">u256</span><span class="p">,</span> <span class="n">exponent</span><span class="o">:</span><span class="n">u256</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">result</span><span class="o">:</span><span class="n">u256</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">:</span><span class="n">u256</span>
        <span class="k">for</span> <span class="p">{</span> <span class="n">let</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">:</span><span class="n">u256</span> <span class="p">}</span> <span class="n">lt</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="p">{</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="o">:</span><span class="n">u256</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">{</span>
            <span class="n">result</span> <span class="o">:=</span> <span class="n">mul</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="specification-of-yul">
<h3>Specification of Yul<a class="headerlink" href="#specification-of-yul" title="Permalink to this headline">¶</a></h3>
<p>This chapter describes Yul code. It is usually placed inside a Yul object, which is described in the following chapter.</p>
<p>Grammar:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Block</span> <span class="o">=</span> <span class="s">&#39;{&#39;</span> <span class="n">Statement</span><span class="o">*</span> <span class="s">&#39;}&#39;</span>
<span class="n">Statement</span> <span class="o">=</span>
    <span class="n">Block</span> <span class="o">|</span>
    <span class="n">FunctionDefinition</span> <span class="o">|</span>
    <span class="n">VariableDeclaration</span> <span class="o">|</span>
    <span class="n">Assignment</span> <span class="o">|</span>
    <span class="n">If</span> <span class="o">|</span>
    <span class="n">Expression</span> <span class="o">|</span>
    <span class="n">Switch</span> <span class="o">|</span>
    <span class="n">ForLoop</span> <span class="o">|</span>
    <span class="n">BreakContinue</span>
<span class="n">FunctionDefinition</span> <span class="o">=</span>
    <span class="s">&#39;function&#39;</span> <span class="n">Identifier</span> <span class="s">&#39;(&#39;</span> <span class="n">TypedIdentifierList</span><span class="o">?</span> <span class="s">&#39;)&#39;</span>
    <span class="p">(</span> <span class="s">&#39;-&gt;&#39;</span> <span class="n">TypedIdentifierList</span> <span class="p">)</span><span class="o">?</span> <span class="n">Block</span>
<span class="n">VariableDeclaration</span> <span class="o">=</span>
    <span class="s">&#39;let&#39;</span> <span class="n">TypedIdentifierList</span> <span class="p">(</span> <span class="s">&#39;:=&#39;</span> <span class="n">Expression</span> <span class="p">)</span><span class="o">?</span>
<span class="n">Assignment</span> <span class="o">=</span>
    <span class="n">IdentifierList</span> <span class="s">&#39;:=&#39;</span> <span class="n">Expression</span>
<span class="n">Expression</span> <span class="o">=</span>
    <span class="n">FunctionCall</span> <span class="o">|</span> <span class="n">Identifier</span> <span class="o">|</span> <span class="n">Literal</span>
<span class="n">If</span> <span class="o">=</span>
    <span class="s">&#39;if&#39;</span> <span class="n">Expression</span> <span class="n">Block</span>
<span class="n">Switch</span> <span class="o">=</span>
    <span class="s">&#39;switch&#39;</span> <span class="n">Expression</span> <span class="p">(</span> <span class="n">Case</span><span class="o">+</span> <span class="n">Default</span><span class="o">?</span> <span class="o">|</span> <span class="n">Default</span> <span class="p">)</span>
<span class="n">Case</span> <span class="o">=</span>
    <span class="s">&#39;case&#39;</span> <span class="n">Literal</span> <span class="n">Block</span>
<span class="n">Default</span> <span class="o">=</span>
    <span class="s">&#39;default&#39;</span> <span class="n">Block</span>
<span class="n">ForLoop</span> <span class="o">=</span>
    <span class="s">&#39;for&#39;</span> <span class="n">Block</span> <span class="n">Expression</span> <span class="n">Block</span> <span class="n">Block</span>
<span class="n">BreakContinue</span> <span class="o">=</span>
    <span class="s">&#39;break&#39;</span> <span class="o">|</span> <span class="s">&#39;continue&#39;</span>
<span class="n">FunctionCall</span> <span class="o">=</span>
    <span class="n">Identifier</span> <span class="s">&#39;(&#39;</span> <span class="p">(</span> <span class="n">Expression</span> <span class="p">(</span> <span class="s">&#39;,&#39;</span> <span class="n">Expression</span> <span class="p">)</span><span class="o">*</span> <span class="p">)</span><span class="o">?</span> <span class="s">&#39;)&#39;</span>
<span class="n">Identifier</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_</span><span class="err">$</span><span class="p">]</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z_</span><span class="err">$</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span>
<span class="n">IdentifierList</span> <span class="o">=</span> <span class="n">Identifier</span> <span class="p">(</span> <span class="s">&#39;,&#39;</span> <span class="n">Identifier</span><span class="p">)</span><span class="o">*</span>
<span class="n">TypeName</span> <span class="o">=</span> <span class="n">Identifier</span> <span class="o">|</span> <span class="n">BuiltinTypeName</span>
<span class="n">BuiltinTypeName</span> <span class="o">=</span> <span class="s">&#39;bool&#39;</span> <span class="o">|</span> <span class="p">[</span><span class="n">us</span><span class="p">]</span> <span class="p">(</span> <span class="s">&#39;8&#39;</span> <span class="o">|</span> <span class="s">&#39;32&#39;</span> <span class="o">|</span> <span class="s">&#39;64&#39;</span> <span class="o">|</span> <span class="s">&#39;128&#39;</span> <span class="o">|</span> <span class="s">&#39;256&#39;</span> <span class="p">)</span>
<span class="n">TypedIdentifierList</span> <span class="o">=</span> <span class="n">Identifier</span> <span class="s">&#39;:&#39;</span> <span class="n">TypeName</span> <span class="p">(</span> <span class="s">&#39;,&#39;</span> <span class="n">Identifier</span> <span class="s">&#39;:&#39;</span> <span class="n">TypeName</span> <span class="p">)</span><span class="o">*</span>
<span class="n">Literal</span> <span class="o">=</span>
    <span class="p">(</span><span class="n">NumberLiteral</span> <span class="o">|</span> <span class="n">StringLiteral</span> <span class="o">|</span> <span class="n">HexLiteral</span> <span class="o">|</span> <span class="n">TrueLiteral</span> <span class="o">|</span> <span class="n">FalseLiteral</span><span class="p">)</span> <span class="s">&#39;:&#39;</span> <span class="n">TypeName</span>
<span class="n">NumberLiteral</span> <span class="o">=</span> <span class="n">HexNumber</span> <span class="o">|</span> <span class="n">DecimalNumber</span>
<span class="n">HexLiteral</span> <span class="o">=</span> <span class="s">&#39;hex&#39;</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">|</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">StringLiteral</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="p">([</span><span class="o">^</span><span class="s">&quot;</span><span class="se">\r\n\\</span><span class="s">] | &#39;</span><span class="se">\\</span><span class="s">&#39; .)* &#39;&quot;&#39;</span>
<span class="n">TrueLiteral</span> <span class="o">=</span> <span class="s">&#39;true&#39;</span>
<span class="n">FalseLiteral</span> <span class="o">=</span> <span class="s">&#39;false&#39;</span>
<span class="n">HexNumber</span> <span class="o">=</span> <span class="s">&#39;0x&#39;</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]</span><span class="o">+</span>
<span class="n">DecimalNumber</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span>
</pre></div>
</div>
<div class="section" id="restrictions-on-the-grammar">
<h4>Restrictions on the Grammar<a class="headerlink" href="#restrictions-on-the-grammar" title="Permalink to this headline">¶</a></h4>
<p>Switches must have at least one case (including the default case).
If all possible values of the expression are covered, a default case should
not be allowed (i.e. a switch with a <code class="docutils literal notranslate"><span class="pre">bool</span></code> expression that has both a
true and a false case should not allow a default case). All case values need to
have the same type.</p>
<p>Every expression evaluates to zero or more values. Identifiers and Literals
evaluate to exactly
one value and function calls evaluate to a number of values equal to the
number of return values of the function called.</p>
<p>In variable declarations and assignments, the right-hand-side expression
(if present) has to evaluate to a number of values equal to the number of
variables on the left-hand-side.
This is the only situation where an expression evaluating
to more than one value is allowed.</p>
<p>Expressions that are also statements (i.e. at the block level) have to
evaluate to zero values.</p>
<p>In all other situations, expressions have to evaluate to exactly one value.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">continue</span></code> and <code class="docutils literal notranslate"><span class="pre">break</span></code> statements can only be used inside loop bodies
and have to be in the same function as the loop (or both have to be at the
top level).
The condition part of the for-loop has to evaluate to exactly one value.</p>
<p>Literals cannot be larger than the their type. The largest type defined is 256-bit wide.</p>
</div>
<div class="section" id="scoping-rules">
<h4>Scoping Rules<a class="headerlink" href="#scoping-rules" title="Permalink to this headline">¶</a></h4>
<p>Scopes in Yul are tied to Blocks (exceptions are functions and the for loop
as explained below) and all declarations
(<code class="docutils literal notranslate"><span class="pre">FunctionDefinition</span></code>, <code class="docutils literal notranslate"><span class="pre">VariableDeclaration</span></code>)
introduce new identifiers into these scopes.</p>
<p>Identifiers are visible in
the block they are defined in (including all sub-nodes and sub-blocks).
As an exception, identifiers defined in the “init” part of the for-loop
(the first block) are visible in all other parts of the for-loop
(but not outside of the loop).
Identifiers declared in the other parts of the for loop respect the regular
syntactical scoping rules.
The parameters and return parameters of functions are visible in the
function body and their names cannot overlap.</p>
<p>Variables can only be referenced after their declaration. In particular,
variables cannot be referenced in the right hand side of their own variable
declaration.
Functions can be referenced already before their declaration (if they are visible).</p>
<p>Shadowing is disallowed, i.e. you cannot declare an identifier at a point
where another identifier with the same name is also visible, even if it is
not accessible.</p>
<p>Inside functions, it is not possible to access a variable that was declared
outside of that function.</p>
</div>
<div class="section" id="formal-specification">
<h4>Formal Specification<a class="headerlink" href="#formal-specification" title="Permalink to this headline">¶</a></h4>
<p>We formally specify Yul by providing an evaluation function E overloaded
on the various nodes of the AST. Any functions can have side effects, so
E takes two state objects and the AST node and returns two new
state objects and a variable number of other values.
The two state objects are the global state object
(which in the context of the EVM is the memory, storage and state of the
blockchain) and the local state object (the state of local variables, i.e. a
segment of the stack in the EVM).
If the AST node is a statement, E returns the two state objects and a “mode”,
which is used for the <code class="docutils literal notranslate"><span class="pre">break</span></code> and <code class="docutils literal notranslate"><span class="pre">continue</span></code> statements.
If the AST node is an expression, E returns the two state objects and
as many values as the expression evaluates to.</p>
<p>The exact nature of the global state is unspecified for this high level
description. The local state <code class="docutils literal notranslate"><span class="pre">L</span></code> is a mapping of identifiers <code class="docutils literal notranslate"><span class="pre">i</span></code> to values <code class="docutils literal notranslate"><span class="pre">v</span></code>,
denoted as <code class="docutils literal notranslate"><span class="pre">L[i]</span> <span class="pre">=</span> <span class="pre">v</span></code>.</p>
<p>For an identifier <code class="docutils literal notranslate"><span class="pre">v</span></code>, let <code class="docutils literal notranslate"><span class="pre">$v</span></code> be the name of the identifier.</p>
<p>We will use a destructuring notation for the AST nodes.</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="p">{</span><span class="n">St1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">Stn</span><span class="p">}</span><span class="o">&gt;:</span> <span class="n">Block</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">let</span> <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">St1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">Stn</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">L2</span> <span class="n">be</span> <span class="n">a</span> <span class="n">restriction</span> <span class="n">of</span> <span class="n">L1</span> <span class="n">to</span> <span class="n">the</span> <span class="n">identifiers</span> <span class="n">of</span> <span class="n">L</span>
    <span class="n">G1</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">mode</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">St1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">Stn</span><span class="o">:</span> <span class="n">Statement</span><span class="p">)</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">n</span> <span class="kr">is</span> <span class="n">zero</span><span class="o">:</span>
        <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">regular</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="n">let</span> <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">St1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="kr">is</span> <span class="n">regular</span> <span class="n">then</span>
            <span class="n">E</span><span class="p">(</span><span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">St2</span><span class="p">,</span> <span class="p">...,</span> <span class="n">Stn</span><span class="p">)</span>
        <span class="n">otherwise</span>
            <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">mode</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">FunctionDefinition</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">regular</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">let</span> <span class="n">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">varn</span> <span class="o">:=</span> <span class="n">rhs</span><span class="o">&gt;:</span> <span class="n">VariableDeclaration</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">varn</span> <span class="o">:=</span> <span class="n">rhs</span><span class="o">&gt;:</span> <span class="n">Assignment</span><span class="p">)</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">let</span> <span class="n">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">varn</span><span class="o">&gt;:</span> <span class="n">VariableDeclaration</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">let</span> <span class="n">L1</span> <span class="n">be</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">L</span> <span class="n">where</span> <span class="n">L1</span><span class="p">[</span><span class="err">$</span><span class="n">vari</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">n</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">regular</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">var1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">varn</span> <span class="o">:=</span> <span class="n">rhs</span><span class="o">&gt;:</span> <span class="n">Assignment</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">let</span> <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">vn</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="n">let</span> <span class="n">L2</span> <span class="n">be</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">L1</span> <span class="n">where</span> <span class="n">L2</span><span class="p">[</span><span class="err">$</span><span class="n">vari</span><span class="p">]</span> <span class="o">=</span> <span class="n">vi</span> <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">n</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">regular</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">for</span> <span class="p">{</span> <span class="n">i1</span><span class="p">,</span> <span class="p">...,</span> <span class="k">in</span> <span class="p">}</span> <span class="n">condition</span> <span class="n">post</span> <span class="n">body</span><span class="o">&gt;:</span> <span class="n">ForLoop</span><span class="p">)</span> <span class="o">=</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">:</span>
        <span class="n">let</span> <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="p">...,</span> <span class="k">in</span><span class="p">)</span>
        <span class="c1">// mode has to be regular due to the syntactic restrictions</span>
        <span class="n">let</span> <span class="n">G2</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="k">for</span> <span class="p">{}</span> <span class="n">condition</span> <span class="n">post</span> <span class="n">body</span><span class="p">)</span>
        <span class="c1">// mode has to be regular due to the syntactic restrictions</span>
        <span class="n">let</span> <span class="n">L3</span> <span class="n">be</span> <span class="n">the</span> <span class="n">restriction</span> <span class="n">of</span> <span class="n">L2</span> <span class="n">to</span> <span class="n">only</span> <span class="n">variables</span> <span class="n">of</span> <span class="n">L</span>
        <span class="n">G2</span><span class="p">,</span> <span class="n">L3</span><span class="p">,</span> <span class="n">regular</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="n">let</span> <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="kr">is</span> <span class="kc">false</span><span class="o">:</span>
            <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">regular</span>
        <span class="k">else</span><span class="o">:</span>
            <span class="n">let</span> <span class="n">G2</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G1</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="kr">is</span> <span class="k">break</span><span class="o">:</span>
                <span class="n">G2</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">regular</span>
            <span class="k">else</span><span class="o">:</span>
                <span class="n">G3</span><span class="p">,</span> <span class="n">L3</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G2</span><span class="p">,</span> <span class="n">L2</span><span class="p">,</span> <span class="n">post</span><span class="p">)</span>
                <span class="n">E</span><span class="p">(</span><span class="n">G3</span><span class="p">,</span> <span class="n">L3</span><span class="p">,</span> <span class="k">for</span> <span class="p">{}</span> <span class="n">condition</span> <span class="n">post</span> <span class="n">body</span><span class="p">)</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="k">break</span><span class="o">:</span> <span class="n">BreakContinue</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="k">break</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="k">continue</span><span class="o">:</span> <span class="n">BreakContinue</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="k">continue</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">if</span> <span class="n">condition</span> <span class="n">body</span><span class="o">&gt;:</span> <span class="n">If</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">let</span> <span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">v</span> <span class="kr">is</span> <span class="kc">true</span><span class="o">:</span>
        <span class="n">E</span><span class="p">(</span><span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">regular</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">switch</span> <span class="n">condition</span> <span class="n">case</span> <span class="n">l1</span><span class="o">:</span><span class="n">t1</span> <span class="n">st1</span> <span class="p">...</span> <span class="n">case</span> <span class="n">ln</span><span class="o">:</span><span class="n">tn</span> <span class="n">stn</span><span class="o">&gt;:</span> <span class="n">Switch</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">switch</span> <span class="n">condition</span> <span class="n">case</span> <span class="n">l1</span><span class="o">:</span><span class="n">t1</span> <span class="n">st1</span> <span class="p">...</span> <span class="n">case</span> <span class="n">ln</span><span class="o">:</span><span class="n">tn</span> <span class="n">stn</span> <span class="kr">default</span> <span class="p">{})</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">switch</span> <span class="n">condition</span> <span class="n">case</span> <span class="n">l1</span><span class="o">:</span><span class="n">t1</span> <span class="n">st1</span> <span class="p">...</span> <span class="n">case</span> <span class="n">ln</span><span class="o">:</span><span class="n">tn</span> <span class="n">stn</span> <span class="kr">default</span> <span class="n">st</span><span class="s">&#39;&gt;: Switch) =</span>
    <span class="n">let</span> <span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
    <span class="c1">// i = 1 .. n</span>
    <span class="c1">// Evaluate literals, context doesn&#39;t matter</span>
    <span class="n">let</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">l1</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">let</span> <span class="kr">_</span><span class="p">,</span> <span class="kr">_</span><span class="p">,</span> <span class="n">vn</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">ln</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">there</span> <span class="n">exists</span> <span class="n">smallest</span> <span class="n">i</span> <span class="n">such</span> <span class="n">that</span> <span class="n">vi</span> <span class="o">=</span> <span class="n">v</span><span class="o">:</span>
        <span class="n">E</span><span class="p">(</span><span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">sti</span><span class="p">)</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="n">E</span><span class="p">(</span><span class="n">G0</span><span class="p">,</span> <span class="n">L0</span><span class="p">,</span> <span class="n">st</span><span class="s">&#39;)</span>

<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;:</span> <span class="n">Identifier</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">L</span><span class="p">[</span><span class="err">$</span><span class="n">name</span><span class="p">]</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">fname</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">argn</span><span class="p">)</span><span class="o">&gt;:</span> <span class="n">FunctionCall</span><span class="p">)</span> <span class="o">=</span>
    <span class="n">G1</span><span class="p">,</span> <span class="n">L1</span><span class="p">,</span> <span class="n">vn</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">argn</span><span class="p">)</span>
    <span class="p">...</span>
    <span class="n">G</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">L</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">L</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">arg2</span><span class="p">)</span>
    <span class="n">Gn</span><span class="p">,</span> <span class="n">Ln</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">L</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">arg1</span><span class="p">)</span>
    <span class="n">Let</span> <span class="o">&lt;</span><span class="kd">function</span> <span class="n">fname</span> <span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">paramn</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ret1</span><span class="p">,</span> <span class="p">...,</span> <span class="n">retm</span> <span class="n">block</span><span class="o">&gt;</span>
    <span class="n">be</span> <span class="n">the</span> <span class="kd">function</span> <span class="n">of</span> <span class="n">name</span> <span class="err">$</span><span class="n">fname</span> <span class="n">visible</span> <span class="n">at</span> <span class="n">the</span> <span class="n">point</span> <span class="n">of</span> <span class="n">the</span> <span class="nf">call</span><span class="p">.</span>
    <span class="n">Let</span> <span class="n">L</span><span class="s">&#39; be a new local state such that</span>
    <span class="n">L</span><span class="s">&#39;[$parami] = vi and L&#39;</span><span class="p">[</span><span class="err">$</span><span class="n">reti</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">all</span> <span class="n">i</span><span class="p">.</span>
    <span class="n">Let</span> <span class="n">G</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">L</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">Gn</span><span class="p">,</span> <span class="n">L</span><span class="s">&#39;, block)</span>
    <span class="n">G</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">Ln</span><span class="p">,</span> <span class="n">L</span><span class="s">&#39;&#39;</span><span class="p">[</span><span class="err">$</span><span class="n">ret1</span><span class="p">],</span> <span class="p">...,</span> <span class="n">L</span><span class="s">&#39;&#39;</span><span class="p">[</span><span class="err">$</span><span class="n">retm</span><span class="p">]</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">l</span><span class="o">:</span> <span class="n">HexLiteral</span><span class="p">)</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">hexString</span><span class="p">(</span><span class="n">l</span><span class="p">),</span>
    <span class="n">where</span> <span class="n">hexString</span> <span class="n">decodes</span> <span class="n">l</span> <span class="kr">from</span> <span class="n">hex</span> <span class="n">and</span> <span class="n">left</span><span class="o">-</span><span class="n">aligns</span> <span class="n">it</span> <span class="n">into</span> <span class="mi">32</span> <span class="kt">bytes</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">l</span><span class="o">:</span> <span class="n">StringLiteral</span><span class="p">)</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">utf8EncodeLeftAligned</span><span class="p">(</span><span class="n">l</span><span class="p">),</span>
    <span class="n">where</span> <span class="n">utf8EncodeLeftAligned</span> <span class="n">performs</span> <span class="n">a</span> <span class="n">utf8</span> <span class="n">encoding</span> <span class="n">of</span> <span class="n">l</span>
    <span class="n">and</span> <span class="n">aligns</span> <span class="n">it</span> <span class="n">left</span> <span class="n">into</span> <span class="mi">32</span> <span class="kt">bytes</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">n</span><span class="o">:</span> <span class="n">HexNumber</span><span class="p">)</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">hex</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">where</span> <span class="n">hex</span> <span class="kr">is</span> <span class="n">the</span> <span class="n">hexadecimal</span> <span class="n">decoding</span> <span class="kd">function</span>
<span class="n">E</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">n</span><span class="o">:</span> <span class="n">DecimalNumber</span><span class="p">)</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">dec</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
    <span class="n">where</span> <span class="n">dec</span> <span class="kr">is</span> <span class="n">the</span> <span class="n">decimal</span> <span class="n">decoding</span> <span class="kd">function</span>
</pre></div>
</div>
</div>
<div class="section" id="type-conversion-functions">
<h4>Type Conversion Functions<a class="headerlink" href="#type-conversion-functions" title="Permalink to this headline">¶</a></h4>
<p>Yul has no support for implicit type conversion and therefore functions exist to provide explicit conversion.
When converting a larger type to a shorter type a runtime exception can occur in case of an overflow.</p>
<dl class="docutils">
<dt>Truncating conversions are supported between the following types:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">bool</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">u32</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">u64</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">u256</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">s256</span></code></li>
</ul>
</dd>
</dl>
<p>For each of these a type conversion function exists having the prototype in the form of <code class="docutils literal notranslate"><span class="pre">&lt;input_type&gt;to&lt;output_type&gt;(x:&lt;input_type&gt;)</span> <span class="pre">-&gt;</span> <span class="pre">y:&lt;output_type&gt;</span></code>,
such as <code class="docutils literal notranslate"><span class="pre">u32tobool(x:u32)</span> <span class="pre">-&gt;</span> <span class="pre">y:bool</span></code>, <code class="docutils literal notranslate"><span class="pre">u256tou32(x:u256)</span> <span class="pre">-&gt;</span> <span class="pre">y:u32</span></code> or <code class="docutils literal notranslate"><span class="pre">s256tou256(x:s256)</span> <span class="pre">-&gt;</span> <span class="pre">y:u256</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">u32tobool(x:u32)</span> <span class="pre">-&gt;</span> <span class="pre">y:bool</span></code> can be implemented as <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">:=</span> <span class="pre">not(iszerou256(x))</span></code> and
<code class="docutils literal notranslate"><span class="pre">booltou32(x:bool)</span> <span class="pre">-&gt;</span> <span class="pre">y:u32</span></code> can be implemented as <code class="docutils literal notranslate"><span class="pre">switch</span> <span class="pre">x</span> <span class="pre">case</span> <span class="pre">true:bool</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">1:u32</span> <span class="pre">}</span> <span class="pre">case</span> <span class="pre">false:bool</span> <span class="pre">{</span> <span class="pre">y</span> <span class="pre">:=</span> <span class="pre">0:u32</span> <span class="pre">}</span></code></p>
</div>
</div>
<div class="section" id="low-level-functions">
<h4>Low-level Functions<a class="headerlink" href="#low-level-functions" title="Permalink to this headline">¶</a></h4>
<p>The following functions must be available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td colspan="2"><em>Logic</em></td>
</tr>
<tr class="row-even"><td>not(x:bool) -&gt; z:bool</td>
<td>logical not</td>
</tr>
<tr class="row-odd"><td>and(x:bool, y:bool) -&gt; z:bool</td>
<td>logical and</td>
</tr>
<tr class="row-even"><td>or(x:bool, y:bool) -&gt; z:bool</td>
<td>logical or</td>
</tr>
<tr class="row-odd"><td>xor(x:bool, y:bool) -&gt; z:bool</td>
<td>xor</td>
</tr>
<tr class="row-even"><td colspan="2"><em>Arithmetic</em></td>
</tr>
<tr class="row-odd"><td>addu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x + y</td>
</tr>
<tr class="row-even"><td>subu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x - y</td>
</tr>
<tr class="row-odd"><td>mulu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x * y</td>
</tr>
<tr class="row-even"><td>divu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x / y</td>
</tr>
<tr class="row-odd"><td>divs256(x:s256, y:s256) -&gt; z:s256</td>
<td>x / y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-even"><td>modu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x % y</td>
</tr>
<tr class="row-odd"><td>mods256(x:s256, y:s256) -&gt; z:s256</td>
<td>x % y, for signed numbers in two’s complement</td>
</tr>
<tr class="row-even"><td>signextendu256(i:u256, x:u256) -&gt; z:u256</td>
<td>sign extend from (i*8+7)th bit counting from least significant</td>
</tr>
<tr class="row-odd"><td>expu256(x:u256, y:u256) -&gt; z:u256</td>
<td>x to the power of y</td>
</tr>
<tr class="row-even"><td>addmodu256(x:u256, y:u256, m:u256) -&gt; z:u256</td>
<td>(x + y) % m with arbitrary precision arithmetic</td>
</tr>
<tr class="row-odd"><td>mulmodu256(x:u256, y:u256, m:u256) -&gt; z:u256</td>
<td>(x * y) % m with arbitrary precision arithmetic</td>
</tr>
<tr class="row-even"><td>ltu256(x:u256, y:u256) -&gt; z:bool</td>
<td>true if x &lt; y, false otherwise</td>
</tr>
<tr class="row-odd"><td>gtu256(x:u256, y:u256) -&gt; z:bool</td>
<td>true if x &gt; y, false otherwise</td>
</tr>
<tr class="row-even"><td>lts256(x:s256, y:s256) -&gt; z:bool</td>
<td>true if x &lt; y, false otherwise
(for signed numbers in two’s complement)</td>
</tr>
<tr class="row-odd"><td>gts256(x:s256, y:s256) -&gt; z:bool</td>
<td>true if x &gt; y, false otherwise
(for signed numbers in two’s complement)</td>
</tr>
<tr class="row-even"><td>equ256(x:u256, y:u256) -&gt; z:bool</td>
<td>true if x == y, false otherwise</td>
</tr>
<tr class="row-odd"><td>iszerou256(x:u256) -&gt; z:bool</td>
<td>true if x == 0, false otherwise</td>
</tr>
<tr class="row-even"><td>notu256(x:u256) -&gt; z:u256</td>
<td>~x, every bit of x is negated</td>
</tr>
<tr class="row-odd"><td>andu256(x:u256, y:u256) -&gt; z:u256</td>
<td>bitwise and of x and y</td>
</tr>
<tr class="row-even"><td>oru256(x:u256, y:u256) -&gt; z:u256</td>
<td>bitwise or of x and y</td>
</tr>
<tr class="row-odd"><td>xoru256(x:u256, y:u256) -&gt; z:u256</td>
<td>bitwise xor of x and y</td>
</tr>
<tr class="row-even"><td>shlu256(x:u256, y:u256) -&gt; z:u256</td>
<td>logical left shift of x by y</td>
</tr>
<tr class="row-odd"><td>shru256(x:u256, y:u256) -&gt; z:u256</td>
<td>logical right shift of x by y</td>
</tr>
<tr class="row-even"><td>sars256(x:s256, y:u256) -&gt; z:u256</td>
<td>arithmetic right shift of x by y</td>
</tr>
<tr class="row-odd"><td>byte(n:u256, x:u256) -&gt; v:u256</td>
<td>nth byte of x, where the most significant byte is the 0th byte
Cannot this be just replaced by and256(shr256(n, x), 0xff) and
let it be optimised out by the EVM backend?</td>
</tr>
<tr class="row-even"><td colspan="2"><em>Memory and storage</em></td>
</tr>
<tr class="row-odd"><td>mload(p:u256) -&gt; v:u256</td>
<td>mem[p..(p+32))</td>
</tr>
<tr class="row-even"><td>mstore(p:u256, v:u256)</td>
<td>mem[p..(p+32)) := v</td>
</tr>
<tr class="row-odd"><td>mstore8(p:u256, v:u256)</td>
<td>mem[p] := v &amp; 0xff    - only modifies a single byte</td>
</tr>
<tr class="row-even"><td>sload(p:u256) -&gt; v:u256</td>
<td>storage[p]</td>
</tr>
<tr class="row-odd"><td>sstore(p:u256, v:u256)</td>
<td>storage[p] := v</td>
</tr>
<tr class="row-even"><td>msize() -&gt; size:u256</td>
<td>size of memory, i.e. largest accessed memory index, albeit due
due to the memory extension function, which extends by words,
this will always be a multiple of 32 bytes</td>
</tr>
<tr class="row-odd"><td colspan="2"><em>Execution control</em></td>
</tr>
<tr class="row-even"><td>create(v:u256, p:u256, n:u256)</td>
<td>create new contract with code mem[p..(p+n)) and send v wei
and return the new address</td>
</tr>
<tr class="row-odd"><td>create2(v:u256, p:u256, n:u256, s:u256)</td>
<td>create new contract with code mem[p…(p+n)) at address
keccak256(0xff . this . s . keccak256(mem[p…(p+n)))
and send v wei and return the new address, where <code class="docutils literal notranslate"><span class="pre">0xff</span></code> is a
8 byte value, <code class="docutils literal notranslate"><span class="pre">this</span></code> is the current contract’s address
as a 20 byte value and <code class="docutils literal notranslate"><span class="pre">s</span></code> is a big-endian 256-bit value</td>
</tr>
<tr class="row-even"><td>call(g:u256, a:u256, v:u256, in:u256,
insize:u256, out:u256,
outsize:u256)
-&gt; r:u256</td>
<td>call contract at address a with input mem[in..(in+insize))
providing g gas and v wei and output area
mem[out..(out+outsize)) returning 0 on error (eg. out of gas)
and 1 on success</td>
</tr>
<tr class="row-odd"><td>callcode(g:u256, a:u256, v:u256, in:u256,
insize:u256, out:u256,
outsize:u256) -&gt; r:u256</td>
<td>identical to <code class="docutils literal notranslate"><span class="pre">call</span></code> but only use the code from a
and stay in the context of the
current contract otherwise</td>
</tr>
<tr class="row-even"><td>delegatecall(g:u256, a:u256, in:u256,
insize:u256, out:u256,
outsize:u256) -&gt; r:u256</td>
<td>identical to <code class="docutils literal notranslate"><span class="pre">callcode</span></code>,
but also keep <code class="docutils literal notranslate"><span class="pre">caller</span></code>
and <code class="docutils literal notranslate"><span class="pre">callvalue</span></code></td>
</tr>
<tr class="row-odd"><td>abort()</td>
<td>abort (equals to invalid instruction on EVM)</td>
</tr>
<tr class="row-even"><td>return(p:u256, s:u256)</td>
<td>end execution, return data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>revert(p:u256, s:u256)</td>
<td>end execution, revert state changes, return data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>selfdestruct(a:u256)</td>
<td>end execution, destroy current contract and send funds to a</td>
</tr>
<tr class="row-odd"><td>log0(p:u256, s:u256)</td>
<td>log without topics and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log1(p:u256, s:u256, t1:u256)</td>
<td>log with topic t1 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log2(p:u256, s:u256, t1:u256, t2:u256)</td>
<td>log with topics t1, t2 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td>log3(p:u256, s:u256, t1:u256, t2:u256,
t3:u256)</td>
<td>log with topics t, t2, t3 and data mem[p..(p+s))</td>
</tr>
<tr class="row-odd"><td>log4(p:u256, s:u256, t1:u256, t2:u256,
t3:u256, t4:u256)</td>
<td>log with topics t1, t2, t3, t4 and data mem[p..(p+s))</td>
</tr>
<tr class="row-even"><td colspan="2"><em>State queries</em></td>
</tr>
<tr class="row-odd"><td>blockcoinbase() -&gt; address:u256</td>
<td>current mining beneficiary</td>
</tr>
<tr class="row-even"><td>blockdifficulty() -&gt; difficulty:u256</td>
<td>difficulty of the current block</td>
</tr>
<tr class="row-odd"><td>blockgaslimit() -&gt; limit:u256</td>
<td>block gas limit of the current block</td>
</tr>
<tr class="row-even"><td>blockhash(b:u256) -&gt; hash:u256</td>
<td>hash of block nr b - only for last 256 blocks excluding current</td>
</tr>
<tr class="row-odd"><td>blocknumber() -&gt; block:u256</td>
<td>current block number</td>
</tr>
<tr class="row-even"><td>blocktimestamp() -&gt; timestamp:u256</td>
<td>timestamp of the current block in seconds since the epoch</td>
</tr>
<tr class="row-odd"><td>txorigin() -&gt; address:u256</td>
<td>transaction sender</td>
</tr>
<tr class="row-even"><td>txgasprice() -&gt; price:u256</td>
<td>gas price of the transaction</td>
</tr>
<tr class="row-odd"><td>gasleft() -&gt; gas:u256</td>
<td>gas still available to execution</td>
</tr>
<tr class="row-even"><td>balance(a:u256) -&gt; v:u256</td>
<td>wei balance at address a</td>
</tr>
<tr class="row-odd"><td>this() -&gt; address:u256</td>
<td>address of the current contract / execution context</td>
</tr>
<tr class="row-even"><td>caller() -&gt; address:u256</td>
<td>call sender (excluding delegatecall)</td>
</tr>
<tr class="row-odd"><td>callvalue() -&gt; v:u256</td>
<td>wei sent together with the current call</td>
</tr>
<tr class="row-even"><td>calldataload(p:u256) -&gt; v:u256</td>
<td>call data starting from position p (32 bytes)</td>
</tr>
<tr class="row-odd"><td>calldatasize() -&gt; v:u256</td>
<td>size of call data in bytes</td>
</tr>
<tr class="row-even"><td>calldatacopy(t:u256, f:u256, s:u256)</td>
<td>copy s bytes from calldata at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>codesize() -&gt; size:u256</td>
<td>size of the code of the current contract / execution context</td>
</tr>
<tr class="row-even"><td>codecopy(t:u256, f:u256, s:u256)</td>
<td>copy s bytes from code at position f to mem at position t</td>
</tr>
<tr class="row-odd"><td>extcodesize(a:u256) -&gt; size:u256</td>
<td>size of the code at address a</td>
</tr>
<tr class="row-even"><td>extcodecopy(a:u256, t:u256, f:u256, s:u256)</td>
<td>like codecopy(t, f, s) but take code at address a</td>
</tr>
<tr class="row-odd"><td>extcodehash(a:u256)</td>
<td>code hash of address a</td>
</tr>
<tr class="row-even"><td colspan="2"><em>Others</em></td>
</tr>
<tr class="row-odd"><td>discard(unused:bool)</td>
<td>discard value</td>
</tr>
<tr class="row-even"><td>discardu256(unused:u256)</td>
<td>discard value</td>
</tr>
<tr class="row-odd"><td>splitu256tou64(x:u256) -&gt; (x1:u64, x2:u64,
x3:u64, x4:u64)</td>
<td>split u256 to four u64’s</td>
</tr>
<tr class="row-even"><td>combineu64tou256(x1:u64, x2:u64, x3:u64,
x4:u64) -&gt; (x:u256)</td>
<td>combine four u64’s into a single u256</td>
</tr>
<tr class="row-odd"><td>keccak256(p:u256, s:u256) -&gt; v:u256</td>
<td>keccak(mem[p…(p+s)))</td>
</tr>
<tr class="row-even"><td><em>Object access</em></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>datasize(name:string) -&gt; size:u256</td>
<td>size of the data object in bytes, name has to be string literal</td>
</tr>
<tr class="row-even"><td>dataoffset(name:string) -&gt; offset:u256</td>
<td>offset of the data object inside the data area in bytes,
name has to be string literal</td>
</tr>
<tr class="row-odd"><td>datacopy(dst:u256, src:u256, len:u256)</td>
<td>copy len bytes from the data area starting at offset src bytes
to memory at position dst</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="backends">
<h4>Backends<a class="headerlink" href="#backends" title="Permalink to this headline">¶</a></h4>
<p>Backends or targets are the translators from Yul to a specific bytecode. Each of the backends can expose functions
prefixed with the name of the backend. We reserve <code class="docutils literal notranslate"><span class="pre">evm_</span></code> and <code class="docutils literal notranslate"><span class="pre">ewasm_</span></code> prefixes for the two proposed backends.</p>
</div>
<div class="section" id="backend-evm">
<h4>Backend: EVM<a class="headerlink" href="#backend-evm" title="Permalink to this headline">¶</a></h4>
<p>The EVM target will have all the underlying EVM opcodes exposed with the <cite>evm_</cite> prefix.</p>
</div>
<div class="section" id="backend-evm-1-5">
<h4>Backend: “EVM 1.5”<a class="headerlink" href="#backend-evm-1-5" title="Permalink to this headline">¶</a></h4>
<p>TBD</p>
</div>
<div class="section" id="backend-ewasm">
<h4>Backend: eWASM<a class="headerlink" href="#backend-ewasm" title="Permalink to this headline">¶</a></h4>
<p>TBD</p>
</div>
</div>
<div class="section" id="specification-of-yul-object">
<h3>Specification of Yul Object<a class="headerlink" href="#specification-of-yul-object" title="Permalink to this headline">¶</a></h3>
<p>Yul objects are used to group named code and data sections.
The functions <code class="docutils literal notranslate"><span class="pre">datasize</span></code>, <code class="docutils literal notranslate"><span class="pre">dataoffset</span></code> and <code class="docutils literal notranslate"><span class="pre">datacopy</span></code>
can be used to access these sections from within code.
Hex strings can be used to specify data in hex encoding,
regular strings in native encoding. For code,
<code class="docutils literal notranslate"><span class="pre">datacopy</span></code> will access its assembled binary representation.</p>
<p>Grammar:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Object</span> <span class="o">=</span> <span class="s">&#39;object&#39;</span> <span class="n">StringLiteral</span> <span class="s">&#39;{&#39;</span> <span class="n">Code</span> <span class="p">(</span> <span class="n">Object</span> <span class="o">|</span> <span class="n">Data</span> <span class="p">)</span><span class="o">*</span> <span class="s">&#39;}&#39;</span>
<span class="n">Code</span> <span class="o">=</span> <span class="s">&#39;code&#39;</span> <span class="n">Block</span>
<span class="n">Data</span> <span class="o">=</span> <span class="s">&#39;data&#39;</span> <span class="n">StringLiteral</span> <span class="p">(</span> <span class="n">HexLiteral</span> <span class="o">|</span> <span class="n">StringLiteral</span> <span class="p">)</span>
<span class="n">HexLiteral</span> <span class="o">=</span> <span class="s">&#39;hex&#39;</span> <span class="p">(</span><span class="s">&#39;&quot;&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s">&#39;&quot;&#39;</span> <span class="o">|</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span> <span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="n">a</span><span class="o">-</span><span class="n">fA</span><span class="o">-</span><span class="n">F</span><span class="p">]{</span><span class="mi">2</span><span class="p">})</span><span class="o">*</span> <span class="s">&#39;</span><span class="se">\&#39;</span><span class="s">&#39;</span><span class="p">)</span>
<span class="n">StringLiteral</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span> <span class="p">([</span><span class="o">^</span><span class="s">&quot;</span><span class="se">\r\n\\</span><span class="s">] | &#39;</span><span class="se">\\</span><span class="s">&#39; .)* &#39;&quot;&#39;</span>
</pre></div>
</div>
<p>Above, <code class="docutils literal notranslate"><span class="pre">Block</span></code> refers to <code class="docutils literal notranslate"><span class="pre">Block</span></code> in the Yul code grammar explained in the previous chapter.</p>
<p>An example Yul Object is shown below:</p>
<div class="code highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="c1">// Code consists of a single object. A single &quot;code&quot; node is the code of the object.</span>
<span class="c1">// Every (other) named object or data section is serialized and</span>
<span class="c1">// made accessible to the special built-in functions datacopy / dataoffset / datasize</span>
<span class="c1">// Access to nested objects can be performed by joining the names using ``.``.</span>
<span class="c1">// The current object and sub-objects and data items inside the current object</span>
<span class="c1">// are in scope without nested access.</span>
<span class="n">object</span> <span class="s">&quot;Contract1&quot;</span> <span class="p">{</span>
    <span class="n">code</span> <span class="p">{</span>
        <span class="c1">// first create &quot;runtime.Contract2&quot;</span>
        <span class="n">let</span> <span class="n">size</span> <span class="o">=</span> <span class="n">datasize</span><span class="p">(</span><span class="s">&quot;runtime.Contract2&quot;</span><span class="p">)</span>
        <span class="n">let</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="c1">// This will turn into a memory-&gt;memory copy for eWASM and</span>
        <span class="c1">// a codecopy for EVM</span>
        <span class="n">datacopy</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">dataoffset</span><span class="p">(</span><span class="s">&quot;runtime.Contract2&quot;</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
        <span class="c1">// constructor parameter is a single number 0x1234</span>
        <span class="n">mstore</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="mh">0x1234</span><span class="p">)</span>
        <span class="n">create</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>

        <span class="c1">// now return the runtime object (this is</span>
        <span class="c1">// constructor code)</span>
        <span class="n">size</span> <span class="o">:=</span> <span class="n">datasize</span><span class="p">(</span><span class="s">&quot;runtime&quot;</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">:=</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="c1">// This will turn into a memory-&gt;memory copy for eWASM and</span>
        <span class="c1">// a codecopy for EVM</span>
        <span class="n">datacopy</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">dataoffset</span><span class="p">(</span><span class="s">&quot;runtime&quot;</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">data</span> <span class="s">&quot;Table2&quot;</span> <span class="s">hex&quot;4123&quot;</span>

    <span class="n">object</span> <span class="s">&quot;runtime&quot;</span> <span class="p">{</span>
        <span class="n">code</span> <span class="p">{</span>
            <span class="c1">// runtime code</span>

            <span class="n">let</span> <span class="n">size</span> <span class="o">=</span> <span class="n">datasize</span><span class="p">(</span><span class="s">&quot;Contract2&quot;</span><span class="p">)</span>
            <span class="n">let</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">allocate</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="c1">// This will turn into a memory-&gt;memory copy for eWASM and</span>
            <span class="c1">// a codecopy for EVM</span>
            <span class="n">datacopy</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">dataoffset</span><span class="p">(</span><span class="s">&quot;Contract2&quot;</span><span class="p">),</span> <span class="n">size</span><span class="p">)</span>
            <span class="c1">// constructor parameter is a single number 0x1234</span>
            <span class="n">mstore</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="mh">0x1234</span><span class="p">)</span>
            <span class="n">create</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="p">}</span>

        <span class="c1">// Embedded object. Use case is that the outside is a factory contract,</span>
        <span class="c1">// and Contract2 is the code to be created by the factory</span>
        <span class="n">object</span> <span class="s">&quot;Contract2&quot;</span> <span class="p">{</span>
            <span class="n">code</span> <span class="p">{</span>
                <span class="c1">// code here ...</span>
            <span class="p">}</span>

            <span class="n">object</span> <span class="s">&quot;runtime&quot;</span> <span class="p">{</span>
                <span class="n">code</span> <span class="p">{</span>
                    <span class="c1">// code here ...</span>
                <span class="p">}</span>
             <span class="p">}</span>

             <span class="n">data</span> <span class="s">&quot;Table1&quot;</span> <span class="s">hex&quot;4123&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<span id="document-style-guide"></span><div class="section" id="style-guide">
<span id="index-0"></span><h2>Style Guide<a class="headerlink" href="#style-guide" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>This guide is intended to provide coding conventions for writing solidity code.
This guide should be thought of as an evolving document that will change over
time as useful conventions are found and old conventions are rendered obsolete.</p>
<p>Many projects will implement their own style guides.  In the event of
conflicts, project specific style guides take precedence.</p>
<p>The structure and many of the recommendations within this style guide were
taken from python’s
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">pep8 style guide</a>.</p>
<p>The goal of this guide is <em>not</em> to be the right way or the best way to write
solidity code.  The goal of this guide is <em>consistency</em>.  A quote from python’s
<a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#a-foolish-consistency-is-the-hobgoblin-of-little-minds">pep8</a>
captures this concept well.</p>
<blockquote>
<div>A style guide is about consistency. Consistency with this style guide is important. Consistency within a project is more important. Consistency within one module or function is most important.
But most importantly: know when to be inconsistent – sometimes the style guide just doesn’t apply. When in doubt, use your best judgement. Look at other examples and decide what looks best. And don’t hesitate to ask!</div></blockquote>
</div>
<div class="section" id="code-layout">
<h3>Code Layout<a class="headerlink" href="#code-layout" title="Permalink to this headline">¶</a></h3>
<div class="section" id="indentation">
<h4>Indentation<a class="headerlink" href="#indentation" title="Permalink to this headline">¶</a></h4>
<p>Use 4 spaces per indentation level.</p>
</div>
<div class="section" id="tabs-or-spaces">
<h4>Tabs or Spaces<a class="headerlink" href="#tabs-or-spaces" title="Permalink to this headline">¶</a></h4>
<p>Spaces are the preferred indentation method.</p>
<p>Mixing tabs and spaces should be avoided.</p>
</div>
<div class="section" id="blank-lines">
<h4>Blank Lines<a class="headerlink" href="#blank-lines" title="Permalink to this headline">¶</a></h4>
<p>Surround top level declarations in solidity source with two blank lines.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="n">B</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="n">B</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Within a contract surround function declarations with a single blank line.</p>
<p>Blank lines may be omitted between groups of related one-liners (such as stub functions for an abstract contract)</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">spam</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span><span class="p">;</span>
    <span class="kd">function</span> <span class="n">ham</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span><span class="p">;</span>
<span class="p">}</span>


<span class="kd">contract</span> <span class="n">B</span> <span class="kr">is</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">spam</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">ham</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">spam</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="n">ham</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="maximum-line-length">
<span id="id1"></span><h4>Maximum Line Length<a class="headerlink" href="#maximum-line-length" title="Permalink to this headline">¶</a></h4>
<p>Keeping lines under the <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/#maximum-line-length">PEP 8 recommendation</a> to a maximum of 79 (or 99)
characters helps readers easily parse the code.</p>
<p>Wrapped lines should conform to the following guidelines.</p>
<ol class="arabic simple">
<li>The first argument should not be attached to the opening parenthesis.</li>
<li>One, and only one, indent should be used.</li>
<li>Each argument should fall on its own line.</li>
<li>The terminating element, <code class="code docutils literal notranslate"><span class="pre">);</span></code>, should be placed on the final line by itself.</li>
</ol>
<p>Function Calls</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">thisFunctionCallIsReallyLong</span><span class="p">(</span>
    <span class="n">longArgument1</span><span class="p">,</span>
    <span class="n">longArgument2</span><span class="p">,</span>
    <span class="n">longArgument3</span>
<span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">thisFunctionCallIsReallyLong</span><span class="p">(</span><span class="n">longArgument1</span><span class="p">,</span>
                              <span class="n">longArgument2</span><span class="p">,</span>
                              <span class="n">longArgument3</span>
<span class="p">);</span>

<span class="n">thisFunctionCallIsReallyLong</span><span class="p">(</span><span class="n">longArgument1</span><span class="p">,</span>
    <span class="n">longArgument2</span><span class="p">,</span>
    <span class="n">longArgument3</span>
<span class="p">);</span>

<span class="n">thisFunctionCallIsReallyLong</span><span class="p">(</span>
    <span class="n">longArgument1</span><span class="p">,</span> <span class="n">longArgument2</span><span class="p">,</span>
    <span class="n">longArgument3</span>
<span class="p">);</span>

<span class="n">thisFunctionCallIsReallyLong</span><span class="p">(</span>
<span class="n">longArgument1</span><span class="p">,</span>
<span class="n">longArgument2</span><span class="p">,</span>
<span class="n">longArgument3</span>
<span class="p">);</span>

<span class="n">thisFunctionCallIsReallyLong</span><span class="p">(</span>
    <span class="n">longArgument1</span><span class="p">,</span>
    <span class="n">longArgument2</span><span class="p">,</span>
    <span class="n">longArgument3</span><span class="p">);</span>
</pre></div>
</div>
<p>Assignment Statements</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">thisIsALongNestedMapping</span><span class="p">[</span><span class="n">being</span><span class="p">][</span><span class="n">set</span><span class="p">][</span><span class="n">to_some_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">someFunction</span><span class="p">(</span>
    <span class="n">argument1</span><span class="p">,</span>
    <span class="n">argument2</span><span class="p">,</span>
    <span class="n">argument3</span><span class="p">,</span>
    <span class="n">argument4</span>
<span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">thisIsALongNestedMapping</span><span class="p">[</span><span class="n">being</span><span class="p">][</span><span class="n">set</span><span class="p">][</span><span class="n">to_some_value</span><span class="p">]</span> <span class="o">=</span> <span class="n">someFunction</span><span class="p">(</span><span class="n">argument1</span><span class="p">,</span>
                                                                   <span class="n">argument2</span><span class="p">,</span>
                                                                   <span class="n">argument3</span><span class="p">,</span>
                                                                   <span class="n">argument4</span><span class="p">);</span>
</pre></div>
</div>
<p>Event Definitions and Event Emitters</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">event</span> <span class="n">LongAndLotsOfArgs</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">sender</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">publicKey</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span>
    <span class="kt">bytes32</span><span class="p">[]</span> <span class="n">options</span>
<span class="p">);</span>

<span class="n">LongAndLotsOfArgs</span><span class="p">(</span>
    <span class="n">sender</span><span class="p">,</span>
    <span class="n">recipient</span><span class="p">,</span>
    <span class="n">publicKey</span><span class="p">,</span>
    <span class="n">amount</span><span class="p">,</span>
    <span class="n">options</span>
<span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">event</span> <span class="n">LongAndLotsOfArgs</span><span class="p">(</span><span class="kt">address</span> <span class="n">sender</span><span class="p">,</span>
                        <span class="kt">address</span> <span class="n">recipient</span><span class="p">,</span>
                        <span class="kt">uint256</span> <span class="n">publicKey</span><span class="p">,</span>
                        <span class="kt">uint256</span> <span class="n">amount</span><span class="p">,</span>
                        <span class="kt">bytes32</span><span class="p">[]</span> <span class="n">options</span><span class="p">);</span>

<span class="n">LongAndLotsOfArgs</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span>
                  <span class="n">recipient</span><span class="p">,</span>
                  <span class="n">publicKey</span><span class="p">,</span>
                  <span class="n">amount</span><span class="p">,</span>
                  <span class="n">options</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="source-file-encoding">
<h4>Source File Encoding<a class="headerlink" href="#source-file-encoding" title="Permalink to this headline">¶</a></h4>
<p>UTF-8 or ASCII encoding is preferred.</p>
</div>
<div class="section" id="imports">
<h4>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h4>
<p>Import statements should always be placed at the top of the file.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kn">import</span> <span class="s">&quot;./Owned.sol&quot;</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">B</span> <span class="kr">is</span> <span class="n">Owned</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>


<span class="kn">import</span> <span class="s">&quot;./Owned.sol&quot;</span><span class="p">;</span>


<span class="kd">contract</span> <span class="n">B</span> <span class="kr">is</span> <span class="n">Owned</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="order-of-functions">
<h4>Order of Functions<a class="headerlink" href="#order-of-functions" title="Permalink to this headline">¶</a></h4>
<p>Ordering helps readers identify which functions they can call and to find the constructor and fallback definitions easier.</p>
<p>Functions should be grouped according to their visibility and ordered:</p>
<ul class="simple">
<li>constructor</li>
<li>fallback function (if exists)</li>
<li>external</li>
<li>public</li>
<li>internal</li>
<li>private</li>
</ul>
<p>Within a grouping, place the <code class="docutils literal notranslate"><span class="pre">view</span></code> and <code class="docutils literal notranslate"><span class="pre">pure</span></code> functions last.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// External functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// External functions that are view</span>
    <span class="c1">// ...</span>

    <span class="c1">// External functions that are pure</span>
    <span class="c1">// ...</span>

    <span class="c1">// Public functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Internal functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Private functions</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>

    <span class="c1">// External functions</span>
    <span class="c1">// ...</span>

    <span class="kd">function</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// Private functions</span>
    <span class="c1">// ...</span>

    <span class="c1">// Public functions</span>
    <span class="c1">// ...</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="c1">// Internal functions</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="whitespace-in-expressions">
<h4>Whitespace in Expressions<a class="headerlink" href="#whitespace-in-expressions" title="Permalink to this headline">¶</a></h4>
<p>Avoid extraneous whitespace in the following  situations:</p>
<p>Immediately inside parenthesis, brackets or braces, with the exception of single line function declarations.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">spam</span><span class="p">(</span><span class="n">ham</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Coin</span><span class="p">({</span><span class="n">name</span><span class="o">:</span> <span class="s">&quot;ham&quot;</span><span class="p">}));</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">spam</span><span class="p">(</span> <span class="n">ham</span><span class="p">[</span> <span class="mi">1</span> <span class="p">],</span> <span class="n">Coin</span><span class="p">(</span> <span class="p">{</span> <span class="n">name</span><span class="o">:</span> <span class="s">&quot;ham&quot;</span> <span class="p">}</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<p>Exception:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">singleLine</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">spam</span><span class="p">();</span> <span class="p">}</span>
</pre></div>
</div>
<p>Immediately before a comma, semicolon:</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">spam</span><span class="p">(</span><span class="kt">uint</span> <span class="n">i</span><span class="p">,</span> <span class="n">Coin</span> <span class="n">coin</span><span class="p">)</span> <span class="kr">public</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">spam</span><span class="p">(</span><span class="kt">uint</span> <span class="n">i</span> <span class="p">,</span> <span class="n">Coin</span> <span class="n">coin</span><span class="p">)</span> <span class="kr">public</span> <span class="p">;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>More than one space around an assignment or other operator to align with</dt>
<dd>another:</dd>
</dl>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">long_variable</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">x</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">y</span>             <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">long_variable</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
<p>Don’t include a whitespace in the fallback function:</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span><span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="p">()</span> <span class="kr">external</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="control-structures">
<h4>Control Structures<a class="headerlink" href="#control-structures" title="Permalink to this headline">¶</a></h4>
<p>The braces denoting the body of a contract, library, functions and structs
should:</p>
<ul class="simple">
<li>open on the same line as the declaration</li>
<li>close on their own line at the same indentation level as the beginning of the
declaration.</li>
<li>The opening brace should be proceeded by a single space.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Coin</span> <span class="p">{</span>
    <span class="kd">struct</span> <span class="n">Bank</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nb">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Coin</span>
<span class="p">{</span>
    <span class="kd">struct</span> <span class="n">Bank</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>
        <span class="kt">uint</span> <span class="nb">balance</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The same recommendations apply to the control structures <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">else</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>,
and <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p>
<p>Additionally there should be a single space between the control structures
<code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">while</span></code>, and <code class="docutils literal notranslate"><span class="pre">for</span></code> and the parenthetic block representing the
conditional, as well as a single space between the conditional parenthetic
block and the opening brace.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(...)</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">while</span><span class="p">(...){</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...;}</span>
</pre></div>
</div>
<p>For control structures whose body contains a single statement, omitting the
braces is ok <em>if</em> the statement is contained on a single line.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">someArray</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">Coin</span><span class="p">({</span>
        <span class="n">name</span><span class="o">:</span> <span class="s">&#39;spam&#39;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">:</span> <span class="mi">42</span>
    <span class="p">}));</span>
</pre></div>
</div>
<p>For <code class="docutils literal notranslate"><span class="pre">if</span></code> blocks which have an <code class="docutils literal notranslate"><span class="pre">else</span></code> or <code class="docutils literal notranslate"><span class="pre">else</span> <span class="pre">if</span></code> clause, the <code class="docutils literal notranslate"><span class="pre">else</span></code> should be
placed on the same line as the <code class="docutils literal notranslate"><span class="pre">if</span></code>’s closing brace. This is an exception compared
to the rules of other block-like structures.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">else</span>
    <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="function-declaration">
<h4>Function Declaration<a class="headerlink" href="#function-declaration" title="Permalink to this headline">¶</a></h4>
<p>For short function declarations, it is recommended for the opening brace of the
function body to be kept on the same line as the function declaration.</p>
<p>The closing brace should be at the same indentation level as the function
declaration.</p>
<p>The opening brace should be preceded by a single space.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="n">onlyowner</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">){</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

<span class="kd">function</span> <span class="n">increment</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;}</span>
</pre></div>
</div>
<p>You should explicitly label the visibility of all functions, including constructors.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">explicitlyPublic</span><span class="p">(</span><span class="kt">uint</span> <span class="n">val</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">implicitlyPublic</span><span class="p">(</span><span class="kt">uint</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The visibility modifier for a function should come before any custom
modifiers.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="kr">public</span> <span class="n">onlyowner</span> <span class="p">{</span>
    <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">kill</span><span class="p">()</span> <span class="n">onlyowner</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nb">selfdestruct</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For long function declarations, it is recommended to drop each argument onto
it’s own line at the same indentation level as the function body.  The closing
parenthesis and opening bracket should be placed on their own line as well at
the same indentation level as the function declaration.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">thisFunctionHasLotsOfArguments</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">d</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">e</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">f</span>
<span class="p">)</span>
    <span class="kr">public</span>
<span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span> <span class="n">a</span><span class="p">,</span> <span class="kt">address</span> <span class="n">b</span><span class="p">,</span> <span class="kt">address</span> <span class="n">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">d</span><span class="p">,</span> <span class="kt">address</span> <span class="n">e</span><span class="p">,</span> <span class="kt">address</span> <span class="n">f</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">thisFunctionHasLotsOfArguments</span><span class="p">(</span><span class="kt">address</span> <span class="n">a</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="n">b</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="n">c</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="n">d</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="n">e</span><span class="p">,</span>
                                        <span class="kt">address</span> <span class="n">f</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">thisFunctionHasLotsOfArguments</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">c</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">d</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">e</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">f</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If a long function declaration has modifiers, then each modifier should be
dropped to its own line.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="n">x</span><span class="p">,</span> <span class="kt">address</span> <span class="n">y</span><span class="p">,</span> <span class="kt">address</span> <span class="n">z</span><span class="p">)</span>
    <span class="kr">public</span>
    <span class="n">onlyowner</span>
    <span class="n">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">thisFunctionNameIsReallyLong</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">x</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">y</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">z</span><span class="p">,</span>
<span class="p">)</span>
    <span class="kr">public</span>
    <span class="n">onlyowner</span>
    <span class="n">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="n">x</span><span class="p">,</span> <span class="kt">address</span> <span class="n">y</span><span class="p">,</span> <span class="kt">address</span> <span class="n">z</span><span class="p">)</span>
                                      <span class="kr">public</span>
                                      <span class="n">onlyowner</span>
                                      <span class="n">priced</span>
                                      <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="n">x</span><span class="p">,</span> <span class="kt">address</span> <span class="n">y</span><span class="p">,</span> <span class="kt">address</span> <span class="n">z</span><span class="p">)</span>
    <span class="kr">public</span> <span class="n">onlyowner</span> <span class="n">priced</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">thisFunctionNameIsReallyLong</span><span class="p">(</span><span class="kt">address</span> <span class="n">x</span><span class="p">,</span> <span class="kt">address</span> <span class="n">y</span><span class="p">,</span> <span class="kt">address</span> <span class="n">z</span><span class="p">)</span>
    <span class="kr">public</span>
    <span class="n">onlyowner</span>
    <span class="n">priced</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">doSomething</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Multiline output parameters and return statements should follow the same style recommended for wrapping long lines found in the <a class="reference internal" href="#maximum-line-length"><span class="std std-ref">Maximum Line Length</span></a> section.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">thisFunctionNameIsReallyLong</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">c</span>
<span class="p">)</span>
    <span class="kr">public</span>
    <span class="k">returns</span> <span class="p">(</span>
        <span class="kt">address</span> <span class="n">someAddressName</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">LongArgument</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">Argument</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">doSomething</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">veryLongReturnArg1</span><span class="p">,</span>
        <span class="n">veryLongReturnArg2</span><span class="p">,</span>
        <span class="n">veryLongReturnArg3</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">thisFunctionNameIsReallyLong</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">a</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">b</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">c</span>
<span class="p">)</span>
    <span class="kr">public</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">someAddressName</span><span class="p">,</span>
             <span class="kt">uint256</span> <span class="n">LongArgument</span><span class="p">,</span>
             <span class="kt">uint256</span> <span class="n">Argument</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">doSomething</span><span class="p">()</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">veryLongReturnArg1</span><span class="p">,</span>
            <span class="n">veryLongReturnArg1</span><span class="p">,</span>
            <span class="n">veryLongReturnArg1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For constructor functions on inherited contracts whose bases require arguments,
it is recommended to drop the base constructors onto new lines in the same
manner as modifiers if the function declaration is long or hard to read.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// Base contracts just to make this compile</span>
<span class="kd">contract</span> <span class="n">B</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="kr">is</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param5</span><span class="p">)</span>
        <span class="n">B</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span>
        <span class="n">C</span><span class="p">(</span><span class="n">param2</span><span class="p">,</span> <span class="n">param3</span><span class="p">)</span>
        <span class="n">D</span><span class="p">(</span><span class="n">param4</span><span class="p">)</span>
        <span class="kr">public</span>
    <span class="p">{</span>
        <span class="c1">// do something with param5</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">param5</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// Base contracts just to make this compile</span>
<span class="kd">contract</span> <span class="n">B</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kd">contract</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="kr">is</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param5</span><span class="p">)</span>
    <span class="n">B</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span>
    <span class="n">C</span><span class="p">(</span><span class="n">param2</span><span class="p">,</span> <span class="n">param3</span><span class="p">)</span>
    <span class="n">D</span><span class="p">(</span><span class="n">param4</span><span class="p">)</span>
    <span class="kr">public</span>
    <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">param5</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">X</span> <span class="kr">is</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">x</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">(</span><span class="kt">uint</span> <span class="n">param1</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param2</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param3</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param4</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">param5</span><span class="p">)</span>
        <span class="n">B</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span>
        <span class="n">C</span><span class="p">(</span><span class="n">param2</span><span class="p">,</span> <span class="n">param3</span><span class="p">)</span>
        <span class="n">D</span><span class="p">(</span><span class="n">param4</span><span class="p">)</span>
        <span class="kr">public</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">param5</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When declaring short functions with a single statement, it is permissible to do it on a single line.</p>
<p>Permissible:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="n">shortFunction</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span> <span class="n">doSomething</span><span class="p">();</span> <span class="p">}</span>
</pre></div>
</div>
<p>These guidelines for function declarations are intended to improve readability.
Authors should use their best judgement as this guide does not try to cover all
possible permutations for function declarations.</p>
</div>
<div class="section" id="mappings">
<h4>Mappings<a class="headerlink" href="#mappings" title="Permalink to this headline">¶</a></h4>
<p>In variable declarations, do not separate the keyword <code class="docutils literal notranslate"><span class="pre">mapping</span></code> from its
type by a space. Do not separate any nested <code class="docutils literal notranslate"><span class="pre">mapping</span></code> keyword from its type by
whitespace.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">map</span><span class="p">;</span>
<span class="kd">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">registeredAddresses</span><span class="p">;</span>
<span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kd">mapping</span><span class="p">(</span><span class="kt">bool</span> <span class="o">=&gt;</span> <span class="n">Data</span><span class="p">[]))</span> <span class="kr">public</span> <span class="n">data</span><span class="p">;</span>
<span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="n">s</span><span class="p">))</span> <span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">map</span><span class="p">;</span>
<span class="kd">mapping</span><span class="p">(</span> <span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">bool</span> <span class="p">)</span> <span class="n">registeredAddresses</span><span class="p">;</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kd">mapping</span> <span class="p">(</span><span class="kt">bool</span> <span class="o">=&gt;</span> <span class="n">Data</span><span class="p">[]))</span> <span class="kr">public</span> <span class="n">data</span><span class="p">;</span>
<span class="kd">mapping</span><span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="kd">mapping</span> <span class="p">(</span><span class="kt">uint</span> <span class="o">=&gt;</span> <span class="n">s</span><span class="p">))</span> <span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="variable-declarations">
<h4>Variable Declarations<a class="headerlink" href="#variable-declarations" title="Permalink to this headline">¶</a></h4>
<p>Declarations of array variables should not have a space between the type and
the brackets.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint</span><span class="p">[]</span> <span class="n">x</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kt">uint</span> <span class="p">[]</span> <span class="n">x</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="other-recommendations">
<h4>Other Recommendations<a class="headerlink" href="#other-recommendations" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Strings should be quoted with double-quotes instead of single-quotes.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">str</span> <span class="o">=</span> <span class="s">&quot;foo&quot;</span><span class="p">;</span>
<span class="n">str</span> <span class="o">=</span> <span class="s">&quot;Hamlet says, &#39;To be or not to be...&#39;&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">str</span> <span class="o">=</span> <span class="s">&#39;bar&#39;</span><span class="p">;</span>
<span class="n">str</span> <span class="o">=</span> <span class="s">&#39;&quot;Be yourself; everyone else is already taken.&quot; -Oscar Wilde&#39;</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Surround operators with a single space on either side.</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
<span class="n">x</span> <span class="o">|=</span> <span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">z</span><span class="p">;</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">100</span><span class="o">/</span><span class="mi">10</span><span class="p">;</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="p">;</span>
<span class="n">x</span> <span class="o">|=</span> <span class="n">y</span><span class="o">&amp;&amp;</span><span class="n">z</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Operators with a higher priority than others can exclude surrounding
whitespace in order to denote precedence.  This is meant to allow for
improved readability for complex statement. You should always use the same
amount of whitespace on either side of an operator:</li>
</ul>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">z</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">);</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">+</span><span class="n">z</span><span class="p">;</span>
<span class="n">x</span> <span class="o">+=</span><span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="order-of-layout">
<h3>Order of Layout<a class="headerlink" href="#order-of-layout" title="Permalink to this headline">¶</a></h3>
<p>Layout contract elements in the following order:</p>
<ol class="arabic simple">
<li>Pragma statements</li>
<li>Import statements</li>
<li>Interfaces</li>
<li>Libraries</li>
<li>Contracts</li>
</ol>
<p>Inside each contract, library or interface, use the following order:</p>
<ol class="arabic simple">
<li>Type declarations</li>
<li>State variables</li>
<li>Events</li>
<li>Functions</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It might be clearer to declare types close to their use in events or state
variables.</p>
</div>
</div>
<div class="section" id="naming-conventions">
<h3>Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h3>
<p>Naming conventions are powerful when adopted and used broadly.  The use of
different conventions can convey significant <em>meta</em> information that would
otherwise not be immediately available.</p>
<p>The naming recommendations given here are intended to improve the readability,
and thus they are not rules, but rather guidelines to try and help convey the
most information through the names of things.</p>
<p>Lastly, consistency within a codebase should always supersede any conventions
outlined in this document.</p>
<div class="section" id="naming-styles">
<h4>Naming Styles<a class="headerlink" href="#naming-styles" title="Permalink to this headline">¶</a></h4>
<p>To avoid confusion, the following names will be used to refer to different
naming styles.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">b</span></code> (single lowercase letter)</li>
<li><code class="docutils literal notranslate"><span class="pre">B</span></code> (single uppercase letter)</li>
<li><code class="docutils literal notranslate"><span class="pre">lowercase</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">lower_case_with_underscores</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">UPPERCASE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">UPPER_CASE_WITH_UNDERSCORES</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CapitalizedWords</span></code> (or CapWords)</li>
<li><code class="docutils literal notranslate"><span class="pre">mixedCase</span></code> (differs from CapitalizedWords by initial lowercase character!)</li>
<li><code class="docutils literal notranslate"><span class="pre">Capitalized_Words_With_Underscores</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using initialisms in CapWords, capitalize all the letters of the initialisms. Thus HTTPServerError is better than HttpServerError. When using initialisms is mixedCase, capitalize all the letters of the initialisms, except keep the first one lower case if it is the beginning of the name. Thus xmlHTTPRequest is better than XMLHTTPRequest.</p>
</div>
</div>
<div class="section" id="names-to-avoid">
<h4>Names to Avoid<a class="headerlink" href="#names-to-avoid" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">l</span></code> - Lowercase letter el</li>
<li><code class="docutils literal notranslate"><span class="pre">O</span></code> - Uppercase letter oh</li>
<li><code class="docutils literal notranslate"><span class="pre">I</span></code> - Uppercase letter eye</li>
</ul>
<p>Never use any of these for single letter variable names.  They are often
indistinguishable from the numerals one and zero.</p>
</div>
<div class="section" id="contract-and-library-names">
<h4>Contract and Library Names<a class="headerlink" href="#contract-and-library-names" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Contracts and libraries should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">SimpleToken</span></code>, <code class="docutils literal notranslate"><span class="pre">SmartBank</span></code>, <code class="docutils literal notranslate"><span class="pre">CertificateHashRepository</span></code>, <code class="docutils literal notranslate"><span class="pre">Player</span></code>, <code class="docutils literal notranslate"><span class="pre">Congress</span></code>, <code class="docutils literal notranslate"><span class="pre">Owned</span></code>.</li>
<li>Contract and library names should also match their filenames.</li>
<li>If a contract file includes multiple contracts and/or libraries, then the filename should match the <em>core contract</em>. This is not recommended however if it can be avoided.</li>
</ul>
<p>As shown in the example below, if the contract name is <cite>Congress</cite> and the library name is <cite>Owned</cite>, then their associated filenames should be <cite>Congress.sol</cite> and <cite>Owned.sol</cite>.</p>
<p>Yes:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// Owned.sol</span>
<span class="kd">contract</span> <span class="n">Owned</span> <span class="p">{</span>
     <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span><span class="p">;</span>

     <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
         <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">modifier</span> <span class="n">onlyOwner</span> <span class="p">{</span>
         <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
         <span class="kr">_</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">function</span> <span class="n">transferOwnership</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="kr">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
         <span class="n">owner</span> <span class="o">=</span> <span class="n">newOwner</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Congress.sol</span>
<span class="kn">import</span> <span class="s">&quot;./Owned.sol&quot;</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Congress</span> <span class="kr">is</span> <span class="n">Owned</span><span class="p">,</span> <span class="n">TokenRecipient</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// owned.sol</span>
<span class="kd">contract</span> <span class="n">owned</span> <span class="p">{</span>
     <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span><span class="p">;</span>

     <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
         <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">modifier</span> <span class="n">onlyOwner</span> <span class="p">{</span>
         <span class="nf">require</span><span class="p">(</span><span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
         <span class="kr">_</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="kd">function</span> <span class="n">transferOwnership</span><span class="p">(</span><span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="kr">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
         <span class="n">owner</span> <span class="o">=</span> <span class="n">newOwner</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Congress.sol</span>
<span class="kn">import</span> <span class="s">&quot;./owned.sol&quot;</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">Congress</span> <span class="kr">is</span> <span class="n">owned</span><span class="p">,</span> <span class="n">tokenRecipient</span> <span class="p">{</span>
    <span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="struct-names">
<h4>Struct Names<a class="headerlink" href="#struct-names" title="Permalink to this headline">¶</a></h4>
<p>Structs should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">MyCoin</span></code>, <code class="docutils literal notranslate"><span class="pre">Position</span></code>, <code class="docutils literal notranslate"><span class="pre">PositionXY</span></code>.</p>
</div>
<div class="section" id="event-names">
<h4>Event Names<a class="headerlink" href="#event-names" title="Permalink to this headline">¶</a></h4>
<p>Events should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">Deposit</span></code>, <code class="docutils literal notranslate"><span class="pre">Transfer</span></code>, <code class="docutils literal notranslate"><span class="pre">Approval</span></code>, <code class="docutils literal notranslate"><span class="pre">BeforeTransfer</span></code>, <code class="docutils literal notranslate"><span class="pre">AfterTransfer</span></code>.</p>
</div>
<div class="section" id="function-names">
<h4>Function Names<a class="headerlink" href="#function-names" title="Permalink to this headline">¶</a></h4>
<p>Functions other than constructors should use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">getBalance</span></code>, <code class="docutils literal notranslate"><span class="pre">transfer</span></code>, <code class="docutils literal notranslate"><span class="pre">verifyOwner</span></code>, <code class="docutils literal notranslate"><span class="pre">addMember</span></code>, <code class="docutils literal notranslate"><span class="pre">changeOwner</span></code>.</p>
</div>
<div class="section" id="function-argument-names">
<h4>Function Argument Names<a class="headerlink" href="#function-argument-names" title="Permalink to this headline">¶</a></h4>
<p>Function arguments should use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">initialSupply</span></code>, <code class="docutils literal notranslate"><span class="pre">account</span></code>, <code class="docutils literal notranslate"><span class="pre">recipientAddress</span></code>, <code class="docutils literal notranslate"><span class="pre">senderAddress</span></code>, <code class="docutils literal notranslate"><span class="pre">newOwner</span></code>.</p>
<p>When writing library functions that operate on a custom struct, the struct
should be the first argument and should always be named <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
</div>
<div class="section" id="local-and-state-variable-names">
<h4>Local and State Variable Names<a class="headerlink" href="#local-and-state-variable-names" title="Permalink to this headline">¶</a></h4>
<p>Use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">totalSupply</span></code>, <code class="docutils literal notranslate"><span class="pre">remainingSupply</span></code>, <code class="docutils literal notranslate"><span class="pre">balancesOf</span></code>, <code class="docutils literal notranslate"><span class="pre">creatorAddress</span></code>, <code class="docutils literal notranslate"><span class="pre">isPreSale</span></code>, <code class="docutils literal notranslate"><span class="pre">tokenExchangeRate</span></code>.</p>
</div>
<div class="section" id="constants">
<h4>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h4>
<p>Constants should be named with all capital letters with underscores separating
words. Examples: <code class="docutils literal notranslate"><span class="pre">MAX_BLOCKS</span></code>, <code class="docutils literal notranslate"><span class="pre">TOKEN_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">TOKEN_TICKER</span></code>, <code class="docutils literal notranslate"><span class="pre">CONTRACT_VERSION</span></code>.</p>
</div>
<div class="section" id="modifier-names">
<h4>Modifier Names<a class="headerlink" href="#modifier-names" title="Permalink to this headline">¶</a></h4>
<p>Use mixedCase. Examples: <code class="docutils literal notranslate"><span class="pre">onlyBy</span></code>, <code class="docutils literal notranslate"><span class="pre">onlyAfter</span></code>, <code class="docutils literal notranslate"><span class="pre">onlyDuringThePreSale</span></code>.</p>
</div>
<div class="section" id="enums">
<h4>Enums<a class="headerlink" href="#enums" title="Permalink to this headline">¶</a></h4>
<p>Enums, in the style of simple type declarations, should be named using the CapWords style. Examples: <code class="docutils literal notranslate"><span class="pre">TokenGroup</span></code>, <code class="docutils literal notranslate"><span class="pre">Frame</span></code>, <code class="docutils literal notranslate"><span class="pre">HashStyle</span></code>, <code class="docutils literal notranslate"><span class="pre">CharacterLocation</span></code>.</p>
</div>
<div class="section" id="avoiding-naming-collisions">
<h4>Avoiding Naming Collisions<a class="headerlink" href="#avoiding-naming-collisions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">single_trailing_underscore_</span></code></li>
</ul>
<p>This convention is suggested when the desired name collides with that of a
built-in or otherwise reserved name.</p>
</div>
<div class="section" id="general-recommendations">
<h4>General Recommendations<a class="headerlink" href="#general-recommendations" title="Permalink to this headline">¶</a></h4>
<p>TODO</p>
</div>
</div>
<div class="section" id="natspec">
<span id="id2"></span><h3>NatSpec<a class="headerlink" href="#natspec" title="Permalink to this headline">¶</a></h3>
<p>Solidity contracts can have a form of comments that are the basis of the
Ethereum Natural Language Specification Format.</p>
<p>Add comments above functions or contracts following <a class="reference external" href="http://www.doxygen.nl">doxygen</a> notation
of one or multiple lines starting with <cite>///</cite> or a
multiline comment starting with <cite>/**</cite> and ending with <cite>*/</cite>.</p>
<p>For example, the contract from <a class="reference external" href="simple-smart-contract">a simple smart contract</a> with the comments
added looks like the one below:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">/// </span><span class="cs">@author</span><span class="c1"> The Solidity Team</span>
<span class="c1">/// </span><span class="cs">@title</span><span class="c1"> A simple storage example</span>
<span class="kd">contract</span> <span class="n">SimpleStorage</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">storedData</span><span class="p">;</span>

    <span class="c1">/// Store `x`.</span>
    <span class="c1">/// </span><span class="cs">@param</span><span class="c1"> x the new value to store</span>
    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> stores the number in the state variable `storedData`</span>
    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span> <span class="n">x</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">storedData</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Return the stored value.</span>
    <span class="c1">/// </span><span class="cs">@dev</span><span class="c1"> retrieves the value of the state variable `storedData`</span>
    <span class="c1">/// </span><span class="cs">@return</span><span class="c1"> the stored value</span>
    <span class="kd">function</span> <span class="n">get</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">storedData</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Natspec uses doxygen style tags with some special meaning.
If no tag is used, then the comment applies to <code class="docutils literal notranslate"><span class="pre">&#64;notice</span></code>.
The <code class="docutils literal notranslate"><span class="pre">&#64;notice</span></code> tag is the main NatSpec tag and its audience is
users of the contract who have never seen the source code, so it should make
as little assumptions about the inner details as possible.
All tags are optional.</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="49%" />
<col width="36%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Tag</th>
<th class="head">Description</th>
<th class="head">Context</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;title</span></code></td>
<td>A title that describes the contract</td>
<td>contract, interface</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;author</span></code></td>
<td>The name of the author</td>
<td>contract, interface, function</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;notice</span></code></td>
<td>Explanation of functionality</td>
<td>contract, interface, function</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;dev</span></code></td>
<td>Any extra details</td>
<td>contract, interface, function</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">&#64;param</span></code></td>
<td>Parameter type followed by parameter name</td>
<td>function</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">&#64;return</span></code></td>
<td>The return value of a contract’s function</td>
<td>function</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-common-patterns"></span><div class="section" id="common-patterns">
<h2>Common Patterns<a class="headerlink" href="#common-patterns" title="Permalink to this headline">¶</a></h2>
<div class="section" id="withdrawal-from-contracts">
<span id="withdrawal-pattern"></span><span id="index-0"></span><h3>Withdrawal from Contracts<a class="headerlink" href="#withdrawal-from-contracts" title="Permalink to this headline">¶</a></h3>
<p>The recommended method of sending funds after an effect
is using the withdrawal pattern. Although the most intuitive
method of sending Ether, as a result of an effect, is a
direct <code class="docutils literal notranslate"><span class="pre">transfer</span></code> call, this is not recommended as it
introduces a potential security risk. You may read
more about this on the <a class="reference internal" href="index.html#security-considerations"><span class="std std-ref">Security Considerations</span></a> page.</p>
<p>The following is an example of the withdrawal pattern in practice in
a contract where the goal is to send the most money to the
contract in order to become the “richest”, inspired by
<a class="reference external" href="https://www.kingoftheether.com/">King of the Ether</a>.</p>
<p>In the following contract, if you are usurped as the richest,
you will receive the funds of the person who has gone on to
become the new richest.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">WithdrawalContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">mostSent</span><span class="p">;</span>

    <span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="n">pendingWithdrawals</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">becomeRichest</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pendingWithdrawals</span><span class="p">[</span><span class="n">richest</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">msg.value</span><span class="p">;</span>
            <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
            <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">];</span>
        <span class="c1">// Remember to zero the pending refund before</span>
        <span class="c1">// sending to prevent re-entrancy attacks</span>
        <span class="n">pendingWithdrawals</span><span class="p">[</span><span class="nb">msg.sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="n">amount</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is as opposed to the more intuitive sending pattern:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">SendContract</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">payable</span> <span class="kr">public</span> <span class="n">richest</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">mostSent</span><span class="p">;</span>

    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{</span>
        <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
        <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">becomeRichest</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">mostSent</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// This line can cause problems (explained below).</span>
            <span class="n">richest</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">msg.value</span><span class="p">);</span>
            <span class="n">richest</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
            <span class="n">mostSent</span> <span class="o">=</span> <span class="nb">msg.value</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notice that, in this example, an attacker could trap the
contract into an unusable state by causing <code class="docutils literal notranslate"><span class="pre">richest</span></code> to be
the address of a contract that has a fallback function
which fails (e.g. by using <code class="docutils literal notranslate"><span class="pre">revert()</span></code> or by just
consuming more than the 2300 gas stipend transferred to them). That way,
whenever <code class="docutils literal notranslate"><span class="pre">transfer</span></code> is called to deliver funds to the
“poisoned” contract, it will fail and thus also <code class="docutils literal notranslate"><span class="pre">becomeRichest</span></code>
will fail, with the contract being stuck forever.</p>
<p>In contrast, if you use the “withdraw” pattern from the first example,
the attacker can only cause his or her own withdraw to fail and not the
rest of the contract’s workings.</p>
</div>
<div class="section" id="restricting-access">
<span id="index-1"></span><h3>Restricting Access<a class="headerlink" href="#restricting-access" title="Permalink to this headline">¶</a></h3>
<p>Restricting access is a common pattern for contracts.
Note that you can never restrict any human or computer
from reading the content of your transactions or
your contract’s state. You can make it a bit harder
by using encryption, but if your contract is supposed
to read the data, so will everyone else.</p>
<p>You can restrict read access to your contract’s state
by <strong>other contracts</strong>. That is actually the default
unless you declare your state variables <code class="docutils literal notranslate"><span class="pre">public</span></code>.</p>
<p>Furthermore, you can restrict who can make modifications
to your contract’s state or call your contract’s
functions and this is what this section is about.</p>
<p id="index-2">The use of <strong>function modifiers</strong> makes these
restrictions highly readable.</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">AccessRestriction</span> <span class="p">{</span>
    <span class="c1">// These will be assigned at the construction</span>
    <span class="c1">// phase, where `msg.sender` is the account</span>
    <span class="c1">// creating this contract.</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg.sender</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="c1">// Modifiers can be used to change</span>
    <span class="c1">// the body of a function.</span>
    <span class="c1">// If this modifier is used, it will</span>
    <span class="c1">// prepend a check that only passes</span>
    <span class="c1">// if the function is called from</span>
    <span class="c1">// a certain address.</span>
    <span class="kd">modifier</span> <span class="n">onlyBy</span><span class="p">(</span><span class="kt">address</span> <span class="n">_account</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.sender</span> <span class="o">==</span> <span class="n">_account</span><span class="p">,</span>
            <span class="s">&quot;Sender not authorized.&quot;</span>
        <span class="p">);</span>
        <span class="c1">// Do not forget the &quot;_;&quot;! It will</span>
        <span class="c1">// be replaced by the actual function</span>
        <span class="c1">// body when the modifier is used.</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Make `_newOwner` the new owner of this</span>
    <span class="c1">/// contract.</span>
    <span class="kd">function</span> <span class="n">changeOwner</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newOwner</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="n">onlyBy</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">_newOwner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">onlyAfter</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_time</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">_time</span><span class="p">,</span>
            <span class="s">&quot;Function called too early.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// Erase ownership information.</span>
    <span class="c1">/// May only be called 6 weeks after</span>
    <span class="c1">/// the contract has been created.</span>
    <span class="kd">function</span> <span class="n">disown</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">onlyBy</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span>
        <span class="n">onlyAfter</span><span class="p">(</span><span class="n">creationTime</span> <span class="o">+</span> <span class="mi">6</span> <span class="kc">weeks</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This modifier requires a certain</span>
    <span class="c1">// fee being associated with a function call.</span>
    <span class="c1">// If the caller sent too much, he or she is</span>
    <span class="c1">// refunded, but only after the function body.</span>
    <span class="c1">// This was dangerous before Solidity version 0.4.0,</span>
    <span class="c1">// where it was possible to skip the part after `_;`.</span>
    <span class="kd">modifier</span> <span class="n">costs</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_amount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="nb">msg.value</span> <span class="o">&gt;=</span> <span class="n">_amount</span><span class="p">,</span>
            <span class="s">&quot;Not enough Ether provided.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">msg.value</span> <span class="o">&gt;</span> <span class="n">_amount</span><span class="p">)</span>
            <span class="nb">msg.sender</span><span class="p">.</span><span class="nf">transfer</span><span class="p">(</span><span class="nb">msg.value</span> <span class="o">-</span> <span class="n">_amount</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">forceOwnerChange</span><span class="p">(</span><span class="kt">address</span> <span class="n">_newOwner</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="kr">payable</span>
        <span class="n">costs</span><span class="p">(</span><span class="mi">200</span> <span class="kc">ether</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="n">_newOwner</span><span class="p">;</span>
        <span class="c1">// just some example condition</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="n">owner</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1">// This did not refund for Solidity</span>
            <span class="c1">// before version 0.4.0.</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="c1">// refund overpaid fees</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A more specialised way in which access to function
calls can be restricted will be discussed
in the next example.</p>
</div>
<div class="section" id="state-machine">
<span id="index-3"></span><h3>State Machine<a class="headerlink" href="#state-machine" title="Permalink to this headline">¶</a></h3>
<p>Contracts often act as a state machine, which means
that they have certain <strong>stages</strong> in which they behave
differently or in which different functions can
be called. A function call often ends a stage
and transitions the contract into the next stage
(especially if the contract models <strong>interaction</strong>).
It is also common that some stages are automatically
reached at a certain point in <strong>time</strong>.</p>
<p>An example for this is a blind auction contract which
starts in the stage “accepting blinded bids”, then
transitions to “revealing bids” which is ended by
“determine auction outcome”.</p>
<p id="index-4">Function modifiers can be used in this situation
to model the states and guard against
incorrect usage of the contract.</p>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>In the following example,
the modifier <code class="docutils literal notranslate"><span class="pre">atStage</span></code> ensures that the function can
only be called at a certain stage.</p>
<p>Automatic timed transitions
are handled by the modifier <code class="docutils literal notranslate"><span class="pre">timeTransitions</span></code>, which
should be used for all functions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Modifier Order Matters</strong>.
If atStage is combined
with timedTransitions, make sure that you mention
it after the latter, so that the new stage is
taken into account.</p>
</div>
<p>Finally, the modifier <code class="docutils literal notranslate"><span class="pre">transitionNext</span></code> can be used
to automatically go to the next stage when the
function finishes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Modifier May be Skipped</strong>.
This only applies to Solidity before version 0.4.0:
Since modifiers are applied by simply replacing
code and not by using a function call,
the code in the transitionNext modifier
can be skipped if the function itself uses
return. If you want to do that, make sure
to call nextStage manually from those functions.
Starting with version 0.4.0, modifier code
will run even if the function explicitly returns.</p>
</div>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">22</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">StateMachine</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">Stages</span> <span class="p">{</span>
        <span class="n">AcceptingBlindedBids</span><span class="p">,</span>
        <span class="n">RevealBids</span><span class="p">,</span>
        <span class="n">AnotherStage</span><span class="p">,</span>
        <span class="n">AreWeDoneYet</span><span class="p">,</span>
        <span class="n">Finished</span>
    <span class="p">}</span>

    <span class="c1">// This is the current stage.</span>
    <span class="n">Stages</span> <span class="kr">public</span> <span class="n">stage</span> <span class="o">=</span> <span class="n">Stages</span><span class="p">.</span><span class="n">AcceptingBlindedBids</span><span class="p">;</span>

    <span class="kt">uint</span> <span class="kr">public</span> <span class="n">creationTime</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span> <span class="n">_stage</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="n">stage</span> <span class="o">==</span> <span class="n">_stage</span><span class="p">,</span>
            <span class="s">&quot;Function cannot be called at this time.&quot;</span>
        <span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">nextStage</span><span class="p">()</span> <span class="kr">internal</span> <span class="p">{</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="n">Stages</span><span class="p">(</span><span class="kt">uint</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Perform timed transitions. Be sure to mention</span>
    <span class="c1">// this modifier first, otherwise the guards</span>
    <span class="c1">// will not take the new stage into account.</span>
    <span class="kd">modifier</span> <span class="n">timedTransitions</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">stage</span> <span class="o">==</span> <span class="n">Stages</span><span class="p">.</span><span class="n">AcceptingBlindedBids</span> <span class="o">&amp;&amp;</span>
                    <span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">creationTime</span> <span class="o">+</span> <span class="mi">10</span> <span class="kc">days</span><span class="p">)</span>
            <span class="n">nextStage</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">stage</span> <span class="o">==</span> <span class="n">Stages</span><span class="p">.</span><span class="n">RevealBids</span> <span class="o">&amp;&amp;</span>
                <span class="nb">now</span> <span class="o">&gt;=</span> <span class="n">creationTime</span> <span class="o">+</span> <span class="mi">12</span> <span class="kc">days</span><span class="p">)</span>
            <span class="n">nextStage</span><span class="p">();</span>
        <span class="c1">// The other stages transition by transaction</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Order of the modifiers matters here!</span>
    <span class="kd">function</span> <span class="n">bid</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="kr">payable</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">AcceptingBlindedBids</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// We will not implement that here</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">reveal</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">RevealBids</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="c1">// This modifier goes to the next stage</span>
    <span class="c1">// after the function is done.</span>
    <span class="kd">modifier</span> <span class="n">transitionNext</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kr">_</span><span class="p">;</span>
        <span class="n">nextStage</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">g</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">AnotherStage</span><span class="p">)</span>
        <span class="n">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">h</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">AreWeDoneYet</span><span class="p">)</span>
        <span class="n">transitionNext</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">i</span><span class="p">()</span>
        <span class="kr">public</span>
        <span class="n">timedTransitions</span>
        <span class="n">atStage</span><span class="p">(</span><span class="n">Stages</span><span class="p">.</span><span class="n">Finished</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-bugs"></span><div class="section" id="list-of-known-bugs">
<span id="known-bugs"></span><span id="index-0"></span><h2>List of Known Bugs<a class="headerlink" href="#list-of-known-bugs" title="Permalink to this headline">¶</a></h2>
<p>Below, you can find a JSON-formatted list of some of the known security-relevant bugs in the
Solidity compiler. The file itself is hosted in the <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs.json">Github repository</a>.
The list stretches back as far as version 0.3.0, bugs known to be present only
in versions preceding that are not listed.</p>
<p>There is another file called <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/docs/bugs_by_version.json">bugs_by_version.json</a>,
which can be used to check which bugs affect a specific version of the compiler.</p>
<p>Contract source verification tools and also other tools interacting with
contracts should consult this list according to the following criteria:</p>
<blockquote>
<div><ul class="simple">
<li>It is mildly suspicious if a contract was compiled with a nightly
compiler version instead of a released version. This list does not keep
track of unreleased or nightly versions.</li>
<li>It is also mildly suspicious if a contract was compiled with a version that was
not the most recent at the time the contract was created. For contracts
created from other contracts, you have to follow the creation chain
back to a transaction and use the date of that transaction as creation date.</li>
<li>It is highly suspicious if a contract was compiled with a compiler that
contains a known bug and the contract was created at a time where a newer
compiler version containing a fix was already released.</li>
</ul>
</div></blockquote>
<p>The JSON file of known bugs below is an array of objects, one for each bug,
with the following keys:</p>
<dl class="docutils">
<dt>name</dt>
<dd>Unique name given to the bug</dd>
<dt>summary</dt>
<dd>Short description of the bug</dd>
<dt>description</dt>
<dd>Detailed description of the bug</dd>
<dt>link</dt>
<dd>URL of a website with more detailed information, optional</dd>
<dt>introduced</dt>
<dd>The first published compiler version that contained the bug, optional</dd>
<dt>fixed</dt>
<dd>The first published compiler version that did not contain the bug anymore</dd>
<dt>publish</dt>
<dd>The date at which the bug became known publicly, optional</dd>
<dt>severity</dt>
<dd>Severity of the bug: very low, low, medium, high. Takes into account
discoverability in contract tests, likelihood of occurrence and
potential damage by exploits.</dd>
<dt>conditions</dt>
<dd>Conditions that have to be met to trigger the bug. Currently, this
is an object that can contain a boolean value <code class="docutils literal notranslate"><span class="pre">optimizer</span></code>, which
means that the optimizer has to be switched on to enable the bug.
If no conditions are given, assume that the bug is present.</dd>
<dt>check</dt>
<dd>This field contains different checks that report whether the smart contract
contains the bug or not. The first type of check are Javascript regular
expressions that are to be matched against the source code (“source-regex”)
if the bug is present.  If there is no match, then the bug is very likely
not present. If there is a match, the bug might be present.  For improved
accuracy, the checks should be applied to the source code after stripping
comments.
The second type of check are patterns to be checked on the compact AST of
the Solidity program (“ast-compact-json-path”). The specified search query
is a <a class="reference external" href="https://github.com/json-path/JsonPath">JsonPath</a> expression.
If at least one path of the Solidity AST matches the query, the bug is
likely present.</dd>
</dl>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ExpExponentCleanup&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Using the ** operator with an exponent of type shorter than 256 bits can result in unexpected values.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Higher order bits in the exponent are not properly cleaned before the EXP opcode is applied if the type of the exponent expression is smaller than 256 bits and not smaller than the type of the base. In that case, the result might be larger than expected if the exponent is assumed to lie within the value range of the type. Literal numbers as exponents are unaffected as are exponents or bases of type uint256.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.25&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium/high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;check&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;regex-source&quot;</span><span class="o">:</span> <span class="s2">&quot;[^/]\\*\\* *[^/0-9 ]&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;EventStructWrongData&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Using structs in events logged wrong data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If a struct is used in an event, the address of the struct is logged instead of the actual data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.17&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.25&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;very low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;check&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;ast-compact-json-path&quot;</span><span class="o">:</span> <span class="s2">&quot;$..[?(@.nodeType === &#39;EventDefinition&#39;)]..[?(@.nodeType === &#39;UserDefinedTypeName&#39; &amp;&amp; @.typeDescriptions.typeString.startsWith(&#39;struct&#39;))]&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;NestedArrayFunctionCallDecoder&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Calling functions that return multi-dimensional fixed-size arrays can result in memory corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If Solidity code calls a function that returns a multi-dimensional fixed-size array, array elements are incorrectly interpreted as memory pointers and thus can cause memory corruption if the return values are accessed. Calling functions with multi-dimensional fixed-size arrays is unaffected as is returning fixed-size arrays from function calls. The regular expression only checks if such functions are present, not if they are called, which is required for the contract to be affected.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.1.4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.22&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;check&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;regex-source&quot;</span><span class="o">:</span> <span class="s2">&quot;returns[^;{]*\\[\\s*[^\\] \\t\\r\\n\\v\\f][^\\]]*\\]\\s*\\[\\s*[^\\] \\t\\r\\n\\v\\f][^\\]]*\\][^{;]*[;{]&quot;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OneOfTwoConstructorsSkipped&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;If a contract has both a new-style constructor (using the constructor keyword) and an old-style constructor (a function with the same name as the contract) at the same time, one of them will be ignored.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If a contract has both a new-style constructor (using the constructor keyword) and an old-style constructor (a function with the same name as the contract) at the same time, one of them will be ignored. There will be a compiler warning about the old-style constructor, so contracts only using new-style constructors are fine.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.22&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.23&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;very low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ZeroFunctionSelector&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;It is possible to craft the name of a function such that it is executed instead of the fallback function in very specific circumstances.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If a function has a selector consisting only of zeros, is payable and part of a contract that does not have a fallback function and at most five external functions in total, this function is called instead of the fallback function if Ether is sent to the contract without data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;very low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;DelegateCallReturnValue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The low-level .delegatecall() does not return the execution outcome, but converts the value returned by the functioned called to a boolean instead.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The return value of the low-level .delegatecall() function is taken from a position in memory, where the call data or the return data resides. This value is interpreted as a boolean and put onto the stack. This means if the called function returns at least 32 zero bytes, .delegatecall() returns false even if the call was successful.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ECRecoverMalformedInput&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The ecrecover() builtin can return garbage for malformed input.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The ecrecover precompile does not properly signal failure for malformed input (especially in the &#39;v&#39; argument) and thus the Solidity function can return data that was previously present in the return area in memory.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SkipEmptyStringLiteral&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;If \&quot;\&quot; is used in a function call, the following function arguments will not be correctly passed to the function.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;If the empty string literal \&quot;\&quot; is used as an argument in a function call, it is skipped by the encoder. This has the effect that the encoding of all arguments following this is shifted left by 32 bytes and thus the function call data is corrupted.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ConstantOptimizerSubtraction&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;In some situations, the optimizer replaces certain numbers in the code with routines that compute different numbers.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer tries to represent any number in the bytecode by routines that compute them with less gas. For some special numbers, an incorrect routine is generated. This could allow an attacker to e.g. trick victims about a specific amount of ether, or function calls to call different functions (or none at all).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="s2">&quot;https://blog.ethereum.org/2017/05/03/solidity-optimizer-bug/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.11&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;IdentityPrecompileReturnIgnored&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Failure of the identity precompile was ignored.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Calls to the identity contract, which is used for copying memory, ignored its return value. On the public chain, calls to the identity precompile can be made in a way that they never fail, but this might be different on private chains.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.7&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerStateKnowledgeNotResetForJumpdest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was simplified to just use the empty state, but this implementation was not done properly. This bug can cause data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;HighOrderByteCleanStorage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;For short types, the high order bytes were not cleaned properly and could overwrite existing data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Types shorter than 32 bytes are packed together into the same 32 byte storage slot, but storage writes always write 32 bytes. For some types, the higher order bytes were not cleaned properly, which made it sometimes possible to overwrite a variable in storage when writing to another one.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="s2">&quot;https://blog.ethereum.org/2016/11/01/security-alert-solidity-variables-can-overwritten-storage/&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.1.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.4&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerStaleKnowledgeAboutSHA3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its knowledge about SHA3 operations resulting in some hashes (also used for storage variable positions) not being calculated correctly.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution in order to save re-evaluating expressions whose value is already known. This knowledge was not properly reset across control flow paths and thus the optimizer sometimes thought that the result of a SHA3 operation is already present on the stack. This could result in data corruption by accessing the wrong storage slot.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;LibrariesNotCallableFromPayableFunctions&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Library functions threw an exception when called from a call that received Ether.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Library functions are protected against sending them Ether through a call. Since the DELEGATECALL opcode forwards the information about how much Ether was sent with a call, the library function incorrectly assumed that Ether was sent to the library and threw an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;introduced&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.2&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;SendFailsForZeroEther&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The send function did not provide enough gas to the recipient if no Ether was sent with it.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The recipient of an Ether transfer automatically receives a certain amount of gas from the EVM to handle the transfer. In the case of a zero-transfer, this gas is not provided which causes the recipient to throw an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.4.0&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;DynamicAllocationInfiniteLoop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Dynamic allocation of an empty memory array caused an infinite loop and thus an exception.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Memory arrays can be created provided a length. If this length is zero, code was generated that did not terminate and thus consumed all gas.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.6&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;OptimizerClearStateOnCodePathJoin&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer did not properly reset its internal state at jump destinations, which could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The optimizer performs symbolic execution at certain stages. At jump destinations, multiple code paths join and thus it has to compute a common state from the incoming edges. Computing this common state was not done correctly. This bug can cause data corruption, but it is probably quite hard to use for targeted attacks.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.6&quot;</span><span class="p">,</span>
        <span class="s2">&quot;conditions&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;optimizer&quot;</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;CleanBytesHigherOrderBits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;The higher order bits of short bytesNN types were not cleaned before comparison.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Two variables of type bytesNN were considered different if their higher order bits, which are not part of the actual value, were different. An attacker might use this to reach seemingly unreachable code paths by providing incorrectly formatted input data.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium/high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.3&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;ArrayAccessCleanHigherOrderBits&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Access to array elements for arrays of types with less than 32 bytes did not correctly clean the higher order bits, causing corruption in other array elements.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Multiple elements of an array of values that are shorter than 17 bytes are packed into the same storage slot. Writing to a single element of such an array did not properly clean the higher order bytes and thus could lead to data corruption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;medium/high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.1&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;AncientCompiler&quot;</span><span class="p">,</span>
        <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;This compiler version is ancient and might contain several undocumented or undiscovered bugs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;The list of bugs is only kept for compiler versions starting from 0.3.0, so older versions might contain undocumented bugs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;severity&quot;</span><span class="o">:</span> <span class="s2">&quot;high&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fixed&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.0&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<span id="document-contributing"></span><div class="section" id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Help is always appreciated!</p>
<p>To get started, you can try <a class="reference internal" href="index.html#building-from-source"><span class="std std-ref">Building from Source</span></a> in order to familiarize
yourself with the components of Solidity and the build process. Also, it may be
useful to become well-versed at writing smart-contracts in Solidity.</p>
<p>In particular, we need help in the following areas:</p>
<ul class="simple">
<li>Improving the documentation</li>
<li>Responding to questions from other users on <a class="reference external" href="https://ethereum.stackexchange.com">StackExchange</a> and the <a class="reference external" href="https://gitter.im/ethereum/solidity">Solidity Gitter</a></li>
<li>Fixing and responding to <a class="reference external" href="https://github.com/ethereum/solidity/issues">Solidity’s GitHub issues</a>, especially those tagged as
<a class="reference external" href="https://github.com/ethereum/solidity/labels/good%20first%20issue">good first issue</a> which are
meant as introductory issues for external contributors.</li>
</ul>
<p>Please note that this project is released with a <a class="reference external" href="https://raw.githubusercontent.com/ethereum/solidity/develop/CODE_OF_CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project - in the issues, pull requests, or Gitter channels - you agree to abide by its terms.</p>
<div class="section" id="how-to-report-issues">
<h3>How to Report Issues<a class="headerlink" href="#how-to-report-issues" title="Permalink to this headline">¶</a></h3>
<p>To report an issue, please use the
<a class="reference external" href="https://github.com/ethereum/solidity/issues">GitHub issues tracker</a>. When
reporting issues, please mention the following details:</p>
<ul class="simple">
<li>Which version of Solidity you are using</li>
<li>What was the source code (if applicable)</li>
<li>Which platform are you running on</li>
<li>How to reproduce the issue</li>
<li>What was the result of the issue</li>
<li>What the expected behaviour is</li>
</ul>
<p>Reducing the source code that caused the issue to a bare minimum is always
very helpful and sometimes even clarifies a misunderstanding.</p>
</div>
<div class="section" id="workflow-for-pull-requests">
<h3>Workflow for Pull Requests<a class="headerlink" href="#workflow-for-pull-requests" title="Permalink to this headline">¶</a></h3>
<p>In order to contribute, please fork off of the <code class="docutils literal notranslate"><span class="pre">develop</span></code> branch and make your
changes there. Your commit messages should detail <em>why</em> you made your change
in addition to <em>what</em> you did (unless it is a tiny change).</p>
<p>If you need to pull in any changes from <code class="docutils literal notranslate"><span class="pre">develop</span></code> after making your fork (for
example, to resolve potential merge conflicts), please avoid using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">merge</span></code>
and instead, <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rebase</span></code> your branch. This will help us review your change
more easily.</p>
<p>Additionally, if you are writing a new feature, please ensure you add appropriate
test cases under <code class="docutils literal notranslate"><span class="pre">test/</span></code> (see below).</p>
<p>However, if you are making a larger change, please consult with the <a class="reference external" href="https://gitter.im/ethereum/solidity-dev">Solidity Development Gitter channel</a> (different from the one mentioned above, this one is
focused on compiler and language development instead of language use) first.</p>
<p>New features and bugfixes should be added to the <code class="docutils literal notranslate"><span class="pre">Changelog.md</span></code> file: please
follow the style of previous entries, when applicable.</p>
<p>Finally, please make sure you respect the <a class="reference external" href="https://github.com/ethereum/solidity/blob/develop/CODING_STYLE.md">coding style</a>
for this project. Also, even though we do CI testing, please test your code and
ensure that it builds locally before submitting a pull request.</p>
<p>Thank you for your help!</p>
</div>
<div class="section" id="running-the-compiler-tests">
<h3>Running the compiler tests<a class="headerlink" href="#running-the-compiler-tests" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">./scripts/tests.sh</span></code> script executes most Solidity tests and
runs <code class="docutils literal notranslate"><span class="pre">aleth</span></code> automatically if it is in the path, but does not download it,
so you need to install it first. Please read on for the details.</p>
<p>Solidity includes different types of tests, most of them bundled into the <code class="docutils literal notranslate"><span class="pre">soltest</span></code>
application. Some of them require the <code class="docutils literal notranslate"><span class="pre">aleth</span></code> client in testing mode, others require <code class="docutils literal notranslate"><span class="pre">libz3</span></code>.</p>
<p>To run a basic set of tests that require neither <code class="docutils literal notranslate"><span class="pre">aleth</span></code> nor <code class="docutils literal notranslate"><span class="pre">libz3</span></code>, run
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>. This script runs <code class="docutils literal notranslate"><span class="pre">./build/test/soltest</span></code>
internally.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Those working in a Windows environment wanting to run the above basic sets without aleth or libz3 in Git Bash, you would have to do: <code class="docutils literal notranslate"><span class="pre">./build/test/Release/soltest.exe</span> <span class="pre">--</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>.
If you’re running this in plain Command Prompt, use <code class="docutils literal notranslate"><span class="pre">.\build\test\Release\soltest.exe</span> <span class="pre">--</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>.</p>
</div>
<p>The option <code class="docutils literal notranslate"><span class="pre">--no-smt</span></code> disables the tests that require <code class="docutils literal notranslate"><span class="pre">libz3</span></code> and
<code class="docutils literal notranslate"><span class="pre">--no-ipc</span></code> disables those that require <code class="docutils literal notranslate"><span class="pre">aleth</span></code>.</p>
<p>If you want to run the ipc tests (that test the semantics of the generated code),
you need to install <a class="reference external" href="https://github.com/ethereum/aleth/releases/download/v1.5.0-alpha.7/aleth-1.5.0-alpha.7-linux-x86_64.tar.gz">aleth</a> and run it in testing mode: <code class="docutils literal notranslate"><span class="pre">aleth</span> <span class="pre">--db</span> <span class="pre">memorydb</span> <span class="pre">--test</span> <span class="pre">-d</span> <span class="pre">/tmp/testeth</span></code>.</p>
<p>To run the actual tests, use: <code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span></code>.</p>
<p>To run a subset of tests, you can use filters:
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">-t</span> <span class="pre">TestSuite/TestName</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/testeth/geth.ipc</span></code>,
where <code class="docutils literal notranslate"><span class="pre">TestName</span></code> can be a wildcard <code class="docutils literal notranslate"><span class="pre">*</span></code>.</p>
<p>For example, here’s an example test you might run;
<code class="docutils literal notranslate"><span class="pre">./scripts/soltest.sh</span> <span class="pre">-t</span> <span class="pre">&quot;yulOptimizerTests/disambiguator/*&quot;</span> <span class="pre">--no-ipc</span> <span class="pre">--no-smt</span></code>.
This will test all the tests for the disambiguator.</p>
<p>To get a list of all tests, use
<code class="docutils literal notranslate"><span class="pre">./build/test/soltest</span> <span class="pre">--list_content=HRF</span> <span class="pre">--</span> <span class="pre">--ipcpath</span> <span class="pre">/tmp/irrelevant</span></code>.</p>
<p>If you want to debug using GDB, make sure you build differently than the “usual”.
For example, you could run the following command in your <code class="docutils literal notranslate"><span class="pre">build</span></code> folder:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">Debug</span> <span class="p">..</span>
<span class="n">make</span>
</pre></div>
</div>
<p>This will create symbols such that when you debug a test using the <code class="docutils literal notranslate"><span class="pre">--debug</span></code> flag, you will have access to functions and variables in which you can break or print with.</p>
<p>The script <code class="docutils literal notranslate"><span class="pre">./scripts/tests.sh</span></code> also runs commandline tests and compilation tests
in addition to those found in <code class="docutils literal notranslate"><span class="pre">soltest</span></code>.</p>
<p>The CI runs additional tests (including <code class="docutils literal notranslate"><span class="pre">solc-js</span></code> and testing third party Solidity frameworks) that require compiling the Emscripten target.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some versions of <code class="docutils literal notranslate"><span class="pre">aleth</span></code> can not be used for testing. We suggest using
the same version that the Solidity continuous integration tests use.
Currently the CI uses version <code class="docutils literal notranslate"><span class="pre">1.5.0-alpha.7</span></code> of <code class="docutils literal notranslate"><span class="pre">aleth</span></code>.</p>
</div>
<div class="section" id="writing-and-running-syntax-tests">
<h4>Writing and running syntax tests<a class="headerlink" href="#writing-and-running-syntax-tests" title="Permalink to this headline">¶</a></h4>
<p>Syntax tests check that the compiler generates the correct error messages for invalid code
and properly accepts valid code.
They are stored in individual files inside the <code class="docutils literal notranslate"><span class="pre">tests/libsolidity/syntaxTests</span></code> folder.
These files must contain annotations, stating the expected result(s) of the respective test.
The test suite compiles and checks them against the given expectations.</p>
<p>For example: <code class="docutils literal notranslate"><span class="pre">./test/libsolidity/syntaxTests/double_stateVariable_declaration.sol</span></code></p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
    <span class="kt">uint128</span> <span class="n">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: (36-52): Identifier already declared.</span>
</pre></div>
</div>
<p>A syntax test must contain at least the contract under test itself, followed by the separator <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">----</span></code>. The comments that follow the separator are used to describe the
expected compiler errors or warnings. The number range denotes the location in the source where the error occurred.
If you want the contract to compile without any errors or warning you can leave
out the separator and the comments that follow it.</p>
<p>In the above example, the state variable <code class="docutils literal notranslate"><span class="pre">variable</span></code> was declared twice, which is not allowed. This results in a <code class="docutils literal notranslate"><span class="pre">DeclarationError</span></code> stating that the identifier was already declared.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">isoltest</span></code> tool is used for these tests and you can find it under <code class="docutils literal notranslate"><span class="pre">./build/test/tools/</span></code>. It is an interactive tool which allows
editing of failing contracts using your preferred text editor. Let’s try to break this test by removing the second declaration of <code class="docutils literal notranslate"><span class="pre">variable</span></code>:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
<span class="c1">// DeclarationError: (36-52): Identifier already declared.</span>
</pre></div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">./build/test/isoltest</span></code> again results in a test failure:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">syntaxTests</span><span class="o">/</span><span class="n">double_stateVariable_declaration</span><span class="p">.</span><span class="n">sol</span><span class="o">:</span> <span class="n">FAIL</span>
    <span class="n">Contract</span><span class="o">:</span>
        <span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
            <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
        <span class="p">}</span>

    <span class="n">Expected</span> <span class="n">result</span><span class="o">:</span>
        <span class="n">DeclarationError</span><span class="o">:</span> <span class="p">(</span><span class="mi">36</span><span class="o">-</span><span class="mi">52</span><span class="p">)</span><span class="o">:</span> <span class="n">Identifier</span> <span class="n">already</span> <span class="n">declared</span><span class="p">.</span>
    <span class="n">Obtained</span> <span class="n">result</span><span class="o">:</span>
        <span class="n">Success</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">isoltest</span></code> prints the expected result next to the obtained result, and also
provides a way to edit, update or skip the current contract file, or quit the application.</p>
<p>It offers several options for failing tests:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">edit</span></code>: <code class="docutils literal notranslate"><span class="pre">isoltest</span></code> tries to open the contract in an editor so you can adjust it. It either uses the editor given on the command line (as <code class="docutils literal notranslate"><span class="pre">isoltest</span> <span class="pre">--editor</span> <span class="pre">/path/to/editor</span></code>), in the environment variable <code class="docutils literal notranslate"><span class="pre">EDITOR</span></code> or just <code class="docutils literal notranslate"><span class="pre">/usr/bin/editor</span></code> (in that order).</li>
<li><code class="docutils literal notranslate"><span class="pre">update</span></code>: Updates the expectations for contract under test. This updates the annotations by removing unmet expectations and adding missing expectations. The test is then run again.</li>
<li><code class="docutils literal notranslate"><span class="pre">skip</span></code>: Skips the execution of this particular test.</li>
<li><code class="docutils literal notranslate"><span class="pre">quit</span></code>: Quits <code class="docutils literal notranslate"><span class="pre">isoltest</span></code>.</li>
</ul>
<p>All of these options apply to the current contract, expect <code class="docutils literal notranslate"><span class="pre">quit</span></code> which stops the entire testing process.</p>
<p>Automatically updating the test above changes it to</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">test</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="n">variable</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ----</span>
</pre></div>
</div>
<p>and re-run the test. It now passes again:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Re</span><span class="o">-</span><span class="n">running</span> <span class="n">test</span> <span class="n">case</span><span class="p">...</span>
<span class="n">syntaxTests</span><span class="o">/</span><span class="n">double_stateVariable_declaration</span><span class="p">.</span><span class="n">sol</span><span class="o">:</span> <span class="n">OK</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Choose a name for the contract file that explains what it tests, e.g. <code class="docutils literal notranslate"><span class="pre">double_variable_declaration.sol</span></code>.
Do not put more than one contract into a single file, unless you are testing inheritance or cross-contract calls.
Each file should test one aspect of your new feature.</p>
</div>
</div>
</div>
<div class="section" id="running-the-fuzzer-via-afl">
<h3>Running the Fuzzer via AFL<a class="headerlink" href="#running-the-fuzzer-via-afl" title="Permalink to this headline">¶</a></h3>
<p>Fuzzing is a technique that runs programs on more or less random inputs to find exceptional execution
states (segmentation faults, exceptions, etc). Modern fuzzers are clever and run a directed search
inside the input. We have a specialized binary called <code class="docutils literal notranslate"><span class="pre">solfuzzer</span></code> which takes source code as input
and fails whenever it encounters an internal compiler error, segmentation fault or similar, but
does not fail if e.g., the code contains an error. This way, fuzzing tools can find internal problems in the compiler.</p>
<p>We mainly use <a class="reference external" href="http://lcamtuf.coredump.cx/afl/">AFL</a> for fuzzing. You need to download and
install the AFL packages from your repositories (afl, afl-clang) or build them manually.
Next, build Solidity (or just the <code class="docutils literal notranslate"><span class="pre">solfuzzer</span></code> binary) with AFL as your compiler:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">build</span>
<span class="err">#</span> <span class="k">if</span> <span class="n">needed</span>
<span class="n">make</span> <span class="n">clean</span>
<span class="n">cmake</span> <span class="p">..</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">gcc</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">g</span><span class="o">++</span>
<span class="n">make</span> <span class="n">solfuzzer</span>
</pre></div>
</div>
<p>At this stage you should be able to see a message similar to the following:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">Scanning</span> <span class="n">dependencies</span> <span class="n">of</span> <span class="n">target</span> <span class="n">solfuzzer</span>
<span class="p">[</span> <span class="mi">98</span><span class="o">%</span><span class="p">]</span> <span class="n">Building</span> <span class="n">CXX</span> <span class="n">object</span> <span class="n">test</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">CMakeFiles</span><span class="o">/</span><span class="n">solfuzzer</span><span class="p">.</span><span class="n">dir</span><span class="o">/</span><span class="n">fuzzer</span><span class="p">.</span><span class="n">cpp</span><span class="p">.</span><span class="n">o</span>
<span class="n">afl</span><span class="o">-</span><span class="n">cc</span> <span class="mf">2.52</span><span class="n">b</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">lcamtuf</span><span class="err">@</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">afl</span><span class="o">-</span><span class="kr">as</span> <span class="mf">2.52</span><span class="n">b</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">lcamtuf</span><span class="err">@</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Instrumented</span> <span class="mi">1949</span> <span class="n">locations</span> <span class="p">(</span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="p">,</span> <span class="n">non</span><span class="o">-</span><span class="n">hardened</span> <span class="n">mode</span><span class="p">,</span> <span class="n">ratio</span> <span class="mi">100</span><span class="o">%</span><span class="p">).</span>
<span class="p">[</span><span class="mi">100</span><span class="o">%</span><span class="p">]</span> <span class="n">Linking</span> <span class="n">CXX</span> <span class="n">executable</span> <span class="n">solfuzzer</span>
</pre></div>
</div>
<p>If the instrumentation messages did not appear, try switching the cmake flags pointing to AFL’s clang binaries:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="err">#</span> <span class="k">if</span> <span class="n">previously</span> <span class="n">failed</span>
<span class="n">make</span> <span class="n">clean</span>
<span class="n">cmake</span> <span class="p">..</span> <span class="o">-</span><span class="n">DCMAKE_C_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">clang</span> <span class="o">-</span><span class="n">DCMAKE_CXX_COMPILER</span><span class="o">=</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">clang</span><span class="o">++</span>
<span class="n">make</span> <span class="n">solfuzzer</span>
</pre></div>
</div>
<p>Otherwise, upon execution the fuzzer halts with an error saying binary is not instrumented:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span> <span class="mf">2.52</span><span class="n">b</span> <span class="n">by</span> <span class="o">&lt;</span><span class="n">lcamtuf</span><span class="err">@</span><span class="n">google</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="p">...</span> <span class="p">(</span><span class="n">truncated</span> <span class="n">messages</span><span class="p">)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Validating</span> <span class="n">target</span> <span class="n">binary</span><span class="p">...</span>

<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="n">Looks</span> <span class="n">like</span> <span class="n">the</span> <span class="n">target</span> <span class="n">binary</span> <span class="kr">is</span> <span class="n">not</span> <span class="n">instrumented</span><span class="o">!</span> <span class="n">The</span> <span class="n">fuzzer</span> <span class="n">depends</span> <span class="n">on</span>
    <span class="n">compile</span><span class="o">-</span><span class="n">time</span> <span class="n">instrumentation</span> <span class="n">to</span> <span class="n">isolate</span> <span class="n">interesting</span> <span class="n">test</span> <span class="n">cases</span> <span class="k">while</span>
    <span class="n">mutating</span> <span class="n">the</span> <span class="n">input</span> <span class="n">data</span><span class="p">.</span> <span class="n">For</span> <span class="n">more</span> <span class="n">information</span><span class="p">,</span> <span class="n">and</span> <span class="k">for</span> <span class="n">tips</span> <span class="n">on</span> <span class="n">how</span> <span class="n">to</span>
    <span class="n">instrument</span> <span class="n">binaries</span><span class="p">,</span> <span class="n">please</span> <span class="n">see</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">afl</span><span class="o">-</span><span class="n">doc</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">README</span><span class="p">.</span>

    <span class="n">When</span> <span class="n">source</span> <span class="n">code</span> <span class="kr">is</span> <span class="n">not</span> <span class="n">available</span><span class="p">,</span> <span class="n">you</span> <span class="n">may</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">leverage</span> <span class="n">QEMU</span>
    <span class="n">mode</span> <span class="n">support</span><span class="p">.</span> <span class="n">Consult</span> <span class="n">the</span> <span class="n">README</span> <span class="k">for</span> <span class="n">tips</span> <span class="n">on</span> <span class="n">how</span> <span class="n">to</span> <span class="n">enable</span> <span class="nb">this</span><span class="p">.</span>
    <span class="p">(</span><span class="n">It</span> <span class="kr">is</span> <span class="n">also</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">use</span> <span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span> <span class="kr">as</span> <span class="n">a</span> <span class="n">traditional</span><span class="p">,</span> <span class="s">&quot;dumb&quot;</span> <span class="n">fuzzer</span><span class="p">.</span>
    <span class="n">For</span> <span class="n">that</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">use</span> <span class="n">the</span> <span class="o">-</span><span class="n">n</span> <span class="n">option</span> <span class="o">-</span> <span class="n">but</span> <span class="n">expect</span> <span class="n">much</span> <span class="n">worse</span> <span class="n">results</span><span class="p">.)</span>

<span class="p">[</span><span class="o">-</span><span class="p">]</span> <span class="n">PROGRAM</span> <span class="n">ABORT</span> <span class="o">:</span> <span class="n">No</span> <span class="n">instrumentation</span> <span class="n">detected</span>
         <span class="n">Location</span> <span class="o">:</span> <span class="n">check_binary</span><span class="p">(),</span> <span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span><span class="p">.</span><span class="n">c</span><span class="o">:</span><span class="mi">6920</span>
</pre></div>
</div>
<p>Next, you need some example source files. This makes it much easier for the fuzzer
to find errors. You can either copy some files from the syntax tests or extract test files
from the documentation or the other tests:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test_cases</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test_cases</span>
<span class="err">#</span> <span class="n">extract</span> <span class="kr">from</span> <span class="n">tests</span><span class="o">:</span>
<span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">isolate_tests</span><span class="p">.</span><span class="n">py</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">libsolidity</span><span class="o">/</span><span class="n">SolidityEndToEndTest</span><span class="p">.</span><span class="n">cpp</span>
<span class="err">#</span> <span class="n">extract</span> <span class="kr">from</span> <span class="n">documentation</span><span class="o">:</span>
<span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">isolate_tests</span><span class="p">.</span><span class="n">py</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solidity</span><span class="o">/</span><span class="n">docs</span> <span class="n">docs</span>
</pre></div>
</div>
<p>The AFL documentation states that the corpus (the initial input files) should not be
too large. The files themselves should not be larger than 1 kB and there should be
at most one input file per functionality, so better start with a small number of.
There is also a tool called <code class="docutils literal notranslate"><span class="pre">afl-cmin</span></code> that can trim input files
that result in similar behaviour of the binary.</p>
<p>Now run the fuzzer (the <code class="docutils literal notranslate"><span class="pre">-m</span></code> extends the size of memory to 60 MB):</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="n">afl</span><span class="o">-</span><span class="n">fuzz</span> <span class="o">-</span><span class="n">m</span> <span class="mi">60</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">test_cases</span> <span class="o">-</span><span class="n">o</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">fuzzer_reports</span> <span class="o">--</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">solfuzzer</span>
</pre></div>
</div>
<p>The fuzzer creates source files that lead to failures in <code class="docutils literal notranslate"><span class="pre">/tmp/fuzzer_reports</span></code>.
Often it finds many similar source files that produce the same error. You can
use the tool <code class="docutils literal notranslate"><span class="pre">scripts/uniqueErrors.sh</span></code> to filter out the unique errors.</p>
</div>
<div class="section" id="whiskers">
<h3>Whiskers<a class="headerlink" href="#whiskers" title="Permalink to this headline">¶</a></h3>
<p><em>Whiskers</em> is a string templating system similar to <a class="reference external" href="https://mustache.github.io">Mustache</a>. It is used by the
compiler in various places to aid readability, and thus maintainability and verifiability, of the code.</p>
<p>The syntax comes with a substantial difference to Mustache. The template markers <code class="docutils literal notranslate"><span class="pre">{{</span></code> and <code class="docutils literal notranslate"><span class="pre">}}</span></code> are
replaced by <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> in order to aid parsing and avoid conflicts with <a class="reference internal" href="index.html#inline-assembly"><span class="std std-ref">Inline Assembly</span></a>
(The symbols <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> are invalid in inline assembly, while <code class="docutils literal notranslate"><span class="pre">{</span></code> and <code class="docutils literal notranslate"><span class="pre">}</span></code> are used to delimit blocks).
Another limitation is that lists are only resolved one depth and they do not recurse. This may change in the future.</p>
<p>A rough specification is the following:</p>
<p>Any occurrence of <code class="docutils literal notranslate"><span class="pre">&lt;name&gt;</span></code> is replaced by the string-value of the supplied variable <code class="docutils literal notranslate"><span class="pre">name</span></code> without any
escaping and without iterated replacements. An area can be delimited by <code class="docutils literal notranslate"><span class="pre">&lt;#name&gt;...&lt;/name&gt;</span></code>. It is replaced
by as many concatenations of its contents as there were sets of variables supplied to the template system,
each time replacing any <code class="docutils literal notranslate"><span class="pre">&lt;inner&gt;</span></code> items by their respective value. Top-level variables can also be used
inside such areas.</p>
</div>
</div>
<span id="document-frequently-asked-questions"></span><div class="section" id="frequently-asked-questions">
<h2>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h2>
<p>This list was originally compiled by <a class="reference external" href="mailto:fivedogit&#37;&#52;&#48;gmail&#46;com">fivedogit</a>.</p>
<div class="section" id="basic-questions">
<h3>Basic Questions<a class="headerlink" href="#basic-questions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="if-i-return-an-enum-i-only-get-integer-values-in-web3-js-how-to-get-the-named-values">
<h4>If I return an <code class="docutils literal notranslate"><span class="pre">enum</span></code>, I only get integer values in web3.js. How to get the named values?<a class="headerlink" href="#if-i-return-an-enum-i-only-get-integer-values-in-web3-js-how-to-get-the-named-values" title="Permalink to this headline">¶</a></h4>
<p>Enums are not supported by the ABI, they are just supported by Solidity.
You have to do the mapping yourself for now, we might provide some help
later.</p>
</div>
<div class="section" id="what-are-some-examples-of-basic-string-manipulation-substring-indexof-charat-etc">
<h4>What are some examples of basic string manipulation (<code class="docutils literal notranslate"><span class="pre">substring</span></code>, <code class="docutils literal notranslate"><span class="pre">indexOf</span></code>, <code class="docutils literal notranslate"><span class="pre">charAt</span></code>, etc)?<a class="headerlink" href="#what-are-some-examples-of-basic-string-manipulation-substring-indexof-charat-etc" title="Permalink to this headline">¶</a></h4>
<p>There are some string utility functions at <a class="reference external" href="https://github.com/ethereum/dapp-bin/blob/master/library/stringUtils.sol">stringUtils.sol</a>
which will be extended in the future. In addition, Arachnid has written <a class="reference external" href="https://github.com/Arachnid/solidity-stringutils">solidity-stringutils</a>.</p>
<p>For now, if you want to modify a string (even when you only want to know its length),
you should always convert it to a <code class="docutils literal notranslate"><span class="pre">bytes</span></code> first:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">C</span> <span class="p">{</span>
    <span class="kt">string</span> <span class="n">s</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">append</span><span class="p">(</span><span class="kt">byte</span> <span class="n">c</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">bytes</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">push</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">set</span><span class="p">(</span><span class="kt">uint</span> <span class="n">i</span><span class="p">,</span> <span class="kt">byte</span> <span class="n">c</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="kt">bytes</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="can-i-concatenate-two-strings">
<h4>Can I concatenate two strings?<a class="headerlink" href="#can-i-concatenate-two-strings" title="Permalink to this headline">¶</a></h4>
<p>Yes, you can use <code class="docutils literal notranslate"><span class="pre">abi.encodePacked</span></code>:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">&gt;=</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.6</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">library</span> <span class="n">ConcatHelper</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="n">concat</span><span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">a</span><span class="p">,</span> <span class="kt">bytes</span> <span class="kr">memory</span> <span class="n">b</span><span class="p">)</span>
            <span class="kr">internal</span> <span class="kr">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="kr">memory</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">abi.encodePacked</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="advanced-questions">
<h3>Advanced Questions<a class="headerlink" href="#advanced-questions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="get-return-value-from-non-constant-function-from-another-contract">
<h4>Get return value from non-constant function from another contract<a class="headerlink" href="#get-return-value-from-non-constant-function-from-another-contract" title="Permalink to this headline">¶</a></h4>
<p>The key point is that the calling contract needs to know about the function it intends to call.</p>
<p>See <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_ping.sol">ping.sol</a>
and <a class="reference external" href="https://github.com/fivedogit/solidity-baby-steps/blob/master/contracts/45_pong.sol">pong.sol</a>.</p>
</div>
<div class="section" id="how-do-i-initialize-a-contract-with-only-a-specific-amount-of-wei">
<h4>How do I initialize a contract with only a specific amount of wei?<a class="headerlink" href="#how-do-i-initialize-a-contract-with-only-a-specific-amount-of-wei" title="Permalink to this headline">¶</a></h4>
<p>Currently the approach is a little ugly, but there is little that can be done to improve it.
In the case of a <code class="docutils literal notranslate"><span class="pre">contract</span> <span class="pre">A</span></code> calling a new instance of <code class="docutils literal notranslate"><span class="pre">contract</span> <span class="pre">B</span></code>, parentheses have to be used around
<code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">B</span></code> because <code class="docutils literal notranslate"><span class="pre">B.value</span></code> would refer to a member of <code class="docutils literal notranslate"><span class="pre">B</span></code> called <code class="docutils literal notranslate"><span class="pre">value</span></code>.
You will need to make sure that you have both contracts aware of each other’s presence and that <code class="docutils literal notranslate"><span class="pre">contract</span> <span class="pre">B</span></code> has a <code class="docutils literal notranslate"><span class="pre">payable</span></code> constructor.
In this example:</p>
<div class="highlight-Solidity notranslate"><div class="highlight"><pre><span></span><span class="kr">pragma solidity</span> <span class="o">^</span><span class="mf">0.5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="n">B</span> <span class="p">{</span>
    <span class="kd">constructor</span><span class="p">()</span> <span class="kr">public</span> <span class="kr">payable</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="kd">contract</span> <span class="n">A</span> <span class="p">{</span>
    <span class="n">B</span> <span class="n">child</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">test</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
        <span class="n">child</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="n">B</span><span class="p">).</span><span class="n">value</span><span class="p">(</span><span class="mi">10</span><span class="p">)();</span> <span class="c1">//construct a new B with 10 wei</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="more-questions">
<h4>More Questions?<a class="headerlink" href="#more-questions" title="Permalink to this headline">¶</a></h4>
<p>If you have more questions or your question is not answered here, please talk to us on
<a class="reference external" href="https://gitter.im/ethereum/solidity">gitter</a> or file an <a class="reference external" href="https://github.com/ethereum/solidity/issues">issue</a>.</p>
</div>
</div>
</div>
<span id="document-lll"></span><div class="section" id="lll">
<h2>LLL<a class="headerlink" href="#lll" title="Permalink to this headline">¶</a></h2>
<p id="id1">LLL is a low-level language for the EVM with an s-expressions syntax.</p>
<p>The Solidity repository contains an LLL compiler, which shares the assembler subsystem with Solidity.
However, apart from maintaining that it still compiles, no other improvements are made to it.</p>
<p>It is not built unless specifically requested:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cmake -DLLL<span class="o">=</span>ON ..
$ cmake --build .
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The LLL codebase is deprecated and will be removed from the Solidity repository in the future.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Ethereum
      
        <span class="commit">
          Revision <code>10d17f24</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: v0.5.3
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
          <dd><a href="/en/stable/">stable</a></dd>
        
          <dd><a href="/en/v0.5.3/">v0.5.3</a></dd>
        
          <dd><a href="/en/v0.5.2/">v0.5.2</a></dd>
        
          <dd><a href="/en/v0.5.1/">v0.5.1</a></dd>
        
          <dd><a href="/en/v0.5.0/">v0.5.0</a></dd>
        
          <dd><a href="/en/v0.4.25/">v0.4.25</a></dd>
        
          <dd><a href="/en/v0.4.24/">v0.4.24</a></dd>
        
          <dd><a href="/en/v0.4.23/">v0.4.23</a></dd>
        
          <dd><a href="/en/v0.4.22/">v0.4.22</a></dd>
        
          <dd><a href="/en/v0.4.21/">v0.4.21</a></dd>
        
          <dd><a href="/en/v0.4.20/">v0.4.20</a></dd>
        
          <dd><a href="/en/v0.4.19/">v0.4.19</a></dd>
        
          <dd><a href="/en/v0.4.18/">v0.4.18</a></dd>
        
          <dd><a href="/en/v0.4.17/">v0.4.17</a></dd>
        
          <dd><a href="/en/v0.4.16/">v0.4.16</a></dd>
        
          <dd><a href="/en/v0.4.15/">v0.4.15</a></dd>
        
          <dd><a href="/en/v0.4.14/">v0.4.14</a></dd>
        
          <dd><a href="/en/v0.4.13/">v0.4.13</a></dd>
        
          <dd><a href="/en/v0.4.12/">v0.4.12</a></dd>
        
          <dd><a href="/en/v0.4.11/">v0.4.11</a></dd>
        
          <dd><a href="/en/v0.4.10/">v0.4.10</a></dd>
        
          <dd><a href="/en/v0.4.9/">v0.4.9</a></dd>
        
          <dd><a href="/en/v0.4.8/">v0.4.8</a></dd>
        
          <dd><a href="/en/v0.4.7/">v0.4.7</a></dd>
        
          <dd><a href="/en/v0.4.6/">v0.4.6</a></dd>
        
          <dd><a href="/en/v0.4.5/">v0.4.5</a></dd>
        
          <dd><a href="/en/v0.4.4/">v0.4.4</a></dd>
        
          <dd><a href="/en/v0.4.3/">v0.4.3</a></dd>
        
          <dd><a href="/en/v0.4.2/">v0.4.2</a></dd>
        
          <dd><a href="/en/v0.4.1/">v0.4.1</a></dd>
        
          <dd><a href="/en/v0.4.0/">v0.4.0</a></dd>
        
          <dd><a href="/en/v0.3.6/">v0.3.6</a></dd>
        
          <dd><a href="/en/v0.3.5/">v0.3.5</a></dd>
        
          <dd><a href="/en/v0.3.4/">v0.3.4</a></dd>
        
          <dd><a href="/en/v0.3.3/">v0.3.3</a></dd>
        
          <dd><a href="/en/v0.3.2/">v0.3.2</a></dd>
        
          <dd><a href="/en/v0.3.1/">v0.3.1</a></dd>
        
          <dd><a href="/en/v0.3.0/">v0.3.0</a></dd>
        
          <dd><a href="/en/v0.2.2/">v0.2.2</a></dd>
        
          <dd><a href="/en/v0.2.1/">v0.2.1</a></dd>
        
          <dd><a href="/en/v0.2.0/">v0.2.0</a></dd>
        
          <dd><a href="/en/v0.1.7/">v0.1.7</a></dd>
        
          <dd><a href="/en/v0.1.6/">v0.1.6</a></dd>
        
          <dd><a href="/en/v0.1.5/">v0.1.5</a></dd>
        
          <dd><a href="/en/v0.1.4/">v0.1.4</a></dd>
        
          <dd><a href="/en/v0.1.3/">v0.1.3</a></dd>
        
          <dd><a href="/en/v0.1.2/">v0.1.2</a></dd>
        
          <dd><a href="/en/develop/">develop</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/solidity/?fromdocs=solidity">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/solidity/?fromdocs=solidity">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'0.5.3',
              LANGUAGE:'en',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>