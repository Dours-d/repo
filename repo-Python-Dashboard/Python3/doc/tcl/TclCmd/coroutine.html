<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>ActiveTcl 8.6.9 Documentation</title>
    <meta name="generator" content="Hugo 0.26" />

    
    <meta name="description" content="Complete documentation for ActiveTcl 8.6.9">
    
    <link rel="canonical" href="coroutine.html">
    

    
    <meta name="apple-mobile-web-app-title" content="ActiveTcl 8.6.9 Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('../../fonts/icon.eot');
        src: url('../../fonts/icon.eot')
               format('embedded-opentype'),
             url('../../fonts/icon.woff')
               format('woff'),
             url('../../fonts/icon.ttf')
               format('truetype'),
             url('../../fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../../stylesheets/application.css">
    <link rel="stylesheet" href="../../stylesheets/temporary.css">
    <link rel="stylesheet" href="../../stylesheets/palettes.css">
    <link rel="stylesheet" href="../../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open%20Sans:400,700|Source+Code+Pro">
    <style>
      body, input {
        font-family: 'Open Sans', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="../../stylesheets/as_common.css">
    
    <link rel="stylesheet" href="../../stylesheets/as_custom.css">
    
    <script src="../../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-grey palette-accent-red">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="logo">
        <a href="http://www.activestate.com/">
          <img src="../../images/logo.png" alt="ActiveState homepage">
        </a>
      </div>
      <div class="title">
        <a href="http://docs.activestate.com/">docs.activestate.com</a>
      </div>
    </div>

    

    
    
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>

</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="../../index.html" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../images/as_tcl.png">
        </div>
      
      <div class="name">
        <strong>ActiveTcl 8.6.9 Documentation </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  



<a  title="Get ActiveTcl" href="../../get/index.html">
	
	Get ActiveTcl
</a>



  
    <ul>
      
        
        



<a  title="Release notes" href="../../get/relnotes/index.html">
	
	Release notes
</a>



      
        
        



<a  title="Windows installation" href="../../get/windows/index.html">
	
	Windows installation
</a>



      
        
        



<a  title="Linux/Unix Installaton" href="../../get/linux/index.html">
	
	Linux/Unix Installaton
</a>



      
        
        



<a  title="macOS Installation" href="../../get/macos/index.html">
	
	macOS Installation
</a>



      
        
        



<a  title="License" href="../../get/license/index.html">
	
	License
</a>



      
    </ul>
  
</li>



<li>
  



<a  title="Get Started" href="../../start/index.html">
	
	Get Started
</a>



  
    <ul>
      
        
        



<a  title="Package Reference" href="../../pkg/index.html">
	
	Package Reference
</a>



      
        
        



<a  title="Tcl 8.6.9 docs" href="../contents.html">
	
	Tcl 8.6.9 docs
</a>



      
    </ul>
  
</li>



<li>
  



<a  title="Contact Us" href="../../contact/index.html">
	
	Contact Us
</a>



  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1> </h1>

			<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD><TITLE>coroutine manual page - Tcl Built-In Commands</TITLE>
<link rel="stylesheet" href="../docs.css" type="text/css" media="all">
</HEAD>
<BODY><H2><a href="../contents.html">Tcl8.6.9/Tk8.6.9 Documentation</a> <small>&gt;</small> <a href="contents.html">Tcl Commands, version 8.6.9</a> <small>&gt;</small> coroutine</H2>
<H3><A HREF="../UserCmd/contents.html">Tcl/Tk Applications</A> | <A HREF="contents.html">Tcl Commands</A> | <A HREF="../TkCmd/contents.html">Tk Commands</A> | <A HREF="../ItclCmd/contents.html">[incr Tcl] Package Commands</A> | <A HREF="../SqliteCmd/contents.html">SQLite3 Package Commands</A> | <A HREF="../TdbcCmd/contents.html">TDBC Package Commands</A> | <A HREF="../TdbcmysqlCmd/contents.html">tdbc::mysql Package Commands</A> | <A HREF="../TdbcodbcCmd/contents.html">tdbc::odbc Package Commands</A> | <A HREF="../TdbcpostgresCmd/contents.html">tdbc::postgres Package Commands</A> | <A HREF="../TdbcsqliteCmd/contents.html">tdbc::sqlite3 Package Commands</A> | <A HREF="../ThreadCmd/contents.html">Thread Package Commands</A> | <A HREF="../TclLib/contents.html">Tcl C API</A> | <A HREF="../TkLib/contents.html">Tk C API</A> | <A HREF="../ItclLib/contents.html">[incr Tcl] Package C API</A> | <A HREF="../TdbcLib/contents.html">TDBC Package C API</A></H3>
<H3><A NAME="M2">NAME</A></H3>
coroutine, yield, yieldto &mdash; Create and produce values from coroutines
<H3><A NAME="M3">SYNOPSIS</A></H3>
<B>coroutine </B><I>name command</I> ?<I>arg...</I>?<BR>
<B>yield</B> ?<I>value</I>?<BR>
<B>yieldto</B> <I>command</I> ?<I>arg...</I>?<BR>
<I>name</I> ?<I>value...</I>?<BR>
<H3><A NAME="M4">DESCRIPTION</A></H3>
The <B>coroutine</B> command creates a new coroutine context (with associated
command) named <I>name</I> and executes that context by calling <I>command</I>,
passing in the other remaining arguments without further interpretation. Once
<I>command</I> returns normally or with an exception (e.g., an error) the
coroutine context <I>name</I> is deleted.
<P>
Within the context, values may be generated as results by using the
<B>yield</B> command; if no <I>value</I> is supplied, the empty string is used.
When that is called, the context will suspend execution and the
<B>coroutine</B> command will return the argument to <B>yield</B>. The execution
of the context can then be resumed by calling the context command, optionally
passing in the <I>single</I> value to use as the result of the <B>yield</B> call
that caused
the context to be suspended. If the coroutine context never yields and instead
returns conventionally, the result of the <B>coroutine</B> command will be the
result of the evaluation of the context.
<P>
The coroutine may also suspend its execution by use of the <B>yieldto</B>
command, which instead of returning, cedes execution to some command called
<I>command</I> (resolved in the context of the coroutine) and to which <I>any
number</I> of arguments may be passed. Since every coroutine has a context
command, <B>yieldto</B> can be used to transfer control directly from one
coroutine to another (this is only advisable if the two coroutines are
expecting this to happen) but <I>any</I> command may be the target. If a
coroutine is suspended by this mechanism, the coroutine processing can be
resumed by calling the context command optionally passing in an arbitrary
number of arguments. The return value of the <B>yieldto</B> call will be the
list of arguments passed to the context command; it is up to the caller to
decide what to do with those values.
<P>
The recommended way of writing a version of <B>yield</B> that allows resumption
with multiple arguments is by using <B>yieldto</B> and the <B><A HREF="return.html">return</A></B>
command, like this:
<P>
<PRE>proc yieldm {value} {
    <B>yieldto</B> return -level 0 $value
}</PRE>
<P>
The coroutine can also be deleted by destroying the command <I>name</I>, and
the name of the current coroutine can be retrieved by using
<B><A HREF="info.html">info coroutine</A></B>.
If there are deletion traces on variables in the coroutine's
implementation, they will fire at the point when the coroutine is explicitly
deleted (or, naturally, if the command returns conventionally).
<P>
At the point when <I>command</I> is called, the current namespace will be the
global namespace and there will be no stack frames above it (in the sense of
<B><A HREF="upvar.html">upvar</A></B> and <B><A HREF="uplevel.html">uplevel</A></B>). However, which command to call will be
determined in the namespace that the <B>coroutine</B> command was called from.
<H3><A NAME="M5">EXAMPLES</A></H3>
This example shows a coroutine that will produce an infinite sequence of
even values, and a loop that consumes the first ten of them.
<P>
<PRE>proc allNumbers {} {
    <B>yield</B>
    set i 0
    while 1 {
        <B>yield</B> $i
        incr i 2
    }
}
<B>coroutine</B> nextNumber allNumbers
for {set i 0} {$i &lt; 10} {incr i} {
    puts &quot;received [<I>nextNumber</I>]&quot;
}
rename nextNumber {}</PRE>
<P>
In this example, the coroutine acts to add up the arguments passed to it.
<P>
<PRE><B>coroutine</B> accumulator apply {{} {
    set x 0
    while 1 {
        incr x [<B>yield</B> $x]
    }
}}
for {set i 0} {$i &lt; 10} {incr i} {
    puts &quot;$i -&gt; [<I>accumulator</I> $i]&quot;
}</PRE>
<P>
This example demonstrates the use of coroutines to implement the classic Sieve
of Eratosthenes algorithm for finding prime numbers. Note the creation of
coroutines inside a coroutine.
<P>
<PRE>proc filterByFactor {source n} {
    <B>yield</B> [info coroutine]
    while 1 {
        set x [<I>$source</I>]
        if {$x % $n} {
            <B>yield</B> $x
        }
    }
}
<B>coroutine</B> allNumbers apply {{} {while 1 {<B>yield</B> [incr x]}}}
<B>coroutine</B> eratosthenes apply {c {
    <B>yield</B>
    while 1 {
        set n [<I>$c</I>]
        <B>yield</B> $n
        set c [<B>coroutine</B> prime$n filterByFactor $c $n]
    }
}} allNumbers
for {set i 1} {$i &lt;= 20} {incr i} {
    puts &quot;prime#$i = [<I>eratosthenes</I>]&quot;
}</PRE>
<P>
This example shows how a value can be passed around a group of three
coroutines that yield to each other:
<P>
<PRE>proc juggler {name target {value &quot;&quot;}} {
    if {$value eq &quot;&quot;} {
        set value [<B>yield</B> [info coroutine]]
    }
    while {$value ne &quot;&quot;} {
        puts &quot;$name : $value&quot;
        set value [string range $value 0 end-1]
        lassign [<B>yieldto</B> $target $value] value
    }
}
<B>coroutine</B> j1 juggler Larry [
    <B>coroutine</B> j2 juggler Curly [
        <B>coroutine</B> j3 juggler Moe j1]] &quot;Nyuck!Nyuck!Nyuck!&quot;</PRE>
<H4><A NAME="M6">DETAILED SEMANTICS</A></H4>
This example demonstrates that coroutines start from the global namespace, and
that <I>command</I> resolution happens before the coroutine stack is created.
<P>
<PRE>proc report {where level} {
    # Where was the caller called from?
    set ns [uplevel 2 {namespace current}]
    <B>yield</B> &quot;made $where $level context=$ns name=[info coroutine]&quot;
}
proc example {} {
    report outer [info level]
}
namespace eval demo {
    proc example {} {
        report inner [info level]
    }
    proc makeExample {} {
        puts &quot;making from [info level]&quot;
        puts [<B>coroutine</B> coroEg example]
    }
    makeExample
}</PRE>
<P>
Which produces the output below. In particular, we can see that stack
manipulation has occurred (comparing the levels from the first and second
line) and that the parent level in the coroutine is the global namespace. We
can also see that coroutine names are local to the current namespace if not
qualified, and that coroutines may yield at depth (e.g., in called
procedures).
<P>
<PRE>making from 2
made inner 1 context=:: name=::demo::coroEg</PRE>
<H3><A NAME="M7">SEE ALSO</A></H3>
<B><A HREF="apply.html">apply</A></B>, <B><A HREF="info.html">info</A></B>, <B><A HREF="proc.html">proc</A></B>, <B><A HREF="return.html">return</A></B>
<H3><A NAME="M8">KEYWORDS</A></H3>
<A href="../Keywords/C.html#coroutine">coroutine</A>, <A href="../Keywords/G.html#generator">generator</A>
<div class="copy">Copyright &copy; 2009 Donal K. Fellows.
</div>
</BODY></HTML>


			<aside class="copyright" role="note">
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				<div class="as_footer">
  
  <div class="prod_links">
    <strong>
      <a href="http://platform.activestate.com/" target="_blank">ActiveState Platform</a>&nbsp;&nbsp;
      <a href="http://www.activestate.com/downloads" target="_blank">Downloads</a>&nbsp;&nbsp;
      <a href="http://community.activestate.com/" target="_blank">Community</a>&nbsp;&nbsp;
      <a href="http://github.com/activestate/code" target="_blank">Code Recipes</a>&nbsp;&nbsp;
    </strong>
  </div>
  <div class="as_copyright"> 
    &copy; 2019 ActiveState Software Inc. All rights reserved. <strong><a href="../../trademarks/index.html">Trademarks</a>. <a href="http://www.activestate.com/privacy-policy">Privacy Policy</a>.</strong>
  </div>
</div>

			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="../../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "¶";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-20072-24', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="../../javascripts/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

