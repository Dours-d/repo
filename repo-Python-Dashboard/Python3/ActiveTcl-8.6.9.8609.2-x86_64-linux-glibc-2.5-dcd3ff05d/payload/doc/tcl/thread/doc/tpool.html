<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>ActiveTcl 8.6.9 Documentation</title>
    <meta name="generator" content="Hugo 0.26" />

    
    <meta name="description" content="Complete documentation for ActiveTcl 8.6.9">
    
    <link rel="canonical" href="tpool.html">
    

    
    <meta name="apple-mobile-web-app-title" content="ActiveTcl 8.6.9 Documentation">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../../../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../../images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('../../../fonts/icon.eot');
        src: url('../../../fonts/icon.eot')
               format('embedded-opentype'),
             url('../../../fonts/icon.woff')
               format('woff'),
             url('../../../fonts/icon.ttf')
               format('truetype'),
             url('../../../fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="../../../stylesheets/application.css">
    <link rel="stylesheet" href="../../../stylesheets/temporary.css">
    <link rel="stylesheet" href="../../../stylesheets/palettes.css">
    <link rel="stylesheet" href="../../../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open%20Sans:400,700|Source+Code+Pro">
    <style>
      body, input {
        font-family: 'Open Sans', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="../../../stylesheets/as_common.css">
    
    <link rel="stylesheet" href="../../../stylesheets/as_custom.css">
    
    <script src="../../../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-grey palette-accent-red">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="logo">
        <a href="http://www.activestate.com/">
          <img src="../../../images/logo.png" alt="ActiveState homepage">
        </a>
      </div>
      <div class="title">
        <a href="http://docs.activestate.com/">docs.activestate.com</a>
      </div>
    </div>

    

    
    
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>

</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="../../../index.html" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../../../images/as_tcl.png">
        </div>
      
      <div class="name">
        <strong>ActiveTcl 8.6.9 Documentation </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  



<a  title="Get ActiveTcl" href="../../../get/index.html">
	
	Get ActiveTcl
</a>



  
    <ul>
      
        
        



<a  title="Release notes" href="../../../get/relnotes/index.html">
	
	Release notes
</a>



      
        
        



<a  title="Windows installation" href="../../../get/windows/index.html">
	
	Windows installation
</a>



      
        
        



<a  title="Linux/Unix Installaton" href="../../../get/linux/index.html">
	
	Linux/Unix Installaton
</a>



      
        
        



<a  title="macOS Installation" href="../../../get/macos/index.html">
	
	macOS Installation
</a>



      
        
        



<a  title="License" href="../../../get/license/index.html">
	
	License
</a>



      
    </ul>
  
</li>



<li>
  



<a  title="Get Started" href="../../../start/index.html">
	
	Get Started
</a>



  
    <ul>
      
        
        



<a  title="Package Reference" href="../../../pkg/index.html">
	
	Package Reference
</a>



      
        
        



<a  title="Tcl 8.6.9 docs" href="../../contents.html">
	
	Tcl 8.6.9 docs
</a>



      
    </ul>
  
</li>



<li>
  



<a  title="Contact Us" href="../../../contact/index.html">
	
	Contact Us
</a>



  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1> </h1>

			<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<title>tpool - Tcl Threading</title>
<meta name='Author' content='ActiveState'>

</head>
<body>
<div class="doctools">


<hr>
[ <a
href="../toc.html">Thread Table Of Contents</a> | <a href=
"../index.html">Thread Index</a> ] 

<hr>
<h1 class="title">tpool(n) 2.7 "Tcl Threading"</h1>

<div id="name" class="section">
<h2><a name="name">Name</a></h2>

<p>tpool - Part of the Tcl threading extension implementing pools
of worker threads.</p>
</div>

<div id="toc" class="section">
<h2><a name="toc">Table Of Contents</a></h2>

<ul class="toc">
<li class="section"><a href="tpool.html#toc">Table Of Contents</a></li>

<li class="section"><a href="tpool.html#synopsis">Synopsis</a></li>

<li class="section"><a href="tpool.html#section1">Description</a></li>

<li class="section"><a href="tpool.html#section2">COMMANDS</a></li>

<li class="section"><a href="tpool.html#section3">DISCUSSION</a></li>

<li class="section"><a href="tpool.html#see-also">See Also</a></li>

<li class="section"><a href="tpool.html#keywords">Keywords</a></li>
</ul>
</div>

<div id="synopsis" class="section">
<h2><a name="synopsis">Synopsis</a></h2>

<div class="synopsis">
<ul class="requirements">
<li>package require <b class="pkgname">Tcl 8.4</b></li>

<li>package require <b class="pkgname">Thread <span class=
"opt">?2.7?</span></b></li>
</ul>

<ul class="syntax">
<li><a href="tpool.html#1"><b class="cmd">tpool::create</b> <span class=
"opt">?options?</span></a></li>

<li><a href="tpool.html#2"><b class="cmd">tpool::names</b></a></li>

<li><a href="tpool.html#3"><b class="cmd">tpool::post</b> <span class=
"opt">?-detached?</span> <span class="opt">?-nowait?</span> <i
class="arg">tpool</i> <i class="arg">script</i></a></li>

<li><a href="tpool.html#4"><b class="cmd">tpool::wait</b> <i class=
"arg">tpool</i> <i class="arg">joblist</i> <span class=
"opt">?varname?</span></a></li>

<li><a href="tpool.html#5"><b class="cmd">tpool::cancel</b> <i class=
"arg">tpool</i> <i class="arg">joblist</i> <span class=
"opt">?varname?</span></a></li>

<li><a href="tpool.html#6"><b class="cmd">tpool::get</b> <i class=
"arg">tpool</i> <i class="arg">job</i></a></li>

<li><a href="tpool.html#7"><b class="cmd">tpool::preserve</b> <i class=
"arg">tpool</i></a></li>

<li><a href="tpool.html#8"><b class="cmd">tpool::release</b> <i class=
"arg">tpool</i></a></li>

<li><a href="tpool.html#9"><b class="cmd">tpool::suspend</b> <i class=
"arg">tpool</i></a></li>

<li><a href="tpool.html#10"><b class="cmd">tpool::resume</b> <i class=
"arg">tpool</i></a></li>
</ul>
</div>
</div>

<div id="section1" class="section">
<h2><a name="section1">Description</a></h2>

<p>This package creates and manages pools of worker threads. It
allows you to post jobs to worker threads and wait for their
completion. The threadpool implementation is Tcl event-loop aware.
That means that any time a caller is forced to wait for an event
(job being completed or a worker thread becoming idle or
initialized), the implementation will enter the event loop and
allow for servicing of other pending file or timer (or any other
supported) events.</p>
</div>

<div id="section2" class="section">
<h2><a name="section2">COMMANDS</a></h2>

<dl class="definitions">
<dt><a name="1"><b class="cmd">tpool::create</b> <span class=
"opt">?options?</span></a></dt>

<dd>
<p>This command creates new threadpool. It accepts several options
as key-value pairs. Options are used to tune some threadpool
parameters. The command returns the ID of the newly created
threadpool.</p>

<p>Following options are supported:</p>

<dl class="options">
<dt><b class="option">-minworkers</b> <i class=
"arg">number</i></dt>

<dd>
<p>Minimum number of worker threads needed for this threadpool
instance. During threadpool creation, the implementation will
create somany worker threads upfront and will keep at least number
of them alive during the lifetime of the threadpool instance.
Default value of this parameter is 0 (zero). which means that a
newly threadpool will have no worker threads initialy. All worker
threads will be started on demand by callers running <b class=
"cmd">tpool::post</b> command and posting jobs to the job
queue.</p>
</dd>

<dt><b class="option">-maxworkers</b> <i class=
"arg">number</i></dt>

<dd>
<p>Maximum number of worker threads allowed for this threadpool
instance. If a new job is pending and there are no idle worker
threads available, the implementation will try to create new worker
thread. If the number of available worker threads is lower than the
given number, new worker thread will start. The caller will
automatically enter the event loop and wait until the worker thread
has initialized. If. however, the number of available worker
threads is equal to the given number, the caller will enter the
event loop and wait for the first worker thread to get idle, thus
ready to run the job. Default value of this parameter is 4 (four),
which means that the threadpool instance will allow maximum of 4
worker threads running jobs or being idle waiting for new jobs to
get posted to the job queue.</p>
</dd>

<dt><b class="option">-idletime</b> <i class="arg">seconds</i></dt>

<dd>
<p>Time in seconds an idle worker thread waits for the job to get
posted to the job queue. If no job arrives during this interval and
the time expires, the worker thread will check the number of
currently available worker threads and if the number is higher than
the number set by the <b class="option">minthreads</b> option, it
will exit. If an <b class="option">exitscript</b> has been defined,
the exiting worker thread will first run the script and then exit.
Errors from the exit script, if any, are ignored.</p>

<p>The idle worker thread is not servicing the event loop. If you,
however, put the worker thread into the event loop, by evaluating
the <b class="cmd">vwait</b> or other related Tcl commands, the
worker thread will not be in the idle state, hence the idle timer
will not be taken into account. Default value for this option is
unspecified.</p>
</dd>

<dt><b class="option">-initcmd</b> <i class="arg">script</i></dt>

<dd>
<p>Sets a Tcl script used to initialize new worker thread. This is
usually used to load packages and commands in the worker, set
default variables, create namespaces, and such. If the passed
script runs into a Tcl error, the worker will not be created and
the initiating command (either the <b class="cmd">tpool::create</b>
or <b class="cmd">tpool::post</b>) will throw error. Default value
for this option is unspecified, hence, the Tcl interpreter of the
worker thread will contain just the initial set of Tcl
commands.</p>
</dd>

<dt><b class="option">-exitcmd</b> <i class="arg">script</i></dt>

<dd>
<p>Sets a Tcl script run when the idle worker thread exits. This is
normaly used to cleanup the state of the worker thread, release
reserved resources, cleanup memory and such. Default value for this
option is unspecified, thus no Tcl script will run on the worker
thread exit.</p>
</dd>
</dl>
</dd>

<dt><a name="2"><b class="cmd">tpool::names</b></a></dt>

<dd>
<p>This command returns a list of IDs of threadpools created with
the <b class="cmd">tpool::create</b> command. If no threadpools
were found, the command will return empty list.</p>
</dd>

<dt><a name="3"><b class="cmd">tpool::post</b> <span class=
"opt">?-detached?</span> <span class="opt">?-nowait?</span> <i
class="arg">tpool</i> <i class="arg">script</i></a></dt>

<dd>
<p>This command sends a <i class="arg">script</i> to the target <i
class="arg">tpool</i> threadpool for execution. The script will be
executed in the first available idle worker thread. If there are no
idle worker threads available, the command will create new one,
enter the event loop and service events until the newly created
thread is initialized. If the current number of worker threads is
equal to the maximum number of worker threads, as defined during
the threadpool creation, the command will enter the event loop and
service events while waiting for one of the worker threads to
become idle. If the optional <span class="opt">?-nowait?</span>
argument is given, the command will not wait for one idle worker.
It will just place the job in the pool's job queue and return
immediately.</p>

<p>The command returns the ID of the posted job. This ID is used
for subsequent <b class="cmd">tpool::wait</b>, <b class=
"cmd">tpool::get</b> and <b class="cmd">tpool::cancel</b> commands
to wait for and retrieve result of the posted script, or cancel the
posted job respectively. If the optional <span class=
"opt">?-detached?</span> argument is specified, the command will
post a detached job. A detached job can not be cancelled or waited
upon and is not identified by the job ID.</p>

<p>If the threadpool <i class="arg">tpool</i> is not found in the
list of active thread pools, the command will throw error. The
error will also be triggered if the newly created worker thread
fails to initialize.</p>
</dd>

<dt><a name="4"><b class="cmd">tpool::wait</b> <i class=
"arg">tpool</i> <i class="arg">joblist</i> <span class=
"opt">?varname?</span></a></dt>

<dd>
<p>This command waits for one or many jobs, whose job IDs are given
in the <i class="arg">joblist</i> to get processed by the worker
thread(s). If none of the specified jobs are ready, the command
will enter the event loop, service events and wait for the first
job to get ready.</p>

<p>The command returns the list of completed job IDs. If the
optional variable <span class="opt">?varname?</span> is given, it
will be set to the list of jobs in the <i class="arg">joblist</i>
which are still pending. If the threadpool <i class="arg">tpool</i>
is not found in the list of active thread pools, the command will
throw error.</p>
</dd>

<dt><a name="5"><b class="cmd">tpool::cancel</b> <i class=
"arg">tpool</i> <i class="arg">joblist</i> <span class=
"opt">?varname?</span></a></dt>

<dd>
<p>This command cancels the previously posted jobs given by the <i
class="arg">joblist</i> to the pool <i class="arg">tpool</i>. Job
cancellation succeeds only for job still waiting to be processed.
If the job is already being executed by one of the worker threads,
the job will not be cancelled. The command returns the list of
cancelled job IDs. If the optional variable <span class=
"opt">?varname?</span> is given, it will be set to the list of jobs
in the <i class="arg">joblist</i> which were not cancelled. If the
threadpool <i class="arg">tpool</i> is not found in the list of
active thread pools, the command will throw error.</p>
</dd>

<dt><a name="6"><b class="cmd">tpool::get</b> <i class=
"arg">tpool</i> <i class="arg">job</i></a></dt>

<dd>
<p>This command retrieves the result of the previously posted <i
class="arg">job</i>. Only results of jobs waited upon with the <b
class="cmd">tpool::wait</b> command can be retrieved. If the
execution of the script resulted in error, the command will throw
the error and update the <b class="variable">errorInfo</b> and <b
class="variable">errorCode</b> variables correspondingly. If the
pool <i class="arg">tpool</i> is not found in the list of
threadpools, the command will throw error. If the job <i class=
"arg">job</i> is not ready for retrieval, because it is currently
being executed by the worker thread, the command will throw
error.</p>
</dd>

<dt><a name="7"><b class="cmd">tpool::preserve</b> <i class=
"arg">tpool</i></a></dt>

<dd>
<p>Each call to this command increments the reference counter of
the threadpool <i class="arg">tpool</i> by one (1). Command returns
the value of the reference counter after the increment. By
incrementing the reference counter, the caller signalizes that
he/she wishes to use the resource for a longer period of time.</p>
</dd>

<dt><a name="8"><b class="cmd">tpool::release</b> <i class=
"arg">tpool</i></a></dt>

<dd>
<p>Each call to this command decrements the reference counter of
the threadpool <i class="arg">tpool</i> by one (1).Command returns
the value of the reference counter after the decrement. When the
reference counter reaches zero (0), the threadpool <i class=
"arg">tpool</i> is marked for termination. You should not reference
the threadpool after the <b class="cmd">tpool::release</b> command
returns zero. The <i class="arg">tpool</i> handle goes out of scope
and should not be used any more. Any following reference to the
same threadpool handle will result in Tcl error.</p>
</dd>

<dt><a name="9"><b class="cmd">tpool::suspend</b> <i class=
"arg">tpool</i></a></dt>

<dd>
<p>Suspends processing work on this queue. All pool workers are
paused but additional work can be added to the pool. Note that
adding the additional work will not increase the number of workers
dynamically as the pool processing is suspended. Number of workers
is maintained to the count that was found prior suspending worker
activity. If you need to assure certain number of worker threads,
use the <b class="option">minworkers</b> option of the <b class=
"cmd">tpool::create</b> command.</p>
</dd>

<dt><a name="10"><b class="cmd">tpool::resume</b> <i class=
"arg">tpool</i></a></dt>

<dd>
<p>Resume processing work on this queue. All paused (suspended)
workers are free to get work from the pool. Note that resuming pool
operation will just let already created workers to proceed. It will
not create additional worker threads to handle the work posted to
the pool's work queue.</p>
</dd>
</dl>
</div>

<div id="section3" class="section">
<h2><a name="section3">DISCUSSION</a></h2>

<p>Threadpool is one of the most common threading paradigm when it
comes to server applications handling a large number of relatively
small tasks. A very simplistic model for building a server
application would be to create a new thread each time a request
arrives and service the request in the new thread. One of the
disadvantages of this approach is that the overhead of creating a
new thread for each request is significant; a server that created a
new thread for each request would spend more time and consume more
system resources in creating and destroying threads than in
processing actual user requests. In addition to the overhead of
creating and destroying threads, active threads consume system
resources. Creating too many threads can cause the system to run
out of memory or trash due to excessive memory consumption.</p>

<p>A thread pool offers a solution to both the problem of thread
life-cycle overhead and the problem of resource trashing. By
reusing threads for multiple tasks, the thread-creation overhead is
spread over many tasks. As a bonus, because the thread already
exists when a request arrives, the delay introduced by thread
creation is eliminated. Thus, the request can be serviced
immediately. Furthermore, by properly tuning the number of threads
in the thread pool, resource thrashing may also be eliminated by
forcing any request to wait until a thread is available to process
it.</p>
</div>

<div id="see-also" class="section">
<h2><a name="see-also">See Also</a></h2>

<p><a href="thread.html">thread</a>, <a href="tsv.html">tsv</a>, <a
href="ttrace.html">ttrace</a></p>
</div>

<div id="keywords" class="section">
<h2><a name="keywords">Keywords</a></h2>

<p><a href="../index.html#key7">thread</a>, <a href=
"../index.html#key9">threadpool</a></p>
</div>

<h4>Copyright &copy; 2015 <a href="http://www.activestate.com">for
compilation: ActiveState</a></h4>
</div>
</body>
</html>



			<aside class="copyright" role="note">
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				<div class="as_footer">
  
  <div class="prod_links">
    <strong>
      <a href="http://platform.activestate.com/" target="_blank">ActiveState Platform</a>&nbsp;&nbsp;
      <a href="http://www.activestate.com/downloads" target="_blank">Downloads</a>&nbsp;&nbsp;
      <a href="http://community.activestate.com/" target="_blank">Community</a>&nbsp;&nbsp;
      <a href="http://github.com/activestate/code" target="_blank">Code Recipes</a>&nbsp;&nbsp;
    </strong>
  </div>
  <div class="as_copyright"> 
    &copy; 2019 ActiveState Software Inc. All rights reserved. <strong><a href="../../../trademarks/index.html">Trademarks</a>. <a href="http://www.activestate.com/privacy-policy">Privacy Policy</a>.</strong>
  </div>
</div>

			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="../../../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "¶";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-20072-24', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="../../../javascripts/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

